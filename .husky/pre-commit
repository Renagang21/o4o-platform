#!/bin/sh

# Check if any package.json was modified
PACKAGE_JSON_CHANGED=$(git diff --cached --name-only | grep -E "package\.json$" || true)

if [ -n "$PACKAGE_JSON_CHANGED" ]; then
  echo "ðŸ“¦ package.json changed, updating lockfile..."

  # Try pnpm directly, fall back to npx pnpm
  if command -v pnpm >/dev/null 2>&1; then
    pnpm install --no-frozen-lockfile
  else
    echo "âš ï¸ pnpm not found directly, trying npx..."
    npx pnpm@9 install --no-frozen-lockfile || echo "âš ï¸ Lockfile update skipped - update manually if needed"
  fi

  # Only stage if lockfile exists and was modified
  if [ -f "pnpm-lock.yaml" ]; then
    git add pnpm-lock.yaml 2>/dev/null || true
    echo "âœ… Lockfile updated and staged"
  fi
fi
