# ÎìúÎ°≠Ïâ¨Ìïë API ÏÑúÎ≤Ñ Íµ¨ÌòÑ ÏöîÍµ¨ÏÇ¨Ìï≠

## üìã Í∞úÏöî
Ïù¥ Î¨∏ÏÑúÎäî ÎìúÎ°≠Ïâ¨Ìïë ÌîåÎû´ÌèºÏùò API ÏÑúÎ≤ÑÏóêÏÑú Íµ¨ÌòÑÌï¥Ïïº Ìï† Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïä§ÌÇ§Îßà, API ÏóîÎìúÌè¨Ïù∏Ìä∏, ÎπÑÏ¶àÎãàÏä§ Î°úÏßÅÏùÑ Ï†ïÏùòÌï©ÎãàÎã§.

## üóÑÔ∏è Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïä§ÌÇ§Îßà

### 1. ÏÇ¨Ïö©Ïûê Ïó≠Ìï† Í¥ÄÎ†® ÌÖåÏù¥Î∏î

#### dropshipping_suppliers (Í≥µÍ∏âÏûê)
```sql
CREATE TABLE dropshipping_suppliers (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  company_name VARCHAR(255) NOT NULL,
  business_registration VARCHAR(100),
  tax_id VARCHAR(100),
  description TEXT,
  logo_url VARCHAR(500),
  website VARCHAR(500),
  phone VARCHAR(50),
  email VARCHAR(255),
  address JSONB,
  verification_status ENUM('pending', 'verified', 'rejected', 'suspended') DEFAULT 'pending',
  verification_date TIMESTAMP,
  commission_rate DECIMAL(5,2) DEFAULT 10.00,
  minimum_order_amount DECIMAL(10,2) DEFAULT 0,
  shipping_methods JSONB,
  return_policy TEXT,
  rating DECIMAL(3,2) DEFAULT 0,
  total_sales INTEGER DEFAULT 0,
  total_revenue DECIMAL(15,2) DEFAULT 0,
  settings JSONB DEFAULT '{}',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_suppliers_user_id ON dropshipping_suppliers(user_id);
CREATE INDEX idx_suppliers_verification ON dropshipping_suppliers(verification_status);
```

#### dropshipping_sellers (ÌåêÎß§Ïûê)
```sql
CREATE TABLE dropshipping_sellers (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  store_name VARCHAR(255) NOT NULL,
  store_url VARCHAR(500),
  business_type ENUM('individual', 'company') DEFAULT 'individual',
  business_registration VARCHAR(100),
  description TEXT,
  logo_url VARCHAR(500),
  verification_status ENUM('pending', 'verified', 'rejected', 'suspended') DEFAULT 'pending',
  verification_date TIMESTAMP,
  tier_level ENUM('bronze', 'silver', 'gold', 'platinum') DEFAULT 'bronze',
  commission_rate DECIMAL(5,2) DEFAULT 15.00,
  total_sales INTEGER DEFAULT 0,
  total_revenue DECIMAL(15,2) DEFAULT 0,
  total_profit DECIMAL(15,2) DEFAULT 0,
  rating DECIMAL(3,2) DEFAULT 0,
  marketplace_connections JSONB DEFAULT '[]',
  payment_methods JSONB DEFAULT '[]',
  settings JSONB DEFAULT '{}',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_sellers_user_id ON dropshipping_sellers(user_id);
CREATE INDEX idx_sellers_tier ON dropshipping_sellers(tier_level);
```

#### dropshipping_affiliates (Ï†úÌú¥Ïûê)
```sql
CREATE TABLE dropshipping_affiliates (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  affiliate_code VARCHAR(50) UNIQUE NOT NULL,
  name VARCHAR(255),
  website VARCHAR(500),
  social_media JSONB,
  tier_level ENUM('bronze', 'silver', 'gold', 'platinum') DEFAULT 'bronze',
  commission_rate DECIMAL(5,2) DEFAULT 10.00,
  parent_affiliate_id UUID REFERENCES dropshipping_affiliates(id),
  total_clicks INTEGER DEFAULT 0,
  total_conversions INTEGER DEFAULT 0,
  total_revenue DECIMAL(15,2) DEFAULT 0,
  total_commission_earned DECIMAL(15,2) DEFAULT 0,
  total_commission_paid DECIMAL(15,2) DEFAULT 0,
  pending_commission DECIMAL(15,2) DEFAULT 0,
  payout_threshold DECIMAL(10,2) DEFAULT 50.00,
  payout_schedule ENUM('weekly', 'biweekly', 'monthly', 'on_demand') DEFAULT 'monthly',
  payment_methods JSONB DEFAULT '[]',
  settings JSONB DEFAULT '{}',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_affiliates_user_id ON dropshipping_affiliates(user_id);
CREATE INDEX idx_affiliates_code ON dropshipping_affiliates(affiliate_code);
CREATE INDEX idx_affiliates_parent ON dropshipping_affiliates(parent_affiliate_id);
```

### 2. Ï†úÌíà Í¥ÄÎ†® ÌÖåÏù¥Î∏î

#### dropshipping_products (Í≥µÍ∏âÏûê Ï†úÌíà)
```sql
CREATE TABLE dropshipping_products (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  supplier_id UUID REFERENCES dropshipping_suppliers(id) ON DELETE CASCADE,
  sku VARCHAR(100) NOT NULL,
  name VARCHAR(500) NOT NULL,
  description TEXT,
  category_id INTEGER REFERENCES categories(id),
  images JSONB DEFAULT '[]',
  base_price DECIMAL(10,2) NOT NULL,
  compare_price DECIMAL(10,2),
  cost DECIMAL(10,2) NOT NULL,
  weight DECIMAL(10,3),
  dimensions JSONB,
  stock_quantity INTEGER DEFAULT 0,
  reserved_quantity INTEGER DEFAULT 0,
  low_stock_threshold INTEGER DEFAULT 10,
  shipping_class VARCHAR(50),
  shipping_time_days INTEGER DEFAULT 3,
  attributes JSONB DEFAULT '{}',
  variations JSONB DEFAULT '[]',
  status ENUM('active', 'inactive', 'out_of_stock') DEFAULT 'active',
  total_sales INTEGER DEFAULT 0,
  rating DECIMAL(3,2) DEFAULT 0,
  review_count INTEGER DEFAULT 0,
  seo_title VARCHAR(255),
  seo_description TEXT,
  tags JSONB DEFAULT '[]',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_products_supplier ON dropshipping_products(supplier_id);
CREATE INDEX idx_products_sku ON dropshipping_products(sku);
CREATE INDEX idx_products_status ON dropshipping_products(status);
CREATE INDEX idx_products_category ON dropshipping_products(category_id);
```

#### dropshipping_seller_products (ÌåêÎß§ÏûêÍ∞Ä Í∞ÄÏ†∏Ïò® Ï†úÌíà)
```sql
CREATE TABLE dropshipping_seller_products (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  seller_id UUID REFERENCES dropshipping_sellers(id) ON DELETE CASCADE,
  product_id UUID REFERENCES dropshipping_products(id) ON DELETE CASCADE,
  supplier_id UUID REFERENCES dropshipping_suppliers(id),
  custom_sku VARCHAR(100),
  custom_name VARCHAR(500),
  custom_description TEXT,
  markup_type ENUM('fixed', 'percentage') DEFAULT 'percentage',
  markup_value DECIMAL(10,2) DEFAULT 30.00,
  selling_price DECIMAL(10,2) NOT NULL,
  auto_sync_price BOOLEAN DEFAULT true,
  auto_sync_stock BOOLEAN DEFAULT true,
  auto_sync_info BOOLEAN DEFAULT false,
  status ENUM('active', 'paused', 'out_of_stock') DEFAULT 'active',
  channels JSONB DEFAULT '[]',
  total_sales INTEGER DEFAULT 0,
  total_revenue DECIMAL(15,2) DEFAULT 0,
  total_profit DECIMAL(15,2) DEFAULT 0,
  last_synced_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_seller_products_seller ON dropshipping_seller_products(seller_id);
CREATE INDEX idx_seller_products_product ON dropshipping_seller_products(product_id);
CREATE INDEX idx_seller_products_status ON dropshipping_seller_products(status);
```

### 3. Ï£ºÎ¨∏ Í¥ÄÎ†® ÌÖåÏù¥Î∏î

#### dropshipping_orders (ÎìúÎ°≠Ïâ¨Ìïë Ï£ºÎ¨∏)
```sql
CREATE TABLE dropshipping_orders (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  order_number VARCHAR(50) UNIQUE NOT NULL,
  ecommerce_order_id INTEGER REFERENCES orders(id),
  seller_id UUID REFERENCES dropshipping_sellers(id),
  supplier_id UUID REFERENCES dropshipping_suppliers(id),
  customer_id INTEGER REFERENCES users(id),
  affiliate_id UUID REFERENCES dropshipping_affiliates(id),
  affiliate_link_id UUID,
  status ENUM('pending', 'confirmed', 'processing', 'shipped', 'delivered', 'cancelled', 'refunded') DEFAULT 'pending',
  items JSONB NOT NULL,
  subtotal DECIMAL(10,2) NOT NULL,
  supplier_cost DECIMAL(10,2) NOT NULL,
  seller_profit DECIMAL(10,2) NOT NULL,
  affiliate_commission DECIMAL(10,2) DEFAULT 0,
  shipping_cost DECIMAL(10,2) DEFAULT 0,
  tax_amount DECIMAL(10,2) DEFAULT 0,
  total_amount DECIMAL(10,2) NOT NULL,
  shipping_address JSONB NOT NULL,
  billing_address JSONB,
  shipping_method VARCHAR(100),
  tracking_number VARCHAR(255),
  carrier VARCHAR(100),
  shipped_at TIMESTAMP,
  delivered_at TIMESTAMP,
  notes TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_dropship_orders_seller ON dropshipping_orders(seller_id);
CREATE INDEX idx_dropship_orders_supplier ON dropshipping_orders(supplier_id);
CREATE INDEX idx_dropship_orders_customer ON dropshipping_orders(customer_id);
CREATE INDEX idx_dropship_orders_affiliate ON dropshipping_orders(affiliate_id);
CREATE INDEX idx_dropship_orders_status ON dropshipping_orders(status);
CREATE INDEX idx_dropship_orders_ecommerce ON dropshipping_orders(ecommerce_order_id);
```

### 4. Ï†úÌú¥ Í¥ÄÎ†® ÌÖåÏù¥Î∏î

#### dropshipping_affiliate_links (Ï†úÌú¥ ÎßÅÌÅ¨)
```sql
CREATE TABLE dropshipping_affiliate_links (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  affiliate_id UUID REFERENCES dropshipping_affiliates(id) ON DELETE CASCADE,
  url VARCHAR(500) NOT NULL,
  short_url VARCHAR(255) UNIQUE,
  custom_alias VARCHAR(100),
  product_id UUID REFERENCES dropshipping_products(id),
  category_id INTEGER REFERENCES categories(id),
  campaign_name VARCHAR(255),
  description TEXT,
  utm_source VARCHAR(100),
  utm_medium VARCHAR(100),
  utm_campaign VARCHAR(100),
  qr_code_url VARCHAR(500),
  clicks INTEGER DEFAULT 0,
  unique_clicks INTEGER DEFAULT 0,
  conversions INTEGER DEFAULT 0,
  revenue DECIMAL(15,2) DEFAULT 0,
  commission DECIMAL(15,2) DEFAULT 0,
  platform VARCHAR(50),
  is_active BOOLEAN DEFAULT true,
  expires_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_affiliate_links_affiliate ON dropshipping_affiliate_links(affiliate_id);
CREATE INDEX idx_affiliate_links_product ON dropshipping_affiliate_links(product_id);
CREATE INDEX idx_affiliate_links_short ON dropshipping_affiliate_links(short_url);
CREATE INDEX idx_affiliate_links_active ON dropshipping_affiliate_links(is_active);
```

#### dropshipping_commissions (ÏàòÏàòÎ£å)
```sql
CREATE TABLE dropshipping_commissions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  affiliate_id UUID REFERENCES dropshipping_affiliates(id),
  order_id UUID REFERENCES dropshipping_orders(id),
  link_id UUID REFERENCES dropshipping_affiliate_links(id),
  product_id UUID REFERENCES dropshipping_products(id),
  order_amount DECIMAL(10,2) NOT NULL,
  commission_rate DECIMAL(5,2) NOT NULL,
  commission_amount DECIMAL(10,2) NOT NULL,
  tier_level VARCHAR(20),
  status ENUM('pending', 'approved', 'paid', 'cancelled') DEFAULT 'pending',
  approved_at TIMESTAMP,
  paid_at TIMESTAMP,
  payout_id UUID,
  notes TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_commissions_affiliate ON dropshipping_commissions(affiliate_id);
CREATE INDEX idx_commissions_order ON dropshipping_commissions(order_id);
CREATE INDEX idx_commissions_status ON dropshipping_commissions(status);
CREATE INDEX idx_commissions_payout ON dropshipping_commissions(payout_id);
```

#### dropshipping_payouts (ÏßÄÍ∏â)
```sql
CREATE TABLE dropshipping_payouts (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  request_number VARCHAR(50) UNIQUE NOT NULL,
  affiliate_id UUID REFERENCES dropshipping_affiliates(id),
  amount DECIMAL(10,2) NOT NULL,
  fee DECIMAL(10,2) DEFAULT 0,
  net_amount DECIMAL(10,2) NOT NULL,
  method VARCHAR(50) NOT NULL,
  account_details JSONB,
  status ENUM('pending', 'processing', 'completed', 'failed', 'cancelled') DEFAULT 'pending',
  transaction_id VARCHAR(255),
  processed_at TIMESTAMP,
  notes TEXT,
  failure_reason TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_payouts_affiliate ON dropshipping_payouts(affiliate_id);
CREATE INDEX idx_payouts_status ON dropshipping_payouts(status);
```

## üîå API ÏóîÎìúÌè¨Ïù∏Ìä∏

### 1. Ïù∏Ï¶ù Î∞è Ïó≠Ìï† Í¥ÄÎ¶¨

```typescript
// Ïó≠Ìï† Ïã†Ï≤≠/Í≤ÄÏ¶ù
POST   /api/v1/dropshipping/apply-role
POST   /api/v1/dropshipping/verify-role
GET    /api/v1/dropshipping/my-roles
POST   /api/v1/dropshipping/switch-role

// Í∂åÌïú ÌôïÏù∏
GET    /api/v1/dropshipping/permissions
POST   /api/v1/dropshipping/check-permission
```

### 2. Í≥µÍ∏âÏûê(Supplier) API

```typescript
// Ï†úÌíà Í¥ÄÎ¶¨
GET    /api/v1/dropshipping/supplier/products
POST   /api/v1/dropshipping/supplier/products
PUT    /api/v1/dropshipping/supplier/products/:id
DELETE /api/v1/dropshipping/supplier/products/:id
POST   /api/v1/dropshipping/supplier/products/bulk-upload
PUT    /api/v1/dropshipping/supplier/products/bulk-update

// Ïû¨Í≥† Í¥ÄÎ¶¨
GET    /api/v1/dropshipping/supplier/inventory
PUT    /api/v1/dropshipping/supplier/inventory/:productId
POST   /api/v1/dropshipping/supplier/inventory/bulk-update
GET    /api/v1/dropshipping/supplier/inventory/alerts

// Ï£ºÎ¨∏ Ï≤òÎ¶¨
GET    /api/v1/dropshipping/supplier/orders
GET    /api/v1/dropshipping/supplier/orders/:id
PUT    /api/v1/dropshipping/supplier/orders/:id/status
POST   /api/v1/dropshipping/supplier/orders/:id/ship
POST   /api/v1/dropshipping/supplier/orders/:id/tracking
GET    /api/v1/dropshipping/supplier/orders/:id/label

// Î∂ÑÏÑù Î∞è Î≥¥Í≥†ÏÑú
GET    /api/v1/dropshipping/supplier/analytics
GET    /api/v1/dropshipping/supplier/reports
GET    /api/v1/dropshipping/supplier/best-sellers
```

### 3. ÌåêÎß§Ïûê(Seller) API

```typescript
// Ï†úÌíà ÎßàÏºìÌîåÎ†àÏù¥Ïä§
GET    /api/v1/dropshipping/seller/marketplace
GET    /api/v1/dropshipping/seller/marketplace/search
GET    /api/v1/dropshipping/seller/marketplace/product/:id
POST   /api/v1/dropshipping/seller/products/import
POST   /api/v1/dropshipping/seller/products/bulk-import

// ÎÇ¥ Ï†úÌíà Í¥ÄÎ¶¨
GET    /api/v1/dropshipping/seller/products
PUT    /api/v1/dropshipping/seller/products/:id
DELETE /api/v1/dropshipping/seller/products/:id
PUT    /api/v1/dropshipping/seller/products/:id/pricing
PUT    /api/v1/dropshipping/seller/products/:id/status
POST   /api/v1/dropshipping/seller/products/:id/sync
PUT    /api/v1/dropshipping/seller/products/bulk-pricing

// Ï£ºÎ¨∏ Í¥ÄÎ¶¨
GET    /api/v1/dropshipping/seller/orders
GET    /api/v1/dropshipping/seller/orders/:id
POST   /api/v1/dropshipping/seller/orders/create
GET    /api/v1/dropshipping/seller/orders/:id/tracking

// Î∂ÑÏÑù
GET    /api/v1/dropshipping/seller/analytics
GET    /api/v1/dropshipping/seller/profit-report
```

### 4. Ï†úÌú¥Ïûê(Affiliate) API

```typescript
// ÎßÅÌÅ¨ Í¥ÄÎ¶¨
GET    /api/v1/dropshipping/affiliate/links
POST   /api/v1/dropshipping/affiliate/links
PUT    /api/v1/dropshipping/affiliate/links/:id
DELETE /api/v1/dropshipping/affiliate/links/:id
GET    /api/v1/dropshipping/affiliate/links/:id/stats
POST   /api/v1/dropshipping/affiliate/links/:id/qr

// ÏàòÏàòÎ£å Í¥ÄÎ¶¨
GET    /api/v1/dropshipping/affiliate/commissions
GET    /api/v1/dropshipping/affiliate/commission/summary
GET    /api/v1/dropshipping/affiliate/commission/export
GET    /api/v1/dropshipping/affiliate/performance
GET    /api/v1/dropshipping/affiliate/top-products
GET    /api/v1/dropshipping/affiliate/tier-info

// ÏßÄÍ∏â Í¥ÄÎ¶¨
GET    /api/v1/dropshipping/affiliate/payout/summary
GET    /api/v1/dropshipping/affiliate/payout/accounts
POST   /api/v1/dropshipping/affiliate/payout/accounts
DELETE /api/v1/dropshipping/affiliate/payout/accounts/:id
GET    /api/v1/dropshipping/affiliate/payout/requests
POST   /api/v1/dropshipping/affiliate/payout/request
POST   /api/v1/dropshipping/affiliate/payout/requests/:id/cancel
GET    /api/v1/dropshipping/affiliate/payout/history

// AFFILIATE Ïï± Ïó∞Îèô
POST   /api/v1/dropshipping/affiliate/app/connect
GET    /api/v1/dropshipping/affiliate/app/status
POST   /api/v1/dropshipping/affiliate/app/sync
POST   /api/v1/dropshipping/affiliate/app/webhook
```

### 5. Ï†ÑÏûêÏÉÅÍ±∞Îûò ÌÜµÌï© API

```typescript
// Ï†úÌíà ÎèôÍ∏∞Ìôî
POST   /api/v1/dropshipping/sync/products
POST   /api/v1/dropshipping/sync/inventory
POST   /api/v1/dropshipping/sync/prices
GET    /api/v1/dropshipping/sync/status

// Ï£ºÎ¨∏ ÌîåÎ°úÏö∞
POST   /api/v1/dropshipping/orders/create-from-ecommerce
POST   /api/v1/dropshipping/orders/split-to-suppliers
POST   /api/v1/dropshipping/orders/update-ecommerce-status
POST   /api/v1/dropshipping/orders/sync-tracking

// ÏõπÌõÖ
POST   /api/v1/dropshipping/webhooks/order-created
POST   /api/v1/dropshipping/webhooks/order-updated
POST   /api/v1/dropshipping/webhooks/product-updated
POST   /api/v1/dropshipping/webhooks/inventory-changed
```

## üîÑ Ï†ÑÏûêÏÉÅÍ±∞Îûò ÌÜµÌï© Î°úÏßÅ

### 1. Ï†úÌíà ÌÜµÌï© ÌîåÎ°úÏö∞

```typescript
// Í≥µÍ∏âÏûê Ï†úÌíà ‚Üí Ï†ÑÏûêÏÉÅÍ±∞Îûò Ï†úÌíà
async function syncSupplierProductToEcommerce(supplierId: string, productId: string) {
  // 1. ÎìúÎ°≠Ïâ¨Ìïë Ï†úÌíà Í∞ÄÏ†∏Ïò§Í∏∞
  const dropshipProduct = await getDropshippingProduct(productId);
  
  // 2. Ï†ÑÏûêÏÉÅÍ±∞Îûò Ï†úÌíà ÏÉùÏÑ±/ÏóÖÎç∞Ïù¥Ìä∏
  const ecommerceProduct = {
    name: dropshipProduct.name,
    description: dropshipProduct.description,
    price: dropshipProduct.base_price,
    sku: `DS-${supplierId}-${dropshipProduct.sku}`,
    stock: dropshipProduct.stock_quantity,
    images: dropshipProduct.images,
    category_id: dropshipProduct.category_id,
    meta_data: {
      dropshipping: true,
      supplier_id: supplierId,
      dropship_product_id: productId,
      shipping_time: dropshipProduct.shipping_time_days
    }
  };
  
  // 3. Í∏∞Ï°¥ products ÌÖåÏù¥Î∏îÏóê Ï†ÄÏû•
  const result = await createOrUpdateProduct(ecommerceProduct);
  
  // 4. Ïó∞Í≤∞ Ï†ïÎ≥¥ Ï†ÄÏû•
  await saveProductMapping(productId, result.id);
  
  return result;
}
```

### 2. Ï£ºÎ¨∏ Ï≤òÎ¶¨ ÌîåÎ°úÏö∞

```typescript
// Ï†ÑÏûêÏÉÅÍ±∞Îûò Ï£ºÎ¨∏ ‚Üí ÎìúÎ°≠Ïâ¨Ìïë Ï£ºÎ¨∏
async function processDropshippingOrder(orderId: number) {
  // 1. Ï†ÑÏûêÏÉÅÍ±∞Îûò Ï£ºÎ¨∏ Í∞ÄÏ†∏Ïò§Í∏∞
  const order = await getEcommerceOrder(orderId);
  
  // 2. ÎìúÎ°≠Ïâ¨Ìïë Ï†úÌíà ÌôïÏù∏
  const dropshipItems = await identifyDropshipItems(order.items);
  
  if (dropshipItems.length === 0) return;
  
  // 3. Í≥µÍ∏âÏûêÎ≥ÑÎ°ú Ï£ºÎ¨∏ Î∂ÑÌï†
  const supplierOrders = await splitOrderBySupplier(dropshipItems);
  
  // 4. Í∞Å Í≥µÍ∏âÏûêÏóêÍ≤å Ï£ºÎ¨∏ ÏÉùÏÑ±
  for (const supplierOrder of supplierOrders) {
    const dropshipOrder = await createDropshippingOrder({
      ecommerce_order_id: orderId,
      supplier_id: supplierOrder.supplier_id,
      seller_id: supplierOrder.seller_id,
      items: supplierOrder.items,
      shipping_address: order.shipping_address,
      // ... Í∏∞ÌÉÄ Ï£ºÎ¨∏ Ï†ïÎ≥¥
    });
    
    // 5. Í≥µÍ∏âÏûêÏóêÍ≤å ÏïåÎ¶º
    await notifySupplier(dropshipOrder);
    
    // 6. Ï†úÌú¥ ÏàòÏàòÎ£å Í≥ÑÏÇ∞
    if (order.affiliate_code) {
      await calculateAffiliateCommission(dropshipOrder, order.affiliate_code);
    }
  }
  
  // 7. Ï£ºÎ¨∏ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
  await updateOrderStatus(orderId, 'processing');
}
```

### 3. Ïû¨Í≥† ÎèôÍ∏∞Ìôî

```typescript
// Ïã§ÏãúÍ∞Ñ Ïû¨Í≥† ÎèôÍ∏∞Ìôî
async function syncInventory(productId: string) {
  // 1. ÎìúÎ°≠Ïâ¨Ìïë Ï†úÌíà Ïû¨Í≥† ÌôïÏù∏
  const dropshipProduct = await getDropshippingProduct(productId);
  
  // 2. Ïó∞Í≤∞Îêú Î™®Îì† Ï†ÑÏûêÏÉÅÍ±∞Îûò Ï†úÌíà Ï∞æÍ∏∞
  const linkedProducts = await getLinkedEcommerceProducts(productId);
  
  // 3. Í∞Å Ï†úÌíàÏùò Ïû¨Í≥† ÏóÖÎç∞Ïù¥Ìä∏
  for (const linkedProduct of linkedProducts) {
    // ÌåêÎß§ÏûêÏùò ÎßàÌÅ¨ÏóÖ Í≥†Î†§
    const sellerProduct = await getSellerProduct(linkedProduct.seller_id, productId);
    
    if (sellerProduct.auto_sync_stock) {
      await updateProductStock(linkedProduct.ecommerce_product_id, {
        stock: dropshipProduct.stock_quantity - dropshipProduct.reserved_quantity,
        low_stock_alert: dropshipProduct.stock_quantity <= dropshipProduct.low_stock_threshold
      });
    }
  }
  
  // 4. Ïû¨Í≥† Î∂ÄÏ°± ÏïåÎ¶º
  if (dropshipProduct.stock_quantity <= dropshipProduct.low_stock_threshold) {
    await sendLowStockAlert(productId);
  }
}
```

## üéØ Í¥ÄÎ¶¨Ïûê Í∏∞Îä• ÌÜµÌï©

### 1. Í∏∞Ï°¥ Í¥ÄÎ¶¨Ïûê Î©îÎâ¥Ïóê ÎìúÎ°≠Ïâ¨Ìïë Ï∂îÍ∞Ä

```typescript
// Í¥ÄÎ¶¨Ïûê Î©îÎâ¥ ÌôïÏû•
const adminMenuExtensions = {
  // Ï†úÌíà Í¥ÄÎ¶¨Ïóê Ï∂îÍ∞Ä
  products: {
    submenu: [
      { title: 'ÎìúÎ°≠Ïâ¨Ìïë Ï†úÌíà', path: '/admin/products/dropshipping' },
      { title: 'Í≥µÍ∏âÏûê Ï†úÌíà ÏäπÏù∏', path: '/admin/products/supplier-approval' },
      { title: 'Ï†úÌíà Îß§Ìïë Í¥ÄÎ¶¨', path: '/admin/products/mapping' }
    ]
  },
  
  // Ï£ºÎ¨∏ Í¥ÄÎ¶¨Ïóê Ï∂îÍ∞Ä
  orders: {
    submenu: [
      { title: 'ÎìúÎ°≠Ïâ¨Ìïë Ï£ºÎ¨∏', path: '/admin/orders/dropshipping' },
      { title: 'Í≥µÍ∏âÏûêÎ≥Ñ Ï£ºÎ¨∏', path: '/admin/orders/by-supplier' },
      { title: 'Î∞∞ÏÜ° Ï∂îÏ†Å', path: '/admin/orders/tracking' }
    ]
  },
  
  // ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨Ïóê Ï∂îÍ∞Ä
  users: {
    submenu: [
      { title: 'Í≥µÍ∏âÏûê Í¥ÄÎ¶¨', path: '/admin/users/suppliers' },
      { title: 'ÌåêÎß§Ïûê Í¥ÄÎ¶¨', path: '/admin/users/sellers' },
      { title: 'Ï†úÌú¥Ïûê Í¥ÄÎ¶¨', path: '/admin/users/affiliates' },
      { title: 'Ïó≠Ìï† ÏäπÏù∏', path: '/admin/users/role-approvals' }
    ]
  },
  
  // Î≥¥Í≥†ÏÑúÏóê Ï∂îÍ∞Ä
  reports: {
    submenu: [
      { title: 'ÎìúÎ°≠Ïâ¨Ìïë Îß§Ï∂ú', path: '/admin/reports/dropshipping-revenue' },
      { title: 'Í≥µÍ∏âÏûê Ïã§Ï†Å', path: '/admin/reports/supplier-performance' },
      { title: 'Ï†úÌú¥ ÏàòÏàòÎ£å', path: '/admin/reports/affiliate-commissions' }
    ]
  },
  
  // ÏÑ§Ï†ïÏóê Ï∂îÍ∞Ä
  settings: {
    submenu: [
      { title: 'ÎìúÎ°≠Ïâ¨Ìïë ÏÑ§Ï†ï', path: '/admin/settings/dropshipping' },
      { title: 'ÏàòÏàòÎ£å Ï†ïÏ±Ö', path: '/admin/settings/commission-rates' },
      { title: 'ÏûêÎèôÌôî Í∑úÏπô', path: '/admin/settings/automation' }
    ]
  }
};
```

### 2. Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú ÏúÑÏ†Ø

```typescript
// ÎìúÎ°≠Ïâ¨Ìïë ÎåÄÏãúÎ≥¥Îìú ÏúÑÏ†Ø
const dropshippingDashboardWidgets = [
  {
    id: 'dropship_overview',
    title: 'ÎìúÎ°≠Ïâ¨Ìïë Í∞úÏöî',
    component: 'DropshippingOverviewWidget',
    position: 'top',
    metrics: [
      'active_suppliers',
      'active_sellers',
      'total_dropship_products',
      'pending_approvals'
    ]
  },
  {
    id: 'dropship_orders',
    title: 'ÎìúÎ°≠Ïâ¨Ìïë Ï£ºÎ¨∏ ÌòÑÌô©',
    component: 'DropshippingOrdersWidget',
    position: 'main',
    data: [
      'today_orders',
      'pending_shipments',
      'in_transit',
      'completed_today'
    ]
  },
  {
    id: 'supplier_performance',
    title: 'Í≥µÍ∏âÏûê Ïã§Ï†Å',
    component: 'SupplierPerformanceWidget',
    position: 'sidebar',
    showTopSuppliers: 5
  },
  {
    id: 'affiliate_earnings',
    title: 'Ï†úÌú¥ ÏàòÏùµ',
    component: 'AffiliateEarningsWidget',
    position: 'sidebar',
    period: 'month'
  }
];
```

## üîß ÎπÑÏ¶àÎãàÏä§ Î°úÏßÅ Íµ¨ÌòÑ

### 1. ÏàòÏàòÎ£å Í≥ÑÏÇ∞ Î°úÏßÅ

```typescript
class CommissionCalculator {
  // ÌåêÎß§Ïûê ÏàòÏùµ Í≥ÑÏÇ∞
  calculateSellerProfit(order: DropshippingOrder): number {
    const supplierCost = order.supplier_cost;
    const sellingPrice = order.subtotal;
    const platformFee = sellingPrice * 0.05; // ÌîåÎû´Ìèº ÏàòÏàòÎ£å 5%
    
    return sellingPrice - supplierCost - platformFee;
  }
  
  // Ï†úÌú¥ ÏàòÏàòÎ£å Í≥ÑÏÇ∞
  calculateAffiliateCommission(
    order: DropshippingOrder,
    affiliate: Affiliate
  ): number {
    const baseRate = affiliate.commission_rate;
    const tierBonus = this.getTierBonus(affiliate.tier_level);
    const finalRate = baseRate * (1 + tierBonus);
    
    return order.subtotal * (finalRate / 100);
  }
  
  // Í≥ÑÏ∏µÎ≥Ñ Î≥¥ÎÑàÏä§
  private getTierBonus(tier: string): number {
    const bonuses = {
      bronze: 0,
      silver: 0.2,  // 20% Î≥¥ÎÑàÏä§
      gold: 0.5,    // 50% Î≥¥ÎÑàÏä§
      platinum: 1.0 // 100% Î≥¥ÎÑàÏä§
    };
    return bonuses[tier] || 0;
  }
}
```

### 2. ÏûêÎèô Ï£ºÎ¨∏ Ï≤òÎ¶¨

```typescript
class AutoOrderProcessor {
  async processOrder(orderId: string) {
    const order = await this.getOrder(orderId);
    
    // 1. Ïû¨Í≥† ÌôïÏù∏
    const stockCheck = await this.checkStock(order.items);
    if (!stockCheck.available) {
      await this.handleOutOfStock(order, stockCheck.unavailableItems);
      return;
    }
    
    // 2. Ïû¨Í≥† ÏòàÏïΩ
    await this.reserveStock(order.items);
    
    // 3. Í≥µÍ∏âÏûêÏóêÍ≤å Ï£ºÎ¨∏ Ï†ÑÏÜ°
    await this.sendToSupplier(order);
    
    // 4. Í≤∞Ï†ú Ï≤òÎ¶¨
    await this.processPayment(order);
    
    // 5. Ï£ºÎ¨∏ ÌôïÏ†ï
    await this.confirmOrder(order);
    
    // 6. ÏïåÎ¶º Î∞úÏÜ°
    await this.sendNotifications(order);
  }
  
  private async checkStock(items: OrderItem[]): Promise<StockCheckResult> {
    // Ïû¨Í≥† ÌôïÏù∏ Î°úÏßÅ
  }
  
  private async reserveStock(items: OrderItem[]) {
    // Ïû¨Í≥† ÏòàÏïΩ Î°úÏßÅ
  }
  
  private async sendToSupplier(order: Order) {
    // Í≥µÍ∏âÏûê API Ìò∏Ï∂ú ÎòêÎäî Ïù¥Î©îÏùº Î∞úÏÜ°
  }
}
```

### 3. Í∞ÄÍ≤© ÎèôÍ∏∞Ìôî

```typescript
class PriceSynchronizer {
  async syncPrices(productId: string) {
    const supplierProduct = await this.getSupplierProduct(productId);
    const sellerProducts = await this.getSellerProducts(productId);
    
    for (const sellerProduct of sellerProducts) {
      if (!sellerProduct.auto_sync_price) continue;
      
      // ÎßàÌÅ¨ÏóÖ Ï†ÅÏö©
      const newPrice = this.calculateSellingPrice(
        supplierProduct.base_price,
        sellerProduct.markup_type,
        sellerProduct.markup_value
      );
      
      // Ï†ÑÏûêÏÉÅÍ±∞Îûò Ï†úÌíà Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
      await this.updateEcommercePrice(
        sellerProduct.ecommerce_product_id,
        newPrice
      );
      
      // ÌåêÎß§Ïûê Ï†úÌíà Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
      await this.updateSellerProductPrice(sellerProduct.id, newPrice);
    }
  }
  
  private calculateSellingPrice(
    basePrice: number,
    markupType: 'fixed' | 'percentage',
    markupValue: number
  ): number {
    if (markupType === 'fixed') {
      return basePrice + markupValue;
    } else {
      return basePrice * (1 + markupValue / 100);
    }
  }
}
```

## üìä Î™®ÎãàÌÑ∞ÎßÅ Î∞è Î∂ÑÏÑù

### 1. Ïã§ÏãúÍ∞Ñ Î™®ÎãàÌÑ∞ÎßÅ

```typescript
// Î™®ÎãàÌÑ∞ÎßÅ Î©îÌä∏Î¶≠
const monitoringMetrics = {
  orders: {
    total_orders: 'COUNT(*)',
    pending_orders: "COUNT(*) WHERE status = 'pending'",
    revenue_today: 'SUM(total_amount) WHERE DATE(created_at) = CURRENT_DATE',
    average_order_value: 'AVG(total_amount)'
  },
  
  inventory: {
    low_stock_products: 'COUNT(*) WHERE stock_quantity <= low_stock_threshold',
    out_of_stock: "COUNT(*) WHERE status = 'out_of_stock'",
    total_inventory_value: 'SUM(stock_quantity * cost)'
  },
  
  performance: {
    supplier_fulfillment_rate: 'AVG(fulfilled_orders / total_orders)',
    average_shipping_time: 'AVG(delivered_at - shipped_at)',
    customer_satisfaction: 'AVG(rating)'
  },
  
  affiliates: {
    active_affiliates: "COUNT(DISTINCT affiliate_id) WHERE created_at >= NOW() - INTERVAL '30 days'",
    conversion_rate: 'AVG(conversions / clicks)',
    total_commission_pending: "SUM(commission_amount) WHERE status = 'pending'"
  }
};
```

### 2. Î≥¥Í≥†ÏÑú ÏÉùÏÑ±

```typescript
class ReportGenerator {
  async generateSupplierReport(supplierId: string, period: string) {
    return {
      overview: await this.getSupplierOverview(supplierId, period),
      products: await this.getProductPerformance(supplierId, period),
      orders: await this.getOrderStatistics(supplierId, period),
      revenue: await this.getRevenueBreakdown(supplierId, period),
      ratings: await this.getRatingsAnalysis(supplierId, period)
    };
  }
  
  async generateAffiliateReport(affiliateId: string, period: string) {
    return {
      earnings: await this.getEarningsSummary(affiliateId, period),
      links: await this.getLinkPerformance(affiliateId, period),
      conversions: await this.getConversionAnalysis(affiliateId, period),
      products: await this.getTopProducts(affiliateId, period),
      payouts: await this.getPayoutHistory(affiliateId, period)
    };
  }
}
```

## üîê Î≥¥Ïïà Î∞è Í∂åÌïú

### 1. API ÎØ∏Îì§Ïõ®Ïñ¥

```typescript
// ÎìúÎ°≠Ïâ¨Ìïë Ïó≠Ìï† ÌôïÏù∏ ÎØ∏Îì§Ïõ®Ïñ¥
export const requireDropshippingRole = (role: string) => {
  return async (req: Request, res: Response, next: NextFunction) => {
    const userId = req.user.id;
    
    // Ïó≠Ìï† ÌôïÏù∏
    const hasRole = await checkUserDropshippingRole(userId, role);
    if (!hasRole) {
      return res.status(403).json({ error: 'Insufficient permissions' });
    }
    
    // Í≤ÄÏ¶ù ÏÉÅÌÉú ÌôïÏù∏
    const isVerified = await checkRoleVerification(userId, role);
    if (!isVerified && role !== 'affiliate') {
      return res.status(403).json({ error: 'Role verification required' });
    }
    
    next();
  };
};

// Î¶¨ÏÜåÏä§ ÏÜåÏú†Í∂å ÌôïÏù∏
export const requireResourceOwnership = (resourceType: string) => {
  return async (req: Request, res: Response, next: NextFunction) => {
    const userId = req.user.id;
    const resourceId = req.params.id;
    
    const isOwner = await checkResourceOwnership(
      userId,
      resourceType,
      resourceId
    );
    
    if (!isOwner && req.user.role !== 'admin') {
      return res.status(403).json({ error: 'Access denied' });
    }
    
    next();
  };
};
```

## üìù ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïä§ÌÅ¨Î¶ΩÌä∏

```sql
-- Í∏∞Ï°¥ Ï†ÑÏûêÏÉÅÍ±∞Îûò ÌÖåÏù¥Î∏îÍ≥º Ïó∞ÎèôÏùÑ ÏúÑÌïú Ïª¨Îüº Ï∂îÍ∞Ä
ALTER TABLE products 
ADD COLUMN is_dropshipping BOOLEAN DEFAULT false,
ADD COLUMN dropship_supplier_id UUID REFERENCES dropshipping_suppliers(id),
ADD COLUMN dropship_product_id UUID REFERENCES dropshipping_products(id);

ALTER TABLE orders
ADD COLUMN has_dropship_items BOOLEAN DEFAULT false,
ADD COLUMN dropship_order_ids UUID[] DEFAULT '{}';

ALTER TABLE users
ADD COLUMN dropshipping_roles JSONB DEFAULT '[]',
ADD COLUMN dropshipping_verified BOOLEAN DEFAULT false;

-- Ïù∏Îç±Ïä§ Ï∂îÍ∞Ä
CREATE INDEX idx_products_dropshipping ON products(is_dropshipping) WHERE is_dropshipping = true;
CREATE INDEX idx_orders_dropshipping ON orders(has_dropship_items) WHERE has_dropship_items = true;
```

## üöÄ Íµ¨ÌòÑ Ïö∞ÏÑ†ÏàúÏúÑ

1. **Phase 1: Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÏÑ§Ï†ï**
   - Î™®Îì† ÌÖåÏù¥Î∏î ÏÉùÏÑ±
   - Ïù∏Îç±Ïä§ Î∞è Ï†úÏïΩÏ°∞Í±¥ ÏÑ§Ï†ï
   - Í∏∞Ï°¥ ÌÖåÏù¥Î∏îÍ≥ºÏùò Í¥ÄÍ≥Ñ ÏÑ§Ï†ï

2. **Phase 2: Í∏∞Î≥∏ API Íµ¨ÌòÑ**
   - Ïù∏Ï¶ù Î∞è Í∂åÌïú ÏãúÏä§ÌÖú
   - CRUD ÏûëÏóÖ API
   - Í≤ÄÏ¶ù Î°úÏßÅ

3. **Phase 3: Ï†ÑÏûêÏÉÅÍ±∞Îûò ÌÜµÌï©**
   - Ï†úÌíà ÎèôÍ∏∞Ìôî
   - Ï£ºÎ¨∏ Ï≤òÎ¶¨ ÌîåÎ°úÏö∞
   - Ïû¨Í≥† Í¥ÄÎ¶¨

4. **Phase 4: ÏûêÎèôÌôî Î∞è ÏµúÏ†ÅÌôî**
   - ÏûêÎèô Ï£ºÎ¨∏ Ï≤òÎ¶¨
   - Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî
   - ÏïåÎ¶º ÏãúÏä§ÌÖú

5. **Phase 5: Î∂ÑÏÑù Î∞è Î≥¥Í≥†ÏÑú**
   - ÎåÄÏãúÎ≥¥Îìú Íµ¨ÌòÑ
   - Î≥¥Í≥†ÏÑú ÏÉùÏÑ±
   - ÏÑ±Îä• Î™®ÎãàÌÑ∞ÎßÅ

---

Ïù¥ Î¨∏ÏÑúÎ•º Í∏∞Î∞òÏúºÎ°ú API ÏÑúÎ≤Ñ Í∞úÎ∞úÌåÄÏù¥ Íµ¨ÌòÑÏùÑ ÏßÑÌñâÌï† Ïàò ÏûàÏäµÎãàÎã§.