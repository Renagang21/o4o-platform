import{r as e,j as t,bq as s,S as r,cj as a,N as n,Y as d,V as l}from"./vendor-react-Bb0TGSr4.js";import{u as i,a as c,b as x}from"./vendor-query-BEO_OofR.js";import{B as o,C as m,k as h,l as p,m as j,I as u,w as y,x as v,y as N,z as f,E as g,L as b,T as w,F as k,j as S,s as q}from"./page-gutenberg-CGPrHM9_.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-B-KQWpLj.js";import"./wp-foundation-Ht0JG6Uo.js";import"./wp-components-CoD93iDH.js";const C=()=>{const C=i(),[I,F]=e.useState(""),[K,_]=e.useState("all"),[P,O]=e.useState(null),[L,$]=e.useState(!1),[z,U]=e.useState(!1),[D,Q]=e.useState({inventoryItemId:"",type:"increase",quantity:0,reason:"",notes:""}),{data:R,isLoading:V}=c({queryKey:["inventory",I,K],queryFn:async()=>{const e=new URLSearchParams;I&&e.append("search",I),"all"!==K&&e.append("status",K);return(await S.api.get(`/v1/inventory?${e.toString()}`)).data}}),A=R?.data||[],{data:B}=c({queryKey:["stock-movements",P?.id],queryFn:async()=>{if(!P?.id)return{data:[]};return(await S.api.get(`/v1/inventory/${P.id}/movements`)).data},enabled:!!P?.id&&z}),E=B?.data||[],{data:T}=c({queryKey:["inventory-stats"],queryFn:async()=>(await S.api.get("/v1/inventory/stats")).data}),Y=T?.data||{},G=x({mutationFn:async e=>(await S.api.post("/v1/inventory/adjust",e)).data,onSuccess:()=>{l.success("재고가 조정되었습니다"),C.invalidateQueries({queryKey:["inventory"]}),C.invalidateQueries({queryKey:["inventory-stats"]}),$(!1),Q({inventoryItemId:"",type:"increase",quantity:0,reason:"",notes:""})}}),H=x({mutationFn:async e=>(await S.api.post("/v1/inventory/bulk-reorder",{itemIds:e})).data,onSuccess:()=>{l.success("대량 재주문이 요청되었습니다")}}),J=A.filter(e=>e.currentStock<=e.reorderPoint&&"discontinued"!==e.status);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"재고 관리"}),t.jsx("p",{className:"text-modern-text-secondary mt-1",children:"실시간 재고 추적 및 관리"})]}),t.jsx("div",{className:"flex gap-2",children:J.length>0&&t.jsxs(o,{variant:"outline",onClick:()=>H.mutate(J.map(e=>e.id)),disabled:H.isPending,children:[t.jsx(s,{className:"w-4 h-4 mr-2"}),"부족 재고 재주문 (",J.length,")"]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs(m,{children:[t.jsx(h,{className:"pb-2",children:t.jsx(p,{className:"text-sm font-medium text-modern-text-secondary",children:"총 상품 수"})}),t.jsxs(j,{children:[t.jsx("div",{className:"text-2xl font-bold text-modern-text-primary",children:Y.totalItems||0}),t.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"활성 상품 기준"})]})]}),t.jsxs(m,{children:[t.jsx(h,{className:"pb-2",children:t.jsx(p,{className:"text-sm font-medium text-modern-text-secondary",children:"부족 재고"})}),t.jsxs(j,{children:[t.jsx("div",{className:"text-2xl font-bold text-orange-600",children:Y.lowStockItems||0}),t.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"재주문 필요"})]})]}),t.jsxs(m,{children:[t.jsx(h,{className:"pb-2",children:t.jsx(p,{className:"text-sm font-medium text-modern-text-secondary",children:"품절 상품"})}),t.jsxs(j,{children:[t.jsx("div",{className:"text-2xl font-bold text-red-600",children:Y.outOfStockItems||0}),t.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"즉시 보충 필요"})]})]}),t.jsxs(m,{children:[t.jsx(h,{className:"pb-2",children:t.jsx(p,{className:"text-sm font-medium text-modern-text-secondary",children:"총 재고 가치"})}),t.jsxs(j,{children:[t.jsxs("div",{className:"text-2xl font-bold text-modern-text-primary",children:["₩",(Y.totalValue||0).toLocaleString()]}),t.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"원가 기준"})]})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(r,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-modern-text-tertiary w-5 h-5"}),t.jsx(u,{type:"text",placeholder:"상품명, SKU로 검색...",value:I,onChange:e=>F(e.target.value),className:"pl-10"})]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(a,{className:"w-5 h-5 text-modern-text-secondary"}),t.jsxs("select",{value:K,onChange:e=>_(e.target.value),className:"px-4 py-2 border border-modern-border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-modern-primary",children:[t.jsx("option",{value:"all",children:"모든 상태"}),t.jsx("option",{value:"in_stock",children:"정상 재고"}),t.jsx("option",{value:"low_stock",children:"부족 재고"}),t.jsx("option",{value:"out_of_stock",children:"품절"}),t.jsx("option",{value:"discontinued",children:"단종"})]})]})]}),t.jsx(m,{children:t.jsx(j,{className:"p-0",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-modern-bg-tertiary border-b border-modern-border-primary",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상품 정보"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"현재 재고"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"예약 재고"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"재주문점"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상태"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"위치"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"작업"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-modern-border-primary",children:V?t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"px-6 py-12 text-center",children:t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})})})}):0===A.length?t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"px-6 py-12 text-center text-modern-text-secondary",children:"재고 데이터가 없습니다."})}):A.map(e=>{return t.jsxs("tr",{className:"hover:bg-modern-bg-hover",children:[t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:e.productName}),t.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["SKU: ",e.sku]}),e.variantOptions&&t.jsx("div",{className:"text-xs text-modern-text-tertiary",children:Object.entries(e.variantOptions).map(([e,t])=>`${e}: ${t}`).join(", ")})]})}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-modern-text-primary",children:e.currentStock}),e.currentStock<=e.reorderPoint&&t.jsx(s,{className:"w-4 h-4 text-orange-500"})]})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:"text-sm text-modern-text-secondary",children:e.reservedStock})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:"text-sm text-modern-text-secondary",children:e.reorderPoint})}),t.jsx("td",{className:"px-6 py-4",children:(r=e.status,a=e.currentStock,l=e.reorderPoint,"out_of_stock"===r||0===a?t.jsx(q,{variant:"destructive",children:"품절"}):"low_stock"===r||a<=l?t.jsx(q,{variant:"outline",className:"text-orange-600 border-orange-600",children:"부족"}):"discontinued"===r?t.jsx(q,{variant:"secondary",children:"단종"}):t.jsx(q,{children:"정상"}))}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:"text-sm text-modern-text-secondary",children:e.location||"-"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(o,{variant:"ghost",size:"sm",onClick:()=>(e=>{O(e),Q({inventoryItemId:e.id,type:"increase",quantity:0,reason:"",notes:""}),$(!0)})(e),children:t.jsx(n,{className:"w-4 h-4"})}),t.jsx(o,{variant:"ghost",size:"sm",onClick:()=>(e=>{O(e),U(!0)})(e),children:t.jsx(d,{className:"w-4 h-4"})})]})})]},e.id);var r,a,l})})]})})})}),t.jsx(y,{open:L,onOpenChange:$,children:t.jsx(v,{children:t.jsxs("form",{onSubmit:e=>{e.preventDefault(),D.quantity&&D.reason?G.mutate(D):l.error("수량과 사유를 입력하세요")},children:[t.jsxs(N,{children:[t.jsx(f,{children:"재고 조정"}),t.jsxs(g,{children:[P?.productName," - ",P?.sku]})]}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsx("div",{children:t.jsxs(b,{children:["현재 재고: ",P?.currentStock,"개"]})}),t.jsxs("div",{children:[t.jsx(b,{htmlFor:"type",children:"조정 유형"}),t.jsxs("select",{id:"type",value:D.type,onChange:e=>Q(t=>({...t,type:e.target.value})),className:"w-full px-3 py-2 border border-modern-border-primary rounded-lg mt-1",children:[t.jsx("option",{value:"increase",children:"증가"}),t.jsx("option",{value:"decrease",children:"감소"}),t.jsx("option",{value:"set",children:"절대값 설정"})]})]}),t.jsxs("div",{children:[t.jsx(b,{htmlFor:"quantity",children:"수량"}),t.jsx(u,{id:"quantity",type:"number",min:"0",value:D.quantity,onChange:e=>Q(t=>({...t,quantity:parseInt(e.target.value)||0})),required:!0})]}),t.jsxs("div",{children:[t.jsx(b,{htmlFor:"reason",children:"조정 사유 *"}),t.jsxs("select",{id:"reason",value:D.reason,onChange:e=>Q(t=>({...t,reason:e.target.value})),className:"w-full px-3 py-2 border border-modern-border-primary rounded-lg mt-1",required:!0,children:[t.jsx("option",{value:"",children:"사유를 선택하세요"}),t.jsx("option",{value:"manual_count",children:"실사 조정"}),t.jsx("option",{value:"damaged",children:"손상품 처리"}),t.jsx("option",{value:"expired",children:"유통기한 만료"}),t.jsx("option",{value:"returned",children:"반품 처리"}),t.jsx("option",{value:"promotional",children:"판촉 사용"}),t.jsx("option",{value:"theft",children:"분실/도난"}),t.jsx("option",{value:"other",children:"기타"})]})]}),t.jsxs("div",{children:[t.jsx(b,{htmlFor:"notes",children:"메모"}),t.jsx(w,{id:"notes",value:D.notes,onChange:e=>Q(t=>({...t,notes:e.target.value})),placeholder:"추가 설명을 입력하세요...",rows:3})]})]}),t.jsxs(k,{children:[t.jsx(o,{type:"button",variant:"outline",onClick:()=>$(!1),children:"취소"}),t.jsx(o,{type:"submit",disabled:G.isPending,children:"조정하기"})]})]})})}),t.jsx(y,{open:z,onOpenChange:U,children:t.jsxs(v,{className:"max-w-4xl",children:[t.jsxs(N,{children:[t.jsx(f,{children:"입출고 이력"}),t.jsxs(g,{children:[P?.productName," - ",P?.sku]})]}),t.jsx("div",{className:"max-h-96 overflow-y-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-modern-bg-tertiary sticky top-0",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"일시"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"유형"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"수량"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"잔여"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"사유"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"참조"})]})}),t.jsx("tbody",{children:E.map(e=>{const s=(e=>{switch(e){case"in":return{label:"입고",color:"text-green-600"};case"out":return{label:"출고",color:"text-red-600"};case"adjustment":return{label:"조정",color:"text-blue-600"};case"reserved":return{label:"예약",color:"text-orange-600"};case"unreserved":return{label:"예약해제",color:"text-purple-600"};default:return{label:e,color:"text-gray-600"}}})(e.type);return t.jsxs("tr",{className:"border-b border-modern-border-primary",children:[t.jsx("td",{className:"px-4 py-2 text-sm",children:new Date(e.createdAt).toLocaleString("ko-KR")}),t.jsx("td",{className:"px-4 py-2",children:t.jsx("span",{className:`text-sm font-medium ${s.color}`,children:s.label})}),t.jsxs("td",{className:"px-4 py-2 text-sm",children:["out"===e.type||"adjustment"===e.type?"-":"+",e.quantity]}),t.jsx("td",{className:"px-4 py-2 text-sm",children:e.remainingStock}),t.jsx("td",{className:"px-4 py-2 text-sm",children:e.reason}),t.jsx("td",{className:"px-4 py-2 text-sm",children:e.reference||"-"})]},e.id)})})]})}),t.jsx(k,{children:t.jsx(o,{onClick:()=>U(!1),children:"닫기"})})]})})]})};export{C as default};
