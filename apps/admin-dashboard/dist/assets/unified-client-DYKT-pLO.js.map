{"version":3,"file":"unified-client-DYKT-pLO.js","sources":["../../src/api/unified-client.ts"],"sourcesContent":["import axios, { AxiosInstance, AxiosError } from 'axios';\nimport { useAuthStore } from '@/stores/authStore';\nimport toast from 'react-hot-toast';\n\n/**\n * Unified API Client for O4O Platform\n * \n * This client provides a single, consistent interface for all API calls\n * with standardized error handling, authentication, and versioning.\n */\nclass UnifiedApiClient {\n  private client: AxiosInstance;\n  private baseURL = import.meta.env.VITE_API_URL || 'https://api.neture.co.kr';\n  private version = 'v1';\n\n  constructor() {\n    // Remove /v1 from baseURL if it already exists to avoid duplication\n    if (this.baseURL.endsWith('/v1')) {\n      this.baseURL = this.baseURL.slice(0, -3); // Remove '/v1'\n    }\n    \n    // Add /api prefix to baseURL if not present\n    if (!this.baseURL.endsWith('/api')) {\n      this.baseURL = `${this.baseURL}/api`;\n    }\n    \n    this.client = axios.create({\n      baseURL: this.baseURL,\n      timeout: 30000,\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      withCredentials: true, // Enable cross-domain cookies for SSO\n    });\n\n    this.setupInterceptors();\n  }\n\n  private setupInterceptors() {\n    // Request interceptor\n    this.client.interceptors.request.use(\n      (config) => {\n        // Get token from multiple sources\n        let token = this.getAuthToken();\n        \n        if (token) {\n          config.headers.Authorization = `Bearer ${token}`;\n        }\n        \n        // Dev environment logging\n        // if (import.meta.env.DEV) {\n        // }\n        \n        return config;\n      },\n      (error) => {\n        return Promise.reject(error);\n      }\n    );\n\n    // Response interceptor\n    this.client.interceptors.response.use(\n      (response) => {\n        // if (import.meta.env.DEV) {\n        // }\n        return response;\n      },\n      (error: AxiosError) => {\n        return this.handleError(error);\n      }\n    );\n  }\n\n  private getAuthToken(): string | null {\n    // Check multiple token sources\n    let token = useAuthStore.getState().token;\n    \n    if (!token) {\n      token = localStorage.getItem('authToken');\n    }\n    \n    if (!token) {\n      token = localStorage.getItem('accessToken');\n    }\n    \n    if (!token) {\n      token = localStorage.getItem('token');\n    }\n    \n    if (!token) {\n      const adminStorage = localStorage.getItem('admin-auth-storage');\n      if (adminStorage) {\n        try {\n          const parsed = JSON.parse(adminStorage);\n          if (parsed.state?.token) {\n            token = parsed.state.token;\n          }\n        } catch {\n          // Failed to parse\n        }\n      }\n    }\n    \n    return token;\n  }\n\n  private handleError(error: AxiosError): Promise<never> {\n    const status = error.response?.status;\n\n    switch (status) {\n      case 401:\n        this.handleUnauthorized();\n        break;\n      case 403:\n        toast.error('접근 권한이 없습니다.');\n        break;\n      case 404:\n        // Silent fail for 404s (handled by fallback data)\n        break;\n      case 429:\n        toast.error('요청이 너무 많습니다. 잠시 후 다시 시도해주세요.');\n        break;\n      case 500:\n      case 502:\n      case 503:\n        toast.error('서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.');\n        break;\n      default:\n        if (error.code === 'ECONNABORTED') {\n          toast.error('요청 시간이 초과되었습니다.');\n        }\n    }\n\n    return Promise.reject(error);\n  }\n\n  private handleUnauthorized() {\n    const currentPath = window.location.pathname;\n    \n    if (currentPath !== '/login') {\n      // Clear all auth data\n      localStorage.removeItem('auth-storage');\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('admin-auth-storage');\n      \n      useAuthStore.getState().logout();\n      window.location.href = '/login';\n      toast.error('세션이 만료되었습니다. 다시 로그인해주세요.');\n    }\n  }\n\n  // Versioned API methods\n  private v1(path: string): string {\n    return `/${this.version}${path}`;\n  }\n\n  // Content API\n  content = {\n    posts: {\n      list: (params?: any) => this.client.get(this.v1('/content/posts'), { params }),\n      get: (id: string) => this.client.get(this.v1(`/content/posts/${id}`)),\n      create: (data: any) => this.client.post(this.v1('/content/posts'), data),\n      update: (id: string, data: any) => this.client.put(this.v1(`/content/posts/${id}`), data),\n      delete: (id: string) => this.client.delete(this.v1(`/content/posts/${id}`)),\n    },\n    categories: {\n      list: (params?: any) => this.client.get(this.v1('/content/categories'), { params }),\n      get: (id: string) => this.client.get(this.v1(`/content/categories/${id}`)),\n      create: (data: any) => this.client.post(this.v1('/content/categories'), data),\n      update: (id: string, data: any) => this.client.put(this.v1(`/content/categories/${id}`), data),\n      delete: (id: string) => this.client.delete(this.v1(`/content/categories/${id}`)),\n    },\n    media: {\n      list: (params?: any) => this.client.get(this.v1('/content/media'), { params }),\n      get: (id: string) => this.client.get(this.v1(`/content/media/${id}`)),\n      upload: (formData: FormData) => this.client.post(this.v1('/content/media/upload'), formData, {\n        headers: { 'Content-Type': 'multipart/form-data' }\n      }),\n      update: (id: string, data: any) => this.client.put(this.v1(`/content/media/${id}`), data),\n      delete: (id: string) => this.client.delete(this.v1(`/content/media/${id}`)),\n    },\n    authors: {\n      list: () => this.client.get(this.v1('/content/authors')),\n    }\n  };\n\n  // Platform API\n  platform = {\n    apps: {\n      list: () => this.client.get(this.v1('/platform/apps')),\n      get: (id: string) => this.client.get(this.v1(`/platform/apps/${id}`)),\n      updateStatus: (id: string, status: string) => \n        this.client.put(this.v1(`/platform/apps/${id}/status`), { status }),\n    },\n    settings: {\n      get: () => this.client.get(this.v1('/platform/settings')),\n      update: (data: any) => this.client.put(this.v1('/platform/settings'), data),\n    },\n    customPostTypes: {\n      list: () => this.client.get(this.v1('/platform/custom-post-types')),\n      get: (id: string) => this.client.get(this.v1(`/platform/custom-post-types/${id}`)),\n      create: (data: any) => this.client.post(this.v1('/platform/custom-post-types'), data),\n      update: (id: string, data: any) => this.client.put(this.v1(`/platform/custom-post-types/${id}`), data),\n      delete: (id: string) => this.client.delete(this.v1(`/platform/custom-post-types/${id}`)),\n    }\n  };\n\n  // E-commerce API\n  ecommerce = {\n    products: {\n      list: (params?: any) => this.client.get(this.v1('/ecommerce/products'), { params }),\n      get: (id: string) => this.client.get(this.v1(`/ecommerce/products/${id}`)),\n      create: (data: any) => this.client.post(this.v1('/ecommerce/products'), data),\n      update: (id: string, data: any) => this.client.put(this.v1(`/ecommerce/products/${id}`), data),\n      delete: (id: string) => this.client.delete(this.v1(`/ecommerce/products/${id}`)),\n    },\n    orders: {\n      list: (params?: any) => this.client.get(this.v1('/ecommerce/orders'), { params }),\n      get: (id: string) => this.client.get(this.v1(`/ecommerce/orders/${id}`)),\n      updateStatus: (id: string, status: string, note?: string) => \n        this.client.put(this.v1(`/ecommerce/orders/${id}/status`), { status, note }),\n    },\n    cart: {\n      get: () => this.client.get(this.v1('/ecommerce/cart')),\n      update: (data: any) => this.client.post(this.v1('/ecommerce/cart'), data),\n      applyCoupon: (code: string) => this.client.post(this.v1('/ecommerce/cart/coupon'), { code }),\n    }\n  };\n\n  // Forum API\n  forum = {\n    posts: {\n      list: (params?: any) => this.client.get(this.v1('/forum/posts'), { params }),\n      get: (id: string) => this.client.get(this.v1(`/forum/posts/${id}`)),\n      create: (data: any) => this.client.post(this.v1('/forum/posts'), data),\n      update: (id: string, data: any) => this.client.put(this.v1(`/forum/posts/${id}`), data),\n      delete: (id: string) => this.client.delete(this.v1(`/forum/posts/${id}`)),\n    },\n    categories: {\n      list: () => this.client.get(this.v1('/forum/categories')),\n      get: (id: string) => this.client.get(this.v1(`/forum/categories/${id}`)),\n      create: (data: any) => this.client.post(this.v1('/forum/categories'), data),\n    },\n    comments: {\n      list: (postId: string) => this.client.get(this.v1(`/forum/posts/${postId}/comments`)),\n      create: (data: any) => this.client.post(this.v1('/forum/comments'), data),\n    }\n  };\n\n  // Auth API\n  auth = {\n    login: (credentials: any) => this.client.post(this.v1('/auth/login'), credentials),\n    logout: () => this.client.post(this.v1('/auth/logout')),\n    register: (data: any) => this.client.post(this.v1('/auth/register'), data),\n    me: () => this.client.get(this.v1('/auth/me')),\n    refresh: () => this.client.post(this.v1('/auth/refresh')),\n  };\n\n  // Direct client access for custom requests\n  get raw() {\n    return this.client;\n  }\n}\n\n// Export singleton instance\nexport const unifiedApi = new UnifiedApiClient();\n\n// Export for type safety\nexport type UnifiedApiType = typeof unifiedApi;"],"names":["UnifiedApiClient","axios","config","token","error","response","useAuthStore","adminStorage","parsed","toast","path","params","id","data","formData","status","note","code","postId","credentials","unifiedApi"],"mappings":"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"}