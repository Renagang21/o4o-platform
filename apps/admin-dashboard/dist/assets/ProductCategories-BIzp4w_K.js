import{r as m,j as e,P as F,D,d as B,c as H,N as V,V as h}from"./vendor-react-CPLvoCm3.js";import{u as _,a as G,b as f}from"./vendor-query-BtistrhA.js";import{B as l,C as J,k as U,l as W,t as X,m as Y,w as Z,x as ee,y as se,z as ie,E as te,L as n,I as d,T as P,F as re,j as u}from"./page-gutenberg-DLeK6fOm.js";import{S as T}from"./page-template-editor-Cv5aTQGT.js";import"./wp-block-editor-Dl58kgFV.js";import"./wp-i18n-CvFqmxct.js";import"./wp-core-DsNNoVDq.js";import"./wp-blocks-core-Bps80Ozc.js";import"./wp-misc-BM-YUiZN.js";import"./wp-data-CXbtpCh2.js";import"./wp-components-YCGeKRou.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-utils-D_7XgcHg.js";import"./wp-api-pXRzUPJ4.js";import"./vendor-monaco-cpVGocfO.js";const ye=()=>{const j=_(),[N,q]=m.useState(new Set),[E,g]=m.useState(!1),[p,v]=m.useState(null),[r,t]=m.useState({name:"",slug:"",description:"",parentId:void 0,active:!0,attributes:[],shippingPolicy:{freeShippingThreshold:5e4,baseShippingFee:3e3},seo:{title:"",description:"",keywords:""}}),[o,c]=m.useState({key:"",label:"",type:"text",required:!1}),{data:O,isLoading:I}=G({queryKey:["product-categories"],queryFn:async()=>(await u.api.get("/v1/ecommerce/categories/tree")).data}),C=O?.data||[],S=f({mutationFn:async s=>(await u.api.post("/v1/ecommerce/categories",s)).data,onSuccess:()=>{h.success("카테고리가 생성되었습니다"),j.invalidateQueries({queryKey:["product-categories"]}),y()}}),w=f({mutationFn:async({id:s,data:i})=>(await u.api.put(`/v1/ecommerce/categories/${s}`,i)).data,onSuccess:()=>{h.success("카테고리가 수정되었습니다"),j.invalidateQueries({queryKey:["product-categories"]}),y()}}),$=f({mutationFn:async s=>(await u.api.delete(`/v1/ecommerce/categories/${s}`)).data,onSuccess:()=>{h.success("카테고리가 삭제되었습니다"),j.invalidateQueries({queryKey:["product-categories"]})}}),z=s=>{const i=new Set(N);i.has(s)?i.delete(s):i.add(s),q(i)},b=(s,i)=>{s?(v(s),t({name:s.name,slug:s.slug,description:s.description||"",parentId:s.parentId,active:s.active,attributes:s.attributes||[],shippingPolicy:{freeShippingThreshold:s.shippingPolicy?.freeShippingThreshold||5e4,baseShippingFee:s.shippingPolicy?.baseShippingFee||3e3},seo:{title:s.seo?.title||"",description:s.seo?.description||"",keywords:s.seo?.keywords?.join(", ")||""}})):(v(null),t({name:"",slug:"",description:"",parentId:i,active:!0,attributes:[],shippingPolicy:{freeShippingThreshold:5e4,baseShippingFee:3e3},seo:{title:"",description:"",keywords:""}})),g(!0)},y=()=>{g(!1),v(null),t({name:"",slug:"",description:"",parentId:void 0,active:!0,attributes:[],shippingPolicy:{freeShippingThreshold:5e4,baseShippingFee:3e3},seo:{title:"",description:"",keywords:""}}),c({key:"",label:"",type:"text",required:!1})},K=s=>s.toLowerCase().replace(/[^a-z0-9가-힣]+/g,"-").replace(/^-+|-+$/g,""),L=s=>{s.preventDefault();const i={...r,seo:{...r.seo,keywords:r.seo.keywords.split(",").map(a=>a.trim()).filter(a=>a)}};p?w.mutate({id:p.id,data:i}):S.mutate(i)},A=s=>{if(s.children&&s.children.length>0){h.error("하위 카테고리가 있는 카테고리는 삭제할 수 없습니다");return}if(s.productCount>0){h.error("상품이 등록된 카테고리는 삭제할 수 없습니다");return}confirm(`"${s.name}" 카테고리를 삭제하시겠습니까?`)&&$.mutate(s.id)},Q=()=>{if(!o.key||!o.label){h.error("속성 키와 라벨을 입력하세요");return}t(s=>({...s,attributes:[...s.attributes,{...o}]})),c({key:"",label:"",type:"text",required:!1})},M=s=>{t(i=>({...i,attributes:i.attributes.filter((a,x)=>x!==s)}))},k=(s,i=0)=>{const a=s.children&&s.children.length>0,x=N.has(s.id);return e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between p-4 hover:bg-modern-bg-hover border-b border-modern-border-primary ${i>0?`ml-${i*8}`:""}`,style:{marginLeft:`${i*2}rem`},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a&&e.jsx("button",{onClick:()=>z(s.id),className:"p-1 hover:bg-modern-bg-tertiary rounded",children:x?e.jsx(B,{className:"w-4 h-4"}):e.jsx(H,{className:"w-4 h-4"})}),!a&&e.jsx("div",{className:"w-6"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-modern-text-primary",children:s.name}),e.jsxs("span",{className:"text-xs text-modern-text-secondary",children:["/",s.slug]}),!s.active&&e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:"비활성"})]}),s.description&&e.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[e.jsxs("span",{className:"text-xs text-modern-text-tertiary",children:["상품 ",s.productCount,"개"]}),s.shippingPolicy&&e.jsxs("span",{className:"text-xs text-modern-text-tertiary",children:["무료배송 ",(s.shippingPolicy.freeShippingThreshold||0).toLocaleString(),"원 이상"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>b(void 0,s.id),children:[e.jsx(F,{className:"w-4 h-4"}),"하위 추가"]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>b(s),children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>A(s),disabled:s.productCount>0||s.children&&s.children.length>0,children:e.jsx(D,{className:"w-4 h-4 text-destructive"})})]})]}),a&&x&&e.jsx("div",{children:s.children.map(R=>k(R,i+1))})]},s.id)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"상품 카테고리"}),e.jsx("p",{className:"text-modern-text-secondary mt-1",children:"다단계 카테고리 구조를 관리하고 속성을 설정하세요."})]}),e.jsxs(l,{onClick:()=>b(),children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"최상위 카테고리"]})]}),e.jsxs(J,{children:[e.jsxs(U,{children:[e.jsx(W,{children:"카테고리 구조"}),e.jsx(X,{children:"드래그앤드롭으로 순서를 변경하고, 카테고리별 속성과 배송 정책을 설정하세요."})]}),e.jsx(Y,{className:"p-0",children:I?e.jsx("div",{className:"p-12 text-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary mx-auto"})}):C.length===0?e.jsx("div",{className:"p-12 text-center text-modern-text-secondary",children:"카테고리가 없습니다. 새 카테고리를 추가하세요."}):e.jsx("div",{children:C.map(s=>k(s))})})]}),e.jsx(Z,{open:E,onOpenChange:g,children:e.jsx(ee,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxs("form",{onSubmit:L,children:[e.jsxs(se,{children:[e.jsx(ie,{children:p?"카테고리 수정":"새 카테고리"}),e.jsx(te,{children:"카테고리 정보와 속성을 설정하세요."})]}),e.jsxs("div",{className:"space-y-6 py-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-modern-text-primary",children:"기본 정보"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"name",children:"카테고리명 *"}),e.jsx(d,{id:"name",value:r.name,onChange:s=>{t(i=>({...i,name:s.target.value,slug:p?i.slug:K(s.target.value)}))},placeholder:"예: 전자제품",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"slug",children:"Slug"}),e.jsx(d,{id:"slug",value:r.slug,onChange:s=>t(i=>({...i,slug:s.target.value})),placeholder:"예: electronics"})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",children:"설명"}),e.jsx(P,{id:"description",value:r.description,onChange:s=>t(i=>({...i,description:s.target.value})),placeholder:"카테고리에 대한 설명을 입력하세요...",rows:3})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"active",children:"활성화"}),e.jsx("p",{className:"text-sm text-modern-text-secondary",children:"비활성화 시 상품 등록이 불가능합니다"})]}),e.jsx(T,{id:"active",checked:r.active,onCheckedChange:s=>t(i=>({...i,active:s}))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-modern-text-primary",children:"카테고리 속성"}),e.jsx("p",{className:"text-sm text-modern-text-secondary",children:"이 카테고리의 상품에 필요한 속성을 정의하세요."}),e.jsx("div",{className:"space-y-2",children:r.attributes.map((s,i)=>e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-modern-bg-tertiary rounded",children:[e.jsx("span",{className:"font-medium",children:s.label}),e.jsxs("span",{className:"text-sm text-modern-text-secondary",children:["(",s.key,")"]}),e.jsx("span",{className:"text-sm",children:s.type}),s.required&&e.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded",children:"필수"}),e.jsx(l,{type:"button",variant:"ghost",size:"sm",onClick:()=>M(i),className:"ml-auto",children:e.jsx(D,{className:"w-4 h-4"})})]},i))}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(n,{children:"속성 키"}),e.jsx(d,{value:o.key,onChange:s=>c(i=>({...i,key:s.target.value})),placeholder:"예: color"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(n,{children:"라벨"}),e.jsx(d,{value:o.label,onChange:s=>c(i=>({...i,label:s.target.value})),placeholder:"예: 색상"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"타입"}),e.jsxs("select",{value:o.type,onChange:s=>c(i=>({...i,type:s.target.value})),className:"h-10 px-3 py-2 border border-modern-border-primary rounded-md",children:[e.jsx("option",{value:"text",children:"텍스트"}),e.jsx("option",{value:"number",children:"숫자"}),e.jsx("option",{value:"select",children:"선택"}),e.jsx("option",{value:"boolean",children:"예/아니오"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{checked:o.required,onCheckedChange:s=>c(i=>({...i,required:s}))}),e.jsx(n,{children:"필수"})]}),e.jsx(l,{type:"button",onClick:Q,children:"추가"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-modern-text-primary",children:"배송 정책"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"freeShippingThreshold",children:"무료배송 기준금액"}),e.jsx(d,{id:"freeShippingThreshold",type:"number",value:r.shippingPolicy.freeShippingThreshold,onChange:s=>t(i=>({...i,shippingPolicy:{...i.shippingPolicy,freeShippingThreshold:parseInt(s.target.value)||0}})),placeholder:"50000"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"baseShippingFee",children:"기본 배송비"}),e.jsx(d,{id:"baseShippingFee",type:"number",value:r.shippingPolicy.baseShippingFee,onChange:s=>t(i=>({...i,shippingPolicy:{...i.shippingPolicy,baseShippingFee:parseInt(s.target.value)||0}})),placeholder:"3000"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-modern-text-primary",children:"SEO 설정"}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"seoTitle",children:"SEO 제목"}),e.jsx(d,{id:"seoTitle",value:r.seo.title,onChange:s=>t(i=>({...i,seo:{...i.seo,title:s.target.value}})),placeholder:"검색 결과에 표시될 제목"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"seoDescription",children:"SEO 설명"}),e.jsx(P,{id:"seoDescription",value:r.seo.description,onChange:s=>t(i=>({...i,seo:{...i.seo,description:s.target.value}})),placeholder:"검색 결과에 표시될 설명",rows:2})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"seoKeywords",children:"SEO 키워드"}),e.jsx(d,{id:"seoKeywords",value:r.seo.keywords,onChange:s=>t(i=>({...i,seo:{...i.seo,keywords:s.target.value}})),placeholder:"쉼표로 구분된 키워드"})]})]})]}),e.jsxs(re,{children:[e.jsx(l,{type:"button",variant:"outline",onClick:y,children:"취소"}),e.jsx(l,{type:"submit",disabled:S.isPending||w.isPending,children:p?"수정":"생성"})]})]})})})]})};export{ye as default};
