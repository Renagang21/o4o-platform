import{r as e,j as s,cB as t,$ as a,bR as n,w as r,bB as d,S as l,V as i}from"./vendor-react-Bb0TGSr4.js";import{u as c,a as x,b as o}from"./vendor-query-BEO_OofR.js";import{B as m,C as p,k as h,l as j,m as u,I as v,w as y,x as N,y as g,z as f,E as b,L as w,F as k,j as S,s as C}from"./page-gutenberg-CGPrHM9_.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-B-KQWpLj.js";import"./wp-foundation-Ht0JG6Uo.js";import"./wp-components-CoD93iDH.js";const A=()=>{const A=c(),[F,L]=e.useState(""),[P,R]=e.useState("all"),[U,$]=e.useState([]),[q,z]=e.useState(!1),[D,I]=e.useState(""),{data:E,isLoading:K}=x({queryKey:["vendor-settlements",F,P],queryFn:async()=>{const e=new URLSearchParams;F&&e.append("search",F),"all"!==P&&e.append("status",P);return(await S.api.get(`/v1/settlements/vendors?${e}`)).data}}),O=E?.data||[],B=o({mutationFn:async e=>(await S.api.post("/v1/settlements/vendors/approve-bulk",e)).data,onSuccess:()=>{i.success("정산이 승인되었습니다"),A.invalidateQueries({queryKey:["vendor-settlements"]}),$([]),z(!1),I("")},onError:()=>{i.error("정산 승인 중 오류가 발생했습니다")}}),M=o({mutationFn:async({id:e,action:s,memo:t})=>(await S.api.post(`/v1/settlements/vendors/${e}/${s}`,{memo:t})).data,onSuccess:(e,s)=>{const t="approve"===s.action?"승인":"reject"===s.action?"거부":"처리";i.success(`정산이 ${t}되었습니다`),A.invalidateQueries({queryKey:["vendor-settlements"]})}}),Q=o({mutationFn:async e=>(await S.api.post("/v1/settlements/vendors/export",{settlementIds:e},{responseType:"blob"})).data,onSuccess:e=>{const s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download=`settlements_${(new Date).toISOString().split("T")[0]}.xlsx`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(s),i.success("정산 데이터가 다운로드되었습니다")}}),T=e=>{switch(e){case"pending":return s.jsx(C,{variant:"outline",className:"text-orange-600 border-orange-600",children:"승인 대기"});case"approved":return s.jsx(C,{variant:"outline",className:"text-blue-600 border-blue-600",children:"승인됨"});case"processing":return s.jsx(C,{variant:"outline",className:"text-purple-600 border-purple-600",children:"처리중"});case"completed":return s.jsx(C,{children:"완료"});case"failed":return s.jsx(C,{variant:"secondary",children:"실패"});default:return s.jsx(C,{variant:"outline",children:e})}},_=e=>`₩${e.toLocaleString()}`,V=e=>new Date(e).toLocaleDateString("ko-KR"),G=O.filter(e=>"pending"===e.status),H=G.reduce((e,s)=>e+s.netAmount,0);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"판매자 정산 관리"}),s.jsx("p",{className:"text-modern-text-secondary mt-1",children:"판매자별 정산 승인 및 처리"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(m,{variant:"outline",onClick:()=>{const e=U.length>0?U:O.map(e=>e.id);Q.mutate(e)},disabled:Q.isPending,children:[s.jsx(t,{className:"w-4 h-4 mr-2"}),"엑셀 다운로드"]}),s.jsxs(m,{onClick:()=>{0!==U.length?z(!0):i.error("승인할 정산을 선택하세요")},disabled:0===U.length,children:[s.jsx(a,{className:"w-4 h-4 mr-2"}),"일괄 승인 (",U.length,")"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs(p,{children:[s.jsx(h,{className:"pb-2",children:s.jsxs(j,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[s.jsx(n,{className:"w-4 h-4"}),"승인 대기"]})}),s.jsxs(u,{children:[s.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[G.length,"건"]}),s.jsx("div",{className:"text-xs text-modern-text-tertiary mt-1",children:_(H)})]})]}),s.jsxs(p,{children:[s.jsx(h,{className:"pb-2",children:s.jsxs(j,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[s.jsx(a,{className:"w-4 h-4"}),"완료"]})}),s.jsxs(u,{children:[s.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[O.filter(e=>"completed"===e.status).length,"건"]}),s.jsx("div",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]}),s.jsxs(p,{children:[s.jsx(h,{className:"pb-2",children:s.jsxs(j,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[s.jsx(r,{className:"w-4 h-4"}),"정산 판매자"]})}),s.jsx(u,{children:s.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[new Set(O.map(e=>e.vendorId)).size,"명"]})})]}),s.jsxs(p,{children:[s.jsx(h,{className:"pb-2",children:s.jsxs(j,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[s.jsx(d,{className:"w-4 h-4"}),"총 정산 금액"]})}),s.jsx(u,{children:s.jsx("div",{className:"text-2xl font-bold text-modern-text-primary",children:_(O.reduce((e,s)=>e+s.netAmount,0))})})]})]}),s.jsx(p,{children:s.jsx(u,{className:"pt-6",children:s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"relative",children:[s.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-modern-text-tertiary w-4 h-4"}),s.jsx(v,{placeholder:"판매자명, 이메일로 검색...",value:F,onChange:e=>L(e.target.value),className:"pl-10"})]})}),s.jsxs("select",{value:P,onChange:e=>R(e.target.value),className:"px-4 py-2 border border-modern-border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-modern-primary",children:[s.jsx("option",{value:"all",children:"모든 상태"}),s.jsx("option",{value:"pending",children:"승인 대기"}),s.jsx("option",{value:"approved",children:"승인됨"}),s.jsx("option",{value:"processing",children:"처리중"}),s.jsx("option",{value:"completed",children:"완료"}),s.jsx("option",{value:"failed",children:"실패"})]})]})})}),s.jsxs(p,{children:[s.jsx(h,{children:s.jsx(j,{children:"정산 목록"})}),s.jsx(u,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-modern-bg-tertiary border-b border-modern-border-primary",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left",children:s.jsx("input",{type:"checkbox",onChange:e=>{e.target.checked?$(O.map(e=>e.id)):$([])},checked:U.length===O.length&&O.length>0})}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"판매자"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"정산 기간"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"매출액"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"수수료"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"정산액"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상태"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"요청일"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"작업"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-modern-border-primary",children:K?s.jsx("tr",{children:s.jsx("td",{colSpan:9,className:"px-4 py-8 text-center",children:s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-modern-primary"})})})}):0===O.length?s.jsx("tr",{children:s.jsx("td",{colSpan:9,className:"px-4 py-8 text-center text-modern-text-secondary",children:"정산 데이터가 없습니다."})}):O.map(e=>s.jsxs("tr",{className:"hover:bg-modern-bg-hover",children:[s.jsx("td",{className:"px-4 py-4",children:s.jsx("input",{type:"checkbox",checked:U.includes(e.id),onChange:s=>{s.target.checked?$([...U,e.id]):$(U.filter(s=>s!==e.id))}})}),s.jsx("td",{className:"px-4 py-4",children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:e.vendorName}),s.jsx("div",{className:"text-sm text-modern-text-secondary",children:e.vendorEmail})]})}),s.jsxs("td",{className:"px-4 py-4",children:[s.jsxs("div",{className:"text-sm text-modern-text-primary",children:[V(e.settlementPeriod.startDate)," ~ ",V(e.settlementPeriod.endDate)]}),s.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:[e.orderCount,"건 주문"]})]}),s.jsx("td",{className:"px-4 py-4",children:s.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:_(e.totalSales)})}),s.jsxs("td",{className:"px-4 py-4",children:[s.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["플랫폼: ",_(e.platformFee)]}),s.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:["토스: ",_(e.tossFee)]})]}),s.jsxs("td",{className:"px-4 py-4",children:[s.jsx("div",{className:"text-sm font-medium text-green-600",children:_(e.netAmount)}),e.taxAmount>0&&s.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:["세금: ",_(e.taxAmount)]})]}),s.jsx("td",{className:"px-4 py-4",children:T(e.status)}),s.jsx("td",{className:"px-4 py-4",children:s.jsx("div",{className:"text-sm text-modern-text-secondary",children:V(e.requestedAt)})}),s.jsx("td",{className:"px-4 py-4",children:s.jsxs("div",{className:"flex gap-2",children:["pending"===e.status&&s.jsxs(s.Fragment,{children:[s.jsx(m,{size:"sm",onClick:()=>M.mutate({id:e.id,action:"approve"}),disabled:M.isPending,children:"승인"}),s.jsx(m,{size:"sm",variant:"outline",onClick:()=>M.mutate({id:e.id,action:"reject"}),disabled:M.isPending,children:"거부"})]}),e.receiptUrl&&s.jsx(m,{size:"sm",variant:"ghost",onClick:()=>window.open(e.receiptUrl,"_blank"),children:"영수증"})]})})]},e.id))})]})})})]}),s.jsx(y,{open:q,onOpenChange:z,children:s.jsxs(N,{children:[s.jsxs(g,{children:[s.jsx(f,{children:"정산 일괄 승인"}),s.jsxs(b,{children:["선택한 ",U.length,"건의 정산을 승인하시겠습니까?"]})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{className:"p-4 bg-modern-bg-secondary rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-modern-text-secondary mb-2",children:"승인 요약"}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"총 정산건수"}),s.jsxs("span",{className:"font-medium",children:[U.length,"건"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"총 정산금액"}),s.jsx("span",{className:"font-medium text-green-600",children:_(O.filter(e=>U.includes(e.id)).reduce((e,s)=>e+s.netAmount,0))})]})]}),s.jsxs("div",{children:[s.jsx(w,{htmlFor:"approvalMemo",children:"메모 (선택)"}),s.jsx(v,{id:"approvalMemo",value:D,onChange:e=>I(e.target.value),placeholder:"승인 관련 메모를 입력하세요"})]})]}),s.jsxs(k,{children:[s.jsx(m,{variant:"outline",onClick:()=>z(!1),children:"취소"}),s.jsx(m,{onClick:()=>{const e=O.filter(e=>U.includes(e.id)).reduce((e,s)=>e+s.netAmount,0);B.mutate({settlementIds:U,totalAmount:e,memo:D})},disabled:B.isPending,children:"승인 확정"})]})]})})]})};export{A as default};
