import{r as g,j as e,P as q,dJ as ce,c as oe,E as J,cR as G,D as U,V as h,cV as de,c5 as V}from"./vendor-react-CPLvoCm3.js";import{B as d,C,m as S,w as W,x as X,y as Y,z as Z,E as _,L as y,I as P,T as ee,S as he,f as ue,g as me,h as xe,i as H,F as se,k as z,l as K,s as Q,D as te,n as ae,o as ne,r as L,j as w,a as ge,b as pe,d as R,e as B}from"./page-gutenberg-DLeK6fOm.js";import{u as re,a as ie,b as T}from"./vendor-query-BtistrhA.js";import"./wp-block-editor-Dl58kgFV.js";import"./wp-i18n-CvFqmxct.js";import"./wp-core-DsNNoVDq.js";import"./wp-blocks-core-Bps80Ozc.js";import"./wp-misc-BM-YUiZN.js";import"./wp-data-CXbtpCh2.js";import"./wp-components-YCGeKRou.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-utils-D_7XgcHg.js";import"./wp-api-pXRzUPJ4.js";import"./vendor-monaco-cpVGocfO.js";class je{baseUrl;constructor(){const a=window.location.hostname;a==="localhost"||a==="127.0.0.1"?this.baseUrl="http://localhost:4000/api/v1":a==="admin.neture.co.kr"?this.baseUrl="https://api.neture.co.kr/api/v1":this.baseUrl="/api/v1"}getAuthHeaders(){const a=localStorage.getItem("accessToken")||localStorage.getItem("token"),r={"Content-Type":"application/json"};return a&&(r.Authorization=`Bearer ${a}`),r}async fetch(a,r={}){const{skipAuth:i=!1,headers:n={},...c}=r,o=i?n:{...this.getAuthHeaders(),...n},l=a.startsWith("http")?a:`${this.baseUrl}${a}`,u=await fetch(l,{...c,headers:o});if(u.status===401&&!i)throw localStorage.removeItem("accessToken"),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login",new Error("Unauthorized");return u}async get(a,r){const i=await this.fetch(a,{...r,method:"GET"});if(!i.ok)throw new Error(`API Error: ${i.statusText}`);return i.json()}async post(a,r,i){const n=await this.fetch(a,{...i,method:"POST",body:r?JSON.stringify(r):void 0});if(!n.ok)throw new Error(`API Error: ${n.statusText}`);return n.json()}async put(a,r,i){const n=await this.fetch(a,{...i,method:"PUT",body:r?JSON.stringify(r):void 0});if(!n.ok)throw new Error(`API Error: ${n.statusText}`);return n.json()}async delete(a,r){const i=await this.fetch(a,{...r,method:"DELETE"});if(!i.ok)throw new Error(`API Error: ${i.statusText}`);return i.json()}}const $=new je,ye=()=>{const[f,a]=g.useState(!1),[r,i]=g.useState(null),[n,c]=g.useState({name:"",slug:"",description:"",parentId:""}),o=re(),{data:l=[],isLoading:u}=ie({queryKey:["categories"],queryFn:async()=>{try{return await $.get("/categories")}catch{return[{id:"1",name:"Announcements",slug:"announcements",postCount:5},{id:"2",name:"Guides",slug:"guides",postCount:12},{id:"3",name:"News",slug:"news",postCount:8}]}}}),v=T({mutationFn:async t=>r?$.put(`/categories/${r.id}`,t):$.post("/categories",t),onSuccess:()=>{o.invalidateQueries({queryKey:["categories"]}),h.success(r?"카테고리가 수정되었습니다":"카테고리가 생성되었습니다"),D()},onError:()=>{h.error("카테고리 저장에 실패했습니다")}}),O=T({mutationFn:async t=>$.delete(`/categories/${t}`),onSuccess:()=>{o.invalidateQueries({queryKey:["categories"]}),h.success("카테고리가 삭제되었습니다")},onError:()=>{h.error("카테고리 삭제에 실패했습니다")}}),p=t=>{t?(i(t),c({name:t.name,slug:t.slug,description:t.description||"",parentId:t.parentId||""})):(i(null),c({name:"",slug:"",description:"",parentId:""})),a(!0)},D=()=>{a(!1),i(null),c({name:"",slug:"",description:"",parentId:""})},k=t=>{t.preventDefault(),v.mutate(n)},N=t=>{confirm(`정말 이 카테고리를 삭제하시겠습니까?
하위 카테고리가 있다면 함께 삭제됩니다.`)&&O.mutate(t)},E=t=>t.toLowerCase().replace(/[^a-z0-9가-힣]+/g,"-").replace(/^-+|-+$/g,""),A=t=>{const m=new Map,j=[];return t.forEach(x=>{m.set(x.id,{...x,children:[]})}),t.forEach(x=>{const I=m.get(x.id);if(x.parentId){const s=m.get(x.parentId);s&&(s.children=s.children||[],s.children.push(I))}else j.push(I)}),j},F=(t,m=0)=>e.jsxs("div",{className:m>0?"ml-8":"",children:[e.jsxs(C,{className:"mb-4",children:[e.jsx(z,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.children&&t.children.length>0&&e.jsx(oe,{className:"w-4 h-4 text-gray-400"}),e.jsx(K,{className:"text-lg",children:t.name})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["/",t.slug]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Q,{variant:"secondary",children:[t.postCount||0,"개 게시글"]}),e.jsxs(te,{children:[e.jsx(ae,{children:e.jsx(d,{variant:"ghost",size:"sm",children:e.jsx(J,{className:"w-4 h-4"})})}),e.jsxs(ne,{align:"end",children:[e.jsxs(L,{onClick:()=>p(t),children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"수정"]}),e.jsxs(L,{onClick:()=>N(t.id),className:"text-red-600",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]})]})}),t.description&&e.jsx(S,{children:e.jsx("p",{className:"text-sm text-gray-600",children:t.description})})]}),t.children&&t.children.map(j=>F(j,m+1))]},t.id),M=A(l);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("p",{className:"text-gray-600",children:"계층 구조로 콘텐츠를 체계적으로 분류합니다"}),e.jsxs(d,{onClick:()=>p(),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"새 카테고리"]})]}),u?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):l.length>0?e.jsx("div",{children:M.map(t=>F(t))}):e.jsx(C,{children:e.jsxs(S,{className:"text-center py-12",children:[e.jsx(ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"카테고리가 없습니다"}),e.jsxs(d,{onClick:()=>p(),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"첫 카테고리 만들기"]})]})}),e.jsx(W,{open:f,onOpenChange:a,children:e.jsx(X,{children:e.jsxs("form",{onSubmit:k,children:[e.jsxs(Y,{children:[e.jsx(Z,{children:r?"카테고리 수정":"새 카테고리"}),e.jsx(_,{children:"게시물을 분류할 카테고리를 만들어보세요"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"name",children:"이름"}),e.jsx(P,{id:"name",value:n.name,onChange:t=>{c({...n,name:t.target.value,slug:E(t.target.value)})},placeholder:"예: 공지사항",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"slug",children:"슬러그"}),e.jsx(P,{id:"slug",value:n.slug,onChange:t=>c({...n,slug:t.target.value}),placeholder:"notice",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"URL에 사용되는 고유 식별자입니다"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"description",children:"설명 (선택)"}),e.jsx(ee,{id:"description",value:n.description,onChange:t=>c({...n,description:t.target.value}),placeholder:"이 카테고리에 대한 설명을 입력하세요",rows:3})]}),l.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"parent",children:"상위 카테고리 (선택)"}),e.jsxs(he,{value:n.parentId,onValueChange:t=>c({...n,parentId:t}),children:[e.jsx(ue,{children:e.jsx(me,{placeholder:"상위 카테고리 선택"})}),e.jsxs(xe,{children:[e.jsx(H,{value:"",children:"없음"}),l.filter(t=>t.id!==r?.id).map(t=>e.jsx(H,{value:t.id,children:t.name},t.id))]})]})]})]}),e.jsxs(se,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:D,children:"취소"}),e.jsx(d,{type:"submit",disabled:v.isPending,children:v.isPending?"저장 중...":"저장"})]})]})})})]})},fe=()=>{const[f,a]=g.useState(!1),[r,i]=g.useState(null),[n,c]=g.useState([]),[o,l]=g.useState({name:"",slug:"",description:""}),u=re(),{data:v=[],isLoading:O}=ie({queryKey:["tags"],queryFn:async()=>(await w.api.get("/tags")).data}),p=T({mutationFn:async s=>r?w.api.put(`/tags/${r.id}`,s):w.api.post("/tags",s),onSuccess:()=>{u.invalidateQueries({queryKey:["tags"]}),h.success(r?"태그가 수정되었습니다":"태그가 생성되었습니다"),E()},onError:()=>{h.error("태그 저장에 실패했습니다")}}),D=T({mutationFn:async s=>w.api.delete(`/tags/${s}`),onSuccess:()=>{u.invalidateQueries({queryKey:["tags"]}),h.success("태그가 삭제되었습니다")},onError:()=>{h.error("태그 삭제에 실패했습니다")}}),k=T({mutationFn:async s=>w.api.post("/tags/bulk-delete",{ids:s}),onSuccess:()=>{u.invalidateQueries({queryKey:["tags"]}),h.success(`${n.length}개의 태그가 삭제되었습니다`),c([])},onError:()=>{h.error("태그 일괄 삭제에 실패했습니다")}}),N=s=>{s?(i(s),l({name:s.name,slug:s.slug,description:s.description||""})):(i(null),l({name:"",slug:"",description:""})),a(!0)},E=()=>{a(!1),i(null),l({name:"",slug:"",description:""})},A=s=>{s.preventDefault(),p.mutate(o)},F=s=>{confirm("정말 이 태그를 삭제하시겠습니까?")&&D.mutate(s)},M=()=>{confirm(`정말 ${n.length}개의 태그를 삭제하시겠습니까?`)&&k.mutate(n)},t=s=>s.toLowerCase().replace(/[^a-z0-9가-힣]+/g,"-").replace(/^-+|-+$/g,""),m=s=>{c(b=>b.includes(s)?b.filter(le=>le!==s):[...b,s])},j=[...v].sort((s,b)=>(b.postCount||0)-(s.postCount||0)),x=s=>s>=50?"text-lg font-semibold":s>=20?"text-base font-medium":s>=10?"text-sm":"text-xs",I=s=>s>=50?"bg-blue-100 text-blue-800 hover:bg-blue-200":s>=20?"bg-green-100 text-green-800 hover:bg-green-200":s>=10?"bg-gray-100 text-gray-800 hover:bg-gray-200":"bg-gray-50 text-gray-600 hover:bg-gray-100";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("p",{className:"text-gray-600",children:"키워드로 콘텐츠를 유연하게 분류합니다"}),e.jsxs("div",{className:"flex gap-2",children:[n.length>0&&e.jsxs(d,{variant:"destructive",onClick:M,disabled:k.isPending,children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),n.length,"개 삭제"]}),e.jsxs(d,{onClick:()=>N(),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"새 태그"]})]})]}),O?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):v.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(C,{className:"mb-6",children:[e.jsx(z,{children:e.jsx(K,{className:"text-lg",children:"태그 클라우드"})}),e.jsx(S,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:j.slice(0,30).map(s=>e.jsxs(Q,{variant:"secondary",className:`cursor-pointer transition-colors ${x(s.postCount||0)} ${I(s.postCount||0)}`,onClick:()=>N(s),children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),s.name,e.jsxs("span",{className:"ml-1 opacity-60",children:["(",s.postCount||0,")"]})]},s.id))})})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:j.map(s=>e.jsxs(C,{className:n.includes(s.id)?"ring-2 ring-blue-500":"",children:[e.jsx(z,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:n.includes(s.id),onChange:()=>m(s.id)}),e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsxs(K,{className:"text-lg flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),s.name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["/",s.slug]})]})]}),e.jsxs(te,{children:[e.jsx(ae,{children:e.jsx(d,{variant:"ghost",size:"sm",children:e.jsx(J,{className:"w-4 h-4"})})}),e.jsxs(ne,{align:"end",children:[e.jsxs(L,{onClick:()=>N(s),children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"수정"]}),e.jsxs(L,{onClick:()=>F(s.id),className:"text-red-600",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]})}),e.jsxs(S,{children:[s.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs(Q,{variant:"outline",children:[s.postCount||0,"개 게시글"]}),e.jsx("span",{className:"text-gray-500",children:new Date(s.createdAt).toLocaleDateString()})]})]})]},s.id))})]}):e.jsx(C,{children:e.jsxs(S,{className:"text-center py-12",children:[e.jsx(V,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"태그가 없습니다"}),e.jsxs(d,{onClick:()=>N(),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"첫 태그 만들기"]})]})}),e.jsx(W,{open:f,onOpenChange:a,children:e.jsx(X,{children:e.jsxs("form",{onSubmit:A,children:[e.jsxs(Y,{children:[e.jsx(Z,{children:r?"태그 수정":"새 태그"}),e.jsx(_,{children:"게시물에 사용할 태그를 만들어보세요"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"name",children:"이름"}),e.jsx(P,{id:"name",value:o.name,onChange:s=>{l({...o,name:s.target.value,slug:t(s.target.value)})},placeholder:"예: React",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"slug",children:"슬러그"}),e.jsx(P,{id:"slug",value:o.slug,onChange:s=>l({...o,slug:s.target.value}),placeholder:"react",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"URL에 사용되는 고유 식별자입니다"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"description",children:"설명 (선택)"}),e.jsx(ee,{id:"description",value:o.description,onChange:s=>l({...o,description:s.target.value}),placeholder:"이 태그에 대한 설명을 입력하세요",rows:3})]})]}),e.jsxs(se,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:E,children:"취소"}),e.jsx(d,{type:"submit",disabled:p.isPending,children:p.isPending?"저장 중...":"저장"})]})]})})})]})};function Pe(){const[f,a]=g.useState("categories");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"카테고리 & 태그"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"콘텐츠를 체계적으로 분류하고 관리합니다"})]}),e.jsxs(ge,{value:f,onValueChange:a,className:"w-full",children:[e.jsxs(pe,{className:"grid w-full grid-cols-2 max-w-[400px]",children:[e.jsx(R,{value:"categories",children:"카테고리"}),e.jsx(R,{value:"tags",children:"태그"})]}),e.jsx(B,{value:"categories",className:"mt-6",children:e.jsx(ye,{})}),e.jsx(B,{value:"tags",className:"mt-6",children:e.jsx(fe,{})})]})]})}export{Pe as default};
