import{_ as o}from"./wp-i18n-CvFqmxct.js";import{n as w,g as R,a as h,h as p,b as g,r as _}from"./wp-misc-BM-YUiZN.js";import"./wp-core-DsNNoVDq.js";import"./vendor-react-CPLvoCm3.js";import"./wp-block-editor-Dl58kgFV.js";import"./wp-blocks-core-Bps80Ozc.js";import"./wp-data-CXbtpCh2.js";import"./wp-components-YCGeKRou.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-utils-D_7XgcHg.js";import"./wp-api-pXRzUPJ4.js";import"./vendor-monaco-cpVGocfO.js";function b(e){const r=(t,a)=>{const{headers:c={}}=t;for(const n in c)if(n.toLowerCase()==="x-wp-nonce"&&c[n]===r.nonce)return a(t);return a({...t,headers:{...c,"X-WP-Nonce":r.nonce}})};return r.nonce=e,r}const P=(e,r)=>{let t=e.path,a,c;return typeof e.namespace=="string"&&typeof e.endpoint=="string"&&(a=e.namespace.replace(/^\/|\/$/g,""),c=e.endpoint.replace(/^\//,""),c?t=a+"/"+c:t=a),delete e.namespace,delete e.endpoint,r({...e,path:t})},U=e=>(r,t)=>P(r,a=>{let c=a.url,n=a.path,d;return typeof n=="string"&&(d=e,e.indexOf("?")!==-1&&(n=n.replace("?","&")),n=n.replace(/^\//,""),typeof d=="string"&&d.indexOf("?")!==-1&&(n=n.replace("?","&")),c=d+n),t({...a,url:c})});function x(e){const r=Object.fromEntries(Object.entries(e).map(([t,a])=>[w(t),a]));return(t,a)=>{const{parse:c=!0}=t;let n=t.path;if(!n&&t.url){const{rest_route:u,...l}=R(t.url);typeof u=="string"&&(n=h(u,l))}if(typeof n!="string")return a(t);const d=t.method||"GET",i=w(n);if(d==="GET"&&r[i]){const u=r[i];return delete r[i],y(u,!!c)}else if(d==="OPTIONS"&&r[d]&&r[d][i]){const u=r[d][i];return delete r[d][i],y(u,!!c)}return a(t)}}function y(e,r){if(r)return Promise.resolve(e.body);try{return Promise.resolve(new window.Response(JSON.stringify(e.body),{status:200,statusText:"OK",headers:e.headers}))}catch{return Object.entries(e.headers).forEach(([t,a])=>{t.toLowerCase()==="link"&&(e.headers[t]=a.replace(/<([^>]+)>/,(c,n)=>`<${encodeURI(n)}>`))}),Promise.resolve(r?e.body:new window.Response(JSON.stringify(e.body),{status:200,statusText:"OK",headers:e.headers}))}}const N=({path:e,url:r,...t},a)=>({...t,url:r&&h(r,a),path:e&&h(e,a)}),T=e=>e.json?e.json():Promise.reject(e),S=e=>{if(!e)return{};const r=e.match(/<([^>]+)>; rel="next"/);return r?{next:r[1]}:{}},E=e=>{const{next:r}=S(e.headers.get("link"));return r},H=e=>{const r=!!e.path&&e.path.indexOf("per_page=-1")!==-1,t=!!e.url&&e.url.indexOf("per_page=-1")!==-1;return r||t},O=async(e,r)=>{if(e.parse===!1||!H(e))return r(e);const t=await s({...N(e,{per_page:100}),parse:!1}),a=await T(t);if(!Array.isArray(a))return a;let c=E(t);if(!c)return a;let n=[].concat(a);for(;c;){const d=await s({...e,path:void 0,url:c,parse:!1}),i=await T(d);n=n.concat(i),c=E(d)}return n},L=new Set(["PATCH","PUT","DELETE"]),C="GET",F=(e,r)=>{const{method:t=C}=e;return L.has(t.toUpperCase())&&(e={...e,headers:{...e.headers,"X-HTTP-Method-Override":t,"Content-Type":"application/json"},method:"POST"}),r(e)},Q=(e,r)=>(typeof e.url=="string"&&!p(e.url,"_locale")&&(e.url=h(e.url,{_locale:"user"})),typeof e.path=="string"&&!p(e.path,"_locale")&&(e.path=h(e.path,{_locale:"user"})),r(e)),k=(e,r=!0)=>r?e.status===204?null:e.json?e.json():Promise.reject(e):e,I=e=>{const r={code:"invalid_json",message:o("The response is not a valid JSON response.")};if(!e||!e.json)throw r;return e.json().catch(()=>{throw r})},v=(e,r=!0)=>Promise.resolve(k(e,r)).catch(t=>m(t,r));function m(e,r=!0){if(!r)throw e;return I(e).then(t=>{const a={code:"unknown_error",message:o("An unknown error occurred.")};throw t||a})}function J(e){const r=!!e.method&&e.method==="POST";return(!!e.path&&e.path.indexOf("/wp/v2/media")!==-1||!!e.url&&e.url.indexOf("/wp/v2/media")!==-1)&&r}const $=(e,r)=>{if(!J(e))return r(e);let t=0;const a=5,c=n=>(t++,r({path:`/wp/v2/media/${n}/post-process`,method:"POST",data:{action:"create-image-subsizes"},parse:!1}).catch(()=>t<a?c(n):(r({path:`/wp/v2/media/${n}?force=true`,method:"DELETE"}),Promise.reject())));return r({...e,parse:!1}).catch(n=>{if(!n.headers)return Promise.reject(n);const d=n.headers.get("x-wp-upload-attachment-id");return n.status>=500&&n.status<600&&d?c(d).catch(()=>e.parse!==!1?Promise.reject({code:"post_process",message:o("Media upload failed. If this is a photo or a large image, please scale it down and try again.")}):Promise.reject(n)):m(n,e.parse)}).then(n=>v(n,e.parse))},z=e=>(r,t)=>{if(typeof r.url=="string"){const a=g(r.url,"wp_theme_preview");a===void 0?r.url=h(r.url,{wp_theme_preview:e}):a===""&&(r.url=_(r.url,"wp_theme_preview"))}if(typeof r.path=="string"){const a=g(r.path,"wp_theme_preview");a===void 0?r.path=h(r.path,{wp_theme_preview:e}):a===""&&(r.path=_(r.path,"wp_theme_preview"))}return t(r)},D={Accept:"application/json, */*;q=0.1"},q={credentials:"include"},M=[Q,P,F,O];function G(e){M.unshift(e)}const A=e=>{if(e.status>=200&&e.status<300)return e;throw e},K=e=>{const{url:r,path:t,data:a,parse:c=!0,...n}=e;let{body:d,headers:i}=e;return i={...D,...i},a&&(d=JSON.stringify(a),i["Content-Type"]="application/json"),window.fetch(r||t||window.location.href,{...q,...n,body:d,headers:i}).then(l=>Promise.resolve(l).then(A).catch(f=>m(f,c)).then(f=>v(f,c)),l=>{throw l&&l.name==="AbortError"?l:{code:"fetch_error",message:o("You are probably offline.")}})};let j=K;function V(e){j=e}function s(e){return M.reduceRight((t,a)=>c=>a(c,t),j)(e).catch(t=>t.code!=="rest_cookie_invalid_nonce"?Promise.reject(t):window.fetch(s.nonceEndpoint).then(A).then(a=>a.text()).then(a=>(s.nonceMiddleware.nonce=a,s(e))))}s.use=G;s.setFetchHandler=V;s.createNonceMiddleware=b;s.createPreloadingMiddleware=x;s.createRootURLMiddleware=U;s.fetchAllMiddleware=O;s.mediaUploadMiddleware=$;s.createThemePreviewMiddleware=z;export{s as default};
