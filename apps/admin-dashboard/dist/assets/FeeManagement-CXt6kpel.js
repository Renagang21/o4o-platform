import{r as e,j as s,bK as t,dm as i,bO as a,bQ as r,bM as n,dn as d,V as l}from"./vendor-react-BQ6HOJoh.js";import{u as c,a as o,b as m}from"./vendor-query-LYSOqK5P.js";import{B as x,L as p,I as j,b as h}from"./page-template-editor-C7FodHrK.js";import{ak as u,al as v,am as y,an as b,av as f,az as g,aA as N,aB as w,aC as F,aD as k,aE as A}from"./wp-misc-DS9m4_P2.js";import"./wp-block-editor-a11y-DrduSWFW.js";import"./wp-block-editor-misc-pHCPYvR2.js";import"./wp-block-editor-api-Buev8_QU.js";import"./wp-block-editor-utils-M5qXzE1L.js";import"./wp-block-editor-colors-D38h-Odz.js";import"./wp-blocks-core-6vwQKPfS.js";import"./wp-block-editor-clipboard-Dg0Y1gQ6.js";import"./wp-block-editor-store-B-g1aSix.js";import"./vendor-ui-CrFdsnXa.js";import"./wp-block-editor-dnd-BYoS8-II.js";import"./wp-block-editor-library-BpQvynjE.js";import"./wp-block-editor-menus-BTQ2wZ-f.js";import"./wp-block-editor-keyboard-CeHTtvP5.js";import"./wp-block-editor-typography-Bl_1REQP.js";import"./wp-block-editor-spacing-BD_2CpN7.js";import"./wp-block-editor-core-DL280tSA.js";import"./wp-block-editor-selection-CC4tJpUu.js";import"./wp-block-editor-formats-CLXkimOp.js";import"./wp-block-editor-inline-CpXpUhQU.js";import"./wp-block-editor-ui-B8YE_4QL.js";import"./wp-block-editor-transforms-jLcKa8Hv.js";import"./wp-block-editor-preview-iw2Xu1ib.js";import"./wp-block-editor-global-styles-CV5-K6QF.js";import"./wp-block-editor-borders-BH1devca.js";import"./wp-block-editor-patterns-BXdHo9lm.js";import"./wp-block-editor-navigation-BFSoKzg0.js";import"./wp-block-editor-media-Bg-JiQDT.js";import"./wp-api-BeoadipR.js";import"./wp-i18n-DGPtqsXY.js";import"./wp-core-Y-jV-nrZ.js";import"./vendor-monaco-BxJH8uUv.js";import"./wp-block-editor-upload-BLw1R9wP.js";import"./vendor-utils-D-spY-QM.js";import"./wp-block-editor-templates-o1_wAMb9.js";import"./wp-data-BmtL8k4r.js";import"./wp-components-CeQNCpMW.js";const C=()=>{const C=c(),[R,q]=e.useState(!1),[S,I]=e.useState(!1),[K,D]=e.useState(null),[M,z]=e.useState(1e5),[B,Q]=e.useState({name:"",type:"platform",baseRate:5,minFee:0,maxFee:0,isActive:!0,conditions:[],description:""}),{data:$,isLoading:_}=o({queryKey:["fee-policies"],queryFn:async()=>(await h.api.get("/v1/settlements/fee-policies")).data}),L=$?.data||[],{data:O}=o({queryKey:["fee-calculation",M],queryFn:async()=>(await h.api.post("/v1/settlements/calculate-fee",{orderAmount:M,categoryId:"cat-1",vendorTier:"standard",paymentMethod:"card"})).data,enabled:M>0}),E=O?.data||{},P=m({mutationFn:async e=>(await h.api.post("/v1/settlements/fee-policies",e)).data,onSuccess:()=>{l.success("수수료 정책이 생성되었습니다"),C.invalidateQueries({queryKey:["fee-policies"]}),q(!1),V()}}),G=m({mutationFn:async({id:e,data:s})=>(await h.api.put(`/v1/settlements/fee-policies/${e}`,s)).data,onSuccess:()=>{l.success("수수료 정책이 수정되었습니다"),C.invalidateQueries({queryKey:["fee-policies"]}),I(!1),V()}}),H=m({mutationFn:async e=>(await h.api.delete(`/v1/settlements/fee-policies/${e}`)).data,onSuccess:()=>{l.success("수수료 정책이 삭제되었습니다"),C.invalidateQueries({queryKey:["fee-policies"]})}}),T=m({mutationFn:async({id:e,isActive:s})=>(await h.api.patch(`/v1/settlements/fee-policies/${e}/toggle`,{isActive:s})).data,onSuccess:()=>{l.success("수수료 정책 상태가 변경되었습니다"),C.invalidateQueries({queryKey:["fee-policies"]})}}),V=()=>{Q({name:"",type:"platform",baseRate:5,minFee:0,maxFee:0,isActive:!0,conditions:[],description:""}),D(null)},J=e=>{switch(e){case"platform":return"기본 플랫폼";case"category":return"카테고리별";case"vendor_tier":return"판매자 등급별";case"payment_method":return"결제 수단별";default:return e}},U=e=>`₩${e.toLocaleString()}`;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"수수료 정책 관리"}),s.jsx("p",{className:"text-modern-text-secondary mt-1",children:"플랫폼 수수료 정책 설정 및 관리"})]}),s.jsxs(x,{onClick:()=>q(!0),children:[s.jsx(t,{className:"w-4 h-4 mr-2"}),"정책 추가"]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsxs(u,{children:[s.jsx(v,{children:s.jsx(y,{children:"수수료 정책 목록"})}),s.jsx(b,{children:s.jsx("div",{className:"space-y-4",children:_?s.jsx("div",{className:"flex justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):0===L.length?s.jsx("div",{className:"text-center py-8 text-modern-text-secondary",children:"수수료 정책이 없습니다."}):L.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("h3",{className:"font-semibold text-modern-text-primary",children:e.name}),s.jsx(f,{variant:e.isActive?"default":"secondary",children:e.isActive?"활성":"비활성"}),s.jsx(f,{variant:"outline",children:J(e.type)})]}),s.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(i,{className:"w-4 h-4 text-modern-text-secondary"}),s.jsxs("span",{className:"text-sm text-modern-text-secondary",children:[e.baseRate,"%"]})]}),e.minFee&&s.jsxs("span",{className:"text-sm text-modern-text-secondary",children:["최소: ",U(e.minFee)]}),e.maxFee&&s.jsxs("span",{className:"text-sm text-modern-text-secondary",children:["최대: ",U(e.maxFee)]})]}),e.description&&s.jsx("p",{className:"text-sm text-modern-text-tertiary mt-1",children:e.description})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(x,{variant:"ghost",size:"sm",onClick:()=>T.mutate({id:e.id,isActive:!e.isActive}),children:s.jsx(a,{className:"w-4 h-4"})}),s.jsx(x,{variant:"ghost",size:"sm",onClick:()=>(e=>{D(e),Q({name:e.name,type:e.type,baseRate:e.baseRate,minFee:e.minFee,maxFee:e.maxFee,isActive:e.isActive,conditions:e.conditions,description:e.description}),I(!0)})(e),children:s.jsx(r,{className:"w-4 h-4"})}),s.jsx(x,{variant:"ghost",size:"sm",onClick:()=>H.mutate(e.id),children:s.jsx(n,{className:"w-4 h-4"})})]})]},e.id))})})]})}),s.jsxs("div",{children:[s.jsxs(u,{children:[s.jsx(v,{children:s.jsxs(y,{className:"flex items-center gap-2",children:[s.jsx(d,{className:"w-5 h-5"}),"수수료 계산기"]})}),s.jsxs(b,{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(p,{htmlFor:"testAmount",children:"주문 금액"}),s.jsx(j,{id:"testAmount",type:"number",value:M,onChange:e=>z(parseInt(e.target.value)||0),placeholder:"주문 금액 입력"})]}),E.breakdown&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"p-3 bg-modern-bg-secondary rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-modern-text-secondary",children:"수수료 내역"}),s.jsx("div",{className:"space-y-2 mt-2",children:E.breakdown.map((e,t)=>s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsxs("span",{className:"text-modern-text-secondary",children:[e.name," (",e.rate,"%)"]}),s.jsx("span",{className:"font-medium",children:U(e.amount)})]},t))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-modern-text-secondary",children:"주문 금액"}),s.jsx("span",{className:"font-medium",children:U(E.orderAmount)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-modern-text-secondary",children:"플랫폼 수수료"}),s.jsxs("span",{className:"font-medium text-blue-600",children:["-",U(E.platformFee)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-modern-text-secondary",children:"토스 수수료"}),s.jsxs("span",{className:"font-medium text-orange-600",children:["-",U(E.tossFee)]})]}),s.jsx("div",{className:"border-t pt-2",children:s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium text-modern-text-primary",children:"판매자 수령액"}),s.jsx("span",{className:"font-bold text-green-600",children:U(E.vendorAmount)})]})})]})]})]})]}),s.jsxs(u,{className:"mt-4",children:[s.jsx(v,{children:s.jsx(y,{children:"정책 요약"})}),s.jsx(b,{children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-modern-text-secondary",children:"활성 정책"}),s.jsxs("span",{className:"font-medium",children:[L.filter(e=>e.isActive).length,"개"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-modern-text-secondary",children:"전체 정책"}),s.jsxs("span",{className:"font-medium",children:[L.length,"개"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-modern-text-secondary",children:"기본 수수료율"}),s.jsxs("span",{className:"font-medium",children:[L.find(e=>"platform"===e.type&&e.isActive)?.baseRate||0,"%"]})]})]})})]})]})]}),s.jsx(g,{open:R,onOpenChange:q,children:s.jsx(N,{className:"max-w-md",children:s.jsxs("form",{onSubmit:e=>{e.preventDefault(),B.name&&B.baseRate?P.mutate(B):l.error("필수 정보를 입력하세요")},children:[s.jsxs(w,{children:[s.jsx(F,{children:"수수료 정책 추가"}),s.jsx(k,{children:"새로운 수수료 정책을 설정합니다."})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{children:[s.jsx(p,{htmlFor:"name",children:"정책명 *"}),s.jsx(j,{id:"name",value:B.name,onChange:e=>Q(s=>({...s,name:e.target.value})),placeholder:"정책명을 입력하세요",required:!0})]}),s.jsxs("div",{children:[s.jsx(p,{htmlFor:"type",children:"정책 유형 *"}),s.jsxs("select",{id:"type",value:B.type,onChange:e=>Q(s=>({...s,type:e.target.value})),className:"w-full px-3 py-2 border border-modern-border-primary rounded-lg mt-1",required:!0,children:[s.jsx("option",{value:"platform",children:"기본 플랫폼"}),s.jsx("option",{value:"category",children:"카테고리별"}),s.jsx("option",{value:"vendor_tier",children:"판매자 등급별"}),s.jsx("option",{value:"payment_method",children:"결제 수단별"})]})]}),s.jsxs("div",{children:[s.jsx(p,{htmlFor:"baseRate",children:"기본 수수료율 (%) *"}),s.jsx(j,{id:"baseRate",type:"number",step:"0.1",min:"0",max:"100",value:B.baseRate,onChange:e=>Q(s=>({...s,baseRate:parseFloat(e.target.value)||0})),required:!0})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(p,{htmlFor:"minFee",children:"최소 수수료 (원)"}),s.jsx(j,{id:"minFee",type:"number",min:"0",value:B.minFee,onChange:e=>Q(s=>({...s,minFee:parseInt(e.target.value)||0}))})]}),s.jsxs("div",{children:[s.jsx(p,{htmlFor:"maxFee",children:"최대 수수료 (원)"}),s.jsx(j,{id:"maxFee",type:"number",min:"0",value:B.maxFee,onChange:e=>Q(s=>({...s,maxFee:parseInt(e.target.value)||0}))})]})]}),s.jsxs("div",{children:[s.jsx(p,{htmlFor:"description",children:"설명"}),s.jsx(j,{id:"description",value:B.description,onChange:e=>Q(s=>({...s,description:e.target.value})),placeholder:"정책 설명을 입력하세요"})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"isActive",checked:B.isActive,onChange:e=>Q(s=>({...s,isActive:e.target.checked})),className:"mr-2"}),s.jsx(p,{htmlFor:"isActive",children:"정책 활성화"})]})]}),s.jsxs(A,{children:[s.jsx(x,{type:"button",variant:"outline",onClick:()=>q(!1),children:"취소"}),s.jsx(x,{type:"submit",disabled:P.isPending,children:"생성"})]})]})})}),s.jsx(g,{open:S,onOpenChange:I,children:s.jsx(N,{className:"max-w-md",children:s.jsxs("form",{onSubmit:e=>{e.preventDefault(),K&&B.name&&B.baseRate?G.mutate({id:K.id,data:B}):l.error("필수 정보를 입력하세요")},children:[s.jsxs(w,{children:[s.jsx(F,{children:"수수료 정책 수정"}),s.jsxs(k,{children:[K?.name," 정책을 수정합니다."]})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{children:[s.jsx(p,{htmlFor:"editName",children:"정책명 *"}),s.jsx(j,{id:"editName",value:B.name,onChange:e=>Q(s=>({...s,name:e.target.value})),placeholder:"정책명을 입력하세요",required:!0})]}),s.jsxs("div",{children:[s.jsx(p,{htmlFor:"editBaseRate",children:"기본 수수료율 (%) *"}),s.jsx(j,{id:"editBaseRate",type:"number",step:"0.1",min:"0",max:"100",value:B.baseRate,onChange:e=>Q(s=>({...s,baseRate:parseFloat(e.target.value)||0})),required:!0})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(p,{htmlFor:"editMinFee",children:"최소 수수료 (원)"}),s.jsx(j,{id:"editMinFee",type:"number",min:"0",value:B.minFee,onChange:e=>Q(s=>({...s,minFee:parseInt(e.target.value)||0}))})]}),s.jsxs("div",{children:[s.jsx(p,{htmlFor:"editMaxFee",children:"최대 수수료 (원)"}),s.jsx(j,{id:"editMaxFee",type:"number",min:"0",value:B.maxFee,onChange:e=>Q(s=>({...s,maxFee:parseInt(e.target.value)||0}))})]})]}),s.jsxs("div",{children:[s.jsx(p,{htmlFor:"editDescription",children:"설명"}),s.jsx(j,{id:"editDescription",value:B.description,onChange:e=>Q(s=>({...s,description:e.target.value})),placeholder:"정책 설명을 입력하세요"})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"editIsActive",checked:B.isActive,onChange:e=>Q(s=>({...s,isActive:e.target.checked})),className:"mr-2"}),s.jsx(p,{htmlFor:"editIsActive",children:"정책 활성화"})]})]}),s.jsxs(A,{children:[s.jsx(x,{type:"button",variant:"outline",onClick:()=>I(!1),children:"취소"}),s.jsx(x,{type:"submit",disabled:G.isPending,children:"수정"})]})]})})})]})};export{C as default};
