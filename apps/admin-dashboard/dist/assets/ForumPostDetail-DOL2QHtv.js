import{a2 as B,a1 as V,r as h,V as m,j as e,a3 as I,dE as J,c8 as O,J as z,O as G,cy as H,E as U,z as W,dF as X}from"./vendor-react-LfmQXg7x.js";import{u as Y,a as D,b as u}from"./vendor-query-D_Ku9Rpr.js";import{j as i,B as n,s as x,T as N,D as Z,n as _,o as ee,r as E}from"./page-gutenberg-Bgd5YFXg.js";import"./wp-blocks-CxaEvwYA.js";import"./wp-i18n-DqTnaU2e.js";import"./wp-core-B49sp2kV.js";import"./vendor-ui-BkLtITBR.js";import"./wp-misc-ifGAUd0I.js";import"./wp-data-DJ51zZuL.js";import"./vendor-monaco-cpVGocfO.js";import"./vendor-utils-DQ8F5vJI.js";import"./wp-components-CCcEz8J1.js";const xe=()=>{const{id:a}=B(),w=V(),c=Y(),[l,o]=h.useState(""),[M,j]=h.useState(null),[P,v]=h.useState(null),[y,p]=h.useState(""),{data:S,isLoading:F}=D({queryKey:["forum-post",a],queryFn:async()=>(await i.api.get(`/v1/forum/posts/${a}`)).data}),t=S?.data,{data:$,isLoading:K}=D({queryKey:["forum-comments",a],queryFn:async()=>(await i.api.get(`/v1/forum/posts/${a}/comments`)).data}),f=$?.data||[],g=u({mutationFn:async s=>(await i.api.post(`/v1/forum/posts/${a}/comments`,s)).data,onSuccess:()=>{m.success("댓글이 작성되었습니다"),o(""),j(null),c.invalidateQueries({queryKey:["forum-comments",a]})}}),b=u({mutationFn:async({commentId:s,content:r})=>(await i.api.put(`/v1/forum/comments/${s}`,{content:r})).data,onSuccess:()=>{m.success("댓글이 수정되었습니다"),v(null),p(""),c.invalidateQueries({queryKey:["forum-comments",a]})}}),Q=u({mutationFn:async s=>(await i.api.delete(`/v1/forum/comments/${s}`)).data,onSuccess:()=>{m.success("댓글이 삭제되었습니다"),c.invalidateQueries({queryKey:["forum-comments",a]})}}),R=u({mutationFn:async()=>(await i.api.post(`/v1/forum/posts/${a}/toggle-pin`)).data,onSuccess:()=>{m.success(t?.isPinned?"고정이 해제되었습니다":"게시글이 고정되었습니다"),c.invalidateQueries({queryKey:["forum-post",a]})}}),T=u({mutationFn:async()=>(await i.api.post(`/v1/forum/posts/${a}/toggle-lock`)).data,onSuccess:()=>{m.success(t?.isLocked?"잠금이 해제되었습니다":"게시글이 잠금되었습니다"),c.invalidateQueries({queryKey:["forum-post",a]})}}),C=s=>{l.trim()&&g.mutate({content:l,parentId:s})},A=s=>{y.trim()&&b.mutate({commentId:s,content:y})},k=s=>new Date(s).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),L=(s,r=0)=>{const q=P===s.id;return e.jsxs("div",{className:`${r>0?"ml-12":""}`,children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-modern-border-primary mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-modern-primary text-white rounded-full flex items-center justify-center text-sm font-medium",children:s.author.name.charAt(0)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-modern-text-primary",children:s.author.name}),e.jsx(x,{variant:"outline",className:"text-xs",children:s.author.role})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-modern-text-secondary",children:[e.jsx("span",{children:k(s.createdAt)}),s.isEdited&&e.jsx("span",{children:"(수정됨)"})]})]})]}),e.jsxs(Z,{children:[e.jsx(_,{children:e.jsx(n,{variant:"ghost",size:"sm",children:e.jsx(U,{className:"w-4 h-4"})})}),e.jsxs(ee,{align:"end",children:[e.jsxs(E,{onClick:()=>{v(s.id),p(s.content)},children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"수정"]}),e.jsxs(E,{className:"text-destructive",onClick:()=>{confirm("정말 삭제하시겠습니까?")&&Q.mutate(s.id)},children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]}),q?e.jsxs("div",{className:"space-y-3",children:[e.jsx(N,{value:y,onChange:d=>p(d.target.value),rows:3,className:"w-full"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",onClick:()=>A(s.id),disabled:b.isPending,children:"수정 완료"}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>{v(null),p("")},children:"취소"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-modern-text-primary mb-3 whitespace-pre-wrap",children:s.content}),!t?.isLocked&&e.jsxs(n,{size:"sm",variant:"ghost",onClick:()=>{j(s.id),o("")},children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"답글"]})]})]}),M===s.id&&!t?.isLocked&&e.jsxs("div",{className:"ml-12 mb-4",children:[e.jsx(N,{value:l,onChange:d=>o(d.target.value),placeholder:"답글을 작성하세요...",rows:3,className:"w-full mb-2"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",onClick:()=>C(s.id),disabled:g.isPending,children:"답글 작성"}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>{j(null),o("")},children:"취소"})]})]}),s.replies&&s.replies.map(d=>L(d,r+1))]},s.id)};return F?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):t?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>w("/forum"),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"게시판 목록"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>R.mutate(),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),t.isPinned?"고정 해제":"고정"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>T.mutate(),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),t.isLocked?"잠금 해제":"잠금"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>w(`/forum/posts/${a}/edit`),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"수정"]})]})]}),e.jsx("div",{className:"wp-card",children:e.jsx("div",{className:"wp-card-body",children:e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.isPinned&&e.jsx(x,{variant:"secondary",children:"고정"}),t.isLocked&&e.jsx(x,{variant:"outline",children:"잠김"}),e.jsx(x,{variant:"outline",children:t.category.name}),t.status==="reported"&&e.jsx(x,{variant:"destructive",children:"신고됨"})]}),e.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary mb-4",children:t.title}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-modern-primary text-white rounded-full flex items-center justify-center text-lg font-medium",children:t.author.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-modern-text-primary",children:t.author.name}),e.jsx("p",{className:"text-sm text-modern-text-secondary",children:k(t.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-modern-text-secondary",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.views," 조회"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.replyCount," 댓글"]})]})]})]}),e.jsx("div",{className:"prose prose-modern max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap text-modern-text-primary",children:t.content})})]})})}),e.jsxs("div",{className:"wp-card",children:[e.jsx("div",{className:"wp-card-header",children:e.jsxs("h2",{className:"text-lg font-semibold",children:["댓글 ",f.length,"개"]})}),e.jsxs("div",{className:"wp-card-body",children:[!t.isLocked&&e.jsxs("div",{className:"mb-6",children:[e.jsx(N,{value:l,onChange:s=>o(s.target.value),placeholder:"댓글을 작성하세요...",rows:4,className:"w-full mb-2"}),e.jsx(n,{onClick:()=>C(),disabled:g.isPending||!l.trim(),children:"댓글 작성"})]}),K?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary mx-auto"})}):f.length===0?e.jsx("p",{className:"text-center text-modern-text-secondary py-8",children:"아직 댓글이 없습니다."}):e.jsx("div",{className:"space-y-4",children:f.map(s=>L(s))})]})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-modern-text-secondary",children:"게시글을 찾을 수 없습니다."})})};export{xe as default};
