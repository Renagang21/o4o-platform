import{r as n,z as l,j as e,a1 as y,H as C,U as B,ar as M,ad as O}from"./vendor-react-P__8vGRG.js";import{B as o,L as d,I as b,T as q,S as H,d as I,e as L,f as $,g as V}from"./page-template-editor-BTdVTS-a.js";import{D as _,h as G,i as J,j as K,k as Q,l as W,C as w,B as h,a as X,b as Y,d as S}from"./index-C0gS3Jf3.js";import{C as R}from"./checkbox-CqkjQ2aW.js";import{U as x}from"./userApi-m_Dm3U7g.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-query-CucHvDcH.js";import"./vendor-utils-dq2XMRwt.js";import"./vendor-socket-DgcwqWsT.js";import"./unified-client-DYKT-pLO.js";const u=["#8b5cf6","#ef4444","#3b82f6","#10b981","#f59e0b","#ec4899","#6366f1","#06b6d4"];function de(){const[j,D]=n.useState([]),[A,k]=n.useState([]),[g,f]=n.useState(!0),[F,m]=n.useState(!1),[c,v]=n.useState(null),[t,r]=n.useState({name:"",displayName:"",description:"",color:u[0],permissions:[],isActive:!0});n.useEffect(()=>{p()},[]);const p=async()=>{try{f(!0);const[s,a]=await Promise.all([x.get("/api/v1/users/roles"),x.get("/api/v1/users/permissions")]);s.data.success&&D(s.data.data),a.data.success&&k(a.data.data)}catch{l.error("Failed to load roles and permissions")}finally{f(!1)}},P=async s=>{s.preventDefault();try{c?(await x.put(`/api/v1/users/roles/${c.id}`,t),l.success("Role updated successfully")):(await x.post("/api/v1/users/roles",t),l.success("Role created successfully")),m(!1),N(),p()}catch{l.error(c?"Failed to update role":"Failed to create role")}},E=s=>{v(s),r({name:s.name,displayName:s.displayName,description:s.description,color:s.color,permissions:s.permissions.map(a=>a.id),isActive:s.isActive}),m(!0)},T=async s=>{if(s.isSystem){l.error("Cannot delete system roles");return}if(s.userCount>0){l.error("Cannot delete role that is assigned to users");return}if(confirm(`Are you sure you want to delete the role "${s.displayName}"?`))try{await x.delete(`/api/v1/users/roles/${s.id}`),l.success("Role deleted successfully"),p()}catch{l.error("Failed to delete role")}},N=()=>{v(null),r({name:"",displayName:"",description:"",color:u[0],permissions:[],isActive:!0})},U=s=>{r(a=>({...a,permissions:a.permissions.includes(s)?a.permissions.filter(i=>i!==s):[...a.permissions,s]}))},z=A.reduce((s,a)=>(s[a.category]||(s[a.category]=[]),s[a.category].push(a),s),{});return g?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"h-48 bg-gray-200 rounded"},s))})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Role Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage user roles and permissions"})]}),e.jsxs(_,{open:F,onOpenChange:m,children:[e.jsx(G,{children:e.jsxs(o,{onClick:N,children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Create Role"]})}),e.jsxs(J,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(K,{children:[e.jsx(Q,{children:c?"Edit Role":"Create New Role"}),e.jsx(W,{children:c?"Update role information and permissions":"Define a new role with specific permissions"})]}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"name",children:"Role Name (Internal)"}),e.jsx(b,{id:"name",value:t.name,onChange:s=>r(a=>({...a,name:s.target.value})),placeholder:"admin, moderator, etc.",disabled:c?.isSystem,required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"displayName",children:"Display Name"}),e.jsx(b,{id:"displayName",value:t.displayName,onChange:s=>r(a=>({...a,displayName:s.target.value})),placeholder:"Administrator, Moderator, etc.",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"description",children:"Description"}),e.jsx(q,{id:"description",value:t.description,onChange:s=>r(a=>({...a,description:s.target.value})),placeholder:"Describe what this role is for...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"color",children:"Color"}),e.jsxs(H,{value:t.color,onValueChange:s=>r(a=>({...a,color:s})),children:[e.jsx(I,{children:e.jsx(L,{})}),e.jsx($,{children:u.map(s=>e.jsx(V,{value:s,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:s}}),s]})},s))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{id:"isActive",checked:t.isActive,onCheckedChange:s=>r(a=>({...a,isActive:!!s}))}),e.jsx(d,{htmlFor:"isActive",children:"Active Role"})]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Permissions"}),e.jsx("div",{className:"mt-2 space-y-4 max-h-64 overflow-y-auto border rounded-lg p-4",children:Object.entries(z).map(([s,a])=>e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700 mb-2 capitalize",children:s.replace("_"," ")}),e.jsx("div",{className:"space-y-2 ml-4",children:a.map(i=>e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(R,{id:i.id,checked:t.permissions.includes(i.id),onCheckedChange:()=>U(i.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx(d,{htmlFor:i.id,className:"text-sm font-medium",children:i.name}),e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]})]},i.id))})]},s))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(o,{type:"submit",className:"flex-1",children:c?"Update Role":"Create Role"}),e.jsx(o,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map(s=>e.jsxs(w,{className:"relative",children:[s.isSystem&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(h,{variant:"secondary",className:"text-xs",children:"System"})}),e.jsx(X,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center",style:{backgroundColor:s.color},children:e.jsx(C,{className:"h-3 w-3 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Y,{className:"text-lg",children:s.displayName}),e.jsx("p",{className:"text-sm text-gray-600",children:s.name})]})]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s.description||"No description provided"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.userCount," users"]})]}),e.jsx(h,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-2",children:["Permissions (",s.permissions.length,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.permissions.slice(0,3).map(a=>e.jsx(h,{variant:"outline",className:"text-xs",children:a.name},a.id)),s.permissions.length>3&&e.jsxs(h,{variant:"outline",className:"text-xs",children:["+",s.permissions.length-3," more"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(o,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>E(s),children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Edit"]}),!s.isSystem&&s.userCount===0&&e.jsx(o,{size:"sm",variant:"destructive",onClick:()=>T(s),children:e.jsx(O,{className:"h-3 w-3"})})]})]})]},s.id))}),j.length===0&&!g&&e.jsx(w,{children:e.jsxs(S,{className:"text-center py-12",children:[e.jsx(C,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No roles found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Create your first role to start managing user permissions"}),e.jsxs(o,{onClick:()=>m(!0),children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Create First Role"]})]})})]})}export{de as default};
//# sourceMappingURL=RoleManagement-DrlzAjWi.js.map
