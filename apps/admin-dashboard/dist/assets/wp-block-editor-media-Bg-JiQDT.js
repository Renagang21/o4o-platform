import{u as e,b as t,s as o,aA as a,_ as i,L as r,b2 as n,J as s,aJ as l,b8 as c,b9 as d,aM as u,g as p,a as m,P as h,a6 as g,b4 as b}from"./wp-block-editor-misc-pHCPYvR2.js";import"./wp-block-editor-a11y-DrduSWFW.js";import f from"./wp-api-BeoadipR.js";import{s as x}from"./wp-misc-DS9m4_P2.js";import{r as j,j as k,t as y}from"./vendor-react-BQ6HOJoh.js";import{_ as C,ak as v,ao as w}from"./wp-block-editor-utils-M5qXzE1L.js";import{D as _,a as S,b as P,d as N}from"./wp-block-editor-dnd-BYoS8-II.js";import{N as D,g as U,O as F,P as M,J as I}from"./wp-block-editor-library-BpQvynjE.js";import{a as L,M as R,U as A}from"./wp-block-editor-menus-BTQ2wZ-f.js";import{c as T}from"./vendor-ui-CrFdsnXa.js";import{B as z}from"./wp-blocks-core-6vwQKPfS.js";import{s as E}from"./wp-block-editor-store-B-g1aSix.js";import{F as H}from"./wp-block-editor-upload-BLw1R9wP.js";function Z({fallback:t=null,children:o}){return e(e=>{const{getSettings:t}=e(E);return!!t().mediaUpload},[])?o:t}const O=C("editor.MediaUpload")(()=>null),W={placement:"bottom-start"};const B=j.createContext({}),J=()=>j.useContext(B);function G({id:e,url:r,naturalWidth:n,naturalHeight:s,onFinishEditing:l,onSaveImage:c,children:d}){const u=function({url:e,naturalWidth:t,naturalHeight:o}){const[a,i]=j.useState(),[r,n]=j.useState(),[s,l]=j.useState({x:0,y:0}),[c,d]=j.useState(100),[u,p]=j.useState(0),m=t/o,[h,g]=j.useState(m),b=j.useCallback(()=>{const t=(u+90)%360;let o=m;if(u%180==90&&(o=1/m),0===t)return i(),p(t),g(m),void l(e=>({x:-e.y*o,y:e.x*o}));const a=new window.Image;a.src=e,a.onload=function(e){const a=document.createElement("canvas");let r=0,n=0;t%180?(a.width=e.target.height,a.height=e.target.width):(a.width=e.target.width,a.height=e.target.height),90!==t&&180!==t||(r=a.width),270!==t&&180!==t||(n=a.height);const s=a.getContext("2d");s.translate(r,n),s.rotate(t*Math.PI/180),s.drawImage(e.target,0,0),a.toBlob(e=>{i(URL.createObjectURL(e)),p(t),g(a.width/a.height),l(e=>({x:-e.y*o,y:e.x*o}))})};const r=v("media.crossOrigin",void 0,e);"string"==typeof r&&(a.crossOrigin=r)},[u,m,e]);return j.useMemo(()=>({editedUrl:a,setEditedUrl:i,crop:r,setCrop:n,position:s,setPosition:l,zoom:c,setZoom:d,rotation:u,setRotation:p,rotateClockwise:b,aspect:h,setAspect:g,defaultAspect:m}),[a,r,s,c,u,b,h,m])}({url:r,naturalWidth:n,naturalHeight:s}),p=function({crop:e,rotation:r,url:n,id:s,onSaveImage:l,onFinishEditing:c}){const{createErrorNotice:d}=t(x),[u,p]=j.useState(!1),m=j.useCallback(()=>{p(!1),c()},[c]),h=j.useCallback(()=>{p(!0);const t=[];if(r>0&&t.push({type:"rotate",args:{angle:r}}),(e.width<99.9||e.height<99.9)&&t.push({type:"crop",args:{left:e.x,top:e.y,width:e.width,height:e.height}}),0===t.length)return p(!1),void c();f({path:`/wp/v2/media/${s}/edit`,method:"POST",data:{src:n,modifiers:t}}).then(e=>{l({id:e.id,url:e.source_url})}).catch(e=>{d(o(i("Could not edit image. %s"),a(e.message)),{id:"image-editing-error",type:"snackbar"})}).finally(()=>{p(!1),c()})},[e,r,s,n,l,d,c]);return j.useMemo(()=>({isInProgress:u,apply:h,cancel:m}),[u,h,m])}({id:e,url:r,onSaveImage:c,onFinishEditing:l,...u}),m=j.useMemo(()=>({...u,...p}),[u,p]);return k.jsx(B.Provider,{value:m,children:d})}function V({aspectRatios:e,isDisabled:t,label:o,onClick:a,value:i}){return k.jsx(L,{label:o,children:e.map(({name:e,slug:o,ratio:r})=>k.jsx(R,{disabled:t,onClick:()=>{a(r)},role:"menuitemradio",isSelected:r===i,icon:r===i?U:void 0,children:e},o))})}function $(e){const[t,o,...a]=e.split("/").map(Number);return t<=0||o<=0||Number.isNaN(t)||Number.isNaN(o)||a.length?NaN:o?t/o:t}function q({ratio:e,...t}){return{ratio:$(e),...t}}function K({toggleProps:e}){const{isInProgress:t,aspect:o,setAspect:a,defaultAspect:n}=J(),[s,l,c]=r("dimensions.aspectRatios.default","dimensions.aspectRatios.theme","dimensions.defaultAspectRatios");return k.jsx(_,{icon:D,label:i("Aspect Ratio"),popoverProps:W,toggleProps:e,children:({onClose:e})=>k.jsxs(k.Fragment,{children:[k.jsx(V,{isDisabled:t,onClick:t=>{a(t),e()},value:o,aspectRatios:[{slug:"original",name:i("Original"),aspect:n},...c?s.map(q).filter(({ratio:e})=>1===e):[]]}),l?.length>0&&k.jsx(V,{label:i("Theme"),isDisabled:t,onClick:t=>{a(t),e()},value:o,aspectRatios:l}),c&&k.jsx(V,{label:i("Landscape"),isDisabled:t,onClick:t=>{a(t),e()},value:o,aspectRatios:s.map(q).filter(({ratio:e})=>e>1)}),c&&k.jsx(V,{label:i("Portrait"),isDisabled:t,onClick:t=>{a(t),e()},value:o,aspectRatios:s.map(q).filter(({ratio:e})=>e<1)})]})})}function Q({url:e,width:t,height:o,naturalHeight:a,naturalWidth:i,borderProps:r}){const{isInProgress:s,editedUrl:l,position:c,zoom:d,aspect:u,setPosition:p,setCrop:m,setZoom:h,rotation:g}=J(),[b,{width:f}]=w();let x=o||f*a/i;g%180==90&&(x=f*i/a);const j=k.jsxs("div",{className:T("wp-block-image__crop-area",r?.className,{"is-applying":s}),style:{...r?.style,width:t||f,height:x},children:[k.jsx(y,{image:l||e,disabled:s,minZoom:1,maxZoom:3,crop:c,zoom:d/100,aspect:u,onCropChange:e=>{p(e)},onCropComplete:e=>{m(e)},onZoomChange:e=>{h(100*e)}}),s&&k.jsx(n,{})]});return k.jsxs(k.Fragment,{children:[b,j]})}function X(){const{isInProgress:e,zoom:t,setZoom:o}=J();return k.jsx(S,{contentClassName:"wp-block-image__zoom",popoverProps:W,renderToggle:({isOpen:t,onToggle:o})=>k.jsx(l,{icon:F,label:i("Zoom"),onClick:o,"aria-expanded":t,disabled:e}),renderContent:()=>k.jsx(P,{paddingSize:"medium",children:k.jsx(s,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:i("Zoom"),min:100,max:300,value:Math.round(t),onChange:o})})})}function Y(){const{isInProgress:e,rotateClockwise:t}=J();return k.jsx(l,{icon:M,label:i("Rotate"),onClick:t,disabled:e})}function ee(){const{isInProgress:e,apply:t,cancel:o}=J();return k.jsxs(k.Fragment,{children:[k.jsx(l,{onClick:t,disabled:e,children:i("Apply")}),k.jsx(l,{onClick:o,children:i("Cancel")})]})}function te({id:e,url:t,width:o,height:a,naturalHeight:i,naturalWidth:r,onSaveImage:n,onFinishEditing:s,borderProps:l}){return k.jsxs(G,{id:e,url:t,naturalWidth:r,naturalHeight:i,onSaveImage:n,onFinishEditing:s,children:[k.jsx(Q,{borderProps:l,url:t,width:o,height:a,naturalHeight:i,naturalWidth:r}),k.jsxs(c,{children:[k.jsxs(d,{children:[k.jsx(X,{}),k.jsx(u,{children:e=>k.jsx(K,{toggleProps:e})}),k.jsx(Y,{})]}),k.jsx(d,{children:k.jsx(ee,{})})]})]})}const oe=()=>{},ae=({src:e,onChange:t,onSubmit:o,onClose:a,popoverAnchor:r})=>k.jsx(A,{anchor:r,onClose:a,children:k.jsx("form",{className:"block-editor-media-placeholder__url-input-form",onSubmit:o,children:k.jsx(g,{__next40pxDefaultSize:!0,label:i("URL"),hideLabelFromVision:!0,placeholder:i("Paste or type URL"),onChange:t,value:e,suffix:k.jsx(b,{variant:"control",children:k.jsx(m,{size:"small",icon:I,label:i("Apply"),type:"submit"})})})})}),ie=({src:e,onChangeSrc:t,onSelectURL:o})=>{const[a,r]=j.useState(null),[n,s]=j.useState(!1),l=()=>{s(!1),a?.focus()};return k.jsxs("div",{className:"block-editor-media-placeholder__url-input-container",children:[k.jsx(m,{__next40pxDefaultSize:!0,className:"block-editor-media-placeholder__button",onClick:()=>{s(!0)},isPressed:n,variant:"secondary","aria-haspopup":"dialog",ref:r,children:i("Insert from URL")}),n&&k.jsx(ae,{src:e,onChange:t,onSubmit:t=>{t.preventDefault(),e&&o&&(o(e),l())},onClose:l,popoverAnchor:a})]})};const re=C("editor.MediaPlaceholder")(function({value:t={},allowedTypes:o,className:a,icon:r,labels:n={},mediaPreview:s,notices:l,isAppender:c,accept:d,addToGallery:u,multiple:g=!1,handleUpload:b=!0,disableDropZone:f,disableMediaButtons:x,onError:y,onSelect:C,onCancel:v,onSelectURL:w,onToggleFeaturedImage:_,onDoubleClick:S,onFilesPreUpload:P=oe,onHTMLDrop:D,children:U,mediaLibraryButton:F,placeholder:M,style:I}){D&&p("wp.blockEditor.MediaPlaceholder onHTMLDrop prop",{since:"6.2",version:"6.4"});const L=e(e=>{const{getSettings:t}=e(E);return t().mediaUpload},[]),[R,A]=j.useState("");j.useEffect(()=>{var e;A(null!==(e=t?.src)&&void 0!==e?e:"")},[t?.src]);const W=e=>{if(!b||"function"==typeof b&&!b(e))return C(e);let a;if(P(e),g)if(u){let e=[];a=o=>{const a=(null!=t?t:[]).filter(t=>t.id?!e.some(({id:e})=>Number(e)===Number(t.id)):!e.some(({urlSlug:e})=>t.url.includes(e)));C(a.concat(o)),e=o.map(e=>{const t=e.url.lastIndexOf("."),o=e.url.slice(0,t);return{id:e.id,urlSlug:o}})}}else a=C;else a=([e])=>C(e);L({allowedTypes:o,filesList:e,onFileChange:a,onError:y})};async function B(e){const t=z({HTML:e});return await async function(e){if(!e||!Array.isArray(e))return;const t=function e(t){return t.flatMap(t=>"core/image"!==t.name&&"core/audio"!==t.name&&"core/video"!==t.name||!t.attributes.url?e(t.innerBlocks):[t])}(e);if(!t.length)return;const a=await Promise.all(t.map(e=>e.attributes.id?e.attributes:new Promise((t,a)=>{window.fetch(e.attributes.url).then(e=>e.blob()).then(i=>L({filesList:[i],additionalData:{title:e.attributes.title,alt_text:e.attributes.alt,caption:e.attributes.caption},onFileChange:([e])=>{e.id&&t(e)},allowedTypes:o,onError:a})).catch(()=>t(e.attributes.url))}))).catch(e=>y(e));C(g?a:a[0])}(t)}const J=e=>{W(e.target.files)},G=null!=M?M:e=>{let{instructions:t,title:d}=n;if(L||w||(t=i("To edit this block, you need permission to upload media.")),void 0===t||void 0===d){const e=null!=o?o:[],[a]=e,r=1===e.length,n=r&&"audio"===a,s=r&&"image"===a,l=r&&"video"===a;void 0===t&&L&&(t=i("Upload a media file or pick one from your media library."),n?t=i("Upload or drag an audio file here, or pick one from your library."):s?t=i("Upload or drag an image file here, or pick one from your library."):l&&(t=i("Upload or drag a video file here, or pick one from your library."))),void 0===d&&(d=i("Media"),n?d=i("Audio"):s?d=i("Image"):l&&(d=i("Video")))}const u=T("block-editor-media-placeholder",a,{"is-appender":c});return k.jsxs(h,{icon:r,label:d,instructions:t,className:u,notices:l,onDoubleClick:S,preview:s,style:I,children:[e,U]})},V=()=>f?null:k.jsx(N,{onFilesDrop:W,onHTMLDrop:B}),$=()=>v&&k.jsx(m,{__next40pxDefaultSize:!0,className:"block-editor-media-placeholder__cancel-button",title:i("Cancel"),variant:"link",onClick:v,children:i("Cancel")}),q=()=>w&&k.jsx(ie,{src:R,onChangeSrc:A,onSelectURL:w}),K=()=>_&&k.jsx("div",{className:"block-editor-media-placeholder__url-input-container",children:k.jsx(m,{__next40pxDefaultSize:!0,className:"block-editor-media-placeholder__button",onClick:_,variant:"secondary",children:i("Use featured image")})});return x?k.jsx(Z,{children:V()}):k.jsx(Z,{fallback:G(q()),children:(()=>{const e=null!=F?F:({open:e})=>k.jsx(m,{__next40pxDefaultSize:!0,variant:"secondary",onClick:()=>{e()},children:i("Media Library")}),a=k.jsx(O,{addToGallery:u,gallery:g&&!(!o||0===o.length)&&o.every(e=>"image"===e||e.startsWith("image/")),multiple:g,onSelect:C,allowedTypes:o,mode:"browse",value:Array.isArray(t)?t.map(({id:e})=>e):t.id,render:e});if(L&&c)return k.jsxs(k.Fragment,{children:[V(),k.jsx(H,{onChange:J,accept:d,multiple:!!g,render:({openFileDialog:e})=>{const t=k.jsxs(k.Fragment,{children:[k.jsx(m,{__next40pxDefaultSize:!0,variant:"primary",className:T("block-editor-media-placeholder__button","block-editor-media-placeholder__upload-button"),onClick:e,children:i("Upload")}),a,q(),K(),$()]});return G(t)}})]});if(L){const e=k.jsxs(k.Fragment,{children:[V(),k.jsx(H,{render:({openFileDialog:e})=>k.jsx(m,{__next40pxDefaultSize:!0,onClick:e,variant:"primary",className:T("block-editor-media-placeholder__button","block-editor-media-placeholder__upload-button"),children:i("Upload")}),onChange:J,accept:d,multiple:!!g}),a,q(),K(),$()]});return G(e)}return G(a)})()})});export{te as I,Z as M,O as a,re as i};
