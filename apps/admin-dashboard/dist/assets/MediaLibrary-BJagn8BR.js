import{r as u,j as e,U as le,X as me,C as De,Y as Te,d8 as ye,F as fe,n as we,d9 as be,I as H,V as M,y as J,cV as Ie,cJ as A,cb as ze,bX as Ue,$ as $e,z as V,da as ie,cq as Ce,c as Fe,b as Le,db as ke,E as ce,ci as de,S as Ee,cp as Oe,h as Be,bx as Re,G as Pe,L as qe,O as pe}from"./vendor-react-LfmQXg7x.js";import{w as Y,x as Z,y as ee,z as se,E as oe,B as c,s as P,P as Ke,L as T,I as O,T as ae,F as xe,j as E,a as Qe,b as Ve,d as te,e as re,D as W,n as G,o as _,r as S,q as X,S as ue,f as ge,g as ve,h as Ne,i as L,C as Ae,m as We}from"./page-gutenberg-Bgd5YFXg.js";import{C as ne}from"./checkbox-Q5H7Vlsm.js";import{u as he,b as q,a as Se}from"./vendor-query-D_Ku9Rpr.js";const Ge=({_isOpen:t,onClose:v,onUploadComplete:I,files:C,folderId:p,acceptedTypes:x,maxFileSize:b=100*1024*1024})=>{const[o,n]=u.useState([]),[N,m]=u.useState(!1),[h,z]=u.useState(null);u.useEffect(()=>{if(t&&C&&C.length>0){const s=Array.from(C).map(l=>({file:l,id:`${Date.now()}-${Math.random()}`,status:"pending",progress:0,preview:l.type.startsWith("image/")?URL.createObjectURL(l):void 0,metadata:{title:l.name.replace(/\.[^/.]+$/,"")}}));n(s)}},[t,C]),u.useEffect(()=>()=>{o.forEach(s=>{s.preview&&URL.revokeObjectURL(s.preview)})},[o]);const r=s=>s.type.startsWith("image/")?"image":s.type.startsWith("video/")?"video":s.type.startsWith("audio/")?"audio":s.type.includes("pdf")||s.type.includes("document")||s.type.includes("msword")||s.type.includes("spreadsheet")||s.type.includes("presentation")?"document":s.type.includes("zip")||s.type.includes("rar")||s.type.includes("tar")?"archive":"other",g=s=>{switch(s){case"image":return e.jsx(H,{className:"w-8 h-8"});case"video":return e.jsx(be,{className:"w-8 h-8"});case"audio":return e.jsx(we,{className:"w-8 h-8"});case"document":return e.jsx(fe,{className:"w-8 h-8"});default:return e.jsx(ye,{className:"w-8 h-8"})}},U=s=>{if(s===0)return"0 Bytes";const l=1024,j=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(s)/Math.log(l));return parseFloat((s/Math.pow(l,d)).toFixed(2))+" "+j[d]},k=u.useCallback(s=>{s.preventDefault();const l=s.dataTransfer.files;if(l.length>0){const j=Array.from(l).map(d=>({file:d,id:`${Date.now()}-${Math.random()}`,status:"pending",progress:0,preview:d.type.startsWith("image/")?URL.createObjectURL(d):void 0,metadata:{title:d.name.replace(/\.[^/.]+$/,"")}}));n(d=>[...d,...j])}},[]),R=s=>{n(l=>{const j=l.find(d=>d.id===s);return j?.preview&&URL.revokeObjectURL(j.preview),l.filter(d=>d.id!==s)})},$=(s,l)=>{n(j=>j.map(d=>d.id===s?{...d,metadata:{...d.metadata,...l}}:d))},y=async s=>{const l=new FormData;l.append("file",s.file),l.append("title",s.metadata?.title||s.file.name),s.metadata?.alt&&l.append("alt",s.metadata.alt),s.metadata?.caption&&l.append("caption",s.metadata.caption),p&&l.append("folderId",p);try{n(f=>f.map(a=>a.id===s.id?{...a,status:"uploading"}:a));const j=setInterval(()=>{n(f=>f.map(a=>a.id===s.id&&a.status==="uploading"?{...a,progress:Math.min(a.progress+10,90)}:a))},200),d=await E.api.post("/media/upload",l,{headers:{"Content-Type":"multipart/form-data"}});return clearInterval(j),n(f=>f.map(a=>a.id===s.id?{...a,status:"success",progress:100}:a)),d.data}catch(j){throw n(d=>d.map(f=>f.id===s.id?{...f,status:"error",error:"업로드 실패"}:f)),j}},K=async()=>{m(!0);const s=o.filter(d=>d.status==="pending");let l=0,j=0;for(const d of s)try{await y(d),l++}catch{j++}m(!1),l>0&&(M.success(`${l}개 파일이 업로드되었습니다`),j===0&&I()),j>0&&M.error(`${j}개 파일 업로드에 실패했습니다`)},F=o.filter(s=>s.status==="pending").length,i=o.filter(s=>s.status==="uploading").length,D=o.filter(s=>s.status==="success").length,B=o.filter(s=>s.status==="error").length;return e.jsx(Y,{open:t,onOpenChange:v,children:e.jsxs(Z,{className:"max-w-4xl max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"미디어 업로드"}),e.jsx(oe,{children:"이미지, 비디오, 문서 등을 업로드합니다"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:o.length===0?e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center cursor-pointer hover:border-gray-400 transition-colors",onDrop:k,onDragOver:s=>s.preventDefault(),onClick:()=>{const s=document.createElement("input");s.type="file",s.multiple=!0,s.accept=x?.join(",")||"*",s.onchange=l=>{const j=l.target.files;if(j){const d=Array.from(j).map(f=>({file:f,id:`${Date.now()}-${Math.random()}`,status:"pending",progress:0,preview:f.type.startsWith("image/")?URL.createObjectURL(f):void 0,metadata:{title:f.name.replace(/\.[^/.]+$/,"")}}));n(d)}},s.click()},children:[e.jsx(le,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-700 mb-2",children:"파일을 드래그하거나 클릭하여 업로드"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["최대 ",U(b)," 크기의 파일 지원"]})]}):e.jsx("div",{className:"space-y-3",children:o.map(s=>e.jsx("div",{className:`border rounded-lg p-4 ${s.status==="error"?"border-red-300 bg-red-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:s.preview?e.jsx("img",{src:s.preview,alt:"",className:"w-20 h-20 rounded object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded bg-gray-100 flex items-center justify-center text-gray-400",children:g(r(s.file))})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm truncate",children:s.metadata?.title||s.file.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[U(s.file.size)," · ",r(s.file)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>z(s.id),children:"편집"}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>R(s.id),children:e.jsx(me,{className:"w-4 h-4"})})]}),s.status==="uploading"&&e.jsx(P,{variant:"secondary",children:"업로드 중"}),s.status==="success"&&e.jsxs(P,{className:"bg-green-100 text-green-800",children:[e.jsx(De,{className:"w-3 h-3 mr-1"}),"완료"]}),s.status==="error"&&e.jsxs(P,{variant:"destructive",children:[e.jsx(Te,{className:"w-3 h-3 mr-1"}),"실패"]})]})]}),s.status==="uploading"&&e.jsx(Ke,{value:s.progress,className:"h-1"}),s.error&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:s.error}),h===s.id&&e.jsxs("div",{className:"mt-3 space-y-3 p-3 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:`title-${s.id}`,children:"제목"}),e.jsx(O,{id:`title-${s.id}`,value:s.metadata?.title||"",onChange:l=>$(s.id,{title:l.target.value}),placeholder:"미디어 제목"})]}),r(s.file)==="image"&&e.jsxs("div",{children:[e.jsx(T,{htmlFor:`alt-${s.id}`,children:"대체 텍스트"}),e.jsx(O,{id:`alt-${s.id}`,value:s.metadata?.alt||"",onChange:l=>$(s.id,{alt:l.target.value}),placeholder:"이미지 설명"})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:`caption-${s.id}`,children:"캡션"}),e.jsx(ae,{id:`caption-${s.id}`,value:s.metadata?.caption||"",onChange:l=>$(s.id,{caption:l.target.value}),placeholder:"미디어 캡션",rows:2})]}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>z(null),children:"완료"})]})]})]})},s.id))})}),e.jsx(xe,{children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[F>0&&e.jsxs("span",{children:[F,"개 대기 중"]}),i>0&&e.jsxs("span",{className:"ml-3",children:[i,"개 업로드 중"]}),D>0&&e.jsxs("span",{className:"ml-3 text-green-600",children:[D,"개 완료"]}),B>0&&e.jsxs("span",{className:"ml-3 text-red-600",children:[B,"개 실패"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",onClick:v,children:"취소"}),e.jsx(c,{onClick:K,disabled:F===0||N,children:N?"업로드 중...":`${F}개 업로드`})]})]})})]})})},_e=({media:t,onClose:v,onUpdate:I,onDelete:C})=>{const p=he(),[x,b]=u.useState({title:t.title,alt:t.alt,caption:t.caption,description:t.description,tags:t.tags,folderId:t.folderId}),o=q({mutationFn:async r=>E.api.put(`/media/${t.id}`,r),onSuccess:()=>{M.success("미디어가 업데이트되었습니다"),p.invalidateQueries({queryKey:["media"]}),I()},onError:()=>{M.error("업데이트에 실패했습니다")}}),n=q({mutationFn:async()=>E.api.delete(`/media/${t.id}`),onSuccess:()=>{M.success("미디어가 삭제되었습니다"),p.invalidateQueries({queryKey:["media"]}),C()},onError:()=>{M.error("삭제에 실패했습니다")}}),N=r=>{if(r===0)return"0 Bytes";const g=1024,U=["Bytes","KB","MB","GB"],k=Math.floor(Math.log(r)/Math.log(g));return parseFloat((r/Math.pow(g,k)).toFixed(2))+" "+U[k]},m=()=>{navigator.clipboard.writeText(t.url),M.success("URL이 복사되었습니다")},h=()=>{o.mutate(x)},z=()=>{confirm("정말 이 미디어를 삭제하시겠습니까?")&&n.mutate()};return e.jsx(Y,{open:!0,onOpenChange:v,children:e.jsxs(Z,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(se,{children:"미디어 상세"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:m,children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>window.open(t.url,"_blank"),children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>{const r=document.createElement("a");r.href=t.url,r.download=t.filename,r.click()},children:e.jsx(A,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:v,children:e.jsx(me,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"bg-gray-100 rounded-lg p-4",children:t.mediaType==="image"?e.jsx("img",{src:t.url,alt:t.alt||t.title,className:"w-full h-auto rounded"}):t.mediaType==="video"?e.jsx("video",{src:t.url,controls:!0,className:"w-full h-auto rounded"}):t.mediaType==="audio"?e.jsx("audio",{src:t.url,controls:!0,className:"w-full"}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[e.jsx(H,{className:"w-16 h-16 mb-4"}),e.jsx("p",{className:"text-sm",children:"미리보기를 사용할 수 없습니다"}),e.jsx(c,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>window.open(t.url,"_blank"),children:"파일 열기"})]})}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"파일명"}),e.jsx("span",{className:"text-sm font-medium",children:t.filename})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"유형"}),e.jsx(P,{variant:"outline",children:t.mimeType})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"크기"}),e.jsx("span",{className:"text-sm font-medium",children:N(t.size)})]}),t.width&&t.height&&e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"크기"}),e.jsxs("span",{className:"text-sm font-medium",children:[t.width," × ",t.height,"px"]})]}),t.duration&&e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"길이"}),e.jsxs("span",{className:"text-sm font-medium",children:[Math.floor(t.duration/60),":",(t.duration%60).toString().padStart(2,"0")]})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(ze,{className:"w-4 h-4"}),"업로드"]}),e.jsx("span",{className:"text-sm font-medium",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(Ue,{className:"w-4 h-4"}),"업로더"]}),e.jsx("span",{className:"text-sm font-medium",children:t.uploadedBy.name})]})]})]}),e.jsxs("div",{children:[e.jsxs(Qe,{defaultValue:"general",children:[e.jsxs(Ve,{className:"grid w-full grid-cols-3",children:[e.jsx(te,{value:"general",children:"일반"}),e.jsx(te,{value:"metadata",children:"메타데이터"}),e.jsx(te,{value:"usage",children:"사용처"})]}),e.jsxs(re,{value:"general",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"title",children:"제목"}),e.jsx(O,{id:"title",value:x.title||"",onChange:r=>b({...x,title:r.target.value}),placeholder:"미디어 제목"})]}),t.mediaType==="image"&&e.jsxs("div",{children:[e.jsx(T,{htmlFor:"alt",children:"대체 텍스트"}),e.jsx(O,{id:"alt",value:x.alt||"",onChange:r=>b({...x,alt:r.target.value}),placeholder:"이미지를 설명하는 텍스트"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"스크린 리더 사용자를 위한 이미지 설명"})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"caption",children:"캡션"}),e.jsx(ae,{id:"caption",value:x.caption||"",onChange:r=>b({...x,caption:r.target.value}),placeholder:"미디어 캡션",rows:2})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"description",children:"설명"}),e.jsx(ae,{id:"description",value:x.description||"",onChange:r=>b({...x,description:r.target.value}),placeholder:"미디어에 대한 상세 설명",rows:3})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"tags",children:"태그"}),e.jsx(O,{id:"tags",value:x.tags?.join(", ")||"",onChange:r=>b({...x,tags:r.target.value.split(",").map(g=>g.trim()).filter(Boolean)}),placeholder:"태그1, 태그2, 태그3"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"쉼표로 구분하여 입력"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:h,disabled:o.isPending,className:"flex-1",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"저장"]}),e.jsxs(c,{variant:"destructive",onClick:z,disabled:n.isPending,children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]}),e.jsx(re,{value:"metadata",className:"space-y-4",children:t.metadata&&Object.entries(t.metadata).length>0?e.jsx("div",{className:"space-y-2",children:Object.entries(t.metadata).map(([r,g])=>e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-sm text-gray-500",children:r}),e.jsx("span",{className:"text-sm font-medium",children:String(g)})]},r))}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-8",children:"메타데이터가 없습니다"})}),e.jsx(re,{value:"usage",className:"space-y-4",children:t.attachedTo&&t.attachedTo.length>0?e.jsx("div",{className:"space-y-2",children:t.attachedTo.map((r,g)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:r.postTitle}),e.jsx("p",{className:"text-xs text-gray-500",children:r.postType})]}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>window.open(`/content/${r.postType}/${r.postId}/edit`,"_blank"),children:"편집"})]},g))}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-8",children:"사용처가 없습니다"})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded",children:[e.jsx(T,{children:"파일 URL"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(O,{value:t.url,readOnly:!0,className:"bg-white"}),e.jsx(c,{variant:"outline",onClick:m,children:e.jsx(J,{className:"w-4 h-4"})})]})]}),t.variations&&Object.keys(t.variations).length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded",children:[e.jsx(T,{children:"이미지 크기"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"원본"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.width," × ",t.height,"px"]})]}),Object.entries(t.variations||{}).map(([r,g])=>g&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm capitalize",children:r}),e.jsxs("span",{className:"text-sm text-gray-500",children:[g.width," × ",g.height,"px"]})]},r))]})]})]})]})})]})})},Me=({folder:t,level:v,expandedFolders:I,onToggle:C,onEdit:p,onDelete:x,onSelect:b,folders:o})=>{const n=o.filter(h=>h.parentId===t.id),N=n.length>0,m=I.includes(t.id);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 rounded cursor-pointer",style:{paddingLeft:`${v*20+8}px`},children:[e.jsx("button",{onClick:()=>N&&C(t.id),className:"p-1",children:N?m?e.jsx(Fe,{className:"w-4 h-4"}):e.jsx(Le,{className:"w-4 h-4"}):e.jsx("div",{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 flex items-center gap-2",onClick:()=>b?.(t.id),children:[m?e.jsx(ke,{className:"w-4 h-4 text-blue-600"}):e.jsx(Ce,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:t.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",t.mediaCount,")"]})]}),e.jsxs(W,{children:[e.jsx(G,{children:e.jsx(c,{variant:"ghost",size:"sm",onClick:h=>h.stopPropagation(),children:e.jsx(ce,{className:"w-4 h-4"})})}),e.jsxs(_,{align:"end",children:[e.jsxs(S,{onClick:()=>p(t),children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"편집"]}),e.jsx(X,{}),e.jsxs(S,{onClick:()=>x(t),className:"text-red-600",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]}),N&&m&&e.jsx("div",{children:n.map(h=>e.jsx(Me,{folder:h,level:v+1,expandedFolders:I,onToggle:C,onEdit:p,onDelete:x,onSelect:b,folders:o},h.id))})]})},Xe=({_isOpen:t,onClose:v,onFolderSelect:I})=>{const C=he(),[p,x]=u.useState([]),[b,o]=u.useState(!1),[n,N]=u.useState(null),[m,h]=u.useState({name:"",parentId:void 0,description:""}),{data:z=[],isLoading:r}=Se({queryKey:["media-folders"],queryFn:async()=>(await E.api.get("/media/folders")).data}),g=q({mutationFn:async i=>E.api.post("/media/folders",i),onSuccess:()=>{M.success("폴더가 생성되었습니다"),C.invalidateQueries({queryKey:["media-folders"]}),o(!1),h({name:"",parentId:void 0,description:""})},onError:()=>{M.error("폴더 생성에 실패했습니다")}}),U=q({mutationFn:async i=>E.api.put(`/media/folders/${i.id}`,i),onSuccess:()=>{M.success("폴더가 수정되었습니다"),C.invalidateQueries({queryKey:["media-folders"]}),N(null)},onError:()=>{M.error("폴더 수정에 실패했습니다")}}),k=q({mutationFn:async i=>E.api.delete(`/media/folders/${i}`),onSuccess:()=>{M.success("폴더가 삭제되었습니다"),C.invalidateQueries({queryKey:["media-folders"]})},onError:()=>{M.error("폴더 삭제에 실패했습니다")}}),R=i=>{x(D=>D.includes(i)?D.filter(B=>B!==i):[...D,i])},$=()=>{g.mutate(m)},y=()=>{n&&U.mutate({id:n.id,name:m.name,description:m.description,parentId:m.parentId})},K=i=>{confirm(`정말 "${i.name}" 폴더를 삭제하시겠습니까?
폴더 내 미디어는 미분류로 이동됩니다.`)&&k.mutate(i.id)},F=z.filter(i=>!i.parentId);return e.jsxs(e.Fragment,{children:[e.jsx(Y,{open:t,onOpenChange:v,children:e.jsxs(Z,{className:"max-w-2xl",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"폴더 관리"}),e.jsx(oe,{children:"미디어를 정리할 폴더를 관리합니다"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"폴더 구조"}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{h({name:"",parentId:void 0,description:""}),N(null),o(!0)},children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"새 폴더"]})]}),r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):z.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ce,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"폴더가 없습니다"}),e.jsxs(c,{variant:"outline",onClick:()=>{h({name:"",parentId:void 0,description:""}),N(null),o(!0)},children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"첫 폴더 만들기"]})]}):e.jsx("div",{className:"border rounded-lg p-4 max-h-96 overflow-y-auto",children:F.map(i=>e.jsx(Me,{folder:i,level:0,expandedFolders:p,onToggle:R,onEdit:D=>{N(D),h({name:D.name,parentId:D.parentId,description:D.description||""}),o(!0)},onDelete:K,onSelect:I,folders:z},i.id))}),e.jsx(xe,{children:e.jsx(c,{variant:"outline",onClick:v,children:"닫기"})})]})}),e.jsx(Y,{open:b,onOpenChange:o,children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:n?"폴더 수정":"새 폴더"}),e.jsx(oe,{children:"폴더 정보를 입력하세요"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"folderName",children:"폴더 이름"}),e.jsx(O,{id:"folderName",value:m.name,onChange:i=>h({...m,name:i.target.value}),placeholder:"예: 2024년 이미지"})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"parentFolder",children:"상위 폴더"}),e.jsxs("select",{id:"parentFolder",className:"w-full px-3 py-2 border rounded-md",value:m.parentId||"",onChange:i=>h({...m,parentId:i.target.value||void 0}),children:[e.jsx("option",{value:"",children:"최상위"}),z.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"folderDescription",children:"설명 (선택)"}),e.jsx(ae,{id:"folderDescription",value:m.description,onChange:i=>h({...m,description:i.target.value}),placeholder:"폴더에 대한 설명",rows:2})]})]}),e.jsxs(xe,{children:[e.jsx(c,{variant:"outline",onClick:()=>{o(!1),N(null)},children:"취소"}),e.jsx(c,{onClick:n?y:$,disabled:!m.name||g.isPending||U.isPending,children:n?"수정":"생성"})]})]})})]})},es=()=>{const t=he(),v=u.useRef(null),[I,C]=u.useState("grid"),[p,x]=u.useState([]),[b,o]=u.useState(""),[n,N]=u.useState({mediaType:"all",folderId:void 0,status:"all"}),[m,h]=u.useState(!1),[z,r]=u.useState(null),[g,U]=u.useState(!1),[k,R]=u.useState(1),$=24,{data:y,isLoading:K,refetch:F}=Se({queryKey:["media",{...n,search:b,page:k,limit:$}],queryFn:async()=>{const a=new URLSearchParams({page:k.toString(),limit:$.toString()});return b&&a.append("search",b),n.mediaType&&n.mediaType!=="all"&&a.append("mediaType",n.mediaType),n.folderId&&a.append("folderId",n.folderId),n.status&&n.status!=="all"&&a.append("status",n.status),(await E.api.get(`/media?${a}`)).data}}),i=q({mutationFn:async a=>{const w=a.map(Q=>E.api.delete(`/media/${Q}`));return Promise.all(w)},onSuccess:()=>{t.invalidateQueries({queryKey:["media"]}),M.success("미디어가 삭제되었습니다"),x([])},onError:()=>{M.error("삭제에 실패했습니다")}}),D=a=>{const w=a.target.files;w&&w.length>0&&h(!0)},B=a=>{x(w=>w.includes(a)?w.filter(Q=>Q!==a):[...w,a])},s=()=>{y?.items&&x(y.items.map(a=>a.id))},l=()=>{x([])},j=()=>{p.length!==0&&confirm(`정말 ${p.length}개의 미디어를 삭제하시겠습니까?`)&&i.mutate(p)},d=a=>{switch(a){case"image":return e.jsx(H,{className:"w-5 h-5"});case"video":return e.jsx(be,{className:"w-5 h-5"});case"audio":return e.jsx(we,{className:"w-5 h-5"});case"document":return e.jsx(fe,{className:"w-5 h-5"});default:return e.jsx(ye,{className:"w-5 h-5"})}},f=a=>{if(a===0)return"0 Bytes";const w=1024,Q=["Bytes","KB","MB","GB"],je=Math.floor(Math.log(a)/Math.log(w));return parseFloat((a/Math.pow(w,je)).toFixed(2))+" "+Q[je]};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"미디어 라이브러리"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"이미지, 비디오, 문서를 관리합니다"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(c,{variant:"outline",onClick:()=>U(!0),children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"폴더 관리"]}),e.jsx("input",{ref:v,type:"file",multiple:!0,className:"hidden",onChange:D,accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.zip,.rar"}),e.jsxs(c,{onClick:()=>v.current?.click(),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"업로드"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 flex gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(O,{placeholder:"미디어 검색...",value:b,onChange:a=>o(a.target.value),className:"pl-10"})]}),e.jsxs(ue,{value:n.mediaType||"all",onValueChange:a=>N({...n,mediaType:a}),children:[e.jsxs(ge,{className:"w-[180px]",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),e.jsx(ve,{placeholder:"미디어 유형"})]}),e.jsxs(Ne,{children:[e.jsx(L,{value:"all",children:"모든 유형"}),e.jsx(L,{value:"image",children:"이미지"}),e.jsx(L,{value:"video",children:"비디오"}),e.jsx(L,{value:"audio",children:"오디오"}),e.jsx(L,{value:"document",children:"문서"}),e.jsx(L,{value:"other",children:"기타"})]})]}),y?.folders&&y.folders.length>0&&e.jsxs(ue,{value:n.folderId||"all",onValueChange:a=>N({...n,folderId:a==="all"?void 0:a}),children:[e.jsxs(ge,{className:"w-[180px]",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),e.jsx(ve,{placeholder:"폴더"})]}),e.jsxs(Ne,{children:[e.jsx(L,{value:"all",children:"모든 폴더"}),e.jsx(L,{value:"uncategorized",children:"미분류"}),y.folders.map(a=>e.jsx(L,{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[p.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[p.length,"개 선택됨"]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:l,children:e.jsx(me,{className:"w-4 h-4"})}),e.jsxs(W,{children:[e.jsx(G,{children:e.jsx(c,{variant:"outline",size:"sm",children:"일괄 작업"})}),e.jsxs(_,{children:[e.jsxs(S,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"다운로드"]}),e.jsxs(S,{children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"폴더 이동"]}),e.jsxs(S,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"태그 추가"]}),e.jsx(X,{}),e.jsxs(S,{onClick:j,className:"text-red-600",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 border rounded-lg p-1",children:[e.jsx(c,{variant:I==="grid"?"default":"ghost",size:"sm",onClick:()=>C("grid"),children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsx(c,{variant:I==="list"?"default":"ghost",size:"sm",onClick:()=>C("list"),children:e.jsx(qe,{className:"w-4 h-4"})})]})]})]}),K?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):y?.items?.length===0?e.jsx(Ae,{children:e.jsxs(We,{className:"text-center py-12",children:[e.jsx(H,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"미디어가 없습니다"}),e.jsxs(c,{onClick:()=>v.current?.click(),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"첫 미디어 업로드"]})]})}):I==="grid"?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:y?.items?.map(a=>e.jsxs("div",{className:`group relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${p.includes(a.id)?"border-blue-500 shadow-lg":"border-gray-200 hover:border-gray-300"}`,onClick:()=>r(a),children:[e.jsxs("div",{className:"aspect-square bg-gray-100 relative",children:[a.mediaType==="image"&&a.thumbnailUrl?e.jsx("img",{src:a.thumbnailUrl,alt:a.alt||a.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:d(a.mediaType)}),e.jsx("div",{className:"absolute top-2 left-2 z-10",onClick:w=>{w.stopPropagation(),B(a.id)},children:e.jsx(ne,{checked:p.includes(a.id),className:"bg-white shadow-sm"})}),a.status!=="ready"&&e.jsx(P,{variant:a.status==="processing"?"secondary":"destructive",className:"absolute top-2 right-2",children:a.status==="processing"?"처리중":"실패"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{size:"sm",variant:"secondary",onClick:w=>{w.stopPropagation(),r(a)},children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsxs(W,{children:[e.jsx(G,{onClick:w=>w.stopPropagation(),children:e.jsx(c,{size:"sm",variant:"secondary",children:e.jsx(ce,{className:"w-4 h-4"})})}),e.jsxs(_,{children:[e.jsxs(S,{children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"편집"]}),e.jsxs(S,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"URL 복사"]}),e.jsxs(S,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"다운로드"]}),e.jsx(X,{}),e.jsxs(S,{className:"text-red-600",onClick:()=>{confirm("정말 삭제하시겠습니까?")&&i.mutate([a.id])},children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]})})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("p",{className:"text-xs font-medium truncate",children:a.title}),e.jsx("p",{className:"text-xs text-gray-500",children:f(a.size)})]})]},a.id))}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx(ne,{checked:p.length===y?.items?.length&&y?.items?.length>0,onCheckedChange:a=>a?s():l()})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"미디어"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"유형"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"크기"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"업로드"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"작업"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:y?.items?.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx(ne,{checked:p.includes(a.id),onCheckedChange:()=>B(a.id)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[a.mediaType==="image"&&a.thumbnailUrl?e.jsx("img",{src:a.thumbnailUrl,alt:a.alt||a.title,className:"w-10 h-10 rounded object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded bg-gray-100 flex items-center justify-center text-gray-400",children:d(a.mediaType)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a.title}),e.jsx("p",{className:"text-xs text-gray-500",children:a.filename})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(P,{variant:"outline",children:a.mediaType})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:f(a.size)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.jsxs("div",{children:[e.jsx("p",{children:new Date(a.createdAt).toLocaleDateString()}),e.jsx("p",{className:"text-xs",children:a.uploadedBy.name})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(W,{children:[e.jsx(G,{children:e.jsx(c,{variant:"ghost",size:"sm",children:e.jsx(ce,{className:"w-4 h-4"})})}),e.jsxs(_,{align:"end",children:[e.jsxs(S,{onClick:()=>r(a),children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"보기"]}),e.jsxs(S,{children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"편집"]}),e.jsxs(S,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"URL 복사"]}),e.jsxs(S,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"다운로드"]}),e.jsx(X,{}),e.jsxs(S,{className:"text-red-600",onClick:()=>{confirm("정말 삭제하시겠습니까?")&&i.mutate([a.id])},children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})})]},a.id))})]})}),y?.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["총 ",y.total,"개 중 ",(k-1)*$+1,"-",Math.min(k*$,y.total),"개 표시"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>R(k-1),disabled:k===1,children:"이전"}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>R(k+1),disabled:k===y.totalPages,children:"다음"})]})]}),e.jsx(Ge,{_isOpen:m,onClose:()=>{h(!1),v.current.value=""},onUploadComplete:()=>{F(),h(!1),v.current.value=""},files:v.current?.files||void 0,folderId:n.folderId}),z&&e.jsx(_e,{media:z,onClose:()=>r(null),onUpdate:()=>F(),onDelete:()=>{F(),r(null)}}),e.jsx(Xe,{_isOpen:g,onClose:()=>U(!1),onFolderSelect:a=>{N({...n,folderId:a}),U(!1)}})]})};export{es as M};
