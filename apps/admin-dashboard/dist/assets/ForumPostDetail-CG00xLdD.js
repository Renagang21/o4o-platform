import{a4 as e,a3 as s,r as a,V as t,j as i,a5 as n,dv as r,c2 as c,N as l,Y as d,cq as m,E as o,D as x,dw as u}from"./vendor-react-B2e3hjul.js";import{u as h,a as j,b as p}from"./vendor-query-gT6dZ-b7.js";import{j as v,B as N,s as y,T as f,D as g,n as w,o as b,r as k}from"./page-gutenberg-C_zDdNV3.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-B-KQWpLj.js";import"./wp-all-B6DO5GFQ.js";const C=()=>{const{id:C}=e(),q=s(),z=h(),[S,L]=a.useState(""),[F,K]=a.useState(null),[$,P]=a.useState(null),[Q,A]=a.useState(""),{data:D,isLoading:I}=j({queryKey:["forum-post",C],queryFn:async()=>(await v.api.get(`/v1/forum/posts/${C}`)).data}),E=D?.data,{data:B,isLoading:R}=j({queryKey:["forum-comments",C],queryFn:async()=>(await v.api.get(`/v1/forum/posts/${C}/comments`)).data}),T=B?.data||[],V=p({mutationFn:async e=>(await v.api.post(`/v1/forum/posts/${C}/comments`,e)).data,onSuccess:()=>{t.success("댓글이 작성되었습니다"),L(""),K(null),z.invalidateQueries({queryKey:["forum-comments",C]})}}),Y=p({mutationFn:async({commentId:e,content:s})=>(await v.api.put(`/v1/forum/comments/${e}`,{content:s})).data,onSuccess:()=>{t.success("댓글이 수정되었습니다"),P(null),A(""),z.invalidateQueries({queryKey:["forum-comments",C]})}}),G=p({mutationFn:async e=>(await v.api.delete(`/v1/forum/comments/${e}`)).data,onSuccess:()=>{t.success("댓글이 삭제되었습니다"),z.invalidateQueries({queryKey:["forum-comments",C]})}}),H=p({mutationFn:async()=>(await v.api.post(`/v1/forum/posts/${C}/toggle-pin`)).data,onSuccess:()=>{t.success(E?.isPinned?"고정이 해제되었습니다":"게시글이 고정되었습니다"),z.invalidateQueries({queryKey:["forum-post",C]})}}),J=p({mutationFn:async()=>(await v.api.post(`/v1/forum/posts/${C}/toggle-lock`)).data,onSuccess:()=>{t.success(E?.isLocked?"잠금이 해제되었습니다":"게시글이 잠금되었습니다"),z.invalidateQueries({queryKey:["forum-post",C]})}}),M=e=>{S.trim()&&V.mutate({content:S,parentId:e})},O=e=>new Date(e).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=(e,s=0)=>{const a=$===e.id;return i.jsxs("div",{className:""+(s>0?"ml-12":""),children:[i.jsxs("div",{className:"bg-white p-4 rounded-lg border border-modern-border-primary mb-4",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-modern-primary text-white rounded-full flex items-center justify-center text-sm font-medium",children:e.author.name.charAt(0)}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"font-medium text-modern-text-primary",children:e.author.name}),i.jsx(y,{variant:"outline",className:"text-xs",children:e.author.role})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-modern-text-secondary",children:[i.jsx("span",{children:O(e.createdAt)}),e.isEdited&&i.jsx("span",{children:"(수정됨)"})]})]})]}),i.jsxs(g,{children:[i.jsx(w,{children:i.jsx(N,{variant:"ghost",size:"sm",children:i.jsx(o,{className:"w-4 h-4"})})}),i.jsxs(b,{align:"end",children:[i.jsxs(k,{onClick:()=>{P(e.id),A(e.content)},children:[i.jsx(l,{className:"w-4 h-4 mr-2"}),"수정"]}),i.jsxs(k,{className:"text-destructive",onClick:()=>{confirm("정말 삭제하시겠습니까?")&&G.mutate(e.id)},children:[i.jsx(x,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]}),a?i.jsxs("div",{className:"space-y-3",children:[i.jsx(f,{value:Q,onChange:e=>A(e.target.value),rows:3,className:"w-full"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(N,{size:"sm",onClick:()=>{return s=e.id,void(Q.trim()&&Y.mutate({commentId:s,content:Q}));var s},disabled:Y.isPending,children:"수정 완료"}),i.jsx(N,{size:"sm",variant:"outline",onClick:()=>{P(null),A("")},children:"취소"})]})]}):i.jsxs(i.Fragment,{children:[i.jsx("p",{className:"text-modern-text-primary mb-3 whitespace-pre-wrap",children:e.content}),!E?.isLocked&&i.jsxs(N,{size:"sm",variant:"ghost",onClick:()=>{K(e.id),L("")},children:[i.jsx(u,{className:"w-4 h-4 mr-2"}),"답글"]})]})]}),F===e.id&&!E?.isLocked&&i.jsxs("div",{className:"ml-12 mb-4",children:[i.jsx(f,{value:S,onChange:e=>L(e.target.value),placeholder:"답글을 작성하세요...",rows:3,className:"w-full mb-2"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(N,{size:"sm",onClick:()=>M(e.id),disabled:V.isPending,children:"답글 작성"}),i.jsx(N,{size:"sm",variant:"outline",onClick:()=>{K(null),L("")},children:"취소"})]})]}),e.replies&&e.replies.map(e=>U(e,s+1))]},e.id)};return I?i.jsx("div",{className:"flex items-center justify-center h-96",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):E?i.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>q("/forum"),children:[i.jsx(n,{className:"w-4 h-4 mr-2"}),"게시판 목록"]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(N,{variant:"outline",size:"sm",onClick:()=>H.mutate(),children:[i.jsx(r,{className:"w-4 h-4 mr-2"}),E.isPinned?"고정 해제":"고정"]}),i.jsxs(N,{variant:"outline",size:"sm",onClick:()=>J.mutate(),children:[i.jsx(c,{className:"w-4 h-4 mr-2"}),E.isLocked?"잠금 해제":"잠금"]}),i.jsxs(N,{variant:"outline",size:"sm",onClick:()=>q(`/forum/posts/${C}/edit`),children:[i.jsx(l,{className:"w-4 h-4 mr-2"}),"수정"]})]})]}),i.jsx("div",{className:"wp-card",children:i.jsx("div",{className:"wp-card-body",children:i.jsxs("div",{className:"mb-6",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[E.isPinned&&i.jsx(y,{variant:"secondary",children:"고정"}),E.isLocked&&i.jsx(y,{variant:"outline",children:"잠김"}),i.jsx(y,{variant:"outline",children:E.category.name}),"reported"===E.status&&i.jsx(y,{variant:"destructive",children:"신고됨"})]}),i.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary mb-4",children:E.title}),i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 bg-modern-primary text-white rounded-full flex items-center justify-center text-lg font-medium",children:E.author.name.charAt(0)}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-modern-text-primary",children:E.author.name}),i.jsx("p",{className:"text-sm text-modern-text-secondary",children:O(E.createdAt)})]})]}),i.jsxs("div",{className:"flex items-center gap-4 text-sm text-modern-text-secondary",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(d,{className:"w-4 h-4"}),i.jsxs("span",{children:[E.views," 조회"]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(m,{className:"w-4 h-4"}),i.jsxs("span",{children:[E.replyCount," 댓글"]})]})]})]}),i.jsx("div",{className:"prose prose-modern max-w-none",children:i.jsx("div",{className:"whitespace-pre-wrap text-modern-text-primary",children:E.content})})]})})}),i.jsxs("div",{className:"wp-card",children:[i.jsx("div",{className:"wp-card-header",children:i.jsxs("h2",{className:"text-lg font-semibold",children:["댓글 ",T.length,"개"]})}),i.jsxs("div",{className:"wp-card-body",children:[!E.isLocked&&i.jsxs("div",{className:"mb-6",children:[i.jsx(f,{value:S,onChange:e=>L(e.target.value),placeholder:"댓글을 작성하세요...",rows:4,className:"w-full mb-2"}),i.jsx(N,{onClick:()=>M(),disabled:V.isPending||!S.trim(),children:"댓글 작성"})]}),R?i.jsx("div",{className:"text-center py-8",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary mx-auto"})}):0===T.length?i.jsx("p",{className:"text-center text-modern-text-secondary py-8",children:"아직 댓글이 없습니다."}):i.jsx("div",{className:"space-y-4",children:T.map(e=>U(e))})]})]})]}):i.jsx("div",{className:"text-center py-12",children:i.jsx("p",{className:"text-modern-text-secondary",children:"게시글을 찾을 수 없습니다."})})};export{C as default};
