import{a3 as e,a4 as t,r as s,V as a,j as r,a5 as n,F as i,dm as d,n as c,a1 as o}from"./vendor-react-Bb0TGSr4.js";import{u as l,a as m,b as p}from"./vendor-query-BEO_OofR.js";import{j as x,B as u,C as j,k as h,l as g,m as f,L as v,I as D,T as y}from"./page-gutenberg-CGPrHM9_.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-B-KQWpLj.js";import"./wp-foundation-Ht0JG6Uo.js";import"./wp-components-CoD93iDH.js";const N=()=>{const N=e(),{id:w}=t(),C=l(),b=!!w,[P,k]=s.useState({title:"",description:"",targetParticipantCount:10,startDate:"",endDate:"",forumLink:""}),[F,L]=s.useState({}),{data:S,isLoading:q}=m({queryKey:["crowdfunding-project",w],queryFn:async()=>(await x.api.get(`/v1/crowdfunding-simple/projects/${w}`)).data,enabled:b}),$=p({mutationFn:async e=>(await x.api.post("/v1/crowdfunding-simple/projects",e)).data,onSuccess:()=>{a.success("프로젝트가 생성되었습니다!"),C.invalidateQueries({queryKey:["crowdfunding-projects"]}),N("/crowdfunding/projects")},onError:e=>{a.error(e.response?.data?.error||"프로젝트 생성에 실패했습니다.")}}),K=p({mutationFn:async e=>(await x.api.put(`/v1/crowdfunding-simple/projects/${w}`,e)).data,onSuccess:()=>{a.success("프로젝트가 수정되었습니다!"),C.invalidateQueries({queryKey:["crowdfunding-project",w]}),C.invalidateQueries({queryKey:["crowdfunding-projects"]}),N(`/crowdfunding/projects/${w}`)},onError:e=>{a.error(e.response?.data?.error||"프로젝트 수정에 실패했습니다.")}});s.useEffect(()=>{if(S?.data){const e=S.data;k({title:e.title,description:e.description,targetParticipantCount:e.targetParticipantCount,startDate:e.startDate,endDate:e.endDate,forumLink:e.forumLink||""})}},[S]);const E=(e,t)=>{k(s=>({...s,[e]:t})),F[e]&&L(t=>({...t,[e]:void 0}))},I=(new Date).toISOString().split("T")[0];return b&&q?r.jsx("div",{className:"flex items-center justify-center h-96",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):r.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>N(b?`/crowdfunding/projects/${w}`:"/crowdfunding/projects"),children:[r.jsx(n,{className:"w-4 h-4 mr-2"}),b?"프로젝트 상세":"프로젝트 목록"]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:b?"프로젝트 수정":"새 프로젝트 만들기"})})]}),r.jsxs("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e={};return P.title.trim()||(e.title="프로젝트 제목을 입력하세요."),P.description.trim()||(e.description="프로젝트 설명을 입력하세요."),P.targetParticipantCount<1&&(e.targetParticipantCount="목표 참여 매장 수는 1개 이상이어야 합니다."),P.startDate||(e.startDate="시작일을 선택하세요."),P.endDate||(e.endDate="종료일을 선택하세요."),P.startDate&&P.endDate&&P.startDate>=P.endDate&&(e.endDate="종료일은 시작일보다 늦어야 합니다."),P.startDate&&new Date(P.startDate)<new Date&&(e.startDate="시작일은 현재 날짜 이후여야 합니다."),L(e),0===Object.keys(e).length})()?b?K.mutate(P):$.mutate(P):a.error("입력한 정보를 확인해주세요.")},className:"space-y-6",children:[r.jsxs(j,{children:[r.jsx(h,{children:r.jsxs(g,{className:"flex items-center gap-2",children:[r.jsx(i,{className:"w-5 h-5 text-modern-primary"}),"프로젝트 기본 정보"]})}),r.jsxs(f,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(v,{htmlFor:"title",children:"프로젝트 제목 *"}),r.jsx(D,{id:"title",value:P.title,onChange:e=>E("title",e.target.value),placeholder:"예: 친환경 포장재 대량 구매 프로젝트",className:F.title?"border-red-500":""}),F.title&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.title})]}),r.jsxs("div",{children:[r.jsx(v,{htmlFor:"description",children:"프로젝트 설명 *"}),r.jsx(y,{id:"description",value:P.description,onChange:e=>E("description",e.target.value),placeholder:"프로젝트의 목적, 혜택, 예상 절감 비용 등을 상세히 설명해주세요...",rows:8,className:F.description?"border-red-500":""}),F.description&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.description}),r.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:"참여 매장이 이해하기 쉽도록 구체적인 혜택과 절감 효과를 포함해주세요."})]})]})]}),r.jsxs(j,{children:[r.jsx(h,{children:r.jsxs(g,{className:"flex items-center gap-2",children:[r.jsx(d,{className:"w-5 h-5 text-modern-primary"}),"목표 및 기간 설정"]})}),r.jsxs(f,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(v,{htmlFor:"targetParticipantCount",children:"목표 참여 매장 수 *"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(D,{id:"targetParticipantCount",type:"number",min:"1",max:"1000",value:P.targetParticipantCount,onChange:e=>E("targetParticipantCount",parseInt(e.target.value)||0),className:"max-w-xs "+(F.targetParticipantCount?"border-red-500":"")}),r.jsx("span",{className:"text-modern-text-secondary",children:"개 매장"})]}),F.targetParticipantCount&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.targetParticipantCount}),r.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:"목표를 달성하면 비용 절감 효과를 얻을 수 있는 최소 참여 매장 수를 설정하세요."})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx(v,{htmlFor:"startDate",children:"프로젝트 시작일 *"}),r.jsx(D,{id:"startDate",type:"date",min:I,value:P.startDate,onChange:e=>E("startDate",e.target.value),className:F.startDate?"border-red-500":""}),F.startDate&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.startDate})]}),r.jsxs("div",{children:[r.jsx(v,{htmlFor:"endDate",children:"프로젝트 종료일 *"}),r.jsx(D,{id:"endDate",type:"date",min:P.startDate||I,value:P.endDate,onChange:e=>E("endDate",e.target.value),className:F.endDate?"border-red-500":""}),F.endDate&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.endDate})]})]})]})]}),r.jsxs(j,{children:[r.jsx(h,{children:r.jsxs(g,{className:"flex items-center gap-2",children:[r.jsx(c,{className:"w-5 h-5 text-modern-primary"}),"추가 설정"]})}),r.jsx(f,{className:"space-y-4",children:r.jsxs("div",{children:[r.jsx(v,{htmlFor:"forumLink",children:"포럼 링크 (선택)"}),r.jsx(D,{id:"forumLink",value:P.forumLink,onChange:e=>E("forumLink",e.target.value),placeholder:"/forum/posts/project-discussion"}),r.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:"참여자들이 토론할 수 있는 포럼 페이지 링크를 입력하세요."})]})})]}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx(u,{type:"button",variant:"outline",onClick:()=>N(b?`/crowdfunding/projects/${w}`:"/crowdfunding/projects"),children:"취소"}),r.jsxs(u,{type:"submit",disabled:$.isPending||K.isPending,children:[r.jsx(o,{className:"w-4 h-4 mr-2"}),$.isPending||K.isPending?"저장 중...":b?"수정하기":"프로젝트 만들기"]})]})]})]})};export{N as default};
