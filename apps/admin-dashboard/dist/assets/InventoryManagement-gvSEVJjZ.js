import{r as e,j as t,bw as s,aE as r,cm as a,bc as n,E as d,V as i}from"./vendor-react-BoWgD0Bu.js";import{u as l,a as c,b as o}from"./vendor-query-CbBSyLUF.js";import{B as x,I as m,L as p,T as h,b as j}from"./page-template-editor-CWJwXWLM.js";import{cy as u,cz as y,cA as v,cB as N,cN as f,cO as b,cP as g,cQ as w,cR as k,cS as S,cJ as q}from"./wp-misc-fiKRzvVp.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-C9jLuAcl.js";import"./wp-foundation-BzBJX52f.js";import"./wp-block-editor-main-y2nlPlta.js";import"./wp-i18n-BPC8WmOV.js";import"./wp-block-editor-store-PPID3vJI.js";import"./wp-block-editor-utils-C52tDze8.js";import"./wp-components-CKWj6dcl.js";const C=()=>{const C=l(),[I,F]=e.useState(""),[K,P]=e.useState("all"),[_,O]=e.useState(null),[L,$]=e.useState(!1),[z,Q]=e.useState(!1),[R,U]=e.useState({inventoryItemId:"",type:"increase",quantity:0,reason:"",notes:""}),{data:A,isLoading:B}=c({queryKey:["inventory",I,K],queryFn:async()=>{const e=new URLSearchParams;I&&e.append("search",I),"all"!==K&&e.append("status",K);return(await j.api.get(`/v1/inventory?${e.toString()}`)).data}}),D=A?.data||[],{data:E}=c({queryKey:["stock-movements",_?.id],queryFn:async()=>{if(!_?.id)return{data:[]};return(await j.api.get(`/v1/inventory/${_.id}/movements`)).data},enabled:!!_?.id&&z}),V=E?.data||[],{data:J}=c({queryKey:["inventory-stats"],queryFn:async()=>(await j.api.get("/v1/inventory/stats")).data}),T=J?.data||{},G=o({mutationFn:async e=>(await j.api.post("/v1/inventory/adjust",e)).data,onSuccess:()=>{i.success("재고가 조정되었습니다"),C.invalidateQueries({queryKey:["inventory"]}),C.invalidateQueries({queryKey:["inventory-stats"]}),$(!1),U({inventoryItemId:"",type:"increase",quantity:0,reason:"",notes:""})}}),H=o({mutationFn:async e=>(await j.api.post("/v1/inventory/bulk-reorder",{itemIds:e})).data,onSuccess:()=>{i.success("대량 재주문이 요청되었습니다")}}),M=D.filter(e=>e.currentStock<=e.reorderPoint&&"discontinued"!==e.status);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"재고 관리"}),t.jsx("p",{className:"text-modern-text-secondary mt-1",children:"실시간 재고 추적 및 관리"})]}),t.jsx("div",{className:"flex gap-2",children:M.length>0&&t.jsxs(x,{variant:"outline",onClick:()=>H.mutate(M.map(e=>e.id)),disabled:H.isPending,children:[t.jsx(s,{className:"w-4 h-4 mr-2"}),"부족 재고 재주문 (",M.length,")"]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs(u,{children:[t.jsx(y,{className:"pb-2",children:t.jsx(v,{className:"text-sm font-medium text-modern-text-secondary",children:"총 상품 수"})}),t.jsxs(N,{children:[t.jsx("div",{className:"text-2xl font-bold text-modern-text-primary",children:T.totalItems||0}),t.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"활성 상품 기준"})]})]}),t.jsxs(u,{children:[t.jsx(y,{className:"pb-2",children:t.jsx(v,{className:"text-sm font-medium text-modern-text-secondary",children:"부족 재고"})}),t.jsxs(N,{children:[t.jsx("div",{className:"text-2xl font-bold text-orange-600",children:T.lowStockItems||0}),t.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"재주문 필요"})]})]}),t.jsxs(u,{children:[t.jsx(y,{className:"pb-2",children:t.jsx(v,{className:"text-sm font-medium text-modern-text-secondary",children:"품절 상품"})}),t.jsxs(N,{children:[t.jsx("div",{className:"text-2xl font-bold text-red-600",children:T.outOfStockItems||0}),t.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"즉시 보충 필요"})]})]}),t.jsxs(u,{children:[t.jsx(y,{className:"pb-2",children:t.jsx(v,{className:"text-sm font-medium text-modern-text-secondary",children:"총 재고 가치"})}),t.jsxs(N,{children:[t.jsxs("div",{className:"text-2xl font-bold text-modern-text-primary",children:["₩",(T.totalValue||0).toLocaleString()]}),t.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"원가 기준"})]})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(r,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-modern-text-tertiary w-5 h-5"}),t.jsx(m,{type:"text",placeholder:"상품명, SKU로 검색...",value:I,onChange:e=>F(e.target.value),className:"pl-10"})]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(a,{className:"w-5 h-5 text-modern-text-secondary"}),t.jsxs("select",{value:K,onChange:e=>P(e.target.value),className:"px-4 py-2 border border-modern-border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-modern-primary",children:[t.jsx("option",{value:"all",children:"모든 상태"}),t.jsx("option",{value:"in_stock",children:"정상 재고"}),t.jsx("option",{value:"low_stock",children:"부족 재고"}),t.jsx("option",{value:"out_of_stock",children:"품절"}),t.jsx("option",{value:"discontinued",children:"단종"})]})]})]}),t.jsx(u,{children:t.jsx(N,{className:"p-0",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-modern-bg-tertiary border-b border-modern-border-primary",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상품 정보"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"현재 재고"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"예약 재고"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"재주문점"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상태"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"위치"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"작업"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-modern-border-primary",children:B?t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"px-6 py-12 text-center",children:t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})})})}):0===D.length?t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"px-6 py-12 text-center text-modern-text-secondary",children:"재고 데이터가 없습니다."})}):D.map(e=>{return t.jsxs("tr",{className:"hover:bg-modern-bg-hover",children:[t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:e.productName}),t.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["SKU: ",e.sku]}),e.variantOptions&&t.jsx("div",{className:"text-xs text-modern-text-tertiary",children:Object.entries(e.variantOptions).map(([e,t])=>`${e}: ${t}`).join(", ")})]})}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-modern-text-primary",children:e.currentStock}),e.currentStock<=e.reorderPoint&&t.jsx(s,{className:"w-4 h-4 text-orange-500"})]})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:"text-sm text-modern-text-secondary",children:e.reservedStock})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:"text-sm text-modern-text-secondary",children:e.reorderPoint})}),t.jsx("td",{className:"px-6 py-4",children:(r=e.status,a=e.currentStock,i=e.reorderPoint,"out_of_stock"===r||0===a?t.jsx(q,{variant:"destructive",children:"품절"}):"low_stock"===r||a<=i?t.jsx(q,{variant:"outline",className:"text-orange-600 border-orange-600",children:"부족"}):"discontinued"===r?t.jsx(q,{variant:"secondary",children:"단종"}):t.jsx(q,{children:"정상"}))}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:"text-sm text-modern-text-secondary",children:e.location||"-"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(x,{variant:"ghost",size:"sm",onClick:()=>(e=>{O(e),U({inventoryItemId:e.id,type:"increase",quantity:0,reason:"",notes:""}),$(!0)})(e),children:t.jsx(n,{className:"w-4 h-4"})}),t.jsx(x,{variant:"ghost",size:"sm",onClick:()=>(e=>{O(e),Q(!0)})(e),children:t.jsx(d,{className:"w-4 h-4"})})]})})]},e.id);var r,a,i})})]})})})}),t.jsx(f,{open:L,onOpenChange:$,children:t.jsx(b,{children:t.jsxs("form",{onSubmit:e=>{e.preventDefault(),R.quantity&&R.reason?G.mutate(R):i.error("수량과 사유를 입력하세요")},children:[t.jsxs(g,{children:[t.jsx(w,{children:"재고 조정"}),t.jsxs(k,{children:[_?.productName," - ",_?.sku]})]}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsx("div",{children:t.jsxs(p,{children:["현재 재고: ",_?.currentStock,"개"]})}),t.jsxs("div",{children:[t.jsx(p,{htmlFor:"type",children:"조정 유형"}),t.jsxs("select",{id:"type",value:R.type,onChange:e=>U(t=>({...t,type:e.target.value})),className:"w-full px-3 py-2 border border-modern-border-primary rounded-lg mt-1",children:[t.jsx("option",{value:"increase",children:"증가"}),t.jsx("option",{value:"decrease",children:"감소"}),t.jsx("option",{value:"set",children:"절대값 설정"})]})]}),t.jsxs("div",{children:[t.jsx(p,{htmlFor:"quantity",children:"수량"}),t.jsx(m,{id:"quantity",type:"number",min:"0",value:R.quantity,onChange:e=>U(t=>({...t,quantity:parseInt(e.target.value)||0})),required:!0})]}),t.jsxs("div",{children:[t.jsx(p,{htmlFor:"reason",children:"조정 사유 *"}),t.jsxs("select",{id:"reason",value:R.reason,onChange:e=>U(t=>({...t,reason:e.target.value})),className:"w-full px-3 py-2 border border-modern-border-primary rounded-lg mt-1",required:!0,children:[t.jsx("option",{value:"",children:"사유를 선택하세요"}),t.jsx("option",{value:"manual_count",children:"실사 조정"}),t.jsx("option",{value:"damaged",children:"손상품 처리"}),t.jsx("option",{value:"expired",children:"유통기한 만료"}),t.jsx("option",{value:"returned",children:"반품 처리"}),t.jsx("option",{value:"promotional",children:"판촉 사용"}),t.jsx("option",{value:"theft",children:"분실/도난"}),t.jsx("option",{value:"other",children:"기타"})]})]}),t.jsxs("div",{children:[t.jsx(p,{htmlFor:"notes",children:"메모"}),t.jsx(h,{id:"notes",value:R.notes,onChange:e=>U(t=>({...t,notes:e.target.value})),placeholder:"추가 설명을 입력하세요...",rows:3})]})]}),t.jsxs(S,{children:[t.jsx(x,{type:"button",variant:"outline",onClick:()=>$(!1),children:"취소"}),t.jsx(x,{type:"submit",disabled:G.isPending,children:"조정하기"})]})]})})}),t.jsx(f,{open:z,onOpenChange:Q,children:t.jsxs(b,{className:"max-w-4xl",children:[t.jsxs(g,{children:[t.jsx(w,{children:"입출고 이력"}),t.jsxs(k,{children:[_?.productName," - ",_?.sku]})]}),t.jsx("div",{className:"max-h-96 overflow-y-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-modern-bg-tertiary sticky top-0",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"일시"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"유형"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"수량"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"잔여"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"사유"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"참조"})]})}),t.jsx("tbody",{children:V.map(e=>{const s=(e=>{switch(e){case"in":return{label:"입고",color:"text-green-600"};case"out":return{label:"출고",color:"text-red-600"};case"adjustment":return{label:"조정",color:"text-blue-600"};case"reserved":return{label:"예약",color:"text-orange-600"};case"unreserved":return{label:"예약해제",color:"text-purple-600"};default:return{label:e,color:"text-gray-600"}}})(e.type);return t.jsxs("tr",{className:"border-b border-modern-border-primary",children:[t.jsx("td",{className:"px-4 py-2 text-sm",children:new Date(e.createdAt).toLocaleString("ko-KR")}),t.jsx("td",{className:"px-4 py-2",children:t.jsx("span",{className:`text-sm font-medium ${s.color}`,children:s.label})}),t.jsxs("td",{className:"px-4 py-2 text-sm",children:["out"===e.type||"adjustment"===e.type?"-":"+",e.quantity]}),t.jsx("td",{className:"px-4 py-2 text-sm",children:e.remainingStock}),t.jsx("td",{className:"px-4 py-2 text-sm",children:e.reason}),t.jsx("td",{className:"px-4 py-2 text-sm",children:e.reference||"-"})]},e.id)})})]})}),t.jsx(S,{children:t.jsx(x,{onClick:()=>Q(!1),children:"닫기"})})]})})]})};export{C as default};
