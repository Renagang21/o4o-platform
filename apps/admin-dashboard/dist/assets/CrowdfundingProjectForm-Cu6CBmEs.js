import{u as e,b as t,r as s,V as r,j as a,A as i,b0 as o,dm as n,aT as d,S as c}from"./vendor-react-DqgGMt48.js";import{u as l,a as p,b as m}from"./vendor-query-D_c3FRkE.js";import{b as j,B as x,L as u,I as h,T as g}from"./page-template-editor-Dej8aqbo.js";import{cF as w,cG as b,cH as f,cI as v}from"./wp-misc-CVe7ECV4.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-C9jLuAcl.js";import"./wp-blocks-core-NinAvWTg.js";import"./wp-block-editor-misc-De1L5-zR.js";import"./wp-core-kvRrOm9B.js";import"./wp-block-editor-api-BKhomcj9.js";import"./wp-block-editor-store-BZ6fZn58.js";import"./wp-block-editor-clipboard-DrG0xX4B.js";import"./wp-i18n-D6_Il8Rt.js";import"./wp-block-editor-global-styles-DiR2HQC4.js";import"./wp-block-editor-typography-W96exnXk.js";import"./wp-components-BJYLMD7r.js";import"./wp-block-editor-spacing-CpdaiY4Q.js";import"./wp-block-editor-menus-IWaA-N3x.js";import"./wp-block-editor-core-BSca1VBH.js";import"./wp-block-editor-utils-Bqn4TiQr.js";import"./wp-block-editor-a11y-YlMsb8JF.js";import"./wp-block-editor-preview-CaF7fUZD.js";import"./wp-block-editor-borders-BtjnCtLF.js";import"./wp-block-editor-formats-B4-8T-Nh.js";import"./wp-block-editor-selection-DYIw7ude.js";import"./wp-block-editor-inline-DHEsfgnI.js";import"./wp-block-editor-ui-l6-7VhtF.js";import"./wp-block-editor-transforms-Bm69JWBw.js";import"./wp-block-editor-patterns-CNk0M6ZZ.js";import"./wp-block-editor-navigation-iME_YXGb.js";import"./wp-block-editor-dnd-DduwJSaE.js";import"./wp-block-editor-media-CVSKmHRK.js";import"./wp-api-Dp_oFsVM.js";import"./wp-block-editor-keyboard-C8o4qxcy.js";import"./wp-block-editor-templates-A6LfENHh.js";import"./wp-data-D64LRRbU.js";const y=()=>{const y=e(),{id:D}=t(),k=l(),N=!!D,[C,P]=s.useState({title:"",description:"",targetParticipantCount:10,startDate:"",endDate:"",forumLink:""}),[F,L]=s.useState({}),{data:S,isLoading:q}=p({queryKey:["crowdfunding-project",D],queryFn:async()=>(await j.api.get(`/v1/crowdfunding-simple/projects/${D}`)).data,enabled:N}),$=m({mutationFn:async e=>(await j.api.post("/v1/crowdfunding-simple/projects",e)).data,onSuccess:()=>{r.success("프로젝트가 생성되었습니다!"),k.invalidateQueries({queryKey:["crowdfunding-projects"]}),y("/crowdfunding/projects")},onError:e=>{r.error(e.response?.data?.error||"프로젝트 생성에 실패했습니다.")}}),E=m({mutationFn:async e=>(await j.api.put(`/v1/crowdfunding-simple/projects/${D}`,e)).data,onSuccess:()=>{r.success("프로젝트가 수정되었습니다!"),k.invalidateQueries({queryKey:["crowdfunding-project",D]}),k.invalidateQueries({queryKey:["crowdfunding-projects"]}),y(`/crowdfunding/projects/${D}`)},onError:e=>{r.error(e.response?.data?.error||"프로젝트 수정에 실패했습니다.")}});s.useEffect(()=>{if(S?.data){const e=S.data;P({title:e.title,description:e.description,targetParticipantCount:e.targetParticipantCount,startDate:e.startDate,endDate:e.endDate,forumLink:e.forumLink||""})}},[S]);const I=(e,t)=>{P(s=>({...s,[e]:t})),F[e]&&L(t=>({...t,[e]:void 0}))},K=(new Date).toISOString().split("T")[0];return N&&q?a.jsx("div",{className:"flex items-center justify-center h-96",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):a.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>y(N?`/crowdfunding/projects/${D}`:"/crowdfunding/projects"),children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),N?"프로젝트 상세":"프로젝트 목록"]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:N?"프로젝트 수정":"새 프로젝트 만들기"})})]}),a.jsxs("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e={};return C.title.trim()||(e.title="프로젝트 제목을 입력하세요."),C.description.trim()||(e.description="프로젝트 설명을 입력하세요."),C.targetParticipantCount<1&&(e.targetParticipantCount="목표 참여 매장 수는 1개 이상이어야 합니다."),C.startDate||(e.startDate="시작일을 선택하세요."),C.endDate||(e.endDate="종료일을 선택하세요."),C.startDate&&C.endDate&&C.startDate>=C.endDate&&(e.endDate="종료일은 시작일보다 늦어야 합니다."),C.startDate&&new Date(C.startDate)<new Date&&(e.startDate="시작일은 현재 날짜 이후여야 합니다."),L(e),0===Object.keys(e).length})()?N?E.mutate(C):$.mutate(C):r.error("입력한 정보를 확인해주세요.")},className:"space-y-6",children:[a.jsxs(w,{children:[a.jsx(b,{children:a.jsxs(f,{className:"flex items-center gap-2",children:[a.jsx(o,{className:"w-5 h-5 text-modern-primary"}),"프로젝트 기본 정보"]})}),a.jsxs(v,{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(u,{htmlFor:"title",children:"프로젝트 제목 *"}),a.jsx(h,{id:"title",value:C.title,onChange:e=>I("title",e.target.value),placeholder:"예: 친환경 포장재 대량 구매 프로젝트",className:F.title?"border-red-500":""}),F.title&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.title})]}),a.jsxs("div",{children:[a.jsx(u,{htmlFor:"description",children:"프로젝트 설명 *"}),a.jsx(g,{id:"description",value:C.description,onChange:e=>I("description",e.target.value),placeholder:"프로젝트의 목적, 혜택, 예상 절감 비용 등을 상세히 설명해주세요...",rows:8,className:F.description?"border-red-500":""}),F.description&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.description}),a.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:"참여 매장이 이해하기 쉽도록 구체적인 혜택과 절감 효과를 포함해주세요."})]})]})]}),a.jsxs(w,{children:[a.jsx(b,{children:a.jsxs(f,{className:"flex items-center gap-2",children:[a.jsx(n,{className:"w-5 h-5 text-modern-primary"}),"목표 및 기간 설정"]})}),a.jsxs(v,{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(u,{htmlFor:"targetParticipantCount",children:"목표 참여 매장 수 *"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(h,{id:"targetParticipantCount",type:"number",min:"1",max:"1000",value:C.targetParticipantCount,onChange:e=>I("targetParticipantCount",parseInt(e.target.value)||0),className:"max-w-xs "+(F.targetParticipantCount?"border-red-500":"")}),a.jsx("span",{className:"text-modern-text-secondary",children:"개 매장"})]}),F.targetParticipantCount&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.targetParticipantCount}),a.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:"목표를 달성하면 비용 절감 효과를 얻을 수 있는 최소 참여 매장 수를 설정하세요."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(u,{htmlFor:"startDate",children:"프로젝트 시작일 *"}),a.jsx(h,{id:"startDate",type:"date",min:K,value:C.startDate,onChange:e=>I("startDate",e.target.value),className:F.startDate?"border-red-500":""}),F.startDate&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.startDate})]}),a.jsxs("div",{children:[a.jsx(u,{htmlFor:"endDate",children:"프로젝트 종료일 *"}),a.jsx(h,{id:"endDate",type:"date",min:C.startDate||K,value:C.endDate,onChange:e=>I("endDate",e.target.value),className:F.endDate?"border-red-500":""}),F.endDate&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.endDate})]})]})]})]}),a.jsxs(w,{children:[a.jsx(b,{children:a.jsxs(f,{className:"flex items-center gap-2",children:[a.jsx(d,{className:"w-5 h-5 text-modern-primary"}),"추가 설정"]})}),a.jsx(v,{className:"space-y-4",children:a.jsxs("div",{children:[a.jsx(u,{htmlFor:"forumLink",children:"포럼 링크 (선택)"}),a.jsx(h,{id:"forumLink",value:C.forumLink,onChange:e=>I("forumLink",e.target.value),placeholder:"/forum/posts/project-discussion"}),a.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:"참여자들이 토론할 수 있는 포럼 페이지 링크를 입력하세요."})]})})]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx(x,{type:"button",variant:"outline",onClick:()=>y(N?`/crowdfunding/projects/${D}`:"/crowdfunding/projects"),children:"취소"}),a.jsxs(x,{type:"submit",disabled:$.isPending||E.isPending,children:[a.jsx(c,{className:"w-4 h-4 mr-2"}),$.isPending||E.isPending?"저장 중...":N?"수정하기":"프로젝트 만들기"]})]})]})]})};export{y as default};
