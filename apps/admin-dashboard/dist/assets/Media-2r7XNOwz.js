import{u as e,r as s,j as t,aI as r,aD as a,V as i,c0 as o,c1 as l}from"./vendor-react-BqkIXTmC.js";import{M as n}from"./MediaLibrary-B5NE81aP.js";import{B as d,b as c}from"./page-template-editor-DmUXhR56.js";import"./vendor-monaco-BxJH8uUv.js";import"./wp-misc-D0_U3Yh3.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-query-C5jzPyjL.js";import"./vendor-utils-C9jLuAcl.js";import"./wp-data-CsLR-lZb.js";import"./wp-block-editor-main-DEdKEcH7.js";import"./wp-block-editor-store-Cdz5rmmV.js";import"./wp-blocks-core-C_Umt3qd.js";import"./wp-core-skmJSxj5.js";import"./wp-i18n-DP14Ry5v.js";import"./wp-block-editor-utils-CmROb2t9.js";import"./wp-components-i3qvAB06.js";import"./wp-api-Dq90bqIA.js";import"./checkbox-DD58aj3L.js";const p=()=>{const o=e(),[l,n]=s.useState([]),[p,m]=s.useState(!1),[u,x]=s.useState(!1),j=s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),x(!1);const s=e.dataTransfer.files;s&&s.length>0&&v(s)},[]),g=s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),x(!0)},[]),h=s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),x(!1)},[]),v=e=>{const s=Array.from(e).map(e=>({file:e,id:`${Date.now()}-${Math.random()}`,status:"pending",progress:0,preview:e.type.startsWith("image/")?URL.createObjectURL(e):void 0}));n(e=>[...e,...s])},b=async e=>{try{n(s=>s.map(s=>s.id===e.id?{...s,status:"uploading",progress:10}:s));const s=new FormData;s.append("file",e.file),s.append("title",e.file.name.replace(/\.[^/.]+$/,""));const t=setInterval(()=>{n(s=>s.map(s=>s.id===e.id&&"uploading"===s.status?{...s,progress:Math.min(s.progress+10,90)}:s))},200),r=await c.api.post("/media/upload",s,{headers:{"Content-Type":"multipart/form-data"}});return clearInterval(t),n(s=>s.map(s=>s.id===e.id?{...s,status:"success",progress:100}:s)),r.data}catch(s){throw n(s=>s.map(s=>s.id===e.id?{...s,status:"error",error:"업로드 실패"}:s)),s}},f=()=>{const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept="image/*,video/*,audio/*,application/pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",e.onchange=e=>{const s=e.target.files;s&&v(s)},e.click()};return t.jsx("div",{className:"wp-admin-content",children:t.jsxs("div",{className:"wrap",children:[t.jsx("h1",{className:"wp-heading-inline",children:"새 미디어 추가"}),t.jsx("div",{className:"mt-6",children:0===l.length?t.jsxs("div",{className:"border-4 border-dashed rounded-lg p-12 text-center transition-colors "+(u?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDrop:j,onDragOver:g,onDragLeave:h,onClick:f,style:{cursor:"pointer"},children:[t.jsx(r,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),t.jsx("h3",{className:"text-xl font-medium text-gray-700 mb-2",children:"파일을 여기에 드래그하거나 클릭하여 선택하세요"}),t.jsx("p",{className:"text-sm text-gray-500",children:"최대 업로드 파일 크기: 100MB"}),t.jsx(d,{variant:"outline",className:"mt-4",onClick:e=>{e.stopPropagation(),f()},children:"파일 선택"})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsxs("h3",{className:"text-lg font-medium",children:[l.length,"개 파일 선택됨"]}),t.jsxs("div",{className:"space-x-2",children:[t.jsx(d,{variant:"outline",onClick:f,children:"파일 추가"}),t.jsx(d,{onClick:async()=>{m(!0);const e=l.filter(e=>"pending"===e.status);let s=0,t=0;for(const a of e)try{await b(a),s++}catch(r){t++}m(!1),s>0&&(i.success(`${s}개 파일이 업로드되었습니다`),0===t&&setTimeout(()=>{o("/media/library")},1500)),t>0&&i.error(`${t}개 파일 업로드에 실패했습니다`)},disabled:p||l.every(e=>"pending"!==e.status),children:"업로드 시작"})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(e=>t.jsxs("div",{className:"border rounded-lg p-4 "+("error"===e.status?"border-red-300 bg-red-50":"border-gray-200"),children:[t.jsxs("div",{className:"flex items-start justify-between mb-2",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-medium text-sm truncate",children:e.file.name}),t.jsxs("p",{className:"text-xs text-gray-500",children:[(e.file.size/1024/1024).toFixed(2)," MB"]})]}),"pending"===e.status&&t.jsx("button",{onClick:()=>{return s=e.id,void n(e=>{const t=e.filter(e=>e.id!==s),r=e.find(e=>e.id===s);return r?.preview&&URL.revokeObjectURL(r.preview),t});var s},className:"ml-2 text-gray-400 hover:text-gray-600",children:t.jsx(a,{className:"w-4 h-4"})})]}),e.preview&&t.jsx("img",{src:e.preview,alt:"",className:"w-full h-32 object-cover rounded mb-2"}),"uploading"===e.status&&t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${e.progress}%`}})}),"success"===e.status&&t.jsx("div",{className:"text-green-600 text-sm",children:"✓ 업로드 완료"}),"error"===e.status&&t.jsx("div",{className:"text-red-600 text-sm",children:e.error||"업로드 실패"})]},e.id))})]})})]})})},m=()=>t.jsxs(o,{children:[t.jsx(l,{path:"/",element:t.jsx(n,{})}),t.jsx(l,{path:"/library",element:t.jsx(n,{})}),t.jsx(l,{path:"/new",element:t.jsx(p,{})})]});export{m as default};
