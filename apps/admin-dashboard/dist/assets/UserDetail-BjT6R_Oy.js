import{r as c,z as l,j as e,Z as _,bV as B,bU as $,$ as T,au as E,w as H,b as P,u as I,A as M,o as k,cg as R,ar as D,bv as F,H as V,as as z,J}from"./vendor-react-P__8vGRG.js";import{B as m,h as O,i as X,j as C,k as S}from"./page-template-editor-BTdVTS-a.js";import{C as h,a as p,b as j,c as L,d as u,B as f}from"./index-C0gS3Jf3.js";import{U as g}from"./userApi-m_Dm3U7g.js";import{B as q}from"./BusinessInfoSection-ulcw75wH.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-query-CucHvDcH.js";import"./vendor-utils-dq2XMRwt.js";import"./vendor-socket-DgcwqWsT.js";import"./unified-client-DYKT-pLO.js";const Z=r=>{switch(r){case"login":return e.jsx($,{className:"h-4 w-4 text-green-500"});case"logout":return e.jsx(B,{className:"h-4 w-4 text-gray-500"});case"role_change":return e.jsx(H,{className:"h-4 w-4 text-blue-500"});case"status_change":return e.jsx(E,{className:"h-4 w-4 text-yellow-500"});case"profile_update":return e.jsx(T,{className:"h-4 w-4 text-purple-500"});case"approval":return e.jsx($,{className:"h-4 w-4 text-green-500"});case"rejection":return e.jsx(B,{className:"h-4 w-4 text-red-500"});default:return e.jsx(_,{className:"h-4 w-4 text-gray-500"})}},G=r=>{switch(r){case"login":case"approval":return"bg-green-100 text-green-800";case"logout":return"bg-gray-100 text-gray-800";case"role_change":return"bg-blue-100 text-blue-800";case"status_change":return"bg-yellow-100 text-yellow-800";case"profile_update":return"bg-purple-100 text-purple-800";case"rejection":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};function K({userId:r}){const[i,t]=c.useState([]),[n,d]=c.useState(!0),[o,y]=c.useState(1),[v,x]=c.useState(!1);c.useEffect(()=>{b()},[r,o]);const b=async()=>{try{d(!0);const s=await g.get(`/api/v1/users/${r}/activity-log?page=${o}&limit=20`);s.data.success&&(t(o===1?s.data.data.activities:U=>[...U,...s.data.data.activities]),x(s.data.data.pagination.hasMore))}catch{l.error("Failed to load activity log")}finally{d(!1)}},w=()=>{y(s=>s+1)},A=s=>{switch(s.actionType){case"login":return"User logged in";case"logout":return"User logged out";case"role_change":return`Role changed from ${s.details.oldRole} to ${s.details.newRole}`;case"status_change":return`Status changed from ${s.details.oldStatus} to ${s.details.newStatus}`;case"profile_update":return`Profile updated: ${Object.keys(s.details.changes||{}).join(", ")}`;case"approval":return`User approved${s.details.notes?`: ${s.details.notes}`:""}`;case"rejection":return`User rejected${s.details.notes?`: ${s.details.notes}`:""}`;default:return s.action}};return e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsx(j,{children:"Activity Log"}),e.jsx(L,{children:"Recent user activities and administrative actions"})]}),e.jsx(u,{children:n&&i.length===0?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"Loading activities..."})}):i.length===0?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"No activities recorded yet"})}):e.jsxs("div",{className:"space-y-4",children:[i.map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg hover:bg-gray-50",children:[e.jsx("div",{className:"mt-0.5",children:Z(s.actionType)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:A(s)}),e.jsx(f,{className:`text-xs ${G(s.actionType)}`,children:s.actionType.replace("_"," ")})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsx("div",{children:new Date(s.timestamp).toLocaleString()}),s.performedBy&&e.jsxs("div",{children:["By: ",s.performedBy.name," (",s.performedBy.role,")"]}),s.ipAddress&&e.jsxs("div",{children:["IP: ",s.ipAddress]})]})]})]},s.id)),v&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{onClick:w,disabled:n,className:"px-4 py-2 text-sm text-blue-600 hover:text-blue-800 disabled:text-gray-400",children:n?"Loading...":"Load More"})})]})})]})}function le(){const{id:r}=P(),i=I(),[t,n]=c.useState(null),[d,o]=c.useState([]),[y,v]=c.useState(!0);c.useEffect(()=>{r&&x()},[r]);const x=async()=>{try{v(!0);const a=await g.getUser(r);a&&n(a.data||a);const N=await g.getUserActivity(r);N.data.success&&o(N.data.data)}catch{l.error("Failed to load user details"),i("/users")}finally{v(!1)}},b=async()=>{try{await g.approveUser(r,"Approved via admin dashboard"),l.success("User approved successfully"),x()}catch{l.error("Failed to approve user")}},w=async()=>{try{await g.rejectUser(r,"Rejected via admin dashboard"),l.success("User rejected successfully"),x()}catch{l.error("Failed to reject user")}},A=a=>({super_admin:"bg-purple-500",admin:"bg-red-500",vendor:"bg-blue-500",seller:"bg-green-500",customer:"bg-gray-500",business:"bg-yellow-500",moderator:"bg-indigo-500",partner:"bg-pink-500"})[a]||"bg-gray-500",s=a=>({active:"bg-green-500",approved:"bg-green-500",pending:"bg-yellow-500",rejected:"bg-red-500"})[a]||"bg-gray-500",U=a=>{switch(a){case"approved":return e.jsx(k,{className:"h-4 w-4 text-green-500"});case"rejected":return e.jsx(R,{className:"h-4 w-4 text-red-500"});default:return e.jsx(J,{className:"h-4 w-4 text-gray-500"})}};return y?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):t?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(m,{variant:"ghost",onClick:()=>i("/users"),children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Back to Users"]}),e.jsx("h1",{className:"text-2xl font-bold",children:t?.name||"Unknown User"})]}),e.jsxs("div",{className:"flex gap-2",children:[t?.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{onClick:b,children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Approve"]}),e.jsxs(m,{variant:"destructive",onClick:w,children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Reject"]})]}),e.jsxs(m,{variant:"outline",onClick:()=>i(`/users/${r}/edit`),children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Edit"]})]})]}),e.jsxs(O,{defaultValue:"overview",className:"w-full",children:[e.jsxs(X,{children:[e.jsx(C,{value:"overview",children:"Overview"}),e.jsx(C,{value:"history",children:"Approval History"}),e.jsx(C,{value:"activity",children:"Activity"})]}),e.jsxs(S,{value:"overview",className:"space-y-6",children:[e.jsx(q,{userId:r,userRole:t?.role}),e.jsxs(h,{children:[e.jsx(p,{children:e.jsx(j,{children:"User Information"})}),e.jsx(u,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Status"}),e.jsx(f,{className:`${s(t?.status||"pending")} text-white`,children:t?.status})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Joined"}),e.jsx("p",{className:"font-medium",children:t?"/* date removed */":""})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Login"}),e.jsx("p",{className:"font-medium",children:t?.lastLoginAt?"/* date removed */":"Never"})]})]})]})})]}),e.jsxs(h,{children:[e.jsx(p,{children:e.jsx(j,{children:"Roles & Permissions"})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Assigned Roles"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:t?.role?[t.role]:[].map(a=>e.jsx(f,{className:`${A(a)} text-white`,children:a.replace("_"," ")},a))})]}),t?.permissions&&t?.permissions.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Special Permissions"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:t?.permissions.map(a=>e.jsx(f,{variant:"outline",children:a},a))})]})]})})]}),e.jsxs(h,{children:[e.jsx(p,{children:e.jsx(j,{children:"Account Status"})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email Verified"}),e.jsx("p",{className:"text-2xl font-bold",children:t?.isEmailVerified?"✓":"✗"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Account Active"}),e.jsx("p",{className:"text-2xl font-bold",children:t?.isActive?"✓":"✗"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Login Attempts"}),e.jsx("p",{className:"text-2xl font-bold",children:t?.loginAttempts||0})]})]})})]})]}),e.jsx(S,{value:"history",className:"space-y-4",children:e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsx(j,{children:"Approval History"}),e.jsx(L,{children:"Timeline of all approval actions for this user"})]}),e.jsx(u,{children:d.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No approval history found"}):e.jsx("div",{className:"space-y-4",children:d.map(a=>e.jsxs("div",{className:"flex items-start gap-4 p-4 border rounded-lg",children:[e.jsx("div",{className:"mt-1",children:U(a.action)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("p",{className:"font-medium",children:[a.action==="approved"&&"Approved",a.action==="rejected"&&"Rejected",a.action==="status_changed"&&"Status Changed"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["by ",a.admin?.fullName||a.admin?.email||"System"]})]}),a.notes&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:a.notes}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:[a.previous_status," → ",a.new_status]}),e.jsx("span",{children:"/* date removed */"})]})]})]},a.id))})})]})}),e.jsx(S,{value:"activity",children:e.jsx(K,{userId:r})})]})]}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"User not found"}),e.jsx(m,{onClick:()=>i("/users"),className:"mt-4",children:"Back to Users"})]})})}export{le as default};
//# sourceMappingURL=UserDetail-BjT6R_Oy.js.map
