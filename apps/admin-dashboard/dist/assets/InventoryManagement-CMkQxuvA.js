import{r as l,j as e,c2 as F,S as X,cY as Z,N as ee,Y as te,V as w}from"./vendor-react-CPLvoCm3.js";import{u as se,a as k,b as O}from"./vendor-query-BtistrhA.js";import{B as d,C as i,k as j,l as y,m as o,I as K,w as M,x as P,y as T,z as _,E as A,L as c,T as re,F as L,j as x,s as v}from"./page-gutenberg-DLeK6fOm.js";import"./wp-block-editor-Dl58kgFV.js";import"./wp-i18n-CvFqmxct.js";import"./wp-core-DsNNoVDq.js";import"./wp-blocks-core-Bps80Ozc.js";import"./wp-misc-BM-YUiZN.js";import"./wp-data-CXbtpCh2.js";import"./wp-components-YCGeKRou.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-utils-D_7XgcHg.js";import"./wp-api-pXRzUPJ4.js";import"./vendor-monaco-cpVGocfO.js";const ve=()=>{const S=se(),[m,H]=l.useState(""),[p,$]=l.useState("all"),[r,C]=l.useState(null),[B,h]=l.useState(!1),[q,N]=l.useState(!1),[n,a]=l.useState({inventoryItemId:"",type:"increase",quantity:0,reason:"",notes:""}),{data:E,isLoading:Q}=k({queryKey:["inventory",m,p],queryFn:async()=>{const t=new URLSearchParams;return m&&t.append("search",m),p!=="all"&&t.append("status",p),(await x.api.get(`/v1/inventory?${t.toString()}`)).data}}),f=E?.data||[],{data:R}=k({queryKey:["stock-movements",r?.id],queryFn:async()=>r?.id?(await x.api.get(`/v1/inventory/${r.id}/movements`)).data:{data:[]},enabled:!!r?.id&&q}),z=R?.data||[],{data:U}=k({queryKey:["inventory-stats"],queryFn:async()=>(await x.api.get("/v1/inventory/stats")).data}),u=U?.data||{},I=O({mutationFn:async t=>(await x.api.post("/v1/inventory/adjust",t)).data,onSuccess:()=>{w.success("재고가 조정되었습니다"),S.invalidateQueries({queryKey:["inventory"]}),S.invalidateQueries({queryKey:["inventory-stats"]}),h(!1),a({inventoryItemId:"",type:"increase",quantity:0,reason:"",notes:""})}}),D=O({mutationFn:async t=>(await x.api.post("/v1/inventory/bulk-reorder",{itemIds:t})).data,onSuccess:()=>{w.success("대량 재주문이 요청되었습니다")}}),V=(t,s,b)=>t==="out_of_stock"||s===0?e.jsx(v,{variant:"destructive",children:"품절"}):t==="low_stock"||s<=b?e.jsx(v,{variant:"outline",className:"text-orange-600 border-orange-600",children:"부족"}):t==="discontinued"?e.jsx(v,{variant:"secondary",children:"단종"}):e.jsx(v,{children:"정상"}),Y=t=>{C(t),a({inventoryItemId:t.id,type:"increase",quantity:0,reason:"",notes:""}),h(!0)},G=t=>{C(t),N(!0)},J=t=>{if(t.preventDefault(),!n.quantity||!n.reason){w.error("수량과 사유를 입력하세요");return}I.mutate(n)},W=t=>{switch(t){case"in":return{label:"입고",color:"text-green-600"};case"out":return{label:"출고",color:"text-red-600"};case"adjustment":return{label:"조정",color:"text-blue-600"};case"reserved":return{label:"예약",color:"text-orange-600"};case"unreserved":return{label:"예약해제",color:"text-purple-600"};default:return{label:t,color:"text-gray-600"}}},g=f.filter(t=>t.currentStock<=t.reorderPoint&&t.status!=="discontinued");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"재고 관리"}),e.jsx("p",{className:"text-modern-text-secondary mt-1",children:"실시간 재고 추적 및 관리"})]}),e.jsx("div",{className:"flex gap-2",children:g.length>0&&e.jsxs(d,{variant:"outline",onClick:()=>D.mutate(g.map(t=>t.id)),disabled:D.isPending,children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"부족 재고 재주문 (",g.length,")"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(i,{children:[e.jsx(j,{className:"pb-2",children:e.jsx(y,{className:"text-sm font-medium text-modern-text-secondary",children:"총 상품 수"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-modern-text-primary",children:u.totalItems||0}),e.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"활성 상품 기준"})]})]}),e.jsxs(i,{children:[e.jsx(j,{className:"pb-2",children:e.jsx(y,{className:"text-sm font-medium text-modern-text-secondary",children:"부족 재고"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:u.lowStockItems||0}),e.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"재주문 필요"})]})]}),e.jsxs(i,{children:[e.jsx(j,{className:"pb-2",children:e.jsx(y,{className:"text-sm font-medium text-modern-text-secondary",children:"품절 상품"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:u.outOfStockItems||0}),e.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"즉시 보충 필요"})]})]}),e.jsxs(i,{children:[e.jsx(j,{className:"pb-2",children:e.jsx(y,{className:"text-sm font-medium text-modern-text-secondary",children:"총 재고 가치"})}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold text-modern-text-primary",children:["₩",(u.totalValue||0).toLocaleString()]}),e.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"원가 기준"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-modern-text-tertiary w-5 h-5"}),e.jsx(K,{type:"text",placeholder:"상품명, SKU로 검색...",value:m,onChange:t=>H(t.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-modern-text-secondary"}),e.jsxs("select",{value:p,onChange:t=>$(t.target.value),className:"px-4 py-2 border border-modern-border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-modern-primary",children:[e.jsx("option",{value:"all",children:"모든 상태"}),e.jsx("option",{value:"in_stock",children:"정상 재고"}),e.jsx("option",{value:"low_stock",children:"부족 재고"}),e.jsx("option",{value:"out_of_stock",children:"품절"}),e.jsx("option",{value:"discontinued",children:"단종"})]})]})]}),e.jsx(i,{children:e.jsx(o,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-modern-bg-tertiary border-b border-modern-border-primary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상품 정보"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"현재 재고"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"예약 재고"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"재주문점"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상태"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"위치"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-modern-border-primary",children:Q?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-12 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})})})}):f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-12 text-center text-modern-text-secondary",children:"재고 데이터가 없습니다."})}):f.map(t=>e.jsxs("tr",{className:"hover:bg-modern-bg-hover",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:t.productName}),e.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["SKU: ",t.sku]}),t.variantOptions&&e.jsx("div",{className:"text-xs text-modern-text-tertiary",children:Object.entries(t.variantOptions).map(([s,b])=>`${s}: ${b}`).join(", ")})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-modern-text-primary",children:t.currentStock}),t.currentStock<=t.reorderPoint&&e.jsx(F,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-modern-text-secondary",children:t.reservedStock})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-modern-text-secondary",children:t.reorderPoint})}),e.jsx("td",{className:"px-6 py-4",children:V(t.status,t.currentStock,t.reorderPoint)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-modern-text-secondary",children:t.location||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>Y(t),children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>G(t),children:e.jsx(te,{className:"w-4 h-4"})})]})})]},t.id))})]})})})}),e.jsx(M,{open:B,onOpenChange:h,children:e.jsx(P,{children:e.jsxs("form",{onSubmit:J,children:[e.jsxs(T,{children:[e.jsx(_,{children:"재고 조정"}),e.jsxs(A,{children:[r?.productName," - ",r?.sku]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{children:e.jsxs(c,{children:["현재 재고: ",r?.currentStock,"개"]})}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"type",children:"조정 유형"}),e.jsxs("select",{id:"type",value:n.type,onChange:t=>a(s=>({...s,type:t.target.value})),className:"w-full px-3 py-2 border border-modern-border-primary rounded-lg mt-1",children:[e.jsx("option",{value:"increase",children:"증가"}),e.jsx("option",{value:"decrease",children:"감소"}),e.jsx("option",{value:"set",children:"절대값 설정"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"quantity",children:"수량"}),e.jsx(K,{id:"quantity",type:"number",min:"0",value:n.quantity,onChange:t=>a(s=>({...s,quantity:parseInt(t.target.value)||0})),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"reason",children:"조정 사유 *"}),e.jsxs("select",{id:"reason",value:n.reason,onChange:t=>a(s=>({...s,reason:t.target.value})),className:"w-full px-3 py-2 border border-modern-border-primary rounded-lg mt-1",required:!0,children:[e.jsx("option",{value:"",children:"사유를 선택하세요"}),e.jsx("option",{value:"manual_count",children:"실사 조정"}),e.jsx("option",{value:"damaged",children:"손상품 처리"}),e.jsx("option",{value:"expired",children:"유통기한 만료"}),e.jsx("option",{value:"returned",children:"반품 처리"}),e.jsx("option",{value:"promotional",children:"판촉 사용"}),e.jsx("option",{value:"theft",children:"분실/도난"}),e.jsx("option",{value:"other",children:"기타"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"notes",children:"메모"}),e.jsx(re,{id:"notes",value:n.notes,onChange:t=>a(s=>({...s,notes:t.target.value})),placeholder:"추가 설명을 입력하세요...",rows:3})]})]}),e.jsxs(L,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>h(!1),children:"취소"}),e.jsx(d,{type:"submit",disabled:I.isPending,children:"조정하기"})]})]})})}),e.jsx(M,{open:q,onOpenChange:N,children:e.jsxs(P,{className:"max-w-4xl",children:[e.jsxs(T,{children:[e.jsx(_,{children:"입출고 이력"}),e.jsxs(A,{children:[r?.productName," - ",r?.sku]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-modern-bg-tertiary sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"일시"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"유형"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"수량"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"잔여"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"사유"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-modern-text-secondary",children:"참조"})]})}),e.jsx("tbody",{children:z.map(t=>{const s=W(t.type);return e.jsxs("tr",{className:"border-b border-modern-border-primary",children:[e.jsx("td",{className:"px-4 py-2 text-sm",children:new Date(t.createdAt).toLocaleString("ko-KR")}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`text-sm font-medium ${s.color}`,children:s.label})}),e.jsxs("td",{className:"px-4 py-2 text-sm",children:[t.type==="out"||t.type==="adjustment"?"-":"+",t.quantity]}),e.jsx("td",{className:"px-4 py-2 text-sm",children:t.remainingStock}),e.jsx("td",{className:"px-4 py-2 text-sm",children:t.reason}),e.jsx("td",{className:"px-4 py-2 text-sm",children:t.reference||"-"})]},t.id)})})]})}),e.jsx(L,{children:e.jsx(d,{onClick:()=>N(!1),children:"닫기"})})]})})]})};export{ve as default};
