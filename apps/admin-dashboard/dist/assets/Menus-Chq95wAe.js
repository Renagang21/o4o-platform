import{a3 as xe,V as f,j as e,P as H,bp as re,E as Le,c9 as me,D as pe,a as Te,X as qe,bK as $e,a4 as Ke,r as h,a5 as Oe,a1 as Pe,cc as Ve,d as Qe,c as _e,cK as ze,n as ne,d0 as Be,F as le,bU as Re,bV as U}from"./vendor-react-CFXBKh8N.js";import{j as v,B as u,s as J,C as L,k as _,l as z,D as Ue,n as He,o as Je,r as ie,m as T,L as N,I as A,S as ce,f as de,g as oe,h as he,i as S,a as Ge,b as Xe,d as V,e as Q,w as We,x as Ye,y as Ze,z as es,E as ss,F as as}from"./page-gutenberg-CihbTQe_.js";import{S as ts}from"./page-template-editor-qYhqNsmP.js";import{u as ge,a as M,b as B}from"./vendor-query-D0j4d4-i.js";import"./wp-block-editor-DhaEFHLK.js";import"./wp-i18n-DXAO7rTz.js";import"./wp-core-CKjiTxtQ.js";import"./wp-blocks-core-CqiW7X_r.js";import"./wp-misc-BCLjNiWG.js";import"./wp-data-DkVHr7c4.js";import"./wp-components-BOsGWWgw.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-monaco-cpVGocfO.js";import"./vendor-utils-DQ8F5vJI.js";const rs={primary:"주 메뉴",footer:"푸터",sidebar:"사이드바",mobile:"모바일"},ns={primary:"bg-blue-100 text-blue-800",footer:"bg-gray-100 text-gray-800",sidebar:"bg-green-100 text-green-800",mobile:"bg-purple-100 text-purple-800"},ls=()=>{const b=xe(),x=ge(),{data:k,isLoading:y}=M({queryKey:["menus"],queryFn:async()=>{const a=new Date;return{menus:[{id:"1",name:"Main Menu",location:"primary",items:[],isActive:!0,createdAt:a,updatedAt:a},{id:"2",name:"Footer Menu",location:"footer",items:[],isActive:!0,createdAt:a,updatedAt:a}]}}}),w=k?.menus||[],q=B({mutationFn:async a=>v.api.delete(`/v1/menus/${a}`),onSuccess:()=>{x.invalidateQueries({queryKey:["menus"]}),f.success("메뉴가 삭제되었습니다")},onError:()=>{f.error("메뉴 삭제에 실패했습니다")}}),E=B({mutationFn:async({id:a,isActive:n})=>v.api.patch(`/v1/menus/${a}/active`,{isActive:n}),onSuccess:()=>{x.invalidateQueries({queryKey:["menus"]}),f.success("메뉴 상태가 변경되었습니다")},onError:()=>{f.error("메뉴 상태 변경에 실패했습니다")}}),$=a=>{confirm("정말 이 메뉴를 삭제하시겠습니까?")&&q.mutate(a)},K=a=>{E.mutate({id:a.id,isActive:!a.isActive})},O=w.reduce((a,n)=>(a[n.location]||(a[n.location]=[]),a[n.location].push(n),a),{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"메뉴 관리"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"사이트의 내비게이션 메뉴를 관리합니다"})]}),e.jsxs(u,{onClick:()=>b("/themes/menus/new"),children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"새 메뉴"]})]}),y?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"})}):w.length>0?e.jsx("div",{className:"space-y-8",children:["primary","footer","sidebar","mobile"].map(a=>{const n=O[a]||[];return n.length===0?null:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(J,{className:ns[a],children:rs[a]}),e.jsxs("span",{className:"text-sm text-gray-500 font-normal",children:["(",n.length,"개 메뉴)"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:n.map(c=>e.jsxs(L,{children:[e.jsx(_,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsxs(z,{className:"text-lg flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),c.name]}),c.description&&e.jsx("p",{className:"text-sm text-gray-500",children:c.description})]}),e.jsxs(Ue,{children:[e.jsx(He,{children:e.jsx(u,{variant:"ghost",size:"sm",children:e.jsx(Le,{className:"w-4 h-4"})})}),e.jsxs(Je,{align:"end",children:[e.jsxs(ie,{onClick:()=>b(`/themes/menus/${c.id}/edit`),children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"편집"]}),e.jsxs(ie,{onClick:()=>$(c.id),className:"text-red-600",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"항목 수"}),e.jsxs(J,{variant:"outline",children:[c.items.length,"개"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"활성화"}),e.jsxs("div",{className:"flex items-center gap-2",children:[c.isActive?e.jsx(Te,{className:"w-4 h-4 text-green-600"}):e.jsx(qe,{className:"w-4 h-4 text-gray-400"}),e.jsx(ts,{checked:c.isActive,onCheckedChange:()=>K(c),disabled:E.isPending})]})]}),e.jsx("div",{className:"pt-3 border-t",children:e.jsx($e,{to:`/themes/menus/${c.id}/edit`,className:"text-sm text-blue-600 hover:text-blue-800",children:"메뉴 편집 →"})})]})})]},c.id))})]},a)})}):e.jsx(L,{children:e.jsxs(T,{className:"text-center py-12",children:[e.jsx(re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"메뉴가 없습니다"}),e.jsxs(u,{onClick:()=>b("/themes/menus/new"),children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"첫 메뉴 만들기"]})]})})]})},ue=()=>{const b=xe(),{id:x}=Ke(),k=ge(),y=!!x,[w,q]=h.useState(""),[E,$]=h.useState("primary"),[K,O]=h.useState(""),[a,n]=h.useState([]),[c,F]=h.useState(!1),[p,G]=h.useState(null),[P,X]=h.useState(null),[je,R]=h.useState(null),[m,D]=h.useState({label:"",type:"custom",url:"",target:"_self"}),{data:C,isLoading:ve}=M({queryKey:["menu",x],queryFn:async()=>(await v.api.get(`/v1/menus/${x}`)).data,enabled:y}),{data:fe=[]}=M({queryKey:["pages-for-menu"],queryFn:async()=>(await v.api.get("/v1/posts?type=page&status=published")).data.posts||[]}),{data:ye=[]}=M({queryKey:["posts-for-menu"],queryFn:async()=>(await v.api.get("/v1/posts?type=post&status=published&limit=50")).data.posts||[]}),{data:Ne=[]}=M({queryKey:["categories-for-menu"],queryFn:async()=>(await v.api.get("/v1/categories")).data}),W=B({mutationFn:async s=>(await v.api.post("/v1/menus",s)).data,onSuccess:()=>{f.success("메뉴가 생성되었습니다"),k.invalidateQueries({queryKey:["menus"]}),b("/themes/menus")},onError:()=>{f.error("메뉴 생성에 실패했습니다")}}),Y=B({mutationFn:async s=>(await v.api.put(`/v1/menus/${x}`,s)).data,onSuccess:()=>{f.success("메뉴가 수정되었습니다"),k.invalidateQueries({queryKey:["menus"]}),k.invalidateQueries({queryKey:["menu",x]})},onError:()=>{f.error("메뉴 수정에 실패했습니다")}});h.useEffect(()=>{C&&(q(C.name),$(C.location),O(C.description||""),n(C.items.map(s=>({...s,isExpanded:!1}))))},[C]);const be=()=>{const s=o=>o.map(({isExpanded:t,...I})=>({...I,children:I.children?s(I.children):void 0})),r={name:w,location:E,description:K,items:s(a),isActive:!0};y?Y.mutate({id:x,...r}):W.mutate(r)},we=()=>{G(null),D({label:"",type:"custom",url:"",target:"_self"}),F(!0)},De=s=>{G(s),D({label:s.label,type:s.type,url:s.url||"",target:s.target||"_self",icon:s.icon,cssClass:s.cssClass,pageId:s.pageId,postId:s.postId,categoryId:s.categoryId}),F(!0)},Ce=()=>{const s={id:p?.id||`item-${Date.now()}`,...m,order:p?.order||a.length,parentId:p?.parentId,children:p?.children||[],createdAt:p?.createdAt||new Date,updatedAt:new Date};if(p){const r=o=>o.map(t=>t.id===p.id?{...s,isExpanded:t.isExpanded}:t.children&&t.children.length>0?{...t,children:r(t.children)}:t);n(r(a))}else n([...a,s]);F(!1)},Ie=s=>{const r=o=>o.filter(t=>t.id===s?!1:(t.children&&t.children.length>0&&(t.children=r(t.children)),!0));n(r(a))},Se=(s,r)=>{X(r),s.dataTransfer.effectAllowed="move"},ke=(s,r)=>{s.preventDefault(),s.dataTransfer.dropEffect="move",R(r)},Ee=()=>{R(null)},Z=(s,r,o="after")=>{if(s.preventDefault(),s.stopPropagation(),!P||P.id===r.id)return;const t=JSON.parse(JSON.stringify(a)),I=(l,g)=>{for(let i=0;i<l.length;i++){if(l[i].id===g)return l.splice(i,1)[0];if(l[i].children&&l[i].children.length>0){const j=I(l[i].children,g);if(j)return j}}return null},se=(l,g,i,j)=>{for(let d=0;d<l.length;d++){if(l[d].id===g){if(j==="inside")l[d].children=l[d].children||[],i.parentId=g,l[d].children.push(i),l[d].isExpanded=!0;else{i.parentId=l[d].parentId;const Me=j==="before"?d:d+1;l.splice(Me,0,i)}return!0}if(l[d].children&&l[d].children.length>0&&se(l[d].children,g,i,j))return!0}return!1},ae=I(t,P.id);if(!ae)return;se(t,r.id,ae,o);const te=(l,g=0)=>{l.forEach((i,j)=>{i.order=g+j,i.children&&i.children.length>0&&te(i.children,0)})};te(t),n(t),X(null),R(null)},Fe=s=>{n(a.map(r=>r.id===s?{...r,isExpanded:!r.isExpanded}:r))},Ae=s=>{switch(s){case"page":return e.jsx(le,{className:"w-4 h-4"});case"post":return e.jsx(le,{className:"w-4 h-4"});case"category":return e.jsx(Be,{className:"w-4 h-4"});case"custom":return e.jsx(ne,{className:"w-4 h-4"});default:return e.jsx(ne,{className:"w-4 h-4"})}},ee=(s,r=0)=>{const o=s.children&&s.children.length>0;return e.jsxs("div",{className:r>0?"ml-8":"",children:[e.jsxs("div",{className:`
            relative flex items-center gap-2 p-3 bg-white border rounded-lg mb-2 transition-all
            ${je===s.id?"border-blue-500 bg-blue-50":"border-gray-200"}
            ${P?.id===s.id?"opacity-50":""}
            hover:shadow-sm
          `,draggable:!0,onDragStart:t=>Se(t,s),onDragOver:t=>{t.preventDefault(),ke(t,s.id)},onDragLeave:Ee,onDrop:t=>Z(t,s,"after"),children:[e.jsx(Ve,{className:"w-5 h-5 text-gray-400 cursor-move flex-shrink-0"}),o&&e.jsx("button",{onClick:()=>Fe(s.id),className:"p-1 hover:bg-gray-100 rounded",children:s.isExpanded?e.jsx(Qe,{className:"w-4 h-4"}):e.jsx(_e,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 flex items-center gap-2 min-w-0",children:[Ae(s.type),e.jsx("span",{className:"font-medium truncate",children:s.label}),e.jsx(J,{variant:"outline",className:"text-xs flex-shrink-0",children:s.type}),s.url&&e.jsxs("span",{className:"text-sm text-gray-500 truncate hidden sm:block",children:["(",s.url,")"]}),s.target==="_blank"&&e.jsx(ze,{className:"w-3 h-3 text-gray-400 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>De(s),className:"h-8 w-8 p-0",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>Ie(s.id),className:"h-8 w-8 p-0 hover:bg-red-50",children:e.jsx(pe,{className:"w-4 h-4 text-red-500"})})]}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-8 flex items-end justify-center opacity-0 hover:opacity-100",onDragOver:t=>{t.preventDefault(),t.stopPropagation()},onDrop:t=>{t.preventDefault(),t.stopPropagation(),Z(t,s,"inside")},children:e.jsx("div",{className:"w-full mx-8 h-1 bg-purple-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs bg-purple-500 text-white px-2 py-1 rounded",children:"Drop here to nest"})})})]}),o&&s.isExpanded&&e.jsx("div",{className:"ml-4 pl-4 border-l-2 border-gray-200",children:s.children.map(t=>ee(t,r+1))})]},s.id)};return y&&ve?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>b("/themes/menus"),children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"메뉴 목록"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:y?"메뉴 수정":"새 메뉴 만들기"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsxs(L,{children:[e.jsx(_,{children:e.jsx(z,{children:"메뉴 설정"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"name",children:"메뉴 이름"}),e.jsx(A,{id:"name",value:w,onChange:s=>q(s.target.value),placeholder:"예: 주 메뉴",className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"location",children:"메뉴 위치"}),e.jsxs(ce,{value:E,onValueChange:s=>$(s),children:[e.jsx(de,{className:"mt-2",children:e.jsx(oe,{})}),e.jsxs(he,{children:[e.jsx(S,{value:"primary",children:"주 메뉴"}),e.jsx(S,{value:"footer",children:"푸터"}),e.jsx(S,{value:"sidebar",children:"사이드바"}),e.jsx(S,{value:"mobile",children:"모바일"})]})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"description",children:"설명 (선택)"}),e.jsx(A,{id:"description",value:K,onChange:s=>O(s.target.value),placeholder:"메뉴 설명",className:"mt-2"})]}),e.jsx("div",{className:"pt-4",children:e.jsxs(u,{onClick:be,className:"w-full",disabled:!w||W.isPending||Y.isPending,children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),y?"메뉴 수정":"메뉴 생성"]})})]})]}),e.jsxs(L,{className:"mt-6",children:[e.jsx(_,{children:e.jsx(z,{children:"항목 추가"})}),e.jsx(T,{children:e.jsxs(Ge,{defaultValue:"pages",children:[e.jsxs(Xe,{className:"grid w-full grid-cols-4",children:[e.jsx(V,{value:"pages",children:"페이지"}),e.jsx(V,{value:"posts",children:"포스트"}),e.jsx(V,{value:"categories",children:"카테고리"}),e.jsx(V,{value:"custom",children:"사용자 정의"})]}),e.jsx(Q,{value:"pages",className:"space-y-2",children:fe.map(s=>e.jsxs("div",{className:"p-2 border rounded hover:bg-gray-50 cursor-pointer",onClick:()=>{const r={id:`item-${Date.now()}`,label:s.title,type:"page",pageId:s.id,url:`/${s.slug}`,order:a.length,createdAt:new Date,updatedAt:new Date};n([...a,r])},children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsxs("div",{className:"text-sm text-gray-500",children:["/",s.slug]})]},s.id))}),e.jsx(Q,{value:"posts",className:"space-y-2",children:ye.map(s=>e.jsxs("div",{className:"p-2 border rounded hover:bg-gray-50 cursor-pointer",onClick:()=>{const r={id:`item-${Date.now()}`,label:s.title,type:"post",postId:s.id,url:`/post/${s.slug}`,order:a.length,createdAt:new Date,updatedAt:new Date};n([...a,r])},children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsxs("div",{className:"text-sm text-gray-500",children:["/post/",s.slug]})]},s.id))}),e.jsx(Q,{value:"categories",className:"space-y-2",children:Ne.map(s=>e.jsxs("div",{className:"p-2 border rounded hover:bg-gray-50 cursor-pointer",onClick:()=>{const r={id:`item-${Date.now()}`,label:s.name,type:"category",categoryId:s.id,url:`/category/${s.slug}`,order:a.length,createdAt:new Date,updatedAt:new Date};n([...a,r])},children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["/category/",s.slug]})]},s.id))}),e.jsx(Q,{value:"custom",className:"pt-4",children:e.jsxs(u,{onClick:we,className:"w-full",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"사용자 정의 링크 추가"]})})]})})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(L,{children:[e.jsxs(_,{children:[e.jsx(z,{children:"메뉴 구조"}),e.jsx("p",{className:"text-sm text-gray-500",children:"드래그 앤 드롭으로 메뉴 항목의 순서를 변경할 수 있습니다"})]}),e.jsx(T,{children:a.length>0?e.jsx("div",{children:a.map(s=>ee(s))}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{children:"메뉴 항목이 없습니다"}),e.jsx("p",{className:"text-sm mt-2",children:"왼쪽에서 항목을 추가하세요"})]})})]})})]}),e.jsx(We,{open:c,onOpenChange:F,children:e.jsxs(Ye,{children:[e.jsxs(Ze,{children:[e.jsx(es,{children:p?"메뉴 항목 수정":"사용자 정의 링크"}),e.jsx(ss,{children:"메뉴에 표시될 링크 정보를 입력하세요"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"itemLabel",children:"레이블"}),e.jsx(A,{id:"itemLabel",value:m.label,onChange:s=>D({...m,label:s.target.value}),placeholder:"메뉴에 표시될 텍스트"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"itemUrl",children:"URL"}),e.jsx(A,{id:"itemUrl",value:m.url,onChange:s=>D({...m,url:s.target.value}),placeholder:"https://example.com 또는 /page-slug"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"itemTarget",children:"링크 열기"}),e.jsxs(ce,{value:m.target,onValueChange:s=>D({...m,target:s}),children:[e.jsx(de,{children:e.jsx(oe,{})}),e.jsxs(he,{children:[e.jsx(S,{value:"_self",children:"같은 창"}),e.jsx(S,{value:"_blank",children:"새 창"})]})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"itemCssClass",children:"CSS 클래스 (선택)"}),e.jsx(A,{id:"itemCssClass",value:m.cssClass||"",onChange:s=>D({...m,cssClass:s.target.value}),placeholder:"custom-class"})]})]}),e.jsxs(as,{children:[e.jsx(u,{variant:"outline",onClick:()=>F(!1),children:"취소"}),e.jsx(u,{onClick:Ce,children:"저장"})]})]})})]})},Ns=()=>e.jsxs(Re,{children:[e.jsx(U,{path:"/",element:e.jsx(ls,{})}),e.jsx(U,{path:"/new",element:e.jsx(ue,{})}),e.jsx(U,{path:"/:id/edit",element:e.jsx(ue,{})})]});export{Ns as default};
