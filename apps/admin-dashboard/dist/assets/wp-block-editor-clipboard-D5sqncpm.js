import{a as e,p as t,e as o}from"./wp-blocks-core-65VcejHr.js";import{j as n,d as s}from"./wp-misc-DyLrwF9p.js";import{s as r,a,b as c}from"./wp-i18n-BuBz6Sgx.js";import{u as l,a as i}from"./wp-block-editor-misc-Bvzg-2Jv.js";import{s as d}from"./wp-block-editor-store-BOagVFfu.js";import{k as p,l as u,m as b,n as f,o as k,p as m,q as g,r as v,t as y,v as w,w as h,x as B}from"./wp-block-editor-utils-BmaAXcuk.js";import{u as C}from"./wp-block-editor-api-MRWBPx9C.js";import{r as j,j as I}from"./vendor-react-DqgGMt48.js";import{s as D,g as E,u as S}from"./wp-block-editor-core-BF86nm2P.js";import{u as U}from"./wp-core-BVMytgUH.js";function _(){const{getBlockName:t}=l(d),{getBlockType:o}=l(e),{createSuccessNotice:s}=i(n);return j.useCallback((e,n)=>{let l="";if(1===n.length){const s=n[0],c=o(t(s))?.title;l=r(a("copy"===e?'Copied "%s" to clipboard.':'Moved "%s" to clipboard.'),c)}else l=r("copy"===e?c("Copied %d block to clipboard.","Copied %d blocks to clipboard.",n.length):c("Moved %d block to clipboard.","Moved %d blocks to clipboard.",n.length),n.length);s(l,{type:"snackbar"})},[])}const L={align:h,borderColor:e=>w(e,"color"),backgroundColor:y,textAlign:v,textColor:g,gradient:m,className:k,fontFamily:f,fontSize:b,layout:u,style:p};function x(e,t){return Object.entries(L).reduce((o,[n,s])=>(s(e.name)&&s(t.name)&&(o[n]=e.attributes[n]),o),{})}function T(e,t,o){for(let n=0;n<Math.min(t.length,e.length);n+=1)o(e[n].clientId,x(t[n],e[n])),T(e[n].innerBlocks,t[n].innerBlocks,o)}function M(){const e=C(),{updateBlockAttributes:s}=i(d),{createSuccessNotice:c,createWarningNotice:l,createErrorNotice:p}=i(n);return j.useCallback(async n=>{let i="";try{if(!window.navigator.clipboard)return void p(a("Unable to paste styles. This feature is only available on secure (https) sites in supporting browsers."),{type:"snackbar"});i=await window.navigator.clipboard.readText()}catch(u){return void p(a("Unable to paste styles. Please allow browser clipboard permissions before continuing."),{type:"snackbar"})}if(!i||!function(e){try{const o=t(e,{__unstableSkipMigrationLogs:!0,__unstableSkipAutop:!0});return 1!==o.length||"core/freeform"!==o[0].name}catch(o){return!1}}(i))return void l(a("Unable to paste styles. Block styles couldn't be found within the copied content."),{type:"snackbar"});const d=t(i);if(1===d.length?e.batch(()=>{T(n,n.map(()=>d[0]),s)}):e.batch(()=>{T(n,d,s)}),1===n.length){const e=o(n[0].name)?.title;c(r(a("Pasted styles to %s."),e),{type:"snackbar"})}else c(r(a("Pasted styles to %d blocks."),n.length),{type:"snackbar"})},[e.batch,s,c,l,p])}function N({selectBlock:e}){const t=C(),{getBlockOrder:o,getBlockRootClientId:n,getBlocksByClientId:s,getPreviousBlockClientId:r,getSelectedBlockClientIds:a,getSettings:c,canInsertBlockType:p,canRemoveBlocks:u}=l(d),{flashBlock:b,removeBlocks:f,replaceBlocks:k,insertBlocks:m}=i(d),g=_();return U(l=>{function i(t,o){o&&e(void 0,t,null,null),B(t,l)}function d(e){if(e.defaultPrevented)return;if(!l.contains(e.target.ownerDocument.activeElement))return;const d=e.target.ownerDocument.activeElement?.closest("[role=row]"),v=d?.dataset?.block;if(!v)return;const{blocksToUpdate:y,firstBlockClientId:w,firstBlockRootClientId:h,originallySelectedBlockClientIds:B}=function(e){const t=a(),o=t.includes(e),s=o?t[0]:e;return{blocksToUpdate:o?t:[e],firstBlockClientId:s,firstBlockRootClientId:n(s),originallySelectedBlockClientIds:t}}(v);if(0!==y.length){if(e.preventDefault(),"copy"===e.type||"cut"===e.type){1===y.length&&b(y[0]),g(e.type,y);const o=s(y);D(e,o,t)}if("cut"===e.type){var C;if(!u(y))return;let e=null!==(C=r(w))&&void 0!==C?C:h;f(y,!1);const t=B.length>0&&0===a().length;e||(e=o()[0]),i(e,t)}else if("paste"===e.type){const{__experimentalCanUserUseUnfilteredHTML:t}=c(),o=E(e);if(1===y.length){const[e]=y;if(o.every(t=>p(t.name,e)))return m(o,void 0,e),void i(o[0]?.clientId,!1)}k(y,o,o.length-1,-1),i(o[0]?.clientId,!1)}}}return l.ownerDocument.addEventListener("copy",d),l.ownerDocument.addEventListener("cut",d),l.ownerDocument.addEventListener("paste",d),()=>{l.ownerDocument.removeEventListener("copy",d),l.ownerDocument.removeEventListener("cut",d),l.ownerDocument.removeEventListener("paste",d)}},[])}const P=()=>(s("__unstableUseClipboardHandler",{alternative:"BlockCanvas or WritingFlow",since:"6.4",version:"6.7"}),S());function R(e){return s("CopyHandler",{alternative:"BlockCanvas or WritingFlow",since:"6.4",version:"6.7"}),I.jsx("div",{...e,ref:S()})}export{R as C,P as _,N as a,M as b,_ as u};
