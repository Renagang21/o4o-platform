import{a1 as U,r as c,j as s,U as M,X as $,V as h,c1 as L,c2 as p}from"./vendor-react-BZRIq8oW.js";import{M as j}from"./MediaLibrary-DZB0rlF7.js";import{B as x,j as R}from"./page-gutenberg-iVBL5IS_.js";import"./wp-block-editor-C14Ds6es.js";import"./wp-blocks-CnCGET8b.js";import"./wp-core-BctBwZpo.js";import"./wp-i18n-Niz9RVma.js";import"./wp-element-CB9_H0_F.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-monaco-cpVGocfO.js";import"./checkbox-C85_75t0.js";import"./vendor-query-GrNIwsDq.js";import"./vendor-utils-DQ8F5vJI.js";import"./wp-components-CLkQS2qf.js";const I=()=>{const v=U(),[l,o]=c.useState([]),[f,g]=c.useState(!1),[b,d]=c.useState(!1),N=c.useCallback(e=>{e.preventDefault(),e.stopPropagation(),d(!1);const t=e.dataTransfer.files;t&&t.length>0&&u(t)},[]),y=c.useCallback(e=>{e.preventDefault(),e.stopPropagation(),d(!0)},[]),w=c.useCallback(e=>{e.preventDefault(),e.stopPropagation(),d(!1)},[]),u=e=>{const t=Array.from(e).map(r=>({file:r,id:`${Date.now()}-${Math.random()}`,status:"pending",progress:0,preview:r.type.startsWith("image/")?URL.createObjectURL(r):void 0}));o(r=>[...r,...t])},D=e=>{o(t=>{const r=t.filter(n=>n.id!==e),i=t.find(n=>n.id===e);return i?.preview&&URL.revokeObjectURL(i.preview),r})},C=async e=>{try{o(n=>n.map(a=>a.id===e.id?{...a,status:"uploading",progress:10}:a));const t=new FormData;t.append("file",e.file),t.append("title",e.file.name.replace(/\.[^/.]+$/,""));const r=setInterval(()=>{o(n=>n.map(a=>a.id===e.id&&a.status==="uploading"?{...a,progress:Math.min(a.progress+10,90)}:a))},200),i=await R.api.post("/media/upload",t,{headers:{"Content-Type":"multipart/form-data"}});return clearInterval(r),o(n=>n.map(a=>a.id===e.id?{...a,status:"success",progress:100}:a)),i.data}catch(t){throw o(r=>r.map(i=>i.id===e.id?{...i,status:"error",error:"업로드 실패"}:i)),t}},k=async()=>{g(!0);const e=l.filter(i=>i.status==="pending");let t=0,r=0;for(const i of e)try{await C(i),t++}catch{r++}g(!1),t>0&&(h.success(`${t}개 파일이 업로드되었습니다`),r===0&&setTimeout(()=>{v("/media/library")},1500)),r>0&&h.error(`${r}개 파일 업로드에 실패했습니다`)},m=()=>{const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept="image/*,video/*,audio/*,application/pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",e.onchange=t=>{const r=t.target.files;r&&u(r)},e.click()};return s.jsx("div",{className:"wp-admin-content",children:s.jsxs("div",{className:"wrap",children:[s.jsx("h1",{className:"wp-heading-inline",children:"새 미디어 추가"}),s.jsx("div",{className:"mt-6",children:l.length===0?s.jsxs("div",{className:`border-4 border-dashed rounded-lg p-12 text-center transition-colors ${b?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDrop:N,onDragOver:y,onDragLeave:w,onClick:m,style:{cursor:"pointer"},children:[s.jsx(M,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),s.jsx("h3",{className:"text-xl font-medium text-gray-700 mb-2",children:"파일을 여기에 드래그하거나 클릭하여 선택하세요"}),s.jsx("p",{className:"text-sm text-gray-500",children:"최대 업로드 파일 크기: 100MB"}),s.jsx(x,{variant:"outline",className:"mt-4",onClick:e=>{e.stopPropagation(),m()},children:"파일 선택"})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("h3",{className:"text-lg font-medium",children:[l.length,"개 파일 선택됨"]}),s.jsxs("div",{className:"space-x-2",children:[s.jsx(x,{variant:"outline",onClick:m,children:"파일 추가"}),s.jsx(x,{onClick:k,disabled:f||l.every(e=>e.status!=="pending"),children:"업로드 시작"})]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(e=>s.jsxs("div",{className:`border rounded-lg p-4 ${e.status==="error"?"border-red-300 bg-red-50":"border-gray-200"}`,children:[s.jsxs("div",{className:"flex items-start justify-between mb-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-sm truncate",children:e.file.name}),s.jsxs("p",{className:"text-xs text-gray-500",children:[(e.file.size/1024/1024).toFixed(2)," MB"]})]}),e.status==="pending"&&s.jsx("button",{onClick:()=>D(e.id),className:"ml-2 text-gray-400 hover:text-gray-600",children:s.jsx($,{className:"w-4 h-4"})})]}),e.preview&&s.jsx("img",{src:e.preview,alt:"",className:"w-full h-32 object-cover rounded mb-2"}),e.status==="uploading"&&s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${e.progress}%`}})}),e.status==="success"&&s.jsx("div",{className:"text-green-600 text-sm",children:"✓ 업로드 완료"}),e.status==="error"&&s.jsx("div",{className:"text-red-600 text-sm",children:e.error||"업로드 실패"})]},e.id))})]})})]})})},J=()=>s.jsxs(L,{children:[s.jsx(p,{path:"/",element:s.jsx(j,{})}),s.jsx(p,{path:"/library",element:s.jsx(j,{})}),s.jsx(p,{path:"/new",element:s.jsx(I,{})})]});export{J as default};
