import{r as e,j as s,co as t,bO as r,cK as a,E as i,ci as l,bV as n,c8 as o,V as c}from"./vendor-react-BQ6HOJoh.js";import{u as d,a as m,b as x}from"./vendor-query-LYSOqK5P.js";import{B as p,L as h,I as j,b as u}from"./page-template-editor-C7FodHrK.js";import{av as y,ak as b,al as v,am as w,an as N,az as g,aA as f,aB as k,aC as U,aD as K,aE as C}from"./wp-misc-DS9m4_P2.js";import"./wp-block-editor-a11y-DrduSWFW.js";import"./wp-block-editor-misc-pHCPYvR2.js";import"./wp-block-editor-api-Buev8_QU.js";import"./wp-block-editor-utils-M5qXzE1L.js";import"./wp-block-editor-colors-D38h-Odz.js";import"./wp-blocks-core-6vwQKPfS.js";import"./wp-block-editor-clipboard-Dg0Y1gQ6.js";import"./wp-block-editor-store-B-g1aSix.js";import"./vendor-ui-CrFdsnXa.js";import"./wp-block-editor-dnd-BYoS8-II.js";import"./wp-block-editor-library-BpQvynjE.js";import"./wp-block-editor-menus-BTQ2wZ-f.js";import"./wp-block-editor-keyboard-CeHTtvP5.js";import"./wp-block-editor-typography-Bl_1REQP.js";import"./wp-block-editor-spacing-BD_2CpN7.js";import"./wp-block-editor-core-DL280tSA.js";import"./wp-block-editor-selection-CC4tJpUu.js";import"./wp-block-editor-formats-CLXkimOp.js";import"./wp-block-editor-inline-CpXpUhQU.js";import"./wp-block-editor-ui-B8YE_4QL.js";import"./wp-block-editor-transforms-jLcKa8Hv.js";import"./wp-block-editor-preview-iw2Xu1ib.js";import"./wp-block-editor-global-styles-CV5-K6QF.js";import"./wp-block-editor-borders-BH1devca.js";import"./wp-block-editor-patterns-BXdHo9lm.js";import"./wp-block-editor-navigation-BFSoKzg0.js";import"./wp-block-editor-media-Bg-JiQDT.js";import"./wp-api-BeoadipR.js";import"./wp-i18n-DGPtqsXY.js";import"./wp-core-Y-jV-nrZ.js";import"./vendor-monaco-BxJH8uUv.js";import"./wp-block-editor-upload-BLw1R9wP.js";import"./vendor-utils-D-spY-QM.js";import"./wp-block-editor-templates-o1_wAMb9.js";import"./wp-data-BmtL8k4r.js";import"./wp-components-CeQNCpMW.js";const L=()=>{const L=d(),[S,q]=e.useState(!1),[F,E]=e.useState("connection"),[A,P]=e.useState(!1),[R,_]=e.useState(!1),[I,M]=e.useState({clientKey:"",secretKey:"",webhookSecretKey:"",isLive:!1,isEnabled:!1,webhookUrl:"",returnUrl:"",failUrl:"",supportedMethods:[{type:"card",name:"신용카드",enabled:!0},{type:"transfer",name:"계좌이체",enabled:!0},{type:"virtualAccount",name:"가상계좌",enabled:!1},{type:"mobilePhone",name:"휴대폰 결제",enabled:!1},{type:"giftCertificate",name:"상품권",enabled:!1},{type:"foreignEasyPay",name:"해외간편결제",enabled:!1}]}),{data:D}=m({queryKey:["toss-payments-config"],queryFn:async()=>(await u.api.get("/v1/payments/toss/config")).data}),B=D?.data,{data:z}=m({queryKey:["toss-payments-tests"],queryFn:async()=>(await u.api.get("/v1/payments/toss/tests")).data}),O=z?.data||[],{data:Q}=m({queryKey:["toss-payments-stats"],queryFn:async()=>(await u.api.get("/v1/payments/toss/stats")).data}),T=Q?.data||{},V=x({mutationFn:async e=>(await u.api.put("/v1/payments/toss/config",e)).data,onSuccess:()=>{c.success("토스페이먼츠 설정이 저장되었습니다"),L.invalidateQueries({queryKey:["toss-payments-config"]})}}),$=x({mutationFn:async e=>(await u.api.post("/v1/payments/toss/test",{testType:e})).data,onSuccess:e=>{e.success?c.success(`${G(F)} 테스트가 성공했습니다`):c.error(`${G(F)} 테스트가 실패했습니다`),L.invalidateQueries({queryKey:["toss-payments-tests"]}),q(!1)}});e.useEffect(()=>{B&&M({...B,supportedMethods:B.supportedMethods||[]})},[B]);const G=e=>{switch(e){case"connection":return"API 연결";case"payment":return"결제";case"webhook":return"웹훅";default:return e}},H=e=>{switch(e){case"success":return s.jsx(y,{className:"bg-green-100 text-green-800 border-green-200",children:"성공"});case"failed":return s.jsx(y,{variant:"destructive",children:"실패"});case"pending":return s.jsx(y,{variant:"outline",className:"text-yellow-600 border-yellow-600",children:"진행중"});default:return s.jsx(y,{variant:"outline",children:e})}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"토스페이먼츠 설정"}),s.jsx("p",{className:"text-modern-text-secondary mt-1",children:"결제 시스템 연동 및 관리"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(p,{variant:"outline",onClick:()=>q(!0),children:[s.jsx(t,{className:"w-4 h-4 mr-2"}),"연결 테스트"]}),B&&s.jsx(y,{variant:B.isEnabled?"default":"secondary",children:B.isEnabled?"활성화":"비활성화"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs(b,{children:[s.jsx(v,{className:"pb-2",children:s.jsx(w,{className:"text-sm font-medium text-modern-text-secondary",children:"총 결제 건수"})}),s.jsxs(N,{children:[s.jsx("div",{className:"text-2xl font-bold text-modern-text-primary",children:T.totalPayments||0}),s.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달 기준"})]})]}),s.jsxs(b,{children:[s.jsx(v,{className:"pb-2",children:s.jsx(w,{className:"text-sm font-medium text-modern-text-secondary",children:"결제 성공률"})}),s.jsxs(N,{children:[s.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[T.successRate||0,"%"]}),s.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"최근 30일"})]})]}),s.jsxs(b,{children:[s.jsx(v,{className:"pb-2",children:s.jsx(w,{className:"text-sm font-medium text-modern-text-secondary",children:"총 결제 금액"})}),s.jsxs(N,{children:[s.jsxs("div",{className:"text-2xl font-bold text-modern-text-primary",children:["₩",(T.totalAmount||0).toLocaleString()]}),s.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]}),s.jsxs(b,{children:[s.jsx(v,{className:"pb-2",children:s.jsx(w,{className:"text-sm font-medium text-modern-text-secondary",children:"환불 건수"})}),s.jsxs(N,{children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:T.refundCount||0}),s.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(b,{children:[s.jsx(v,{children:s.jsxs(w,{className:"flex items-center gap-2",children:[s.jsx(r,{className:"w-5 h-5"}),"API 설정"]})}),s.jsx(N,{children:s.jsxs("form",{onSubmit:e=>{e.preventDefault(),I.clientKey&&I.secretKey?I.webhookUrl&&I.returnUrl&&I.failUrl?V.mutate(I):c.error("웹훅 URL, 성공 URL, 실패 URL은 필수입니다"):c.error("클라이언트 키와 시크릿 키는 필수입니다")},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(h,{className:"text-sm font-medium",children:"환경 설정"}),s.jsxs("div",{className:"flex gap-4 mt-2",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",checked:!I.isLive,onChange:()=>M(e=>({...e,isLive:!1})),className:"mr-2"}),s.jsx("span",{className:"text-sm",children:"테스트 (Sandbox)"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",checked:I.isLive,onChange:()=>M(e=>({...e,isLive:!0})),className:"mr-2"}),s.jsx("span",{className:"text-sm",children:"운영 (Live)"})]})]})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"clientKey",children:"클라이언트 키 *"}),s.jsx(j,{id:"clientKey",value:I.clientKey,onChange:e=>M(s=>({...s,clientKey:e.target.value})),placeholder:"test_ck_... 또는 live_ck_...",required:!0})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"secretKey",children:"시크릿 키 *"}),s.jsxs("div",{className:"relative",children:[s.jsx(j,{id:"secretKey",type:A?"text":"password",value:I.secretKey,onChange:e=>M(s=>({...s,secretKey:e.target.value})),placeholder:"test_sk_... 또는 live_sk_...",required:!0}),s.jsx("button",{type:"button",onClick:()=>P(!A),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:A?s.jsx(a,{className:"w-4 h-4"}):s.jsx(i,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"webhookSecretKey",children:"웹훅 시크릿 키"}),s.jsxs("div",{className:"relative",children:[s.jsx(j,{id:"webhookSecretKey",type:R?"text":"password",value:I.webhookSecretKey,onChange:e=>M(s=>({...s,webhookSecretKey:e.target.value})),placeholder:"웹훅 검증용 시크릿 키"}),s.jsx("button",{type:"button",onClick:()=>_(!R),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:R?s.jsx(a,{className:"w-4 h-4"}):s.jsx(i,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"webhookUrl",children:"웹훅 URL *"}),s.jsx(j,{id:"webhookUrl",value:I.webhookUrl,onChange:e=>M(s=>({...s,webhookUrl:e.target.value})),placeholder:"https://yourdomain.com/api/webhooks/toss",required:!0})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"returnUrl",children:"결제 성공 URL *"}),s.jsx(j,{id:"returnUrl",value:I.returnUrl,onChange:e=>M(s=>({...s,returnUrl:e.target.value})),placeholder:"https://yourdomain.com/payment/success",required:!0})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"failUrl",children:"결제 실패 URL *"}),s.jsx(j,{id:"failUrl",value:I.failUrl,onChange:e=>M(s=>({...s,failUrl:e.target.value})),placeholder:"https://yourdomain.com/payment/fail",required:!0})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"isEnabled",checked:I.isEnabled,onChange:e=>M(s=>({...s,isEnabled:e.target.checked})),className:"mr-2"}),s.jsx(h,{htmlFor:"isEnabled",children:"토스페이먼츠 활성화"})]}),s.jsx(p,{type:"submit",disabled:V.isPending,className:"w-full",children:"설정 저장"})]})})]}),s.jsxs(b,{children:[s.jsx(v,{children:s.jsxs(w,{className:"flex items-center gap-2",children:[s.jsx(l,{className:"w-5 h-5"}),"결제 수단 설정"]})}),s.jsx(N,{children:s.jsx("div",{className:"space-y-3",children:I.supportedMethods?.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:e.enabled,onChange:()=>{return s=e.type,void M(e=>({...e,supportedMethods:e.supportedMethods?.map(e=>e.type===s?{...e,enabled:!e.enabled}:e)}));var s},className:"mr-3"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.name}),s.jsx("div",{className:"text-sm text-modern-text-secondary",children:e.type})]})]}),s.jsx(y,{variant:e.enabled?"default":"secondary",children:e.enabled?"활성":"비활성"})]},e.type))})})]})]}),s.jsxs(b,{children:[s.jsx(v,{children:s.jsx(w,{children:"최근 테스트 결과"})}),s.jsx(N,{children:0===O.length?s.jsx("div",{className:"text-center py-8 text-modern-text-secondary",children:"아직 테스트를 실행하지 않았습니다."}):s.jsx("div",{className:"space-y-3",children:O.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:["success"===e.status?s.jsx(n,{className:"w-5 h-5 text-green-600"}):"failed"===e.status?s.jsx(o,{className:"w-5 h-5 text-red-600"}):s.jsx("div",{className:"w-5 h-5 border-2 border-yellow-600 border-t-transparent rounded-full animate-spin"}),s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium",children:[G(e.testType)," 테스트"]}),s.jsx("div",{className:"text-sm text-modern-text-secondary",children:new Date(e.executedAt).toLocaleString("ko-KR")}),e.error&&s.jsx("div",{className:"text-sm text-red-600 mt-1",children:e.error})]})]}),H(e.status)]},e.id))})})]}),s.jsx(g,{open:S,onOpenChange:q,children:s.jsxs(f,{children:[s.jsxs(k,{children:[s.jsx(U,{children:"연결 테스트"}),s.jsx(K,{children:"토스페이먼츠 API 연결 상태를 테스트합니다."})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{children:[s.jsx(h,{children:"테스트 유형"}),s.jsxs("select",{value:F,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-modern-border-primary rounded-lg mt-1",children:[s.jsx("option",{value:"connection",children:"API 연결 테스트"}),s.jsx("option",{value:"payment",children:"결제 테스트 (100원)"}),s.jsx("option",{value:"webhook",children:"웹훅 테스트"})]})]}),s.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:s.jsxs("div",{className:"text-sm text-blue-800",children:["connection"===F&&"토스페이먼츠 API 서버와의 연결 상태를 확인합니다.","payment"===F&&"실제 100원 결제를 통해 결제 프로세스를 테스트합니다. (테스트 환경에서만)","webhook"===F&&"웹훅 URL의 응답성과 시크릿 키 검증을 테스트합니다."]})})]}),s.jsxs(C,{children:[s.jsx(p,{variant:"outline",onClick:()=>q(!1),children:"취소"}),s.jsx(p,{onClick:()=>{$.mutate(F)},disabled:$.isPending,children:"테스트 실행"})]})]})})]})};export{L as default};
