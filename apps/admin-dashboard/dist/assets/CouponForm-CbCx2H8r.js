import{a3 as U,a4 as T,r as u,V as r,j as e,X as A,cH as D,bw as E,c2 as C,a1 as L}from"./vendor-react-k21L8gyu.js";import{B as j,C as m,k as p,l as x,m as h}from"./page-gutenberg-DfBK4wFH.js";import{a as g}from"./api-Bnu8ldYb.js";import"./wp-block-editor-DM9yXXIa.js";import"./wp-i18n-DQMG9Moe.js";import"./wp-core-CTkjrE6Y.js";import"./wp-blocks-core-m9M-jdYH.js";import"./wp-misc-eJXghOJf.js";import"./wp-data-CiqFlSQ4.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-monaco-cpVGocfO.js";import"./vendor-query-D5rBm9N_.js";import"./vendor-utils-DQ8F5vJI.js";import"./wp-components-C7vO1IIk.js";const G=()=>{const f=U(),{id:t}=T(),o=!!t,[s,c]=u.useState({code:"",description:"",discountType:"percent",discountValue:0,usageLimitPerCoupon:0,usageLimitPerCustomer:1,freeShipping:!1,excludeSaleItems:!1,individualUseOnly:!0}),[w,b]=u.useState(!1),[v,y]=u.useState(!1);u.useEffect(()=>{o&&k()},[t]);const k=async()=>{try{b(!0);const n=(await g.get(`/v1/coupons/${t}`)).data.data;c({...n,validFrom:n.validFrom?n.validFrom.split("T")[0]:"",validUntil:n.validUntil?n.validUntil.split("T")[0]:""})}catch(l){console.error("Error fetching coupon:",l),r.error("Failed to load coupon")}finally{b(!1)}},S=async l=>{if(l.preventDefault(),!s.code){r.error("쿠폰 코드를 입력해주세요");return}if(s.discountValue<=0){r.error("할인 값을 입력해주세요");return}if(s.discountType==="percent"&&s.discountValue>100){r.error("퍼센트 할인은 100%를 초과할 수 없습니다");return}try{y(!0);const n={...s,validFrom:s.validFrom||void 0,validUntil:s.validUntil||void 0,minOrderAmount:s.minOrderAmount||void 0,maxDiscountAmount:s.maxDiscountAmount||void 0};o?(await g.put(`/v1/coupons/${t}`,n),r.success("쿠폰이 수정되었습니다")):(await g.post("/v1/coupons",n),r.success("쿠폰이 생성되었습니다")),f("/ecommerce/coupons")}catch(n){console.error("Error saving coupon:",n);const d=n.response?.data?.message||"Failed to save coupon";r.error(d)}finally{y(!1)}},a=l=>{const{name:n,value:d,type:N}=l.target;if(N==="checkbox"){const i=l.target.checked;c(F=>({...F,[n]:i}))}else c(N==="number"?i=>({...i,[n]:parseFloat(d)||0}):i=>({...i,[n]:d}))};return w?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:o?"쿠폰 수정":"새 쿠폰 만들기"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"할인 쿠폰을 생성하고 설정하세요"})]}),e.jsxs(j,{variant:"outline",onClick:()=>f("/ecommerce/coupons"),children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"취소"]})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(x,{children:"기본 정보"})}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"쿠폰 코드 *"}),e.jsx("input",{type:"text",name:"code",value:s.code,onChange:a,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"예: WELCOME10",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"할인 타입 *"}),e.jsxs("select",{name:"discountType",value:s.discountType,onChange:a,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"percent",children:"퍼센트 할인"}),e.jsx("option",{value:"fixed_cart",children:"정액 할인 (장바구니)"}),e.jsx("option",{value:"fixed_product",children:"정액 할인 (상품별)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"할인 값 *"}),e.jsxs("div",{className:"relative",children:[s.discountType==="percent"?e.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}):e.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"number",name:"discountValue",value:s.discountValue,onChange:a,className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",step:"0.01",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"설명"}),e.jsx("input",{type:"text",name:"description",value:s.description,onChange:a,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"쿠폰 설명"})]})]})})]}),e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(x,{children:"사용 제한"})}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"최소 주문 금액"}),e.jsx("input",{type:"number",name:"minOrderAmount",value:s.minOrderAmount||"",onChange:a,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",step:"1000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"최대 할인 금액"}),e.jsx("input",{type:"number",name:"maxDiscountAmount",value:s.maxDiscountAmount||"",onChange:a,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",step:"1000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"총 사용 제한"}),e.jsx("input",{type:"number",name:"usageLimitPerCoupon",value:s.usageLimitPerCoupon,onChange:a,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0 (무제한)",min:"0"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"0은 무제한"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"고객당 사용 제한"}),e.jsx("input",{type:"number",name:"usageLimitPerCustomer",value:s.usageLimitPerCustomer,onChange:a,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1",min:"1"})]})]})})]}),e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(x,{children:"유효 기간"})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"시작일"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"date",name:"validFrom",value:s.validFrom||"",onChange:a,className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"종료일"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"date",name:"validUntil",value:s.validUntil||"",onChange:a,className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})})]}),e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(x,{children:"추가 옵션"})}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"freeShipping",checked:s.freeShipping,onChange:a,className:"mr-3 rounded"}),e.jsx("span",{className:"text-sm",children:"무료 배송 포함"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"excludeSaleItems",checked:s.excludeSaleItems,onChange:a,className:"mr-3 rounded"}),e.jsx("span",{className:"text-sm",children:"세일 상품 제외"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"individualUseOnly",checked:s.individualUseOnly,onChange:a,className:"mr-3 rounded"}),e.jsx("span",{className:"text-sm",children:"다른 쿠폰과 중복 사용 불가"})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>f("/ecommerce/coupons"),children:"취소"}),e.jsx(j,{type:"submit",disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"저장 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),o?"수정":"생성"]})})]})]})]})};export{G as default};
