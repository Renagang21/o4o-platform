import{r as e,j as s,bg as t,c_ as r,E as a,ci as d,c9 as i,cw as n,bV as o,c8 as l,V as c}from"./vendor-react-BQ6HOJoh.js";import{u as m,a as x,b as p}from"./vendor-query-LYSOqK5P.js";import{I as j,B as u,L as h,T as v,b as N}from"./page-template-editor-C7FodHrK.js";import{ak as y,al as f,am as g,an as b,az as w,aA as k,aB as A,aC as q,aD as S,aE as C,av as L}from"./wp-misc-DS9m4_P2.js";import"./wp-block-editor-a11y-DrduSWFW.js";import"./wp-block-editor-misc-pHCPYvR2.js";import"./wp-block-editor-api-Buev8_QU.js";import"./wp-block-editor-utils-M5qXzE1L.js";import"./wp-block-editor-colors-D38h-Odz.js";import"./wp-blocks-core-6vwQKPfS.js";import"./wp-block-editor-clipboard-Dg0Y1gQ6.js";import"./wp-block-editor-store-B-g1aSix.js";import"./vendor-ui-CrFdsnXa.js";import"./wp-block-editor-dnd-BYoS8-II.js";import"./wp-block-editor-library-BpQvynjE.js";import"./wp-block-editor-menus-BTQ2wZ-f.js";import"./wp-block-editor-keyboard-CeHTtvP5.js";import"./wp-block-editor-typography-Bl_1REQP.js";import"./wp-block-editor-spacing-BD_2CpN7.js";import"./wp-block-editor-core-DL280tSA.js";import"./wp-block-editor-selection-CC4tJpUu.js";import"./wp-block-editor-formats-CLXkimOp.js";import"./wp-block-editor-inline-CpXpUhQU.js";import"./wp-block-editor-ui-B8YE_4QL.js";import"./wp-block-editor-transforms-jLcKa8Hv.js";import"./wp-block-editor-preview-iw2Xu1ib.js";import"./wp-block-editor-global-styles-CV5-K6QF.js";import"./wp-block-editor-borders-BH1devca.js";import"./wp-block-editor-patterns-BXdHo9lm.js";import"./wp-block-editor-navigation-BFSoKzg0.js";import"./wp-block-editor-media-Bg-JiQDT.js";import"./wp-api-BeoadipR.js";import"./wp-i18n-DGPtqsXY.js";import"./wp-core-Y-jV-nrZ.js";import"./vendor-monaco-BxJH8uUv.js";import"./wp-block-editor-upload-BLw1R9wP.js";import"./vendor-utils-D-spY-QM.js";import"./wp-block-editor-templates-o1_wAMb9.js";import"./wp-data-BmtL8k4r.js";import"./wp-components-CeQNCpMW.js";const K=()=>{const K=m(),[F,D]=e.useState(""),[R,z]=e.useState("all"),[I,E]=e.useState(null),[P,Q]=e.useState(!1),[U,B]=e.useState(!1),[$,O]=e.useState({refundId:"",action:"approve",approvedAmount:0,adminNote:"",notifyCustomer:!0}),{data:V,isLoading:_}=x({queryKey:["refund-requests",F,R],queryFn:async()=>{const e=new URLSearchParams;F&&e.append("search",F),"all"!==R&&e.append("status",R);return(await N.api.get(`/v1/payments/refunds?${e.toString()}`)).data}}),G=V?.data||[],{data:H}=x({queryKey:["refund-stats"],queryFn:async()=>(await N.api.get("/v1/payments/refunds/stats")).data}),T=H?.data||{},J=p({mutationFn:async e=>(await N.api.post(`/v1/payments/refunds/${e.refundId}/process`,e)).data,onSuccess:()=>{c.success("환불 처리가 완료되었습니다"),K.invalidateQueries({queryKey:["refund-requests"]}),K.invalidateQueries({queryKey:["refund-stats"]}),Q(!1),O({refundId:"",action:"approve",approvedAmount:0,adminNote:"",notifyCustomer:!0})}}),M=p({mutationFn:async e=>(await N.api.post(`/v1/payments/refunds/${e}/retry`)).data,onSuccess:()=>{c.success("환불 재시도가 시작되었습니다"),K.invalidateQueries({queryKey:["refund-requests"]})}}),W=e=>{switch(e){case"requested":return s.jsx(L,{variant:"outline",className:"text-yellow-600 border-yellow-600",children:"요청됨"});case"processing":return s.jsx(L,{variant:"outline",className:"text-blue-600 border-blue-600",children:"처리중"});case"approved":return s.jsx(L,{variant:"outline",className:"text-purple-600 border-purple-600",children:"승인됨"});case"completed":return s.jsx(L,{children:"완료"});case"rejected":return s.jsx(L,{variant:"secondary",children:"거부됨"});case"failed":return s.jsx(L,{variant:"destructive",children:"실패"});default:return s.jsx(L,{variant:"outline",children:e})}},X=e=>{switch(e){case"requested":return s.jsx(n,{className:"w-4 h-4 text-yellow-600"});case"processing":return s.jsx(i,{className:"w-4 h-4 text-blue-600 animate-spin"});case"approved":return s.jsx(o,{className:"w-4 h-4 text-purple-600"});case"completed":return s.jsx(o,{className:"w-4 h-4 text-green-600"});case"rejected":return s.jsx(l,{className:"w-4 h-4 text-gray-600"});case"failed":return s.jsx(l,{className:"w-4 h-4 text-red-600"});default:return s.jsx(i,{className:"w-4 h-4"})}},Y=e=>"failed"===e;return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"환불 관리"}),s.jsx("p",{className:"text-modern-text-secondary mt-1",children:"토스페이먼츠 환불 요청 처리 및 관리"})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs(y,{children:[s.jsx(f,{className:"pb-2",children:s.jsx(g,{className:"text-sm font-medium text-modern-text-secondary",children:"대기 중"})}),s.jsxs(b,{children:[s.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:T.requested||0}),s.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"처리 대기"})]})]}),s.jsxs(y,{children:[s.jsx(f,{className:"pb-2",children:s.jsx(g,{className:"text-sm font-medium text-modern-text-secondary",children:"처리 중"})}),s.jsxs(b,{children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:T.processing||0}),s.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"토스 처리 중"})]})]}),s.jsxs(y,{children:[s.jsx(f,{className:"pb-2",children:s.jsx(g,{className:"text-sm font-medium text-modern-text-secondary",children:"완료"})}),s.jsxs(b,{children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:T.completed||0}),s.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]}),s.jsxs(y,{children:[s.jsx(f,{className:"pb-2",children:s.jsx(g,{className:"text-sm font-medium text-modern-text-secondary",children:"총 환불 금액"})}),s.jsxs(b,{children:[s.jsxs("div",{className:"text-2xl font-bold text-modern-text-primary",children:["₩",(T.totalAmount||0).toLocaleString()]}),s.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"relative",children:[s.jsx(t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-modern-text-tertiary w-5 h-5"}),s.jsx(j,{type:"text",placeholder:"주문번호, 고객명으로 검색...",value:F,onChange:e=>D(e.target.value),className:"pl-10"})]})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(r,{className:"w-5 h-5 text-modern-text-secondary"}),s.jsxs("select",{value:R,onChange:e=>z(e.target.value),className:"px-4 py-2 border border-modern-border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-modern-primary",children:[s.jsx("option",{value:"all",children:"모든 상태"}),s.jsx("option",{value:"requested",children:"요청됨"}),s.jsx("option",{value:"processing",children:"처리중"}),s.jsx("option",{value:"approved",children:"승인됨"}),s.jsx("option",{value:"completed",children:"완료"}),s.jsx("option",{value:"rejected",children:"거부됨"}),s.jsx("option",{value:"failed",children:"실패"})]})]})]}),s.jsx(y,{children:s.jsx(b,{className:"p-0",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-modern-bg-tertiary border-b border-modern-border-primary",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"주문 정보"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"고객"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"환불 금액"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상태"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"요청일"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"작업"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-modern-border-primary",children:_?s.jsx("tr",{children:s.jsx("td",{colSpan:6,className:"px-6 py-12 text-center",children:s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})})})}):0===G.length?s.jsx("tr",{children:s.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-modern-text-secondary",children:"환불 요청이 없습니다."})}):G.map(e=>{return s.jsxs("tr",{className:"hover:bg-modern-bg-hover",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:e.orderNumber}),s.jsxs("div",{className:"text-sm text-modern-text-secondary",children:[e.items.length,"개 상품"]}),s.jsx("div",{className:"text-xs text-modern-text-tertiary",children:e.reason})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:e.customerName}),s.jsx("div",{className:"text-sm text-modern-text-secondary",children:e.customerEmail})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{children:[s.jsxs("div",{className:"text-sm font-medium text-modern-text-primary",children:["₩",e.requestedAmount.toLocaleString()]}),e.approvedAmount&&e.approvedAmount!==e.requestedAmount&&s.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["승인: ₩",e.approvedAmount.toLocaleString()]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[X(e.status),W(e.status)]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"text-sm text-modern-text-secondary",children:new Date(e.requestedAt).toLocaleDateString("ko-KR")})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(u,{variant:"ghost",size:"sm",onClick:()=>(e=>{E(e),B(!0)})(e),children:s.jsx(a,{className:"w-4 h-4"})}),(t=e.status,["requested","processing"].includes(t)&&s.jsx(u,{variant:"ghost",size:"sm",onClick:()=>(e=>{E(e),O({refundId:e.id,action:"approve",approvedAmount:e.requestedAmount,adminNote:"",notifyCustomer:!0}),Q(!0)})(e),children:s.jsx(d,{className:"w-4 h-4"})})),Y(e.status)&&s.jsx(u,{variant:"ghost",size:"sm",onClick:()=>M.mutate(e.id),disabled:M.isPending,children:s.jsx(i,{className:"w-4 h-4"})})]})})]},e.id);var t})})]})})})}),s.jsx(w,{open:P,onOpenChange:Q,children:s.jsx(k,{className:"max-w-md",children:s.jsxs("form",{onSubmit:e=>{e.preventDefault(),"approve"!==$.action||$.approvedAmount&&!($.approvedAmount<=0)?$.adminNote.trim()?J.mutate($):c.error("처리 메모를 입력하세요"):c.error("승인 금액을 입력하세요")},children:[s.jsxs(A,{children:[s.jsx(q,{children:"환불 처리"}),s.jsxs(S,{children:[I?.orderNumber," - ",I?.customerName]})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsx("div",{children:s.jsxs(h,{children:["요청 금액: ₩",I?.requestedAmount?.toLocaleString()]})}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"action",children:"처리 결과 *"}),s.jsxs("select",{id:"action",value:$.action,onChange:e=>O(s=>({...s,action:e.target.value})),className:"w-full px-3 py-2 border border-modern-border-primary rounded-lg mt-1",required:!0,children:[s.jsx("option",{value:"approve",children:"승인"}),s.jsx("option",{value:"reject",children:"거부"})]})]}),"approve"===$.action&&s.jsxs("div",{children:[s.jsx(h,{htmlFor:"approvedAmount",children:"승인 금액 *"}),s.jsx(j,{id:"approvedAmount",type:"number",min:"0",max:I?.requestedAmount,value:$.approvedAmount,onChange:e=>O(s=>({...s,approvedAmount:parseFloat(e.target.value)||0})),required:!0}),s.jsxs("div",{className:"text-xs text-modern-text-tertiary mt-1",children:["최대 승인 가능: ₩",I?.requestedAmount?.toLocaleString()]})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"adminNote",children:"처리 메모 *"}),s.jsx(v,{id:"adminNote",value:$.adminNote,onChange:e=>O(s=>({...s,adminNote:e.target.value})),placeholder:"환불 처리 사유나 메모를 입력하세요...",rows:3,required:!0})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"notifyCustomer",checked:$.notifyCustomer,onChange:e=>O(s=>({...s,notifyCustomer:e.target.checked})),className:"mr-2"}),s.jsx(h,{htmlFor:"notifyCustomer",children:"고객에게 알림 발송"})]})]}),s.jsxs(C,{children:[s.jsx(u,{type:"button",variant:"outline",onClick:()=>Q(!1),children:"취소"}),s.jsx(u,{type:"submit",disabled:J.isPending,children:"approve"===$.action?"승인":"거부"})]})]})})}),s.jsx(w,{open:U,onOpenChange:B,children:s.jsxs(k,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[s.jsxs(A,{children:[s.jsx(q,{children:"환불 요청 상세"}),s.jsxs(S,{children:[I?.orderNumber," - ",I?.customerName]})]}),I&&s.jsxs("div",{className:"space-y-6 py-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium mb-3",children:"환불 상품"}),s.jsx("div",{className:"space-y-2",children:I.items.map(e=>s.jsxs("div",{className:"flex justify-between p-3 bg-modern-bg-secondary rounded-lg",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.productName}),s.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["SKU: ",e.sku," | 주문 수량: ",e.quantity," | 환불 수량: ",e.refundQuantity]}),s.jsxs("div",{className:"text-sm text-modern-text-tertiary",children:["환불 사유: ",e.reason]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("div",{className:"font-medium",children:["₩",e.refundAmount.toLocaleString()]}),s.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["단가: ₩",e.unitPrice.toLocaleString()]})]})]},e.id))})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium mb-3",children:"결제 정보"}),s.jsx("div",{className:"p-3 bg-modern-bg-secondary rounded-lg",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-modern-text-secondary",children:"토스 결제키"}),s.jsx("div",{className:"font-medium",children:I.paymentKey})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-modern-text-secondary",children:"요청 금액"}),s.jsxs("div",{className:"font-medium",children:["₩",I.requestedAmount.toLocaleString()]})]}),I.approvedAmount&&s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-modern-text-secondary",children:"승인 금액"}),s.jsxs("div",{className:"font-medium",children:["₩",I.approvedAmount.toLocaleString()]})]}),I.tossRefundKey&&s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-modern-text-secondary",children:"토스 환불키"}),s.jsx("div",{className:"font-medium",children:I.tossRefundKey})]})]})})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium mb-3",children:"처리 이력"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-modern-bg-secondary rounded-lg",children:[s.jsx(n,{className:"w-4 h-4 text-yellow-600"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:"환불 요청"}),s.jsx("div",{className:"text-sm text-modern-text-secondary",children:new Date(I.requestedAt).toLocaleString("ko-KR")}),s.jsxs("div",{className:"text-sm text-modern-text-tertiary",children:["사유: ",I.reason]})]})]}),I.processedAt&&s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-modern-bg-secondary rounded-lg",children:[X(I.status),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:"관리자 처리"}),s.jsx("div",{className:"text-sm text-modern-text-secondary",children:new Date(I.processedAt).toLocaleString("ko-KR")}),I.adminNote&&s.jsxs("div",{className:"text-sm text-modern-text-tertiary",children:["메모: ",I.adminNote]})]})]}),I.completedAt&&s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-modern-bg-secondary rounded-lg",children:[s.jsx(o,{className:"w-4 h-4 text-green-600"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:"환불 완료"}),s.jsx("div",{className:"text-sm text-modern-text-secondary",children:new Date(I.completedAt).toLocaleString("ko-KR")}),I.receiptUrl&&s.jsx("div",{className:"text-sm",children:s.jsx("a",{href:I.receiptUrl,target:"_blank",rel:"noopener noreferrer",className:"text-modern-primary hover:underline",children:"환불 영수증 보기"})})]})]})]})]})]}),s.jsx(C,{children:s.jsx(u,{onClick:()=>B(!1),children:"닫기"})})]})})]})};export{K as default};
