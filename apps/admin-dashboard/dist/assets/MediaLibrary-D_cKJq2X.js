import{r as e,j as s,bk as a,bf as t,a as l,bU as i,dF as r,bE as n,bA as d,dG as c,bj as o,V as m,bL as x,dq as h,df as p,cM as j,cy as u,S as g,bM as v,dH as f,c$ as N,C as y,bd as w,dI as b,bN as C,cT as k,bg as S,c_ as F,bt as T,cb as z,bh as I,bi as $,E as M}from"./vendor-react-BQ6HOJoh.js";import{B as U,L,I as B,T as D,b as O,d as E,e as R,f as q,g as P,S as K,h as _,i as A,j as Q,k as W}from"./page-template-editor-C7FodHrK.js";import{az as G,aA as V,aB as H,aC as J,aD as X,av as Y,aH as Z,aE as ee,ao as se,ap as ae,aq as te,at as le,as as ie,ak as re,an as ne}from"./wp-misc-DS9m4_P2.js";import{C as de}from"./checkbox-BfnqKnJs.js";import{u as ce,b as oe,a as me}from"./vendor-query-LYSOqK5P.js";const xe=({_isOpen:x,onClose:h,onUploadComplete:p,files:j,folderId:u,acceptedTypes:g,maxFileSize:v=104857600})=>{const[f,N]=e.useState([]),[y,w]=e.useState(!1),[b,C]=e.useState(null);e.useEffect(()=>{if(x&&j&&j.length>0){const e=Array.from(j).map(e=>({file:e,id:`${Date.now()}-${Math.random()}`,status:"pending",progress:0,preview:e.type.startsWith("image/")?URL.createObjectURL(e):void 0,metadata:{title:e.name.replace(/\.[^/.]+$/,"")}}));N(e)}},[x,j]),e.useEffect(()=>()=>{f.forEach(e=>{e.preview&&URL.revokeObjectURL(e.preview)})},[f]);const k=e=>e.type.startsWith("image/")?"image":e.type.startsWith("video/")?"video":e.type.startsWith("audio/")?"audio":e.type.includes("pdf")||e.type.includes("document")||e.type.includes("msword")||e.type.includes("spreadsheet")||e.type.includes("presentation")?"document":e.type.includes("zip")||e.type.includes("rar")||e.type.includes("tar")?"archive":"other",S=e=>{switch(e){case"image":return s.jsx(o,{className:"w-8 h-8"});case"video":return s.jsx(c,{className:"w-8 h-8"});case"audio":return s.jsx(d,{className:"w-8 h-8"});case"document":return s.jsx(n,{className:"w-8 h-8"});default:return s.jsx(r,{className:"w-8 h-8"})}},F=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},T=e.useCallback(e=>{e.preventDefault();const s=e.dataTransfer.files;if(s.length>0){const e=Array.from(s).map(e=>({file:e,id:`${Date.now()}-${Math.random()}`,status:"pending",progress:0,preview:e.type.startsWith("image/")?URL.createObjectURL(e):void 0,metadata:{title:e.name.replace(/\.[^/.]+$/,"")}}));N(s=>[...s,...e])}},[]),z=(e,s)=>{N(a=>a.map(a=>a.id===e?{...a,metadata:{...a.metadata,...s}}:a))},I=async e=>{const s=new FormData;s.append("file",e.file),s.append("title",e.metadata?.title||e.file.name),e.metadata?.alt&&s.append("alt",e.metadata.alt),e.metadata?.caption&&s.append("caption",e.metadata.caption),u&&s.append("folderId",u);try{N(s=>s.map(s=>s.id===e.id?{...s,status:"uploading"}:s));const a=setInterval(()=>{N(s=>s.map(s=>s.id===e.id&&"uploading"===s.status?{...s,progress:Math.min(s.progress+10,90)}:s))},200),t=await O.api.post("/media/upload",s,{headers:{"Content-Type":"multipart/form-data"}});return clearInterval(a),N(s=>s.map(s=>s.id===e.id?{...s,status:"success",progress:100}:s)),t.data}catch(a){throw N(s=>s.map(s=>s.id===e.id?{...s,status:"error",error:"업로드 실패"}:s)),a}},$=f.filter(e=>"pending"===e.status).length,M=f.filter(e=>"uploading"===e.status).length,E=f.filter(e=>"success"===e.status).length,R=f.filter(e=>"error"===e.status).length;return s.jsx(G,{open:x,onOpenChange:h,children:s.jsxs(V,{className:"max-w-4xl max-h-[80vh] overflow-hidden flex flex-col",children:[s.jsxs(H,{children:[s.jsx(J,{children:"미디어 업로드"}),s.jsx(X,{children:"이미지, 비디오, 문서 등을 업로드합니다"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:0===f.length?s.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center cursor-pointer hover:border-gray-400 transition-colors",onDrop:T,onDragOver:e=>e.preventDefault(),onClick:()=>{const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept=g?.join(",")||"*",e.onchange=e=>{const s=e.target.files;if(s){const e=Array.from(s).map(e=>({file:e,id:`${Date.now()}-${Math.random()}`,status:"pending",progress:0,preview:e.type.startsWith("image/")?URL.createObjectURL(e):void 0,metadata:{title:e.name.replace(/\.[^/.]+$/,"")}}));N(e)}},e.click()},children:[s.jsx(a,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),s.jsx("p",{className:"text-lg font-medium text-gray-700 mb-2",children:"파일을 드래그하거나 클릭하여 업로드"}),s.jsxs("p",{className:"text-sm text-gray-500",children:["최대 ",F(v)," 크기의 파일 지원"]})]}):s.jsx("div",{className:"space-y-3",children:f.map(e=>s.jsx("div",{className:"border rounded-lg p-4 "+("error"===e.status?"border-red-300 bg-red-50":"border-gray-200"),children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"flex-shrink-0",children:e.preview?s.jsx("img",{src:e.preview,alt:"",className:"w-20 h-20 rounded object-cover"}):s.jsx("div",{className:"w-20 h-20 rounded bg-gray-100 flex items-center justify-center text-gray-400",children:S(k(e.file))})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-start justify-between mb-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-sm truncate",children:e.metadata?.title||e.file.name}),s.jsxs("p",{className:"text-xs text-gray-500",children:[F(e.file.size)," · ",k(e.file)]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:["pending"===e.status&&s.jsxs(s.Fragment,{children:[s.jsx(U,{variant:"ghost",size:"sm",onClick:()=>C(e.id),children:"편집"}),s.jsx(U,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,void N(e=>{const a=e.find(e=>e.id===s);return a?.preview&&URL.revokeObjectURL(a.preview),e.filter(e=>e.id!==s)});var s},children:s.jsx(t,{className:"w-4 h-4"})})]}),"uploading"===e.status&&s.jsx(Y,{variant:"secondary",children:"업로드 중"}),"success"===e.status&&s.jsxs(Y,{className:"bg-green-100 text-green-800",children:[s.jsx(l,{className:"w-3 h-3 mr-1"}),"완료"]}),"error"===e.status&&s.jsxs(Y,{variant:"destructive",children:[s.jsx(i,{className:"w-3 h-3 mr-1"}),"실패"]})]})]}),"uploading"===e.status&&s.jsx(Z,{value:e.progress,className:"h-1"}),e.error&&s.jsx("p",{className:"text-xs text-red-600 mt-1",children:e.error}),b===e.id&&s.jsxs("div",{className:"mt-3 space-y-3 p-3 bg-gray-50 rounded",children:[s.jsxs("div",{children:[s.jsx(L,{htmlFor:`title-${e.id}`,children:"제목"}),s.jsx(B,{id:`title-${e.id}`,value:e.metadata?.title||"",onChange:s=>z(e.id,{title:s.target.value}),placeholder:"미디어 제목"})]}),"image"===k(e.file)&&s.jsxs("div",{children:[s.jsx(L,{htmlFor:`alt-${e.id}`,children:"대체 텍스트"}),s.jsx(B,{id:`alt-${e.id}`,value:e.metadata?.alt||"",onChange:s=>z(e.id,{alt:s.target.value}),placeholder:"이미지 설명"})]}),s.jsxs("div",{children:[s.jsx(L,{htmlFor:`caption-${e.id}`,children:"캡션"}),s.jsx(D,{id:`caption-${e.id}`,value:e.metadata?.caption||"",onChange:s=>z(e.id,{caption:s.target.value}),placeholder:"미디어 캡션",rows:2})]}),s.jsx(U,{variant:"outline",size:"sm",onClick:()=>C(null),children:"완료"})]})]})]})},e.id))})}),s.jsx(ee,{children:s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:[$>0&&s.jsxs("span",{children:[$,"개 대기 중"]}),M>0&&s.jsxs("span",{className:"ml-3",children:[M,"개 업로드 중"]}),E>0&&s.jsxs("span",{className:"ml-3 text-green-600",children:[E,"개 완료"]}),R>0&&s.jsxs("span",{className:"ml-3 text-red-600",children:[R,"개 실패"]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(U,{variant:"outline",onClick:h,children:"취소"}),s.jsx(U,{onClick:async()=>{w(!0);const e=f.filter(e=>"pending"===e.status);let s=0,a=0;for(const l of e)try{await I(l),s++}catch(t){a++}w(!1),s>0&&(m.success(`${s}개 파일이 업로드되었습니다`),0===a&&p()),a>0&&m.error(`${a}개 파일 업로드에 실패했습니다`)},disabled:0===$||y,children:y?"업로드 중...":`${$}개 업로드`})]})]})})]})})},he=({media:a,onClose:l,onUpdate:i,onDelete:r})=>{const n=ce(),[d,c]=e.useState({title:a.title,alt:a.alt,caption:a.caption,description:a.description,tags:a.tags,folderId:a.folderId}),f=oe({mutationFn:async e=>O.api.put(`/media/${a.id}`,e),onSuccess:()=>{m.success("미디어가 업데이트되었습니다"),n.invalidateQueries({queryKey:["media"]}),i()},onError:()=>{m.error("업데이트에 실패했습니다")}}),N=oe({mutationFn:async()=>O.api.delete(`/media/${a.id}`),onSuccess:()=>{m.success("미디어가 삭제되었습니다"),n.invalidateQueries({queryKey:["media"]}),r()},onError:()=>{m.error("삭제에 실패했습니다")}}),y=()=>{navigator.clipboard.writeText(a.url),m.success("URL이 복사되었습니다")};return s.jsx(G,{open:!0,onOpenChange:l,children:s.jsxs(V,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[s.jsx(H,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(J,{children:"미디어 상세"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(U,{variant:"ghost",size:"sm",onClick:y,children:s.jsx(x,{className:"w-4 h-4"})}),s.jsx(U,{variant:"ghost",size:"sm",onClick:()=>window.open(a.url,"_blank"),children:s.jsx(h,{className:"w-4 h-4"})}),s.jsx(U,{variant:"ghost",size:"sm",onClick:()=>{const e=document.createElement("a");e.href=a.url,e.download=a.filename,e.click()},children:s.jsx(p,{className:"w-4 h-4"})}),s.jsx(U,{variant:"ghost",size:"sm",onClick:l,children:s.jsx(t,{className:"w-4 h-4"})})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("div",{className:"bg-gray-100 rounded-lg p-4",children:"image"===a.mediaType?s.jsx("img",{src:a.url,alt:a.alt||a.title,className:"w-full h-auto rounded"}):"video"===a.mediaType?s.jsx("video",{src:a.url,controls:!0,className:"w-full h-auto rounded"}):"audio"===a.mediaType?s.jsx("audio",{src:a.url,controls:!0,className:"w-full"}):s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[s.jsx(o,{className:"w-16 h-16 mb-4"}),s.jsx("p",{className:"text-sm",children:"미리보기를 사용할 수 없습니다"}),s.jsx(U,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>window.open(a.url,"_blank"),children:"파일 열기"})]})}),s.jsxs("div",{className:"mt-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[s.jsx("span",{className:"text-sm text-gray-500",children:"파일명"}),s.jsx("span",{className:"text-sm font-medium",children:a.filename})]}),s.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[s.jsx("span",{className:"text-sm text-gray-500",children:"유형"}),s.jsx(Y,{variant:"outline",children:a.mimeType})]}),s.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[s.jsx("span",{className:"text-sm text-gray-500",children:"크기"}),s.jsx("span",{className:"text-sm font-medium",children:(e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})(a.size)})]}),a.width&&a.height&&s.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[s.jsx("span",{className:"text-sm text-gray-500",children:"크기"}),s.jsxs("span",{className:"text-sm font-medium",children:[a.width," × ",a.height,"px"]})]}),a.duration&&s.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[s.jsx("span",{className:"text-sm text-gray-500",children:"길이"}),s.jsxs("span",{className:"text-sm font-medium",children:[Math.floor(a.duration/60),":",(a.duration%60).toString().padStart(2,"0")]})]}),s.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[s.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[s.jsx(j,{className:"w-4 h-4"}),"업로드"]}),s.jsx("span",{className:"text-sm font-medium",children:new Date(a.createdAt).toLocaleDateString()})]}),s.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[s.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[s.jsx(u,{className:"w-4 h-4"}),"업로더"]}),s.jsx("span",{className:"text-sm font-medium",children:a.uploadedBy.name})]})]})]}),s.jsxs("div",{children:[s.jsxs(E,{defaultValue:"general",children:[s.jsxs(R,{className:"grid w-full grid-cols-3",children:[s.jsx(q,{value:"general",children:"일반"}),s.jsx(q,{value:"metadata",children:"메타데이터"}),s.jsx(q,{value:"usage",children:"사용처"})]}),s.jsxs(P,{value:"general",className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(L,{htmlFor:"title",children:"제목"}),s.jsx(B,{id:"title",value:d.title||"",onChange:e=>c({...d,title:e.target.value}),placeholder:"미디어 제목"})]}),"image"===a.mediaType&&s.jsxs("div",{children:[s.jsx(L,{htmlFor:"alt",children:"대체 텍스트"}),s.jsx(B,{id:"alt",value:d.alt||"",onChange:e=>c({...d,alt:e.target.value}),placeholder:"이미지를 설명하는 텍스트"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"스크린 리더 사용자를 위한 이미지 설명"})]}),s.jsxs("div",{children:[s.jsx(L,{htmlFor:"caption",children:"캡션"}),s.jsx(D,{id:"caption",value:d.caption||"",onChange:e=>c({...d,caption:e.target.value}),placeholder:"미디어 캡션",rows:2})]}),s.jsxs("div",{children:[s.jsx(L,{htmlFor:"description",children:"설명"}),s.jsx(D,{id:"description",value:d.description||"",onChange:e=>c({...d,description:e.target.value}),placeholder:"미디어에 대한 상세 설명",rows:3})]}),s.jsxs("div",{children:[s.jsx(L,{htmlFor:"tags",children:"태그"}),s.jsx(B,{id:"tags",value:d.tags?.join(", ")||"",onChange:e=>c({...d,tags:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),placeholder:"태그1, 태그2, 태그3"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"쉼표로 구분하여 입력"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(U,{onClick:()=>{f.mutate(d)},disabled:f.isPending,className:"flex-1",children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),"저장"]}),s.jsxs(U,{variant:"destructive",onClick:()=>{confirm("정말 이 미디어를 삭제하시겠습니까?")&&N.mutate()},disabled:N.isPending,children:[s.jsx(v,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]}),s.jsx(P,{value:"metadata",className:"space-y-4",children:a.metadata&&Object.entries(a.metadata).length>0?s.jsx("div",{className:"space-y-2",children:Object.entries(a.metadata).map(([e,a])=>s.jsxs("div",{className:"flex justify-between py-2 border-b",children:[s.jsx("span",{className:"text-sm text-gray-500",children:e}),s.jsx("span",{className:"text-sm font-medium",children:String(a)})]},e))}):s.jsx("p",{className:"text-sm text-gray-500 text-center py-8",children:"메타데이터가 없습니다"})}),s.jsx(P,{value:"usage",className:"space-y-4",children:a.attachedTo&&a.attachedTo.length>0?s.jsx("div",{className:"space-y-2",children:a.attachedTo.map((e,a)=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-sm",children:e.postTitle}),s.jsx("p",{className:"text-xs text-gray-500",children:e.postType})]}),s.jsx(U,{variant:"outline",size:"sm",onClick:()=>window.open(`/content/${e.postType}/${e.postId}/edit`,"_blank"),children:"편집"})]},a))}):s.jsx("p",{className:"text-sm text-gray-500 text-center py-8",children:"사용처가 없습니다"})})]}),s.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded",children:[s.jsx(L,{children:"파일 URL"}),s.jsxs("div",{className:"flex gap-2 mt-2",children:[s.jsx(B,{value:a.url,readOnly:!0,className:"bg-white"}),s.jsx(U,{variant:"outline",onClick:y,children:s.jsx(x,{className:"w-4 h-4"})})]})]}),a.variations&&Object.keys(a.variations).length>0&&s.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded",children:[s.jsx(L,{children:"이미지 크기"}),s.jsxs("div",{className:"space-y-2 mt-2",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm",children:"원본"}),s.jsxs("span",{className:"text-sm text-gray-500",children:[a.width," × ",a.height,"px"]})]}),Object.entries(a.variations||{}).map(([e,a])=>a&&s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm capitalize",children:e}),s.jsxs("span",{className:"text-sm text-gray-500",children:[a.width," × ",a.height,"px"]})]},e))]})]})]})]})})]})})},pe=({folder:e,level:a,expandedFolders:t,onToggle:l,onEdit:i,onDelete:r,onSelect:n,folders:d})=>{const c=d.filter(s=>s.parentId===e.id),o=c.length>0,m=t.includes(e.id);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 rounded cursor-pointer",style:{paddingLeft:20*a+8+"px"},children:[s.jsx("button",{onClick:()=>o&&l(e.id),className:"p-1",children:o?m?s.jsx(y,{className:"w-4 h-4"}):s.jsx(w,{className:"w-4 h-4"}):s.jsx("div",{className:"w-4 h-4"})}),s.jsxs("div",{className:"flex-1 flex items-center gap-2",onClick:()=>n?.(e.id),children:[m?s.jsx(b,{className:"w-4 h-4 text-blue-600"}):s.jsx(N,{className:"w-4 h-4 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium",children:e.name}),s.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.mediaCount,")"]})]}),s.jsxs(se,{children:[s.jsx(ae,{children:s.jsx(U,{variant:"ghost",size:"sm",onClick:e=>e.stopPropagation(),children:s.jsx(C,{className:"w-4 h-4"})})}),s.jsxs(te,{align:"end",children:[s.jsxs(le,{onClick:()=>i(e),children:[s.jsx(k,{className:"w-4 h-4 mr-2"}),"편집"]}),s.jsx(ie,{}),s.jsxs(le,{onClick:()=>r(e),className:"text-red-600",children:[s.jsx(v,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]}),o&&m&&s.jsx("div",{children:c.map(e=>s.jsx(pe,{folder:e,level:a+1,expandedFolders:t,onToggle:l,onEdit:i,onDelete:r,onSelect:n,folders:d},e.id))})]})},je=({_isOpen:a,onClose:t,onFolderSelect:l})=>{const i=ce(),[r,n]=e.useState([]),[d,c]=e.useState(!1),[o,x]=e.useState(null),[h,p]=e.useState({name:"",parentId:void 0,description:""}),{data:j=[],isLoading:u}=me({queryKey:["media-folders"],queryFn:async()=>(await O.api.get("/media/folders")).data}),g=oe({mutationFn:async e=>O.api.post("/media/folders",e),onSuccess:()=>{m.success("폴더가 생성되었습니다"),i.invalidateQueries({queryKey:["media-folders"]}),c(!1),p({name:"",parentId:void 0,description:""})},onError:()=>{m.error("폴더 생성에 실패했습니다")}}),v=oe({mutationFn:async e=>O.api.put(`/media/folders/${e.id}`,e),onSuccess:()=>{m.success("폴더가 수정되었습니다"),i.invalidateQueries({queryKey:["media-folders"]}),x(null)},onError:()=>{m.error("폴더 수정에 실패했습니다")}}),y=oe({mutationFn:async e=>O.api.delete(`/media/folders/${e}`),onSuccess:()=>{m.success("폴더가 삭제되었습니다"),i.invalidateQueries({queryKey:["media-folders"]})},onError:()=>{m.error("폴더 삭제에 실패했습니다")}}),w=e=>{n(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},b=e=>{confirm(`정말 "${e.name}" 폴더를 삭제하시겠습니까?\n폴더 내 미디어는 미분류로 이동됩니다.`)&&y.mutate(e.id)},C=j.filter(e=>!e.parentId);return s.jsxs(s.Fragment,{children:[s.jsx(G,{open:a,onOpenChange:t,children:s.jsxs(V,{className:"max-w-2xl",children:[s.jsxs(H,{children:[s.jsx(J,{children:"폴더 관리"}),s.jsx(X,{children:"미디어를 정리할 폴더를 관리합니다"})]}),s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-sm font-medium",children:"폴더 구조"}),s.jsxs(U,{variant:"outline",size:"sm",onClick:()=>{p({name:"",parentId:void 0,description:""}),x(null),c(!0)},children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"새 폴더"]})]}),u?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):0===j.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(N,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),s.jsx("p",{className:"text-gray-500 mb-4",children:"폴더가 없습니다"}),s.jsxs(U,{variant:"outline",onClick:()=>{p({name:"",parentId:void 0,description:""}),x(null),c(!0)},children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"첫 폴더 만들기"]})]}):s.jsx("div",{className:"border rounded-lg p-4 max-h-96 overflow-y-auto",children:C.map(e=>s.jsx(pe,{folder:e,level:0,expandedFolders:r,onToggle:w,onEdit:e=>{x(e),p({name:e.name,parentId:e.parentId,description:e.description||""}),c(!0)},onDelete:b,onSelect:l,folders:j},e.id))}),s.jsx(ee,{children:s.jsx(U,{variant:"outline",onClick:t,children:"닫기"})})]})}),s.jsx(G,{open:d,onOpenChange:c,children:s.jsxs(V,{children:[s.jsxs(H,{children:[s.jsx(J,{children:o?"폴더 수정":"새 폴더"}),s.jsx(X,{children:"폴더 정보를 입력하세요"})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{children:[s.jsx(L,{htmlFor:"folderName",children:"폴더 이름"}),s.jsx(B,{id:"folderName",value:h.name,onChange:e=>p({...h,name:e.target.value}),placeholder:"예: 2024년 이미지"})]}),s.jsxs("div",{children:[s.jsx(L,{htmlFor:"parentFolder",children:"상위 폴더"}),s.jsxs("select",{id:"parentFolder",className:"w-full px-3 py-2 border rounded-md",value:h.parentId||"",onChange:e=>p({...h,parentId:e.target.value||void 0}),children:[s.jsx("option",{value:"",children:"최상위"}),j.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsx(L,{htmlFor:"folderDescription",children:"설명 (선택)"}),s.jsx(D,{id:"folderDescription",value:h.description,onChange:e=>p({...h,description:e.target.value}),placeholder:"폴더에 대한 설명",rows:2})]})]}),s.jsxs(ee,{children:[s.jsx(U,{variant:"outline",onClick:()=>{c(!1),x(null)},children:"취소"}),s.jsx(U,{onClick:o?()=>{o&&v.mutate({id:o.id,name:h.name,description:h.description,parentId:h.parentId})}:()=>{g.mutate(h)},disabled:!h.name||g.isPending||v.isPending,children:o?"수정":"생성"})]})]})})]})},ue=()=>{const l=ce(),i=e.useRef(null),[h,j]=e.useState("grid"),[u,g]=e.useState([]),[N,y]=e.useState(""),[w,L]=e.useState({mediaType:"all",folderId:void 0,status:"all"}),[D,E]=e.useState(!1),[R,q]=e.useState(null),[P,G]=e.useState(!1),[V,H]=e.useState(1),{data:J,isLoading:X,refetch:Z}=me({queryKey:["media",{...w,search:N,page:V,limit:24}],queryFn:async()=>{const e=new URLSearchParams({page:V.toString(),limit:24..toString()});N&&e.append("search",N),w.mediaType&&"all"!==w.mediaType&&e.append("mediaType",w.mediaType),w.folderId&&e.append("folderId",w.folderId),w.status&&"all"!==w.status&&e.append("status",w.status);return(await O.api.get(`/media?${e}`)).data}}),ee=oe({mutationFn:async e=>{const s=e.map(e=>O.api.delete(`/media/${e}`));return Promise.all(s)},onSuccess:()=>{l.invalidateQueries({queryKey:["media"]}),m.success("미디어가 삭제되었습니다"),g([])},onError:()=>{m.error("삭제에 실패했습니다")}}),pe=e=>{g(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},ue=()=>{g([])},ge=e=>{switch(e){case"image":return s.jsx(o,{className:"w-5 h-5"});case"video":return s.jsx(c,{className:"w-5 h-5"});case"audio":return s.jsx(d,{className:"w-5 h-5"});case"document":return s.jsx(n,{className:"w-5 h-5"});default:return s.jsx(r,{className:"w-5 h-5"})}},ve=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"미디어 라이브러리"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"이미지, 비디오, 문서를 관리합니다"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs(U,{variant:"outline",onClick:()=>G(!0),children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"폴더 관리"]}),s.jsx("input",{ref:i,type:"file",multiple:!0,className:"hidden",onChange:e=>{const s=e.target.files;s&&s.length>0&&E(!0)},accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.zip,.rar"}),s.jsxs(U,{onClick:()=>i.current?.click(),children:[s.jsx(a,{className:"w-4 h-4 mr-2"}),"업로드"]})]})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsxs("div",{className:"flex-1 flex gap-3",children:[s.jsxs("div",{className:"relative flex-1 max-w-md",children:[s.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),s.jsx(B,{placeholder:"미디어 검색...",value:N,onChange:e=>y(e.target.value),className:"pl-10"})]}),s.jsxs(K,{value:w.mediaType||"all",onValueChange:e=>L({...w,mediaType:e}),children:[s.jsxs(_,{className:"w-[180px]",children:[s.jsx(F,{className:"w-4 h-4 mr-2"}),s.jsx(A,{placeholder:"미디어 유형"})]}),s.jsxs(Q,{children:[s.jsx(W,{value:"all",children:"모든 유형"}),s.jsx(W,{value:"image",children:"이미지"}),s.jsx(W,{value:"video",children:"비디오"}),s.jsx(W,{value:"audio",children:"오디오"}),s.jsx(W,{value:"document",children:"문서"}),s.jsx(W,{value:"other",children:"기타"})]})]}),J?.folders&&J.folders.length>0&&s.jsxs(K,{value:w.folderId||"all",onValueChange:e=>L({...w,folderId:"all"===e?void 0:e}),children:[s.jsxs(_,{className:"w-[180px]",children:[s.jsx(b,{className:"w-4 h-4 mr-2"}),s.jsx(A,{placeholder:"폴더"})]}),s.jsxs(Q,{children:[s.jsx(W,{value:"all",children:"모든 폴더"}),s.jsx(W,{value:"uncategorized",children:"미분류"}),J.folders.map(e=>s.jsx(W,{value:e.id,children:e.name},e.id))]})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[u.length>0&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"text-sm text-gray-600",children:[u.length,"개 선택됨"]}),s.jsx(U,{variant:"ghost",size:"sm",onClick:ue,children:s.jsx(t,{className:"w-4 h-4"})}),s.jsxs(se,{children:[s.jsx(ae,{children:s.jsx(U,{variant:"outline",size:"sm",children:"일괄 작업"})}),s.jsxs(te,{children:[s.jsxs(le,{children:[s.jsx(p,{className:"w-4 h-4 mr-2"}),"다운로드"]}),s.jsxs(le,{children:[s.jsx(T,{className:"w-4 h-4 mr-2"}),"폴더 이동"]}),s.jsxs(le,{children:[s.jsx(z,{className:"w-4 h-4 mr-2"}),"태그 추가"]}),s.jsx(ie,{}),s.jsxs(le,{onClick:()=>{0!==u.length&&confirm(`정말 ${u.length}개의 미디어를 삭제하시겠습니까?`)&&ee.mutate(u)},className:"text-red-600",children:[s.jsx(v,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-1 border rounded-lg p-1",children:[s.jsx(U,{variant:"grid"===h?"default":"ghost",size:"sm",onClick:()=>j("grid"),children:s.jsx(I,{className:"w-4 h-4"})}),s.jsx(U,{variant:"list"===h?"default":"ghost",size:"sm",onClick:()=>j("list"),children:s.jsx($,{className:"w-4 h-4"})})]})]})]}),X?s.jsx("div",{className:"flex items-center justify-center h-96",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):0===J?.items?.length?s.jsx(re,{children:s.jsxs(ne,{className:"text-center py-12",children:[s.jsx(o,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),s.jsx("p",{className:"text-gray-500 mb-4",children:"미디어가 없습니다"}),s.jsxs(U,{onClick:()=>i.current?.click(),children:[s.jsx(a,{className:"w-4 h-4 mr-2"}),"첫 미디어 업로드"]})]})}):"grid"===h?s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:J?.items?.map(e=>s.jsxs("div",{className:"group relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all "+(u.includes(e.id)?"border-blue-500 shadow-lg":"border-gray-200 hover:border-gray-300"),onClick:()=>q(e),children:[s.jsxs("div",{className:"aspect-square bg-gray-100 relative",children:["image"===e.mediaType&&e.thumbnailUrl?s.jsx("img",{src:e.thumbnailUrl,alt:e.alt||e.title,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:ge(e.mediaType)}),s.jsx("div",{className:"absolute top-2 left-2 z-10",onClick:s=>{s.stopPropagation(),pe(e.id)},children:s.jsx(de,{checked:u.includes(e.id),className:"bg-white shadow-sm"})}),"ready"!==e.status&&s.jsx(Y,{variant:"processing"===e.status?"secondary":"destructive",className:"absolute top-2 right-2",children:"processing"===e.status?"처리중":"실패"}),s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(U,{size:"sm",variant:"secondary",onClick:s=>{s.stopPropagation(),q(e)},children:s.jsx(M,{className:"w-4 h-4"})}),s.jsxs(se,{children:[s.jsx(ae,{onClick:e=>e.stopPropagation(),children:s.jsx(U,{size:"sm",variant:"secondary",children:s.jsx(C,{className:"w-4 h-4"})})}),s.jsxs(te,{children:[s.jsxs(le,{children:[s.jsx(k,{className:"w-4 h-4 mr-2"}),"편집"]}),s.jsxs(le,{children:[s.jsx(x,{className:"w-4 h-4 mr-2"}),"URL 복사"]}),s.jsxs(le,{children:[s.jsx(p,{className:"w-4 h-4 mr-2"}),"다운로드"]}),s.jsx(ie,{}),s.jsxs(le,{className:"text-red-600",onClick:()=>{confirm("정말 삭제하시겠습니까?")&&ee.mutate([e.id])},children:[s.jsx(v,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]})})]}),s.jsxs("div",{className:"p-2",children:[s.jsx("p",{className:"text-xs font-medium truncate",children:e.title}),s.jsx("p",{className:"text-xs text-gray-500",children:ve(e.size)})]})]},e.id))}):s.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left",children:s.jsx(de,{checked:u.length===J?.items?.length&&J?.items?.length>0,onCheckedChange:e=>e?void(J?.items&&g(J.items.map(e=>e.id))):ue()})}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"미디어"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"유형"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"크기"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"업로드"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"작업"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200",children:J?.items?.map(e=>s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-4 py-3",children:s.jsx(de,{checked:u.includes(e.id),onCheckedChange:()=>pe(e.id)})}),s.jsx("td",{className:"px-4 py-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:["image"===e.mediaType&&e.thumbnailUrl?s.jsx("img",{src:e.thumbnailUrl,alt:e.alt||e.title,className:"w-10 h-10 rounded object-cover"}):s.jsx("div",{className:"w-10 h-10 rounded bg-gray-100 flex items-center justify-center text-gray-400",children:ge(e.mediaType)}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-sm",children:e.title}),s.jsx("p",{className:"text-xs text-gray-500",children:e.filename})]})]})}),s.jsx("td",{className:"px-4 py-3",children:s.jsx(Y,{variant:"outline",children:e.mediaType})}),s.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:ve(e.size)}),s.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:s.jsxs("div",{children:[s.jsx("p",{children:new Date(e.createdAt).toLocaleDateString()}),s.jsx("p",{className:"text-xs",children:e.uploadedBy.name})]})}),s.jsx("td",{className:"px-4 py-3",children:s.jsxs(se,{children:[s.jsx(ae,{children:s.jsx(U,{variant:"ghost",size:"sm",children:s.jsx(C,{className:"w-4 h-4"})})}),s.jsxs(te,{align:"end",children:[s.jsxs(le,{onClick:()=>q(e),children:[s.jsx(M,{className:"w-4 h-4 mr-2"}),"보기"]}),s.jsxs(le,{children:[s.jsx(k,{className:"w-4 h-4 mr-2"}),"편집"]}),s.jsxs(le,{children:[s.jsx(x,{className:"w-4 h-4 mr-2"}),"URL 복사"]}),s.jsxs(le,{children:[s.jsx(p,{className:"w-4 h-4 mr-2"}),"다운로드"]}),s.jsx(ie,{}),s.jsxs(le,{className:"text-red-600",onClick:()=>{confirm("정말 삭제하시겠습니까?")&&ee.mutate([e.id])},children:[s.jsx(v,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})})]},e.id))})]})}),J?.totalPages>1&&s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-sm text-gray-700",children:["총 ",J.total,"개 중 ",24*(V-1)+1,"-",Math.min(24*V,J.total),"개 표시"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(U,{variant:"outline",size:"sm",onClick:()=>H(V-1),disabled:1===V,children:"이전"}),s.jsx(U,{variant:"outline",size:"sm",onClick:()=>H(V+1),disabled:V===J.totalPages,children:"다음"})]})]}),s.jsx(xe,{_isOpen:D,onClose:()=>{E(!1),i.current.value=""},onUploadComplete:()=>{Z(),E(!1),i.current.value=""},files:i.current?.files||void 0,folderId:w.folderId}),R&&s.jsx(he,{media:R,onClose:()=>q(null),onUpdate:()=>Z(),onDelete:()=>{Z(),q(null)}}),s.jsx(je,{_isOpen:P,onClose:()=>G(!1),onFolderSelect:e=>{L({...w,folderId:e}),G(!1)}})]})};export{ue as M};
