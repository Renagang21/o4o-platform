import{r as h,j as e,x as U,cR as W,B as X,J as Y,z as Z,cS as ee,V as o}from"./vendor-react-BZRIq8oW.js";import{u as se,a as D,b as y}from"./vendor-query-GrNIwsDq.js";import{B as c,C as f,k as N,l as b,m as F,s as S,L as i,I as r,w as k,x as q,y as P,z as I,E as M,F as E,j as m}from"./page-gutenberg-iVBL5IS_.js";import"./wp-block-editor-C14Ds6es.js";import"./wp-blocks-CnCGET8b.js";import"./wp-core-BctBwZpo.js";import"./wp-i18n-Niz9RVma.js";import"./wp-element-CB9_H0_F.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-monaco-cpVGocfO.js";import"./vendor-utils-DQ8F5vJI.js";import"./wp-components-CLkQS2qf.js";const ue=()=>{const u=se(),[O,p]=h.useState(!1),[B,j]=h.useState(!1),[g,C]=h.useState(null),[v,K]=h.useState(1e5),[a,n]=h.useState({name:"",type:"platform",baseRate:5,minFee:0,maxFee:0,isActive:!0,conditions:[],description:""}),{data:Q,isLoading:T}=D({queryKey:["fee-policies"],queryFn:async()=>(await m.api.get("/v1/settlements/fee-policies")).data}),x=Q?.data||[],{data:z}=D({queryKey:["fee-calculation",v],queryFn:async()=>(await m.api.post("/v1/settlements/calculate-fee",{orderAmount:v,categoryId:"cat-1",vendorTier:"standard",paymentMethod:"card"})).data,enabled:v>0}),d=z?.data||{},w=y({mutationFn:async s=>(await m.api.post("/v1/settlements/fee-policies",s)).data,onSuccess:()=>{o.success("수수료 정책이 생성되었습니다"),u.invalidateQueries({queryKey:["fee-policies"]}),p(!1),R()}}),A=y({mutationFn:async({id:s,data:t})=>(await m.api.put(`/v1/settlements/fee-policies/${s}`,t)).data,onSuccess:()=>{o.success("수수료 정책이 수정되었습니다"),u.invalidateQueries({queryKey:["fee-policies"]}),j(!1),R()}}),L=y({mutationFn:async s=>(await m.api.delete(`/v1/settlements/fee-policies/${s}`)).data,onSuccess:()=>{o.success("수수료 정책이 삭제되었습니다"),u.invalidateQueries({queryKey:["fee-policies"]})}}),_=y({mutationFn:async({id:s,isActive:t})=>(await m.api.patch(`/v1/settlements/fee-policies/${s}/toggle`,{isActive:t})).data,onSuccess:()=>{o.success("수수료 정책 상태가 변경되었습니다"),u.invalidateQueries({queryKey:["fee-policies"]})}}),R=()=>{n({name:"",type:"platform",baseRate:5,minFee:0,maxFee:0,isActive:!0,conditions:[],description:""}),C(null)},$=s=>{if(s.preventDefault(),!a.name||!a.baseRate){o.error("필수 정보를 입력하세요");return}w.mutate(a)},H=s=>{if(s.preventDefault(),!g||!a.name||!a.baseRate){o.error("필수 정보를 입력하세요");return}A.mutate({id:g.id,data:a})},V=s=>{C(s),n({name:s.name,type:s.type,baseRate:s.baseRate,minFee:s.minFee,maxFee:s.maxFee,isActive:s.isActive,conditions:s.conditions,description:s.description}),j(!0)},J=s=>{switch(s){case"platform":return"기본 플랫폼";case"category":return"카테고리별";case"vendor_tier":return"판매자 등급별";case"payment_method":return"결제 수단별";default:return s}},l=s=>`₩${s.toLocaleString()}`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"수수료 정책 관리"}),e.jsx("p",{className:"text-modern-text-secondary mt-1",children:"플랫폼 수수료 정책 설정 및 관리"})]}),e.jsxs(c,{onClick:()=>p(!0),children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"정책 추가"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(f,{children:[e.jsx(N,{children:e.jsx(b,{children:"수수료 정책 목록"})}),e.jsx(F,{children:e.jsx("div",{className:"space-y-4",children:T?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):x.length===0?e.jsx("div",{className:"text-center py-8 text-modern-text-secondary",children:"수수료 정책이 없습니다."}):x.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-semibold text-modern-text-primary",children:s.name}),e.jsx(S,{variant:s.isActive?"default":"secondary",children:s.isActive?"활성":"비활성"}),e.jsx(S,{variant:"outline",children:J(s.type)})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"w-4 h-4 text-modern-text-secondary"}),e.jsxs("span",{className:"text-sm text-modern-text-secondary",children:[s.baseRate,"%"]})]}),s.minFee&&e.jsxs("span",{className:"text-sm text-modern-text-secondary",children:["최소: ",l(s.minFee)]}),s.maxFee&&e.jsxs("span",{className:"text-sm text-modern-text-secondary",children:["최대: ",l(s.maxFee)]})]}),s.description&&e.jsx("p",{className:"text-sm text-modern-text-tertiary mt-1",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>_.mutate({id:s.id,isActive:!s.isActive}),children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>V(s),children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>L.mutate(s.id),children:e.jsx(Z,{className:"w-4 h-4"})})]})]},s.id))})})]})}),e.jsxs("div",{children:[e.jsxs(f,{children:[e.jsx(N,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"수수료 계산기"]})}),e.jsxs(F,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"testAmount",children:"주문 금액"}),e.jsx(r,{id:"testAmount",type:"number",value:v,onChange:s=>K(parseInt(s.target.value)||0),placeholder:"주문 금액 입력"})]}),d.breakdown&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-modern-bg-secondary rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-modern-text-secondary",children:"수수료 내역"}),e.jsx("div",{className:"space-y-2 mt-2",children:d.breakdown.map((s,t)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-modern-text-secondary",children:[s.name," (",s.rate,"%)"]}),e.jsx("span",{className:"font-medium",children:l(s.amount)})]},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-modern-text-secondary",children:"주문 금액"}),e.jsx("span",{className:"font-medium",children:l(d.orderAmount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-modern-text-secondary",children:"플랫폼 수수료"}),e.jsxs("span",{className:"font-medium text-blue-600",children:["-",l(d.platformFee)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-modern-text-secondary",children:"토스 수수료"}),e.jsxs("span",{className:"font-medium text-orange-600",children:["-",l(d.tossFee)]})]}),e.jsx("div",{className:"border-t pt-2",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-modern-text-primary",children:"판매자 수령액"}),e.jsx("span",{className:"font-bold text-green-600",children:l(d.vendorAmount)})]})})]})]})]})]}),e.jsxs(f,{className:"mt-4",children:[e.jsx(N,{children:e.jsx(b,{children:"정책 요약"})}),e.jsx(F,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-modern-text-secondary",children:"활성 정책"}),e.jsxs("span",{className:"font-medium",children:[x.filter(s=>s.isActive).length,"개"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-modern-text-secondary",children:"전체 정책"}),e.jsxs("span",{className:"font-medium",children:[x.length,"개"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-modern-text-secondary",children:"기본 수수료율"}),e.jsxs("span",{className:"font-medium",children:[x.find(s=>s.type==="platform"&&s.isActive)?.baseRate||0,"%"]})]})]})})]})]})]}),e.jsx(k,{open:O,onOpenChange:p,children:e.jsx(q,{className:"max-w-md",children:e.jsxs("form",{onSubmit:$,children:[e.jsxs(P,{children:[e.jsx(I,{children:"수수료 정책 추가"}),e.jsx(M,{children:"새로운 수수료 정책을 설정합니다."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"name",children:"정책명 *"}),e.jsx(r,{id:"name",value:a.name,onChange:s=>n(t=>({...t,name:s.target.value})),placeholder:"정책명을 입력하세요",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"type",children:"정책 유형 *"}),e.jsxs("select",{id:"type",value:a.type,onChange:s=>n(t=>({...t,type:s.target.value})),className:"w-full px-3 py-2 border border-modern-border-primary rounded-lg mt-1",required:!0,children:[e.jsx("option",{value:"platform",children:"기본 플랫폼"}),e.jsx("option",{value:"category",children:"카테고리별"}),e.jsx("option",{value:"vendor_tier",children:"판매자 등급별"}),e.jsx("option",{value:"payment_method",children:"결제 수단별"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"baseRate",children:"기본 수수료율 (%) *"}),e.jsx(r,{id:"baseRate",type:"number",step:"0.1",min:"0",max:"100",value:a.baseRate,onChange:s=>n(t=>({...t,baseRate:parseFloat(s.target.value)||0})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"minFee",children:"최소 수수료 (원)"}),e.jsx(r,{id:"minFee",type:"number",min:"0",value:a.minFee,onChange:s=>n(t=>({...t,minFee:parseInt(s.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"maxFee",children:"최대 수수료 (원)"}),e.jsx(r,{id:"maxFee",type:"number",min:"0",value:a.maxFee,onChange:s=>n(t=>({...t,maxFee:parseInt(s.target.value)||0}))})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"description",children:"설명"}),e.jsx(r,{id:"description",value:a.description,onChange:s=>n(t=>({...t,description:s.target.value})),placeholder:"정책 설명을 입력하세요"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:a.isActive,onChange:s=>n(t=>({...t,isActive:s.target.checked})),className:"mr-2"}),e.jsx(i,{htmlFor:"isActive",children:"정책 활성화"})]})]}),e.jsxs(E,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>p(!1),children:"취소"}),e.jsx(c,{type:"submit",disabled:w.isPending,children:"생성"})]})]})})}),e.jsx(k,{open:B,onOpenChange:j,children:e.jsx(q,{className:"max-w-md",children:e.jsxs("form",{onSubmit:H,children:[e.jsxs(P,{children:[e.jsx(I,{children:"수수료 정책 수정"}),e.jsxs(M,{children:[g?.name," 정책을 수정합니다."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"editName",children:"정책명 *"}),e.jsx(r,{id:"editName",value:a.name,onChange:s=>n(t=>({...t,name:s.target.value})),placeholder:"정책명을 입력하세요",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"editBaseRate",children:"기본 수수료율 (%) *"}),e.jsx(r,{id:"editBaseRate",type:"number",step:"0.1",min:"0",max:"100",value:a.baseRate,onChange:s=>n(t=>({...t,baseRate:parseFloat(s.target.value)||0})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"editMinFee",children:"최소 수수료 (원)"}),e.jsx(r,{id:"editMinFee",type:"number",min:"0",value:a.minFee,onChange:s=>n(t=>({...t,minFee:parseInt(s.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"editMaxFee",children:"최대 수수료 (원)"}),e.jsx(r,{id:"editMaxFee",type:"number",min:"0",value:a.maxFee,onChange:s=>n(t=>({...t,maxFee:parseInt(s.target.value)||0}))})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"editDescription",children:"설명"}),e.jsx(r,{id:"editDescription",value:a.description,onChange:s=>n(t=>({...t,description:s.target.value})),placeholder:"정책 설명을 입력하세요"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"editIsActive",checked:a.isActive,onChange:s=>n(t=>({...t,isActive:s.target.checked})),className:"mr-2"}),e.jsx(i,{htmlFor:"editIsActive",children:"정책 활성화"})]})]}),e.jsxs(E,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>j(!1),children:"취소"}),e.jsx(c,{type:"submit",disabled:A.isPending,children:"수정"})]})]})})})]})};export{ue as default};
