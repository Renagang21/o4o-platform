import{u as ee,r as a,j as e,ay as te,bj as k,C as A,R as se,w as ae,z as c}from"./vendor-react-P__8vGRG.js";import{A as re}from"./index-C0gS3Jf3.js";import{a as f}from"./page-template-editor-BTdVTS-a.js";import"./vendor-query-CucHvDcH.js";import"./vendor-socket-DgcwqWsT.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-utils-dq2XMRwt.js";const le=()=>{const E=ee(),[b,x]=a.useState([]),[F,L]=a.useState(!0),[ne,Q]=a.useState(null),[d,N]=a.useState(()=>sessionStorage.getItem("users-active-tab")||"all"),[i,g]=a.useState(new Set),[M,O]=a.useState(null),u=a.useRef(null),[I,B]=a.useState(!1),[v,P]=a.useState(""),[U,q]=a.useState(""),[m,V]=a.useState(null),[p,$]=a.useState("desc"),[D,R]=a.useState(null),[o,j]=a.useState({name:"",email:"",role:"subscriber",username:""}),[l,J]=a.useState(()=>{const t=localStorage.getItem("users-visible-columns");return t?JSON.parse(t):{username:!0,name:!0,email:!0,role:!0,posts:!0,registeredDate:!0}}),[w,H]=a.useState(()=>{const t=localStorage.getItem("users-items-per-page");return t?parseInt(t):20});a.useEffect(()=>{(async()=>{try{L(!0);const s=await f.api.get("/v1/users"),r=s.data?.data?.users||s.data?.data||s.data||[];if(Array.isArray(r)&&r.length>0){const y=r.map(n=>({id:n.id||n._id,name:n.name||"Unknown",username:n.username||n.email?.split("@")[0]||"unknown",email:n.email||"",role:n.role||"subscriber",posts:n.postsCount||0,registeredDate:n.createdAt?new Date(n.createdAt).toISOString().split("T")[0]:"",lastLogin:n.lastLogin||n.lastLoginAt?new Date(n.lastLogin||n.lastLoginAt).toISOString().split("T")[0]:void 0,status:n.status||"active",avatar:n.avatar}));x(y)}else x([])}catch{Q("Failed to load users"),x([])}finally{L(!1)}})()},[]),a.useEffect(()=>{sessionStorage.setItem("users-active-tab",d)},[d]),a.useEffect(()=>{localStorage.setItem("users-visible-columns",JSON.stringify(l))},[l]),a.useEffect(()=>{localStorage.setItem("users-items-per-page",w.toString())},[w]),a.useEffect(()=>()=>{u.current&&clearTimeout(u.current)},[]);const T=b.filter(t=>{if(d!=="all"&&t.role!==d)return!1;if(U){const s=U.toLowerCase();return t.username.toLowerCase().includes(s)||t.name.toLowerCase().includes(s)||t.email.toLowerCase().includes(s)}return!0}),h=[...T].sort((t,s)=>{if(!m)return 0;let r=t[m],y=s[m];return typeof r=="string"&&typeof y=="string"?p==="asc"?r.localeCompare(y):y.localeCompare(r):0}).slice(0,w),S={all:b.length,administrator:b.filter(t=>t.role==="administrator").length,editor:b.filter(t=>t.role==="editor").length,subscriber:b.filter(t=>t.role==="subscriber").length},_=t=>{u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{O(t)},300)},G=()=>{u.current&&clearTimeout(u.current),O(null)},K=async()=>{if(!v){c.error("Please select a bulk action");return}if(i.size===0){c.error("Please select users first");return}if(v==="delete"){if(!confirm(`Are you sure you want to delete ${i.size} user(s)?`))return;try{await Promise.all(Array.from(i).map(t=>f.api.delete(`/api/v1/users/${t}`))),x(t=>t.filter(s=>!i.has(s.id))),g(new Set),c.success(`${i.size} user(s) deleted`)}catch{c.error("Failed to delete users")}}else if(v==="change-role"){const t=prompt("Enter new role (administrator, editor, subscriber):");if(!t)return;try{await Promise.all(Array.from(i).map(s=>f.api.patch(`/api/v1/users/${s}`,{role:t}))),x(s=>s.map(r=>i.has(r.id)?{...r,role:t}:r)),g(new Set),c.success(`Role changed for ${i.size} user(s)`)}catch{c.error("Failed to change roles")}}P("")},W=t=>{R(t.id),j({name:t.name,email:t.email,role:t.role,username:t.username})},X=async()=>{try{await f.api.patch(`/api/v1/users/${D}`,o),x(t=>t.map(s=>s.id===D?{...s,...o}:s)),R(null),c.success("User updated successfully")}catch{c.error("Failed to update user")}},C=t=>{m===t?$(p==="asc"?"desc":"asc"):(V(t),$("asc"))},Y=()=>{i.size===h.length?g(new Set):g(new Set(h.map(t=>t.id)))},Z=async t=>{if(confirm("Are you sure you want to delete this user?"))try{await f.api.delete(`/api/v1/users/${t}`),x(s=>s.filter(r=>r.id!==t)),c.success("User deleted successfully")}catch{c.error("Failed to delete user")}},z=t=>({administrator:{label:"Administrator",color:"text-red-600"},editor:{label:"Editor",color:"text-blue-600"},author:{label:"Author",color:"text-green-600"},contributor:{label:"Contributor",color:"text-purple-600"},subscriber:{label:"Subscriber",color:"text-gray-600"}})[t]||{label:t,color:"text-gray-600"};return F?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-600",children:"Loading users..."})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b px-8 py-3",children:e.jsx(re,{items:[{label:"Dashboard",path:"/"},{label:"Users",path:"/users"}]})}),e.jsxs("div",{className:"px-8 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-normal",children:"Users"}),e.jsx("button",{onClick:()=>E("/users/new"),className:"px-3 py-1 bg-white border border-gray-300 rounded text-sm hover:bg-gray-50",children:"Add New User"})]}),e.jsxs("ul",{className:"flex gap-2 text-sm mb-4",children:[e.jsx("li",{children:e.jsxs("button",{onClick:()=>N("all"),className:d==="all"?"font-medium":"text-blue-600 hover:text-blue-800",children:["All (",S.all,")"]})}),e.jsx("li",{className:"text-gray-400",children:"|"}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>N("administrator"),className:d==="administrator"?"font-medium":"text-blue-600 hover:text-blue-800",children:["Administrator (",S.administrator,")"]})}),e.jsx("li",{className:"text-gray-400",children:"|"}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>N("editor"),className:d==="editor"?"font-medium":"text-blue-600 hover:text-blue-800",children:["Editor (",S.editor,")"]})}),e.jsx("li",{className:"text-gray-400",children:"|"}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>N("subscriber"),className:d==="subscriber"?"font-medium":"text-blue-600 hover:text-blue-800",children:["Subscriber (",S.subscriber,")"]})})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:v,onChange:t=>P(t.target.value),className:"border border-gray-300 rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:"",children:"Bulk actions"}),e.jsx("option",{value:"delete",children:"Delete"}),e.jsx("option",{value:"change-role",children:"Change role"})]}),e.jsx("button",{onClick:K,className:"px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50",children:"Apply"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:U,onChange:t=>q(t.target.value),className:"pl-9 pr-3 py-1 border border-gray-300 rounded text-sm w-64"})]}),e.jsx("button",{className:"px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50",children:"Search"})]})]}),e.jsx("div",{className:"bg-white border rounded-lg",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50",children:[e.jsx("th",{className:"w-10 px-4 py-2 text-left",children:e.jsx("input",{type:"checkbox",checked:i.size===h.length&&h.length>0,onChange:Y,className:"rounded border-gray-300"})}),l.username&&e.jsx("th",{className:"px-4 py-2 text-left",children:e.jsxs("button",{onClick:()=>C("username"),className:"flex items-center gap-1 font-normal text-sm hover:text-blue-600",children:["Username",m==="username"&&(p==="asc"?e.jsx(k,{className:"w-3 h-3"}):e.jsx(A,{className:"w-3 h-3"}))]})}),l.name&&e.jsx("th",{className:"px-4 py-2 text-left",children:e.jsx("span",{className:"text-sm font-normal",children:"Name"})}),l.email&&e.jsx("th",{className:"px-4 py-2 text-left",children:e.jsxs("button",{onClick:()=>C("email"),className:"flex items-center gap-1 font-normal text-sm hover:text-blue-600",children:["Email",m==="email"&&(p==="asc"?e.jsx(k,{className:"w-3 h-3"}):e.jsx(A,{className:"w-3 h-3"}))]})}),l.role&&e.jsx("th",{className:"px-4 py-2 text-left",children:e.jsxs("button",{onClick:()=>C("role"),className:"flex items-center gap-1 font-normal text-sm hover:text-blue-600",children:["Role",m==="role"&&(p==="asc"?e.jsx(k,{className:"w-3 h-3"}):e.jsx(A,{className:"w-3 h-3"}))]})}),l.posts&&e.jsx("th",{className:"px-4 py-2 text-left",children:e.jsx("span",{className:"text-sm font-normal",children:"Posts"})}),l.registeredDate&&e.jsx("th",{className:"px-4 py-2 text-left",children:e.jsxs("button",{onClick:()=>C("registeredDate"),className:"flex items-center gap-1 font-normal text-sm hover:text-blue-600",children:["Date",m==="registeredDate"&&(p==="asc"?e.jsx(k,{className:"w-3 h-3"}):e.jsx(A,{className:"w-3 h-3"}))]})})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:Object.values(l).filter(t=>t).length+1,className:"px-4 py-8 text-center text-gray-500",children:"No users found"})}):h.map(t=>e.jsxs(se.Fragment,{children:[e.jsxs("tr",{className:"border-b hover:bg-gray-50 transition-colors",onMouseEnter:()=>_(t.id),onMouseLeave:G,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:i.has(t.id),onChange:s=>{const r=new Set(i);s.target.checked?r.add(t.id):r.delete(t.id),g(r)},className:"rounded border-gray-300"})}),l.username&&e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.avatar&&e.jsx("img",{src:t.avatar,alt:t.name,className:"w-8 h-8 rounded-full"}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>E(`/users/${t.id}/edit`),className:"text-blue-600 hover:text-blue-800 font-medium",children:t.username}),M===t.id&&e.jsxs("div",{className:"flex gap-2 mt-1 text-xs",children:[e.jsx("button",{onClick:()=>E(`/users/${t.id}/edit`),className:"text-blue-600 hover:text-blue-800",children:"Edit"}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsx("button",{onClick:()=>Z(t.id),className:"text-red-600 hover:text-red-800",children:"Delete"}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsx("button",{onClick:()=>W(t),className:"text-blue-600 hover:text-blue-800",children:"Quick Edit"})]})]})]})}),l.name&&e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:t.name}),l.email&&e.jsx("td",{className:"px-4 py-3",children:e.jsx("a",{href:`mailto:${t.email}`,className:"text-sm text-blue-600 hover:text-blue-800",children:t.email})}),l.role&&e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-sm ${z(t.role).color}`,children:z(t.role).label})}),l.posts&&e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:t.posts>0?e.jsx("button",{className:"text-blue-600 hover:text-blue-800",children:t.posts}):e.jsx("span",{className:"text-gray-400",children:"0"})}),l.registeredDate&&e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:t.registeredDate})]}),D===t.id&&e.jsx("tr",{className:"bg-gray-50 border-b",children:e.jsx("td",{colSpan:Object.values(l).filter(s=>s).length+1,className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Username"}),e.jsx("input",{type:"text",value:o.username,onChange:s=>j({...o,username:s.target.value}),className:"px-2 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:o.name,onChange:s=>j({...o,name:s.target.value}),className:"px-2 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:o.email,onChange:s=>j({...o,email:s.target.value}),className:"px-2 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Role"}),e.jsxs("select",{value:o.role,onChange:s=>j({...o,role:s.target.value}),className:"px-2 py-1 border border-gray-300 rounded text-sm",children:[e.jsx("option",{value:"administrator",children:"Administrator"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"author",children:"Author"}),e.jsx("option",{value:"contributor",children:"Contributor"}),e.jsx("option",{value:"subscriber",children:"Subscriber"})]})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{onClick:X,className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"Update"}),e.jsx("button",{onClick:()=>R(null),className:"px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50",children:"Cancel"})]})]})})})]},t.id))})]})}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[h.length," of ",T.length," items"]}),e.jsxs("div",{className:"fixed bottom-4 right-4",children:[e.jsxs("button",{onClick:()=>B(!I),className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-lg hover:bg-gray-50",children:[e.jsx(ae,{className:"w-4 h-4"}),"Screen Options"]}),I&&e.jsxs("div",{className:"absolute bottom-full right-0 mb-2 p-4 bg-white border rounded-lg shadow-xl w-80",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Screen Options"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Columns"}),e.jsx("div",{className:"space-y-2",children:Object.entries({username:"Username",name:"Name",email:"Email",role:"Role",posts:"Posts",registeredDate:"Date"}).map(([t,s])=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:l[t],onChange:r=>J({...l,[t]:r.target.checked}),className:"rounded border-gray-300"}),s]},t))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Pagination"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Number of items per page:"}),e.jsx("input",{type:"number",value:w,onChange:t=>H(parseInt(t.target.value)||20),className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm"})]})]})]})]})]})]})};function be(){return e.jsx(le,{})}export{be as default};
//# sourceMappingURL=index-D5YgS6SL.js.map
