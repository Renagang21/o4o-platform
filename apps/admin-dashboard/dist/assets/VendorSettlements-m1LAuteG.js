import{r as m,j as e,cI as z,Z as L,bV as K,s as Q,bF as V,S as _,V as p}from"./vendor-react-CMQx0Rxg.js";import{u as H,a as Z,b}from"./vendor-query-B9kD0akd.js";import{B as l,C as i,k as h,l as u,m as c,I,w as G,x as J,y as W,z as X,E as Y,L as ee,F as se,j as N,s as o}from"./page-gutenberg-Bg9cnlWs.js";import"./wp-all-CpKe89B2.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-monaco-cpVGocfO.js";import"./vendor-utils-DQ8F5vJI.js";const ce=()=>{const w=H(),[j,M]=m.useState(""),[v,P]=m.useState("all"),[n,x]=m.useState([]),[U,g]=m.useState(!1),[k,S]=m.useState(""),{data:B,isLoading:E}=Z({queryKey:["vendor-settlements",j,v],queryFn:async()=>{const s=new URLSearchParams;return j&&s.append("search",j),v!=="all"&&s.append("status",v),(await N.api.get(`/v1/settlements/vendors?${s}`)).data}}),r=B?.data||[],C=b({mutationFn:async s=>(await N.api.post("/v1/settlements/vendors/approve-bulk",s)).data,onSuccess:()=>{p.success("정산이 승인되었습니다"),w.invalidateQueries({queryKey:["vendor-settlements"]}),x([]),g(!1),S("")},onError:()=>{p.error("정산 승인 중 오류가 발생했습니다")}}),y=b({mutationFn:async({id:s,action:t,memo:a})=>(await N.api.post(`/v1/settlements/vendors/${s}/${t}`,{memo:a})).data,onSuccess:(s,t)=>{const a=t.action==="approve"?"승인":t.action==="reject"?"거부":"처리";p.success(`정산이 ${a}되었습니다`),w.invalidateQueries({queryKey:["vendor-settlements"]})}}),D=b({mutationFn:async s=>(await N.api.post("/v1/settlements/vendors/export",{settlementIds:s},{responseType:"blob"})).data,onSuccess:s=>{const t=window.URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`settlements_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t),p.success("정산 데이터가 다운로드되었습니다")}}),R=s=>{switch(s){case"pending":return e.jsx(o,{variant:"outline",className:"text-orange-600 border-orange-600",children:"승인 대기"});case"approved":return e.jsx(o,{variant:"outline",className:"text-blue-600 border-blue-600",children:"승인됨"});case"processing":return e.jsx(o,{variant:"outline",className:"text-purple-600 border-purple-600",children:"처리중"});case"completed":return e.jsx(o,{children:"완료"});case"failed":return e.jsx(o,{variant:"secondary",children:"실패"});default:return e.jsx(o,{variant:"outline",children:s})}},d=s=>`₩${s.toLocaleString()}`,f=s=>new Date(s).toLocaleDateString("ko-KR"),T=()=>{if(n.length===0){p.error("승인할 정산을 선택하세요");return}g(!0)},q=()=>{const t=r.filter(a=>n.includes(a.id)).reduce((a,F)=>a+F.netAmount,0);C.mutate({settlementIds:n,totalAmount:t,memo:k})},O=()=>{const s=n.length>0?n:r.map(t=>t.id);D.mutate(s)},A=r.filter(s=>s.status==="pending"),$=A.reduce((s,t)=>s+t.netAmount,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"판매자 정산 관리"}),e.jsx("p",{className:"text-modern-text-secondary mt-1",children:"판매자별 정산 승인 및 처리"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",onClick:O,disabled:D.isPending,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"엑셀 다운로드"]}),e.jsxs(l,{onClick:T,disabled:n.length===0,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"일괄 승인 (",n.length,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(i,{children:[e.jsx(h,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"승인 대기"]})}),e.jsxs(c,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[A.length,"건"]}),e.jsx("div",{className:"text-xs text-modern-text-tertiary mt-1",children:d($)})]})]}),e.jsxs(i,{children:[e.jsx(h,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"완료"]})}),e.jsxs(c,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[r.filter(s=>s.status==="completed").length,"건"]}),e.jsx("div",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]}),e.jsxs(i,{children:[e.jsx(h,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"정산 판매자"]})}),e.jsx(c,{children:e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[new Set(r.map(s=>s.vendorId)).size,"명"]})})]}),e.jsxs(i,{children:[e.jsx(h,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"총 정산 금액"]})}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-modern-text-primary",children:d(r.reduce((s,t)=>s+t.netAmount,0))})})]})]}),e.jsx(i,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-modern-text-tertiary w-4 h-4"}),e.jsx(I,{placeholder:"판매자명, 이메일로 검색...",value:j,onChange:s=>M(s.target.value),className:"pl-10"})]})}),e.jsxs("select",{value:v,onChange:s=>P(s.target.value),className:"px-4 py-2 border border-modern-border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-modern-primary",children:[e.jsx("option",{value:"all",children:"모든 상태"}),e.jsx("option",{value:"pending",children:"승인 대기"}),e.jsx("option",{value:"approved",children:"승인됨"}),e.jsx("option",{value:"processing",children:"처리중"}),e.jsx("option",{value:"completed",children:"완료"}),e.jsx("option",{value:"failed",children:"실패"})]})]})})}),e.jsxs(i,{children:[e.jsx(h,{children:e.jsx(u,{children:"정산 목록"})}),e.jsx(c,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-modern-bg-tertiary border-b border-modern-border-primary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",onChange:s=>{s.target.checked?x(r.map(t=>t.id)):x([])},checked:n.length===r.length&&r.length>0})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"판매자"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"정산 기간"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"매출액"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"수수료"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"정산액"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상태"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"요청일"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-modern-border-primary",children:E?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-8 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-modern-primary"})})})}):r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-8 text-center text-modern-text-secondary",children:"정산 데이터가 없습니다."})}):r.map(s=>e.jsxs("tr",{className:"hover:bg-modern-bg-hover",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:n.includes(s.id),onChange:t=>{t.target.checked?x([...n,s.id]):x(n.filter(a=>a!==s.id))}})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:s.vendorName}),e.jsx("div",{className:"text-sm text-modern-text-secondary",children:s.vendorEmail})]})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{className:"text-sm text-modern-text-primary",children:[f(s.settlementPeriod.startDate)," ~ ",f(s.settlementPeriod.endDate)]}),e.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:[s.orderCount,"건 주문"]})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:d(s.totalSales)})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["플랫폼: ",d(s.platformFee)]}),e.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:["토스: ",d(s.tossFee)]})]}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-green-600",children:d(s.netAmount)}),s.taxAmount>0&&e.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:["세금: ",d(s.taxAmount)]})]}),e.jsx("td",{className:"px-4 py-4",children:R(s.status)}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm text-modern-text-secondary",children:f(s.requestedAt)})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{size:"sm",onClick:()=>y.mutate({id:s.id,action:"approve"}),disabled:y.isPending,children:"승인"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>y.mutate({id:s.id,action:"reject"}),disabled:y.isPending,children:"거부"})]}),s.receiptUrl&&e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>window.open(s.receiptUrl,"_blank"),children:"영수증"})]})})]},s.id))})]})})})]}),e.jsx(G,{open:U,onOpenChange:g,children:e.jsxs(J,{children:[e.jsxs(W,{children:[e.jsx(X,{children:"정산 일괄 승인"}),e.jsxs(Y,{children:["선택한 ",n.length,"건의 정산을 승인하시겠습니까?"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"p-4 bg-modern-bg-secondary rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-modern-text-secondary mb-2",children:"승인 요약"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"총 정산건수"}),e.jsxs("span",{className:"font-medium",children:[n.length,"건"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"총 정산금액"}),e.jsx("span",{className:"font-medium text-green-600",children:d(r.filter(s=>n.includes(s.id)).reduce((s,t)=>s+t.netAmount,0))})]})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"approvalMemo",children:"메모 (선택)"}),e.jsx(I,{id:"approvalMemo",value:k,onChange:s=>S(s.target.value),placeholder:"승인 관련 메모를 입력하세요"})]})]}),e.jsxs(se,{children:[e.jsx(l,{variant:"outline",onClick:()=>g(!1),children:"취소"}),e.jsx(l,{onClick:q,disabled:C.isPending,children:"승인 확정"})]})]})})]})};export{ce as default};
