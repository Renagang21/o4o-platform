import{u as e,b as t,r as s,V as a,j as r,A as i,b0 as n,dm as d,aT as c,S as o}from"./vendor-react-BqkIXTmC.js";import{u as l,a as m,b as p}from"./vendor-query-C5jzPyjL.js";import{b as x,B as j,L as u,I as h,T as g}from"./page-template-editor-DmUXhR56.js";import{cF as f,cG as v,cH as w,cI as D}from"./wp-misc-D0_U3Yh3.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-C9jLuAcl.js";import"./wp-blocks-core-C_Umt3qd.js";import"./wp-block-editor-main-DEdKEcH7.js";import"./wp-block-editor-store-Cdz5rmmV.js";import"./wp-block-editor-utils-CmROb2t9.js";import"./wp-i18n-DP14Ry5v.js";import"./wp-core-skmJSxj5.js";import"./wp-components-i3qvAB06.js";import"./wp-api-Dq90bqIA.js";import"./wp-data-CsLR-lZb.js";const y=()=>{const y=e(),{id:N}=t(),b=l(),C=!!N,[P,k]=s.useState({title:"",description:"",targetParticipantCount:10,startDate:"",endDate:"",forumLink:""}),[F,L]=s.useState({}),{data:S,isLoading:q}=m({queryKey:["crowdfunding-project",N],queryFn:async()=>(await x.api.get(`/v1/crowdfunding-simple/projects/${N}`)).data,enabled:C}),$=p({mutationFn:async e=>(await x.api.post("/v1/crowdfunding-simple/projects",e)).data,onSuccess:()=>{a.success("프로젝트가 생성되었습니다!"),b.invalidateQueries({queryKey:["crowdfunding-projects"]}),y("/crowdfunding/projects")},onError:e=>{a.error(e.response?.data?.error||"프로젝트 생성에 실패했습니다.")}}),I=p({mutationFn:async e=>(await x.api.put(`/v1/crowdfunding-simple/projects/${N}`,e)).data,onSuccess:()=>{a.success("프로젝트가 수정되었습니다!"),b.invalidateQueries({queryKey:["crowdfunding-project",N]}),b.invalidateQueries({queryKey:["crowdfunding-projects"]}),y(`/crowdfunding/projects/${N}`)},onError:e=>{a.error(e.response?.data?.error||"프로젝트 수정에 실패했습니다.")}});s.useEffect(()=>{if(S?.data){const e=S.data;k({title:e.title,description:e.description,targetParticipantCount:e.targetParticipantCount,startDate:e.startDate,endDate:e.endDate,forumLink:e.forumLink||""})}},[S]);const K=(e,t)=>{k(s=>({...s,[e]:t})),F[e]&&L(t=>({...t,[e]:void 0}))},E=(new Date).toISOString().split("T")[0];return C&&q?r.jsx("div",{className:"flex items-center justify-center h-96",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):r.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>y(C?`/crowdfunding/projects/${N}`:"/crowdfunding/projects"),children:[r.jsx(i,{className:"w-4 h-4 mr-2"}),C?"프로젝트 상세":"프로젝트 목록"]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:C?"프로젝트 수정":"새 프로젝트 만들기"})})]}),r.jsxs("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e={};return P.title.trim()||(e.title="프로젝트 제목을 입력하세요."),P.description.trim()||(e.description="프로젝트 설명을 입력하세요."),P.targetParticipantCount<1&&(e.targetParticipantCount="목표 참여 매장 수는 1개 이상이어야 합니다."),P.startDate||(e.startDate="시작일을 선택하세요."),P.endDate||(e.endDate="종료일을 선택하세요."),P.startDate&&P.endDate&&P.startDate>=P.endDate&&(e.endDate="종료일은 시작일보다 늦어야 합니다."),P.startDate&&new Date(P.startDate)<new Date&&(e.startDate="시작일은 현재 날짜 이후여야 합니다."),L(e),0===Object.keys(e).length})()?C?I.mutate(P):$.mutate(P):a.error("입력한 정보를 확인해주세요.")},className:"space-y-6",children:[r.jsxs(f,{children:[r.jsx(v,{children:r.jsxs(w,{className:"flex items-center gap-2",children:[r.jsx(n,{className:"w-5 h-5 text-modern-primary"}),"프로젝트 기본 정보"]})}),r.jsxs(D,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(u,{htmlFor:"title",children:"프로젝트 제목 *"}),r.jsx(h,{id:"title",value:P.title,onChange:e=>K("title",e.target.value),placeholder:"예: 친환경 포장재 대량 구매 프로젝트",className:F.title?"border-red-500":""}),F.title&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.title})]}),r.jsxs("div",{children:[r.jsx(u,{htmlFor:"description",children:"프로젝트 설명 *"}),r.jsx(g,{id:"description",value:P.description,onChange:e=>K("description",e.target.value),placeholder:"프로젝트의 목적, 혜택, 예상 절감 비용 등을 상세히 설명해주세요...",rows:8,className:F.description?"border-red-500":""}),F.description&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.description}),r.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:"참여 매장이 이해하기 쉽도록 구체적인 혜택과 절감 효과를 포함해주세요."})]})]})]}),r.jsxs(f,{children:[r.jsx(v,{children:r.jsxs(w,{className:"flex items-center gap-2",children:[r.jsx(d,{className:"w-5 h-5 text-modern-primary"}),"목표 및 기간 설정"]})}),r.jsxs(D,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(u,{htmlFor:"targetParticipantCount",children:"목표 참여 매장 수 *"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(h,{id:"targetParticipantCount",type:"number",min:"1",max:"1000",value:P.targetParticipantCount,onChange:e=>K("targetParticipantCount",parseInt(e.target.value)||0),className:"max-w-xs "+(F.targetParticipantCount?"border-red-500":"")}),r.jsx("span",{className:"text-modern-text-secondary",children:"개 매장"})]}),F.targetParticipantCount&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.targetParticipantCount}),r.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:"목표를 달성하면 비용 절감 효과를 얻을 수 있는 최소 참여 매장 수를 설정하세요."})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx(u,{htmlFor:"startDate",children:"프로젝트 시작일 *"}),r.jsx(h,{id:"startDate",type:"date",min:E,value:P.startDate,onChange:e=>K("startDate",e.target.value),className:F.startDate?"border-red-500":""}),F.startDate&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.startDate})]}),r.jsxs("div",{children:[r.jsx(u,{htmlFor:"endDate",children:"프로젝트 종료일 *"}),r.jsx(h,{id:"endDate",type:"date",min:P.startDate||E,value:P.endDate,onChange:e=>K("endDate",e.target.value),className:F.endDate?"border-red-500":""}),F.endDate&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:F.endDate})]})]})]})]}),r.jsxs(f,{children:[r.jsx(v,{children:r.jsxs(w,{className:"flex items-center gap-2",children:[r.jsx(c,{className:"w-5 h-5 text-modern-primary"}),"추가 설정"]})}),r.jsx(D,{className:"space-y-4",children:r.jsxs("div",{children:[r.jsx(u,{htmlFor:"forumLink",children:"포럼 링크 (선택)"}),r.jsx(h,{id:"forumLink",value:P.forumLink,onChange:e=>K("forumLink",e.target.value),placeholder:"/forum/posts/project-discussion"}),r.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:"참여자들이 토론할 수 있는 포럼 페이지 링크를 입력하세요."})]})})]}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx(j,{type:"button",variant:"outline",onClick:()=>y(C?`/crowdfunding/projects/${N}`:"/crowdfunding/projects"),children:"취소"}),r.jsxs(j,{type:"submit",disabled:$.isPending||I.isPending,children:[r.jsx(o,{className:"w-4 h-4 mr-2"}),$.isPending||I.isPending?"저장 중...":C?"수정하기":"프로젝트 만들기"]})]})]})]})};export{y as default};
