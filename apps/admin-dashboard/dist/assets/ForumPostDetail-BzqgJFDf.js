import{b as e,u as s,r as a,V as t,j as i,A as r,dv as n,c5 as c,bc as l,E as d,cs as m,b9 as o,b8 as x,dw as u}from"./vendor-react-BqkIXTmC.js";import{u as p,a as h,b as j}from"./vendor-query-C5jzPyjL.js";import{b as v,B as f,T as N}from"./page-template-editor-DmUXhR56.js";import{cQ as y,cJ as w,cK as g,cL as b,cO as k}from"./wp-misc-D0_U3Yh3.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-C9jLuAcl.js";import"./wp-blocks-core-C_Umt3qd.js";import"./wp-block-editor-main-DEdKEcH7.js";import"./wp-block-editor-store-Cdz5rmmV.js";import"./wp-block-editor-utils-CmROb2t9.js";import"./wp-i18n-DP14Ry5v.js";import"./wp-core-skmJSxj5.js";import"./wp-components-i3qvAB06.js";import"./wp-api-Dq90bqIA.js";import"./wp-data-CsLR-lZb.js";const C=()=>{const{id:C}=e(),q=s(),z=p(),[L,S]=a.useState(""),[K,F]=a.useState(null),[$,P]=a.useState(null),[Q,A]=a.useState(""),{data:I,isLoading:D}=h({queryKey:["forum-post",C],queryFn:async()=>(await v.api.get(`/v1/forum/posts/${C}`)).data}),E=I?.data,{data:B,isLoading:J}=h({queryKey:["forum-comments",C],queryFn:async()=>(await v.api.get(`/v1/forum/posts/${C}/comments`)).data}),O=B?.data||[],R=j({mutationFn:async e=>(await v.api.post(`/v1/forum/posts/${C}/comments`,e)).data,onSuccess:()=>{t.success("댓글이 작성되었습니다"),S(""),F(null),z.invalidateQueries({queryKey:["forum-comments",C]})}}),T=j({mutationFn:async({commentId:e,content:s})=>(await v.api.put(`/v1/forum/comments/${e}`,{content:s})).data,onSuccess:()=>{t.success("댓글이 수정되었습니다"),P(null),A(""),z.invalidateQueries({queryKey:["forum-comments",C]})}}),V=j({mutationFn:async e=>(await v.api.delete(`/v1/forum/comments/${e}`)).data,onSuccess:()=>{t.success("댓글이 삭제되었습니다"),z.invalidateQueries({queryKey:["forum-comments",C]})}}),G=j({mutationFn:async()=>(await v.api.post(`/v1/forum/posts/${C}/toggle-pin`)).data,onSuccess:()=>{t.success(E?.isPinned?"고정이 해제되었습니다":"게시글이 고정되었습니다"),z.invalidateQueries({queryKey:["forum-post",C]})}}),H=j({mutationFn:async()=>(await v.api.post(`/v1/forum/posts/${C}/toggle-lock`)).data,onSuccess:()=>{t.success(E?.isLocked?"잠금이 해제되었습니다":"게시글이 잠금되었습니다"),z.invalidateQueries({queryKey:["forum-post",C]})}}),M=e=>{L.trim()&&R.mutate({content:L,parentId:e})},U=e=>new Date(e).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=(e,s=0)=>{const a=$===e.id;return i.jsxs("div",{className:""+(s>0?"ml-12":""),children:[i.jsxs("div",{className:"bg-white p-4 rounded-lg border border-modern-border-primary mb-4",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-modern-primary text-white rounded-full flex items-center justify-center text-sm font-medium",children:e.author.name.charAt(0)}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"font-medium text-modern-text-primary",children:e.author.name}),i.jsx(y,{variant:"outline",className:"text-xs",children:e.author.role})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-modern-text-secondary",children:[i.jsx("span",{children:U(e.createdAt)}),e.isEdited&&i.jsx("span",{children:"(수정됨)"})]})]})]}),i.jsxs(w,{children:[i.jsx(g,{children:i.jsx(f,{variant:"ghost",size:"sm",children:i.jsx(o,{className:"w-4 h-4"})})}),i.jsxs(b,{align:"end",children:[i.jsxs(k,{onClick:()=>{P(e.id),A(e.content)},children:[i.jsx(l,{className:"w-4 h-4 mr-2"}),"수정"]}),i.jsxs(k,{className:"text-destructive",onClick:()=>{confirm("정말 삭제하시겠습니까?")&&V.mutate(e.id)},children:[i.jsx(x,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]}),a?i.jsxs("div",{className:"space-y-3",children:[i.jsx(N,{value:Q,onChange:e=>A(e.target.value),rows:3,className:"w-full"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(f,{size:"sm",onClick:()=>{return s=e.id,void(Q.trim()&&T.mutate({commentId:s,content:Q}));var s},disabled:T.isPending,children:"수정 완료"}),i.jsx(f,{size:"sm",variant:"outline",onClick:()=>{P(null),A("")},children:"취소"})]})]}):i.jsxs(i.Fragment,{children:[i.jsx("p",{className:"text-modern-text-primary mb-3 whitespace-pre-wrap",children:e.content}),!E?.isLocked&&i.jsxs(f,{size:"sm",variant:"ghost",onClick:()=>{F(e.id),S("")},children:[i.jsx(u,{className:"w-4 h-4 mr-2"}),"답글"]})]})]}),K===e.id&&!E?.isLocked&&i.jsxs("div",{className:"ml-12 mb-4",children:[i.jsx(N,{value:L,onChange:e=>S(e.target.value),placeholder:"답글을 작성하세요...",rows:3,className:"w-full mb-2"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(f,{size:"sm",onClick:()=>M(e.id),disabled:R.isPending,children:"답글 작성"}),i.jsx(f,{size:"sm",variant:"outline",onClick:()=>{F(null),S("")},children:"취소"})]})]}),e.replies&&e.replies.map(e=>W(e,s+1))]},e.id)};return D?i.jsx("div",{className:"flex items-center justify-center h-96",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):E?i.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>q("/forum"),children:[i.jsx(r,{className:"w-4 h-4 mr-2"}),"게시판 목록"]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(f,{variant:"outline",size:"sm",onClick:()=>G.mutate(),children:[i.jsx(n,{className:"w-4 h-4 mr-2"}),E.isPinned?"고정 해제":"고정"]}),i.jsxs(f,{variant:"outline",size:"sm",onClick:()=>H.mutate(),children:[i.jsx(c,{className:"w-4 h-4 mr-2"}),E.isLocked?"잠금 해제":"잠금"]}),i.jsxs(f,{variant:"outline",size:"sm",onClick:()=>q(`/forum/posts/${C}/edit`),children:[i.jsx(l,{className:"w-4 h-4 mr-2"}),"수정"]})]})]}),i.jsx("div",{className:"wp-card",children:i.jsx("div",{className:"wp-card-body",children:i.jsxs("div",{className:"mb-6",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[E.isPinned&&i.jsx(y,{variant:"secondary",children:"고정"}),E.isLocked&&i.jsx(y,{variant:"outline",children:"잠김"}),i.jsx(y,{variant:"outline",children:E.category.name}),"reported"===E.status&&i.jsx(y,{variant:"destructive",children:"신고됨"})]}),i.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary mb-4",children:E.title}),i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 bg-modern-primary text-white rounded-full flex items-center justify-center text-lg font-medium",children:E.author.name.charAt(0)}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-modern-text-primary",children:E.author.name}),i.jsx("p",{className:"text-sm text-modern-text-secondary",children:U(E.createdAt)})]})]}),i.jsxs("div",{className:"flex items-center gap-4 text-sm text-modern-text-secondary",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(d,{className:"w-4 h-4"}),i.jsxs("span",{children:[E.views," 조회"]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(m,{className:"w-4 h-4"}),i.jsxs("span",{children:[E.replyCount," 댓글"]})]})]})]}),i.jsx("div",{className:"prose prose-modern max-w-none",children:i.jsx("div",{className:"whitespace-pre-wrap text-modern-text-primary",children:E.content})})]})})}),i.jsxs("div",{className:"wp-card",children:[i.jsx("div",{className:"wp-card-header",children:i.jsxs("h2",{className:"text-lg font-semibold",children:["댓글 ",O.length,"개"]})}),i.jsxs("div",{className:"wp-card-body",children:[!E.isLocked&&i.jsxs("div",{className:"mb-6",children:[i.jsx(N,{value:L,onChange:e=>S(e.target.value),placeholder:"댓글을 작성하세요...",rows:4,className:"w-full mb-2"}),i.jsx(f,{onClick:()=>M(),disabled:R.isPending||!L.trim(),children:"댓글 작성"})]}),J?i.jsx("div",{className:"text-center py-8",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary mx-auto"})}):0===O.length?i.jsx("p",{className:"text-center text-modern-text-secondary py-8",children:"아직 댓글이 없습니다."}):i.jsx("div",{className:"space-y-4",children:O.map(e=>W(e))})]})]})]}):i.jsx("div",{className:"text-center py-12",children:i.jsx("p",{className:"text-modern-text-secondary",children:"게시글을 찾을 수 없습니다."})})};export{C as default};
