import{r as e,j as s,b6 as i,b8 as r,C as t,aB as a,bc as o,V as l}from"./vendor-react-DqgGMt48.js";import{u as n,a as d,b as c}from"./vendor-query-D_c3FRkE.js";import{B as p,L as m,I as h,T as x,m as j,b as u}from"./page-template-editor-5uesjTWI.js";import{cF as g,cG as v,cH as y,cR as b,cI as w,cU as k,cV as N,cW as f,cX as S,cY as C,cZ as F}from"./wp-misc-DyLrwF9p.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-C9jLuAcl.js";import"./wp-blocks-core-65VcejHr.js";import"./wp-block-editor-misc-Bvzg-2Jv.js";import"./wp-core-BVMytgUH.js";import"./wp-block-editor-api-MRWBPx9C.js";import"./wp-block-editor-store-BOagVFfu.js";import"./wp-block-editor-clipboard-D5sqncpm.js";import"./wp-i18n-BuBz6Sgx.js";import"./wp-block-editor-global-styles-DFEUywv4.js";import"./wp-block-editor-typography-D5fCIzVQ.js";import"./wp-components-Uj2D7Nfy.js";import"./wp-block-editor-spacing-CY2h70rf.js";import"./wp-block-editor-menus-CucXu4UM.js";import"./wp-block-editor-core-BF86nm2P.js";import"./wp-block-editor-utils-BmaAXcuk.js";import"./wp-block-editor-colors-60WWD1Za.js";import"./wp-block-editor-a11y-BVzCbFSD.js";import"./wp-block-editor-preview-WXXja22U.js";import"./wp-block-editor-borders-C-QIiBvP.js";import"./wp-block-editor-formats--rvRJrSX.js";import"./wp-block-editor-selection-DBFjOmhH.js";import"./wp-block-editor-inline-CtEBI-J7.js";import"./wp-block-editor-ui-DwG3jajt.js";import"./wp-block-editor-transforms-Bg08EtRt.js";import"./wp-block-editor-patterns-DIcm1rGW.js";import"./wp-block-editor-navigation-ufXSM7dn.js";import"./wp-block-editor-dnd-yPphmZPp.js";import"./wp-block-editor-media-CatADaW3.js";import"./wp-api-COhbxmzY.js";import"./wp-block-editor-keyboard-3DDntAoE.js";import"./wp-block-editor-templates-C6YLNdWR.js";import"./wp-data-CL-okzN5.js";const P=()=>{const P=n(),[q,T]=e.useState(new Set),[I,z]=e.useState(!1),[K,E]=e.useState(null),[L,O]=e.useState({name:"",slug:"",description:"",parentId:void 0,active:!0,attributes:[],shippingPolicy:{freeShippingThreshold:5e4,baseShippingFee:3e3},seo:{title:"",description:"",keywords:""}}),[D,$]=e.useState({key:"",label:"",type:"text",required:!1}),{data:B,isLoading:Q}=d({queryKey:["product-categories"],queryFn:async()=>(await u.api.get("/v1/ecommerce/categories/tree")).data}),V=B?.data||[],A=c({mutationFn:async e=>(await u.api.post("/v1/ecommerce/categories",e)).data,onSuccess:()=>{l.success("카테고리가 생성되었습니다"),P.invalidateQueries({queryKey:["product-categories"]}),U()}}),G=c({mutationFn:async({id:e,data:s})=>(await u.api.put(`/v1/ecommerce/categories/${e}`,s)).data,onSuccess:()=>{l.success("카테고리가 수정되었습니다"),P.invalidateQueries({queryKey:["product-categories"]}),U()}}),H=c({mutationFn:async e=>(await u.api.delete(`/v1/ecommerce/categories/${e}`)).data,onSuccess:()=>{l.success("카테고리가 삭제되었습니다"),P.invalidateQueries({queryKey:["product-categories"]})}}),R=(e,s)=>{e?(E(e),O({name:e.name,slug:e.slug,description:e.description||"",parentId:e.parentId,active:e.active,attributes:e.attributes||[],shippingPolicy:{freeShippingThreshold:e.shippingPolicy?.freeShippingThreshold||5e4,baseShippingFee:e.shippingPolicy?.baseShippingFee||3e3},seo:{title:e.seo?.title||"",description:e.seo?.description||"",keywords:e.seo?.keywords?.join(", ")||""}})):(E(null),O({name:"",slug:"",description:"",parentId:s,active:!0,attributes:[],shippingPolicy:{freeShippingThreshold:5e4,baseShippingFee:3e3},seo:{title:"",description:"",keywords:""}})),z(!0)},U=()=>{z(!1),E(null),O({name:"",slug:"",description:"",parentId:void 0,active:!0,attributes:[],shippingPolicy:{freeShippingThreshold:5e4,baseShippingFee:3e3},seo:{title:"",description:"",keywords:""}}),$({key:"",label:"",type:"text",required:!1})},W=(e,n=0)=>{const d=e.children&&e.children.length>0,c=q.has(e.id);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-modern-bg-hover border-b border-modern-border-primary "+(n>0?"ml-"+8*n:""),style:{marginLeft:2*n+"rem"},children:[s.jsxs("div",{className:"flex items-center gap-3",children:[d&&s.jsx("button",{onClick:()=>(e=>{const s=new Set(q);s.has(e)?s.delete(e):s.add(e),T(s)})(e.id),className:"p-1 hover:bg-modern-bg-tertiary rounded",children:c?s.jsx(t,{className:"w-4 h-4"}):s.jsx(a,{className:"w-4 h-4"})}),!d&&s.jsx("div",{className:"w-6"}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h4",{className:"font-medium text-modern-text-primary",children:e.name}),s.jsxs("span",{className:"text-xs text-modern-text-secondary",children:["/",e.slug]}),!e.active&&s.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:"비활성"})]}),e.description&&s.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:e.description}),s.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[s.jsxs("span",{className:"text-xs text-modern-text-tertiary",children:["상품 ",e.productCount,"개"]}),e.shippingPolicy&&s.jsxs("span",{className:"text-xs text-modern-text-tertiary",children:["무료배송 ",(e.shippingPolicy.freeShippingThreshold||0).toLocaleString(),"원 이상"]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>R(void 0,e.id),children:[s.jsx(i,{className:"w-4 h-4"}),"하위 추가"]}),s.jsx(p,{variant:"ghost",size:"sm",onClick:()=>R(e),children:s.jsx(o,{className:"w-4 h-4"})}),s.jsx(p,{variant:"ghost",size:"sm",onClick:()=>(e=>{e.children&&e.children.length>0?l.error("하위 카테고리가 있는 카테고리는 삭제할 수 없습니다"):e.productCount>0?l.error("상품이 등록된 카테고리는 삭제할 수 없습니다"):confirm(`"${e.name}" 카테고리를 삭제하시겠습니까?`)&&H.mutate(e.id)})(e),disabled:e.productCount>0||e.children&&e.children.length>0,children:s.jsx(r,{className:"w-4 h-4 text-destructive"})})]})]}),d&&c&&s.jsx("div",{children:e.children.map(e=>W(e,n+1))})]},e.id)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"상품 카테고리"}),s.jsx("p",{className:"text-modern-text-secondary mt-1",children:"다단계 카테고리 구조를 관리하고 속성을 설정하세요."})]}),s.jsxs(p,{onClick:()=>R(),children:[s.jsx(i,{className:"w-4 h-4 mr-2"}),"최상위 카테고리"]})]}),s.jsxs(g,{children:[s.jsxs(v,{children:[s.jsx(y,{children:"카테고리 구조"}),s.jsx(b,{children:"드래그앤드롭으로 순서를 변경하고, 카테고리별 속성과 배송 정책을 설정하세요."})]}),s.jsx(w,{className:"p-0",children:Q?s.jsx("div",{className:"p-12 text-center",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary mx-auto"})}):0===V.length?s.jsx("div",{className:"p-12 text-center text-modern-text-secondary",children:"카테고리가 없습니다. 새 카테고리를 추가하세요."}):s.jsx("div",{children:V.map(e=>W(e))})})]}),s.jsx(k,{open:I,onOpenChange:z,children:s.jsx(N,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:s.jsxs("form",{onSubmit:e=>{e.preventDefault();const s={...L,seo:{...L.seo,keywords:L.seo.keywords.split(",").map(e=>e.trim()).filter(e=>e)}};K?G.mutate({id:K.id,data:s}):A.mutate(s)},children:[s.jsxs(f,{children:[s.jsx(S,{children:K?"카테고리 수정":"새 카테고리"}),s.jsx(C,{children:"카테고리 정보와 속성을 설정하세요."})]}),s.jsxs("div",{className:"space-y-6 py-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium text-modern-text-primary",children:"기본 정보"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(m,{htmlFor:"name",children:"카테고리명 *"}),s.jsx(h,{id:"name",value:L.name,onChange:e=>{O(s=>{return{...s,name:e.target.value,slug:K?s.slug:(i=e.target.value,i.toLowerCase().replace(/[^a-z0-9가-힣]+/g,"-").replace(/^-+|-+$/g,""))};var i})},placeholder:"예: 전자제품",required:!0})]}),s.jsxs("div",{children:[s.jsx(m,{htmlFor:"slug",children:"Slug"}),s.jsx(h,{id:"slug",value:L.slug,onChange:e=>O(s=>({...s,slug:e.target.value})),placeholder:"예: electronics"})]})]}),s.jsxs("div",{children:[s.jsx(m,{htmlFor:"description",children:"설명"}),s.jsx(x,{id:"description",value:L.description,onChange:e=>O(s=>({...s,description:e.target.value})),placeholder:"카테고리에 대한 설명을 입력하세요...",rows:3})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx(m,{htmlFor:"active",children:"활성화"}),s.jsx("p",{className:"text-sm text-modern-text-secondary",children:"비활성화 시 상품 등록이 불가능합니다"})]}),s.jsx(j,{id:"active",checked:L.active,onCheckedChange:e=>O(s=>({...s,active:e}))})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium text-modern-text-primary",children:"카테고리 속성"}),s.jsx("p",{className:"text-sm text-modern-text-secondary",children:"이 카테고리의 상품에 필요한 속성을 정의하세요."}),s.jsx("div",{className:"space-y-2",children:L.attributes.map((e,i)=>s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-modern-bg-tertiary rounded",children:[s.jsx("span",{className:"font-medium",children:e.label}),s.jsxs("span",{className:"text-sm text-modern-text-secondary",children:["(",e.key,")"]}),s.jsx("span",{className:"text-sm",children:e.type}),e.required&&s.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded",children:"필수"}),s.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{O(s=>({...s,attributes:s.attributes.filter((s,i)=>i!==e)}))})(i),className:"ml-auto",children:s.jsx(r,{className:"w-4 h-4"})})]},i))}),s.jsxs("div",{className:"flex gap-2 items-end",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx(m,{children:"속성 키"}),s.jsx(h,{value:D.key,onChange:e=>$(s=>({...s,key:e.target.value})),placeholder:"예: color"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx(m,{children:"라벨"}),s.jsx(h,{value:D.label,onChange:e=>$(s=>({...s,label:e.target.value})),placeholder:"예: 색상"})]}),s.jsxs("div",{children:[s.jsx(m,{children:"타입"}),s.jsxs("select",{value:D.type,onChange:e=>$(s=>({...s,type:e.target.value})),className:"h-10 px-3 py-2 border border-modern-border-primary rounded-md",children:[s.jsx("option",{value:"text",children:"텍스트"}),s.jsx("option",{value:"number",children:"숫자"}),s.jsx("option",{value:"select",children:"선택"}),s.jsx("option",{value:"boolean",children:"예/아니오"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(j,{checked:D.required,onCheckedChange:e=>$(s=>({...s,required:e}))}),s.jsx(m,{children:"필수"})]}),s.jsx(p,{type:"button",onClick:()=>{D.key&&D.label?(O(e=>({...e,attributes:[...e.attributes,{...D}]})),$({key:"",label:"",type:"text",required:!1})):l.error("속성 키와 라벨을 입력하세요")},children:"추가"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium text-modern-text-primary",children:"배송 정책"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(m,{htmlFor:"freeShippingThreshold",children:"무료배송 기준금액"}),s.jsx(h,{id:"freeShippingThreshold",type:"number",value:L.shippingPolicy.freeShippingThreshold,onChange:e=>O(s=>({...s,shippingPolicy:{...s.shippingPolicy,freeShippingThreshold:parseInt(e.target.value)||0}})),placeholder:"50000"})]}),s.jsxs("div",{children:[s.jsx(m,{htmlFor:"baseShippingFee",children:"기본 배송비"}),s.jsx(h,{id:"baseShippingFee",type:"number",value:L.shippingPolicy.baseShippingFee,onChange:e=>O(s=>({...s,shippingPolicy:{...s.shippingPolicy,baseShippingFee:parseInt(e.target.value)||0}})),placeholder:"3000"})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium text-modern-text-primary",children:"SEO 설정"}),s.jsxs("div",{children:[s.jsx(m,{htmlFor:"seoTitle",children:"SEO 제목"}),s.jsx(h,{id:"seoTitle",value:L.seo.title,onChange:e=>O(s=>({...s,seo:{...s.seo,title:e.target.value}})),placeholder:"검색 결과에 표시될 제목"})]}),s.jsxs("div",{children:[s.jsx(m,{htmlFor:"seoDescription",children:"SEO 설명"}),s.jsx(x,{id:"seoDescription",value:L.seo.description,onChange:e=>O(s=>({...s,seo:{...s.seo,description:e.target.value}})),placeholder:"검색 결과에 표시될 설명",rows:2})]}),s.jsxs("div",{children:[s.jsx(m,{htmlFor:"seoKeywords",children:"SEO 키워드"}),s.jsx(h,{id:"seoKeywords",value:L.seo.keywords,onChange:e=>O(s=>({...s,seo:{...s.seo,keywords:e.target.value}})),placeholder:"쉼표로 구분된 키워드"})]})]})]}),s.jsxs(F,{children:[s.jsx(p,{type:"button",variant:"outline",onClick:U,children:"취소"}),s.jsx(p,{type:"submit",disabled:A.isPending||G.isPending,children:K?"수정":"생성"})]})]})})})]})};export{P as default};
