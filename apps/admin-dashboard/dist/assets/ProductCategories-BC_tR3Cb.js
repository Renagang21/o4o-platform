import{r as e,j as s,b6 as i,b8 as t,C as r,aB as a,bc as n,V as l}from"./vendor-react-BqkIXTmC.js";import{u as d,a as c,b as o}from"./vendor-query-C5jzPyjL.js";import{B as p,L as h,I as m,T as x,m as j,b as u}from"./page-template-editor-DmUXhR56.js";import{cF as g,cG as v,cH as y,cR as b,cI as N,cU as f,cV as w,cW as S,cX as k,cY as C,cZ as F}from"./wp-misc-D0_U3Yh3.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-C9jLuAcl.js";import"./wp-blocks-core-C_Umt3qd.js";import"./wp-block-editor-main-DEdKEcH7.js";import"./wp-block-editor-store-Cdz5rmmV.js";import"./wp-block-editor-utils-CmROb2t9.js";import"./wp-i18n-DP14Ry5v.js";import"./wp-core-skmJSxj5.js";import"./wp-components-i3qvAB06.js";import"./wp-api-Dq90bqIA.js";import"./wp-data-CsLR-lZb.js";const P=()=>{const P=d(),[q,T]=e.useState(new Set),[I,K]=e.useState(!1),[z,L]=e.useState(null),[O,E]=e.useState({name:"",slug:"",description:"",parentId:void 0,active:!0,attributes:[],shippingPolicy:{freeShippingThreshold:5e4,baseShippingFee:3e3},seo:{title:"",description:"",keywords:""}}),[$,D]=e.useState({key:"",label:"",type:"text",required:!1}),{data:Q,isLoading:B}=c({queryKey:["product-categories"],queryFn:async()=>(await u.api.get("/v1/ecommerce/categories/tree")).data}),V=Q?.data||[],G=o({mutationFn:async e=>(await u.api.post("/v1/ecommerce/categories",e)).data,onSuccess:()=>{l.success("카테고리가 생성되었습니다"),P.invalidateQueries({queryKey:["product-categories"]}),W()}}),H=o({mutationFn:async({id:e,data:s})=>(await u.api.put(`/v1/ecommerce/categories/${e}`,s)).data,onSuccess:()=>{l.success("카테고리가 수정되었습니다"),P.invalidateQueries({queryKey:["product-categories"]}),W()}}),R=o({mutationFn:async e=>(await u.api.delete(`/v1/ecommerce/categories/${e}`)).data,onSuccess:()=>{l.success("카테고리가 삭제되었습니다"),P.invalidateQueries({queryKey:["product-categories"]})}}),U=(e,s)=>{e?(L(e),E({name:e.name,slug:e.slug,description:e.description||"",parentId:e.parentId,active:e.active,attributes:e.attributes||[],shippingPolicy:{freeShippingThreshold:e.shippingPolicy?.freeShippingThreshold||5e4,baseShippingFee:e.shippingPolicy?.baseShippingFee||3e3},seo:{title:e.seo?.title||"",description:e.seo?.description||"",keywords:e.seo?.keywords?.join(", ")||""}})):(L(null),E({name:"",slug:"",description:"",parentId:s,active:!0,attributes:[],shippingPolicy:{freeShippingThreshold:5e4,baseShippingFee:3e3},seo:{title:"",description:"",keywords:""}})),K(!0)},W=()=>{K(!1),L(null),E({name:"",slug:"",description:"",parentId:void 0,active:!0,attributes:[],shippingPolicy:{freeShippingThreshold:5e4,baseShippingFee:3e3},seo:{title:"",description:"",keywords:""}}),D({key:"",label:"",type:"text",required:!1})},X=(e,d=0)=>{const c=e.children&&e.children.length>0,o=q.has(e.id);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-modern-bg-hover border-b border-modern-border-primary "+(d>0?"ml-"+8*d:""),style:{marginLeft:2*d+"rem"},children:[s.jsxs("div",{className:"flex items-center gap-3",children:[c&&s.jsx("button",{onClick:()=>(e=>{const s=new Set(q);s.has(e)?s.delete(e):s.add(e),T(s)})(e.id),className:"p-1 hover:bg-modern-bg-tertiary rounded",children:o?s.jsx(r,{className:"w-4 h-4"}):s.jsx(a,{className:"w-4 h-4"})}),!c&&s.jsx("div",{className:"w-6"}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h4",{className:"font-medium text-modern-text-primary",children:e.name}),s.jsxs("span",{className:"text-xs text-modern-text-secondary",children:["/",e.slug]}),!e.active&&s.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:"비활성"})]}),e.description&&s.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:e.description}),s.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[s.jsxs("span",{className:"text-xs text-modern-text-tertiary",children:["상품 ",e.productCount,"개"]}),e.shippingPolicy&&s.jsxs("span",{className:"text-xs text-modern-text-tertiary",children:["무료배송 ",(e.shippingPolicy.freeShippingThreshold||0).toLocaleString(),"원 이상"]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>U(void 0,e.id),children:[s.jsx(i,{className:"w-4 h-4"}),"하위 추가"]}),s.jsx(p,{variant:"ghost",size:"sm",onClick:()=>U(e),children:s.jsx(n,{className:"w-4 h-4"})}),s.jsx(p,{variant:"ghost",size:"sm",onClick:()=>(e=>{e.children&&e.children.length>0?l.error("하위 카테고리가 있는 카테고리는 삭제할 수 없습니다"):e.productCount>0?l.error("상품이 등록된 카테고리는 삭제할 수 없습니다"):confirm(`"${e.name}" 카테고리를 삭제하시겠습니까?`)&&R.mutate(e.id)})(e),disabled:e.productCount>0||e.children&&e.children.length>0,children:s.jsx(t,{className:"w-4 h-4 text-destructive"})})]})]}),c&&o&&s.jsx("div",{children:e.children.map(e=>X(e,d+1))})]},e.id)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"상품 카테고리"}),s.jsx("p",{className:"text-modern-text-secondary mt-1",children:"다단계 카테고리 구조를 관리하고 속성을 설정하세요."})]}),s.jsxs(p,{onClick:()=>U(),children:[s.jsx(i,{className:"w-4 h-4 mr-2"}),"최상위 카테고리"]})]}),s.jsxs(g,{children:[s.jsxs(v,{children:[s.jsx(y,{children:"카테고리 구조"}),s.jsx(b,{children:"드래그앤드롭으로 순서를 변경하고, 카테고리별 속성과 배송 정책을 설정하세요."})]}),s.jsx(N,{className:"p-0",children:B?s.jsx("div",{className:"p-12 text-center",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary mx-auto"})}):0===V.length?s.jsx("div",{className:"p-12 text-center text-modern-text-secondary",children:"카테고리가 없습니다. 새 카테고리를 추가하세요."}):s.jsx("div",{children:V.map(e=>X(e))})})]}),s.jsx(f,{open:I,onOpenChange:K,children:s.jsx(w,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:s.jsxs("form",{onSubmit:e=>{e.preventDefault();const s={...O,seo:{...O.seo,keywords:O.seo.keywords.split(",").map(e=>e.trim()).filter(e=>e)}};z?H.mutate({id:z.id,data:s}):G.mutate(s)},children:[s.jsxs(S,{children:[s.jsx(k,{children:z?"카테고리 수정":"새 카테고리"}),s.jsx(C,{children:"카테고리 정보와 속성을 설정하세요."})]}),s.jsxs("div",{className:"space-y-6 py-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium text-modern-text-primary",children:"기본 정보"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(h,{htmlFor:"name",children:"카테고리명 *"}),s.jsx(m,{id:"name",value:O.name,onChange:e=>{E(s=>{return{...s,name:e.target.value,slug:z?s.slug:(i=e.target.value,i.toLowerCase().replace(/[^a-z0-9가-힣]+/g,"-").replace(/^-+|-+$/g,""))};var i})},placeholder:"예: 전자제품",required:!0})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"slug",children:"Slug"}),s.jsx(m,{id:"slug",value:O.slug,onChange:e=>E(s=>({...s,slug:e.target.value})),placeholder:"예: electronics"})]})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"description",children:"설명"}),s.jsx(x,{id:"description",value:O.description,onChange:e=>E(s=>({...s,description:e.target.value})),placeholder:"카테고리에 대한 설명을 입력하세요...",rows:3})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx(h,{htmlFor:"active",children:"활성화"}),s.jsx("p",{className:"text-sm text-modern-text-secondary",children:"비활성화 시 상품 등록이 불가능합니다"})]}),s.jsx(j,{id:"active",checked:O.active,onCheckedChange:e=>E(s=>({...s,active:e}))})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium text-modern-text-primary",children:"카테고리 속성"}),s.jsx("p",{className:"text-sm text-modern-text-secondary",children:"이 카테고리의 상품에 필요한 속성을 정의하세요."}),s.jsx("div",{className:"space-y-2",children:O.attributes.map((e,i)=>s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-modern-bg-tertiary rounded",children:[s.jsx("span",{className:"font-medium",children:e.label}),s.jsxs("span",{className:"text-sm text-modern-text-secondary",children:["(",e.key,")"]}),s.jsx("span",{className:"text-sm",children:e.type}),e.required&&s.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded",children:"필수"}),s.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{E(s=>({...s,attributes:s.attributes.filter((s,i)=>i!==e)}))})(i),className:"ml-auto",children:s.jsx(t,{className:"w-4 h-4"})})]},i))}),s.jsxs("div",{className:"flex gap-2 items-end",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx(h,{children:"속성 키"}),s.jsx(m,{value:$.key,onChange:e=>D(s=>({...s,key:e.target.value})),placeholder:"예: color"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx(h,{children:"라벨"}),s.jsx(m,{value:$.label,onChange:e=>D(s=>({...s,label:e.target.value})),placeholder:"예: 색상"})]}),s.jsxs("div",{children:[s.jsx(h,{children:"타입"}),s.jsxs("select",{value:$.type,onChange:e=>D(s=>({...s,type:e.target.value})),className:"h-10 px-3 py-2 border border-modern-border-primary rounded-md",children:[s.jsx("option",{value:"text",children:"텍스트"}),s.jsx("option",{value:"number",children:"숫자"}),s.jsx("option",{value:"select",children:"선택"}),s.jsx("option",{value:"boolean",children:"예/아니오"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(j,{checked:$.required,onCheckedChange:e=>D(s=>({...s,required:e}))}),s.jsx(h,{children:"필수"})]}),s.jsx(p,{type:"button",onClick:()=>{$.key&&$.label?(E(e=>({...e,attributes:[...e.attributes,{...$}]})),D({key:"",label:"",type:"text",required:!1})):l.error("속성 키와 라벨을 입력하세요")},children:"추가"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium text-modern-text-primary",children:"배송 정책"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(h,{htmlFor:"freeShippingThreshold",children:"무료배송 기준금액"}),s.jsx(m,{id:"freeShippingThreshold",type:"number",value:O.shippingPolicy.freeShippingThreshold,onChange:e=>E(s=>({...s,shippingPolicy:{...s.shippingPolicy,freeShippingThreshold:parseInt(e.target.value)||0}})),placeholder:"50000"})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"baseShippingFee",children:"기본 배송비"}),s.jsx(m,{id:"baseShippingFee",type:"number",value:O.shippingPolicy.baseShippingFee,onChange:e=>E(s=>({...s,shippingPolicy:{...s.shippingPolicy,baseShippingFee:parseInt(e.target.value)||0}})),placeholder:"3000"})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium text-modern-text-primary",children:"SEO 설정"}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"seoTitle",children:"SEO 제목"}),s.jsx(m,{id:"seoTitle",value:O.seo.title,onChange:e=>E(s=>({...s,seo:{...s.seo,title:e.target.value}})),placeholder:"검색 결과에 표시될 제목"})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"seoDescription",children:"SEO 설명"}),s.jsx(x,{id:"seoDescription",value:O.seo.description,onChange:e=>E(s=>({...s,seo:{...s.seo,description:e.target.value}})),placeholder:"검색 결과에 표시될 설명",rows:2})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"seoKeywords",children:"SEO 키워드"}),s.jsx(m,{id:"seoKeywords",value:O.seo.keywords,onChange:e=>E(s=>({...s,seo:{...s.seo,keywords:e.target.value}})),placeholder:"쉼표로 구분된 키워드"})]})]})]}),s.jsxs(F,{children:[s.jsx(p,{type:"button",variant:"outline",onClick:W,children:"취소"}),s.jsx(p,{type:"submit",disabled:G.isPending||H.isPending,children:z?"수정":"생성"})]})]})})})]})};export{P as default};
