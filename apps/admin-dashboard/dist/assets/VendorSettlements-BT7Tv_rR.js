import{r as m,j as e,cI as z,Z as L,bV as K,s as Q,bF as V,S as _,V as p}from"./vendor-react-BZRIq8oW.js";import{u as H,a as Z,b}from"./vendor-query-GrNIwsDq.js";import{B as i,C as l,k as h,l as u,m as c,I,w as G,x as J,y as W,z as X,E as Y,L as ee,F as te,j as N,s as o}from"./page-gutenberg-iVBL5IS_.js";import"./wp-block-editor-C14Ds6es.js";import"./wp-blocks-CnCGET8b.js";import"./wp-core-BctBwZpo.js";import"./wp-i18n-Niz9RVma.js";import"./wp-element-CB9_H0_F.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-monaco-cpVGocfO.js";import"./vendor-utils-DQ8F5vJI.js";import"./wp-components-CLkQS2qf.js";const he=()=>{const w=H(),[j,M]=m.useState(""),[v,P]=m.useState("all"),[r,x]=m.useState([]),[U,g]=m.useState(!1),[k,S]=m.useState(""),{data:B,isLoading:E}=Z({queryKey:["vendor-settlements",j,v],queryFn:async()=>{const t=new URLSearchParams;return j&&t.append("search",j),v!=="all"&&t.append("status",v),(await N.api.get(`/v1/settlements/vendors?${t}`)).data}}),n=B?.data||[],C=b({mutationFn:async t=>(await N.api.post("/v1/settlements/vendors/approve-bulk",t)).data,onSuccess:()=>{p.success("정산이 승인되었습니다"),w.invalidateQueries({queryKey:["vendor-settlements"]}),x([]),g(!1),S("")},onError:()=>{p.error("정산 승인 중 오류가 발생했습니다")}}),y=b({mutationFn:async({id:t,action:s,memo:a})=>(await N.api.post(`/v1/settlements/vendors/${t}/${s}`,{memo:a})).data,onSuccess:(t,s)=>{const a=s.action==="approve"?"승인":s.action==="reject"?"거부":"처리";p.success(`정산이 ${a}되었습니다`),w.invalidateQueries({queryKey:["vendor-settlements"]})}}),D=b({mutationFn:async t=>(await N.api.post("/v1/settlements/vendors/export",{settlementIds:t},{responseType:"blob"})).data,onSuccess:t=>{const s=window.URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`settlements_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s),p.success("정산 데이터가 다운로드되었습니다")}}),R=t=>{switch(t){case"pending":return e.jsx(o,{variant:"outline",className:"text-orange-600 border-orange-600",children:"승인 대기"});case"approved":return e.jsx(o,{variant:"outline",className:"text-blue-600 border-blue-600",children:"승인됨"});case"processing":return e.jsx(o,{variant:"outline",className:"text-purple-600 border-purple-600",children:"처리중"});case"completed":return e.jsx(o,{children:"완료"});case"failed":return e.jsx(o,{variant:"secondary",children:"실패"});default:return e.jsx(o,{variant:"outline",children:t})}},d=t=>`₩${t.toLocaleString()}`,f=t=>new Date(t).toLocaleDateString("ko-KR"),T=()=>{if(r.length===0){p.error("승인할 정산을 선택하세요");return}g(!0)},q=()=>{const s=n.filter(a=>r.includes(a.id)).reduce((a,F)=>a+F.netAmount,0);C.mutate({settlementIds:r,totalAmount:s,memo:k})},O=()=>{const t=r.length>0?r:n.map(s=>s.id);D.mutate(t)},A=n.filter(t=>t.status==="pending"),$=A.reduce((t,s)=>t+s.netAmount,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"판매자 정산 관리"}),e.jsx("p",{className:"text-modern-text-secondary mt-1",children:"판매자별 정산 승인 및 처리"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",onClick:O,disabled:D.isPending,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"엑셀 다운로드"]}),e.jsxs(i,{onClick:T,disabled:r.length===0,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"일괄 승인 (",r.length,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(l,{children:[e.jsx(h,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"승인 대기"]})}),e.jsxs(c,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[A.length,"건"]}),e.jsx("div",{className:"text-xs text-modern-text-tertiary mt-1",children:d($)})]})]}),e.jsxs(l,{children:[e.jsx(h,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"완료"]})}),e.jsxs(c,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[n.filter(t=>t.status==="completed").length,"건"]}),e.jsx("div",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]}),e.jsxs(l,{children:[e.jsx(h,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"정산 판매자"]})}),e.jsx(c,{children:e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[new Set(n.map(t=>t.vendorId)).size,"명"]})})]}),e.jsxs(l,{children:[e.jsx(h,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"총 정산 금액"]})}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-modern-text-primary",children:d(n.reduce((t,s)=>t+s.netAmount,0))})})]})]}),e.jsx(l,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-modern-text-tertiary w-4 h-4"}),e.jsx(I,{placeholder:"판매자명, 이메일로 검색...",value:j,onChange:t=>M(t.target.value),className:"pl-10"})]})}),e.jsxs("select",{value:v,onChange:t=>P(t.target.value),className:"px-4 py-2 border border-modern-border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-modern-primary",children:[e.jsx("option",{value:"all",children:"모든 상태"}),e.jsx("option",{value:"pending",children:"승인 대기"}),e.jsx("option",{value:"approved",children:"승인됨"}),e.jsx("option",{value:"processing",children:"처리중"}),e.jsx("option",{value:"completed",children:"완료"}),e.jsx("option",{value:"failed",children:"실패"})]})]})})}),e.jsxs(l,{children:[e.jsx(h,{children:e.jsx(u,{children:"정산 목록"})}),e.jsx(c,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-modern-bg-tertiary border-b border-modern-border-primary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",onChange:t=>{t.target.checked?x(n.map(s=>s.id)):x([])},checked:r.length===n.length&&n.length>0})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"판매자"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"정산 기간"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"매출액"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"수수료"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"정산액"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상태"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"요청일"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-modern-border-primary",children:E?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-8 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-modern-primary"})})})}):n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-8 text-center text-modern-text-secondary",children:"정산 데이터가 없습니다."})}):n.map(t=>e.jsxs("tr",{className:"hover:bg-modern-bg-hover",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:r.includes(t.id),onChange:s=>{s.target.checked?x([...r,t.id]):x(r.filter(a=>a!==t.id))}})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:t.vendorName}),e.jsx("div",{className:"text-sm text-modern-text-secondary",children:t.vendorEmail})]})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{className:"text-sm text-modern-text-primary",children:[f(t.settlementPeriod.startDate)," ~ ",f(t.settlementPeriod.endDate)]}),e.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:[t.orderCount,"건 주문"]})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:d(t.totalSales)})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["플랫폼: ",d(t.platformFee)]}),e.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:["토스: ",d(t.tossFee)]})]}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-green-600",children:d(t.netAmount)}),t.taxAmount>0&&e.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:["세금: ",d(t.taxAmount)]})]}),e.jsx("td",{className:"px-4 py-4",children:R(t.status)}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm text-modern-text-secondary",children:f(t.requestedAt)})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{size:"sm",onClick:()=>y.mutate({id:t.id,action:"approve"}),disabled:y.isPending,children:"승인"}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>y.mutate({id:t.id,action:"reject"}),disabled:y.isPending,children:"거부"})]}),t.receiptUrl&&e.jsx(i,{size:"sm",variant:"ghost",onClick:()=>window.open(t.receiptUrl,"_blank"),children:"영수증"})]})})]},t.id))})]})})})]}),e.jsx(G,{open:U,onOpenChange:g,children:e.jsxs(J,{children:[e.jsxs(W,{children:[e.jsx(X,{children:"정산 일괄 승인"}),e.jsxs(Y,{children:["선택한 ",r.length,"건의 정산을 승인하시겠습니까?"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"p-4 bg-modern-bg-secondary rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-modern-text-secondary mb-2",children:"승인 요약"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"총 정산건수"}),e.jsxs("span",{className:"font-medium",children:[r.length,"건"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"총 정산금액"}),e.jsx("span",{className:"font-medium text-green-600",children:d(n.filter(t=>r.includes(t.id)).reduce((t,s)=>t+s.netAmount,0))})]})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"approvalMemo",children:"메모 (선택)"}),e.jsx(I,{id:"approvalMemo",value:k,onChange:t=>S(t.target.value),placeholder:"승인 관련 메모를 입력하세요"})]})]}),e.jsxs(te,{children:[e.jsx(i,{variant:"outline",onClick:()=>g(!1),children:"취소"}),e.jsx(i,{onClick:q,disabled:C.isPending,children:"승인 확정"})]})]})})]})};export{he as default};
