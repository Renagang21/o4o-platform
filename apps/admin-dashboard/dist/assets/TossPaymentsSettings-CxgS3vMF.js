import{r as m,j as e,bM as Q,B as H,c8 as L,O as F,bE as V,Z as W,bu as $,V as p}from"./vendor-react-CMQx0Rxg.js";import{u as z,a as C,b as E}from"./vendor-query-B9kD0akd.js";import{B as f,s as h,C as c,k as d,l as o,m as x,L as n,I as u,w as Z,x as G,y as J,z as X,E as Y,F as ee,j}from"./page-gutenberg-Bg9cnlWs.js";import"./wp-all-CpKe89B2.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-monaco-cpVGocfO.js";import"./vendor-utils-DQ8F5vJI.js";const ce=()=>{const k=z(),[T,y]=m.useState(!1),[l,q]=m.useState("connection"),[v,D]=m.useState(!1),[N,M]=m.useState(!1),[a,r]=m.useState({clientKey:"",secretKey:"",webhookSecretKey:"",isLive:!1,isEnabled:!1,webhookUrl:"",returnUrl:"",failUrl:"",supportedMethods:[{type:"card",name:"신용카드",enabled:!0},{type:"transfer",name:"계좌이체",enabled:!0},{type:"virtualAccount",name:"가상계좌",enabled:!1},{type:"mobilePhone",name:"휴대폰 결제",enabled:!1},{type:"giftCertificate",name:"상품권",enabled:!1},{type:"foreignEasyPay",name:"해외간편결제",enabled:!1}]}),{data:P}=C({queryKey:["toss-payments-config"],queryFn:async()=>(await j.api.get("/v1/payments/toss/config")).data}),i=P?.data,{data:R}=C({queryKey:["toss-payments-tests"],queryFn:async()=>(await j.api.get("/v1/payments/toss/tests")).data}),K=R?.data||[],{data:A}=C({queryKey:["toss-payments-stats"],queryFn:async()=>(await j.api.get("/v1/payments/toss/stats")).data}),g=A?.data||{},S=E({mutationFn:async s=>(await j.api.put("/v1/payments/toss/config",s)).data,onSuccess:()=>{p.success("토스페이먼츠 설정이 저장되었습니다"),k.invalidateQueries({queryKey:["toss-payments-config"]})}}),U=E({mutationFn:async s=>(await j.api.post("/v1/payments/toss/test",{testType:s})).data,onSuccess:s=>{s.success?p.success(`${w(l)} 테스트가 성공했습니다`):p.error(`${w(l)} 테스트가 실패했습니다`),k.invalidateQueries({queryKey:["toss-payments-tests"]}),y(!1)}});m.useEffect(()=>{i&&r({...i,supportedMethods:i.supportedMethods||[]})},[i]);const w=s=>{switch(s){case"connection":return"API 연결";case"payment":return"결제";case"webhook":return"웹훅";default:return s}},I=s=>{switch(s){case"success":return e.jsx(h,{className:"bg-green-100 text-green-800 border-green-200",children:"성공"});case"failed":return e.jsx(h,{variant:"destructive",children:"실패"});case"pending":return e.jsx(h,{variant:"outline",className:"text-yellow-600 border-yellow-600",children:"진행중"});default:return e.jsx(h,{variant:"outline",children:s})}},_=s=>{if(s.preventDefault(),!a.clientKey||!a.secretKey){p.error("클라이언트 키와 시크릿 키는 필수입니다");return}if(!a.webhookUrl||!a.returnUrl||!a.failUrl){p.error("웹훅 URL, 성공 URL, 실패 URL은 필수입니다");return}S.mutate(a)},B=s=>{r(t=>({...t,supportedMethods:t.supportedMethods?.map(b=>b.type===s?{...b,enabled:!b.enabled}:b)}))},O=()=>{U.mutate(l)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"토스페이먼츠 설정"}),e.jsx("p",{className:"text-modern-text-secondary mt-1",children:"결제 시스템 연동 및 관리"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"outline",onClick:()=>y(!0),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"연결 테스트"]}),i&&e.jsx(h,{variant:i.isEnabled?"default":"secondary",children:i.isEnabled?"활성화":"비활성화"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-modern-text-secondary",children:"총 결제 건수"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-modern-text-primary",children:g.totalPayments||0}),e.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달 기준"})]})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-modern-text-secondary",children:"결제 성공률"})}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[g.successRate||0,"%"]}),e.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"최근 30일"})]})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-modern-text-secondary",children:"총 결제 금액"})}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold text-modern-text-primary",children:["₩",(g.totalAmount||0).toLocaleString()]}),e.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-modern-text-secondary",children:"환불 건수"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:g.refundCount||0}),e.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"API 설정"]})}),e.jsx(x,{children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-medium",children:"환경 설정"}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",checked:!a.isLive,onChange:()=>r(s=>({...s,isLive:!1})),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"테스트 (Sandbox)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",checked:a.isLive,onChange:()=>r(s=>({...s,isLive:!0})),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"운영 (Live)"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"clientKey",children:"클라이언트 키 *"}),e.jsx(u,{id:"clientKey",value:a.clientKey,onChange:s=>r(t=>({...t,clientKey:s.target.value})),placeholder:"test_ck_... 또는 live_ck_...",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"secretKey",children:"시크릿 키 *"}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{id:"secretKey",type:v?"text":"password",value:a.secretKey,onChange:s=>r(t=>({...t,secretKey:s.target.value})),placeholder:"test_sk_... 또는 live_sk_...",required:!0}),e.jsx("button",{type:"button",onClick:()=>D(!v),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:v?e.jsx(L,{className:"w-4 h-4"}):e.jsx(F,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"webhookSecretKey",children:"웹훅 시크릿 키"}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{id:"webhookSecretKey",type:N?"text":"password",value:a.webhookSecretKey,onChange:s=>r(t=>({...t,webhookSecretKey:s.target.value})),placeholder:"웹훅 검증용 시크릿 키"}),e.jsx("button",{type:"button",onClick:()=>M(!N),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:N?e.jsx(L,{className:"w-4 h-4"}):e.jsx(F,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"webhookUrl",children:"웹훅 URL *"}),e.jsx(u,{id:"webhookUrl",value:a.webhookUrl,onChange:s=>r(t=>({...t,webhookUrl:s.target.value})),placeholder:"https://yourdomain.com/api/webhooks/toss",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"returnUrl",children:"결제 성공 URL *"}),e.jsx(u,{id:"returnUrl",value:a.returnUrl,onChange:s=>r(t=>({...t,returnUrl:s.target.value})),placeholder:"https://yourdomain.com/payment/success",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"failUrl",children:"결제 실패 URL *"}),e.jsx(u,{id:"failUrl",value:a.failUrl,onChange:s=>r(t=>({...t,failUrl:s.target.value})),placeholder:"https://yourdomain.com/payment/fail",required:!0})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isEnabled",checked:a.isEnabled,onChange:s=>r(t=>({...t,isEnabled:s.target.checked})),className:"mr-2"}),e.jsx(n,{htmlFor:"isEnabled",children:"토스페이먼츠 활성화"})]}),e.jsx(f,{type:"submit",disabled:S.isPending,className:"w-full",children:"설정 저장"})]})})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"결제 수단 설정"]})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-3",children:a.supportedMethods?.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.enabled,onChange:()=>B(s.type),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-modern-text-secondary",children:s.type})]})]}),e.jsx(h,{variant:s.enabled?"default":"secondary",children:s.enabled?"활성":"비활성"})]},s.type))})})]})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(o,{children:"최근 테스트 결과"})}),e.jsx(x,{children:K.length===0?e.jsx("div",{className:"text-center py-8 text-modern-text-secondary",children:"아직 테스트를 실행하지 않았습니다."}):e.jsx("div",{className:"space-y-3",children:K.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.status==="success"?e.jsx(W,{className:"w-5 h-5 text-green-600"}):s.status==="failed"?e.jsx($,{className:"w-5 h-5 text-red-600"}):e.jsx("div",{className:"w-5 h-5 border-2 border-yellow-600 border-t-transparent rounded-full animate-spin"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[w(s.testType)," 테스트"]}),e.jsx("div",{className:"text-sm text-modern-text-secondary",children:new Date(s.executedAt).toLocaleString("ko-KR")}),s.error&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:s.error})]})]}),I(s.status)]},s.id))})})]}),e.jsx(Z,{open:T,onOpenChange:y,children:e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(X,{children:"연결 테스트"}),e.jsx(Y,{children:"토스페이먼츠 API 연결 상태를 테스트합니다."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"테스트 유형"}),e.jsxs("select",{value:l,onChange:s=>q(s.target.value),className:"w-full px-3 py-2 border border-modern-border-primary rounded-lg mt-1",children:[e.jsx("option",{value:"connection",children:"API 연결 테스트"}),e.jsx("option",{value:"payment",children:"결제 테스트 (100원)"}),e.jsx("option",{value:"webhook",children:"웹훅 테스트"})]})]}),e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[l==="connection"&&"토스페이먼츠 API 서버와의 연결 상태를 확인합니다.",l==="payment"&&"실제 100원 결제를 통해 결제 프로세스를 테스트합니다. (테스트 환경에서만)",l==="webhook"&&"웹훅 URL의 응답성과 시크릿 키 검증을 테스트합니다."]})})]}),e.jsxs(ee,{children:[e.jsx(f,{variant:"outline",onClick:()=>y(!1),children:"취소"}),e.jsx(f,{onClick:O,disabled:U.isPending,children:"테스트 실행"})]})]})})]})};export{ce as default};
