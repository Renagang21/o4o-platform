import{r as e,j as t,cD as s,bh as r,bU as a,b1 as n,bn as i,aE as d,V as l}from"./vendor-react-DqgGMt48.js";import{u as c,a as o,b as m}from"./vendor-query-D_c3FRkE.js";import{B as x,I as p,L as h,b as j}from"./page-template-editor-Dej8aqbo.js";import{cF as u,cG as v,cH as y,cI as b,cU as g,cV as N,cW as f,cX as w,cY as k,cZ as C,cQ as S}from"./wp-misc-CVe7ECV4.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-C9jLuAcl.js";import"./wp-blocks-core-NinAvWTg.js";import"./wp-block-editor-misc-De1L5-zR.js";import"./wp-core-kvRrOm9B.js";import"./wp-block-editor-api-BKhomcj9.js";import"./wp-block-editor-store-BZ6fZn58.js";import"./wp-block-editor-clipboard-DrG0xX4B.js";import"./wp-i18n-D6_Il8Rt.js";import"./wp-block-editor-global-styles-DiR2HQC4.js";import"./wp-block-editor-typography-W96exnXk.js";import"./wp-components-BJYLMD7r.js";import"./wp-block-editor-spacing-CpdaiY4Q.js";import"./wp-block-editor-menus-IWaA-N3x.js";import"./wp-block-editor-core-BSca1VBH.js";import"./wp-block-editor-utils-Bqn4TiQr.js";import"./wp-block-editor-a11y-YlMsb8JF.js";import"./wp-block-editor-preview-CaF7fUZD.js";import"./wp-block-editor-borders-BtjnCtLF.js";import"./wp-block-editor-formats-B4-8T-Nh.js";import"./wp-block-editor-selection-DYIw7ude.js";import"./wp-block-editor-inline-DHEsfgnI.js";import"./wp-block-editor-ui-l6-7VhtF.js";import"./wp-block-editor-transforms-Bm69JWBw.js";import"./wp-block-editor-patterns-CNk0M6ZZ.js";import"./wp-block-editor-navigation-iME_YXGb.js";import"./wp-block-editor-dnd-DduwJSaE.js";import"./wp-block-editor-media-CVSKmHRK.js";import"./wp-api-Dp_oFsVM.js";import"./wp-block-editor-keyboard-C8o4qxcy.js";import"./wp-block-editor-templates-A6LfENHh.js";import"./wp-data-D64LRRbU.js";const A=()=>{const A=c(),[F,L]=e.useState(""),[U,q]=e.useState("all"),[D,P]=e.useState([]),[I,R]=e.useState(!1),[$,z]=e.useState(""),{data:E,isLoading:K}=o({queryKey:["vendor-settlements",F,U],queryFn:async()=>{const e=new URLSearchParams;F&&e.append("search",F),"all"!==U&&e.append("status",U);return(await j.api.get(`/v1/settlements/vendors?${e}`)).data}}),O=E?.data||[],Q=m({mutationFn:async e=>(await j.api.post("/v1/settlements/vendors/approve-bulk",e)).data,onSuccess:()=>{l.success("정산이 승인되었습니다"),A.invalidateQueries({queryKey:["vendor-settlements"]}),P([]),R(!1),z("")},onError:()=>{l.error("정산 승인 중 오류가 발생했습니다")}}),B=m({mutationFn:async({id:e,action:t,memo:s})=>(await j.api.post(`/v1/settlements/vendors/${e}/${t}`,{memo:s})).data,onSuccess:(e,t)=>{const s="approve"===t.action?"승인":"reject"===t.action?"거부":"처리";l.success(`정산이 ${s}되었습니다`),A.invalidateQueries({queryKey:["vendor-settlements"]})}}),M=m({mutationFn:async e=>(await j.api.post("/v1/settlements/vendors/export",{settlementIds:e},{responseType:"blob"})).data,onSuccess:e=>{const t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`settlements_${(new Date).toISOString().split("T")[0]}.xlsx`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(t),l.success("정산 데이터가 다운로드되었습니다")}}),T=e=>{switch(e){case"pending":return t.jsx(S,{variant:"outline",className:"text-orange-600 border-orange-600",children:"승인 대기"});case"approved":return t.jsx(S,{variant:"outline",className:"text-blue-600 border-blue-600",children:"승인됨"});case"processing":return t.jsx(S,{variant:"outline",className:"text-purple-600 border-purple-600",children:"처리중"});case"completed":return t.jsx(S,{children:"완료"});case"failed":return t.jsx(S,{variant:"secondary",children:"실패"});default:return t.jsx(S,{variant:"outline",children:e})}},V=e=>`₩${e.toLocaleString()}`,_=e=>new Date(e).toLocaleDateString("ko-KR"),G=O.filter(e=>"pending"===e.status),H=G.reduce((e,t)=>e+t.netAmount,0);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"판매자 정산 관리"}),t.jsx("p",{className:"text-modern-text-secondary mt-1",children:"판매자별 정산 승인 및 처리"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(x,{variant:"outline",onClick:()=>{const e=D.length>0?D:O.map(e=>e.id);M.mutate(e)},disabled:M.isPending,children:[t.jsx(s,{className:"w-4 h-4 mr-2"}),"엑셀 다운로드"]}),t.jsxs(x,{onClick:()=>{0!==D.length?R(!0):l.error("승인할 정산을 선택하세요")},disabled:0===D.length,children:[t.jsx(r,{className:"w-4 h-4 mr-2"}),"일괄 승인 (",D.length,")"]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs(u,{children:[t.jsx(v,{className:"pb-2",children:t.jsxs(y,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[t.jsx(a,{className:"w-4 h-4"}),"승인 대기"]})}),t.jsxs(b,{children:[t.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[G.length,"건"]}),t.jsx("div",{className:"text-xs text-modern-text-tertiary mt-1",children:V(H)})]})]}),t.jsxs(u,{children:[t.jsx(v,{className:"pb-2",children:t.jsxs(y,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[t.jsx(r,{className:"w-4 h-4"}),"완료"]})}),t.jsxs(b,{children:[t.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[O.filter(e=>"completed"===e.status).length,"건"]}),t.jsx("div",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]}),t.jsxs(u,{children:[t.jsx(v,{className:"pb-2",children:t.jsxs(y,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[t.jsx(n,{className:"w-4 h-4"}),"정산 판매자"]})}),t.jsx(b,{children:t.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[new Set(O.map(e=>e.vendorId)).size,"명"]})})]}),t.jsxs(u,{children:[t.jsx(v,{className:"pb-2",children:t.jsxs(y,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[t.jsx(i,{className:"w-4 h-4"}),"총 정산 금액"]})}),t.jsx(b,{children:t.jsx("div",{className:"text-2xl font-bold text-modern-text-primary",children:V(O.reduce((e,t)=>e+t.netAmount,0))})})]})]}),t.jsx(u,{children:t.jsx(b,{className:"pt-6",children:t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-modern-text-tertiary w-4 h-4"}),t.jsx(p,{placeholder:"판매자명, 이메일로 검색...",value:F,onChange:e=>L(e.target.value),className:"pl-10"})]})}),t.jsxs("select",{value:U,onChange:e=>q(e.target.value),className:"px-4 py-2 border border-modern-border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-modern-primary",children:[t.jsx("option",{value:"all",children:"모든 상태"}),t.jsx("option",{value:"pending",children:"승인 대기"}),t.jsx("option",{value:"approved",children:"승인됨"}),t.jsx("option",{value:"processing",children:"처리중"}),t.jsx("option",{value:"completed",children:"완료"}),t.jsx("option",{value:"failed",children:"실패"})]})]})})}),t.jsxs(u,{children:[t.jsx(v,{children:t.jsx(y,{children:"정산 목록"})}),t.jsx(b,{children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-modern-bg-tertiary border-b border-modern-border-primary",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left",children:t.jsx("input",{type:"checkbox",onChange:e=>{e.target.checked?P(O.map(e=>e.id)):P([])},checked:D.length===O.length&&O.length>0})}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"판매자"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"정산 기간"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"매출액"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"수수료"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"정산액"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상태"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"요청일"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"작업"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-modern-border-primary",children:K?t.jsx("tr",{children:t.jsx("td",{colSpan:9,className:"px-4 py-8 text-center",children:t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-modern-primary"})})})}):0===O.length?t.jsx("tr",{children:t.jsx("td",{colSpan:9,className:"px-4 py-8 text-center text-modern-text-secondary",children:"정산 데이터가 없습니다."})}):O.map(e=>t.jsxs("tr",{className:"hover:bg-modern-bg-hover",children:[t.jsx("td",{className:"px-4 py-4",children:t.jsx("input",{type:"checkbox",checked:D.includes(e.id),onChange:t=>{t.target.checked?P([...D,e.id]):P(D.filter(t=>t!==e.id))}})}),t.jsx("td",{className:"px-4 py-4",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:e.vendorName}),t.jsx("div",{className:"text-sm text-modern-text-secondary",children:e.vendorEmail})]})}),t.jsxs("td",{className:"px-4 py-4",children:[t.jsxs("div",{className:"text-sm text-modern-text-primary",children:[_(e.settlementPeriod.startDate)," ~ ",_(e.settlementPeriod.endDate)]}),t.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:[e.orderCount,"건 주문"]})]}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:V(e.totalSales)})}),t.jsxs("td",{className:"px-4 py-4",children:[t.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["플랫폼: ",V(e.platformFee)]}),t.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:["토스: ",V(e.tossFee)]})]}),t.jsxs("td",{className:"px-4 py-4",children:[t.jsx("div",{className:"text-sm font-medium text-green-600",children:V(e.netAmount)}),e.taxAmount>0&&t.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:["세금: ",V(e.taxAmount)]})]}),t.jsx("td",{className:"px-4 py-4",children:T(e.status)}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"text-sm text-modern-text-secondary",children:_(e.requestedAt)})}),t.jsx("td",{className:"px-4 py-4",children:t.jsxs("div",{className:"flex gap-2",children:["pending"===e.status&&t.jsxs(t.Fragment,{children:[t.jsx(x,{size:"sm",onClick:()=>B.mutate({id:e.id,action:"approve"}),disabled:B.isPending,children:"승인"}),t.jsx(x,{size:"sm",variant:"outline",onClick:()=>B.mutate({id:e.id,action:"reject"}),disabled:B.isPending,children:"거부"})]}),e.receiptUrl&&t.jsx(x,{size:"sm",variant:"ghost",onClick:()=>window.open(e.receiptUrl,"_blank"),children:"영수증"})]})})]},e.id))})]})})})]}),t.jsx(g,{open:I,onOpenChange:R,children:t.jsxs(N,{children:[t.jsxs(f,{children:[t.jsx(w,{children:"정산 일괄 승인"}),t.jsxs(k,{children:["선택한 ",D.length,"건의 정산을 승인하시겠습니까?"]})]}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"p-4 bg-modern-bg-secondary rounded-lg",children:[t.jsx("div",{className:"text-sm font-medium text-modern-text-secondary mb-2",children:"승인 요약"}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"총 정산건수"}),t.jsxs("span",{className:"font-medium",children:[D.length,"건"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"총 정산금액"}),t.jsx("span",{className:"font-medium text-green-600",children:V(O.filter(e=>D.includes(e.id)).reduce((e,t)=>e+t.netAmount,0))})]})]}),t.jsxs("div",{children:[t.jsx(h,{htmlFor:"approvalMemo",children:"메모 (선택)"}),t.jsx(p,{id:"approvalMemo",value:$,onChange:e=>z(e.target.value),placeholder:"승인 관련 메모를 입력하세요"})]})]}),t.jsxs(C,{children:[t.jsx(x,{variant:"outline",onClick:()=>R(!1),children:"취소"}),t.jsx(x,{onClick:()=>{const e=O.filter(e=>D.includes(e.id)).reduce((e,t)=>e+t.netAmount,0);Q.mutate({settlementIds:D,totalAmount:e,memo:$})},disabled:Q.isPending,children:"승인 확정"})]})]})})]})};export{A as default};
