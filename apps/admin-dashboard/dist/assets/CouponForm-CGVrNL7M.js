import{u as e,b as s,r as l,V as n,j as a,aD as i,cK as r,bn as c,c8 as o,S as t}from"./vendor-react-BoWgD0Bu.js";import{B as d}from"./page-template-editor-CWJwXWLM.js";import{cy as m,cz as u,cA as p,cB as x}from"./wp-misc-fiKRzvVp.js";import{a as h}from"./api-DhTH7TNi.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-query-CbBSyLUF.js";import"./vendor-utils-C9jLuAcl.js";import"./wp-foundation-BzBJX52f.js";import"./wp-block-editor-main-y2nlPlta.js";import"./wp-i18n-BPC8WmOV.js";import"./wp-block-editor-store-PPID3vJI.js";import"./wp-block-editor-utils-C52tDze8.js";import"./wp-components-CKWj6dcl.js";const j=()=>{const j=e(),{id:f}=s(),b=!!f,[g,v]=l.useState({code:"",description:"",discountType:"percent",discountValue:0,usageLimitPerCoupon:0,usageLimitPerCustomer:1,freeShipping:!1,excludeSaleItems:!1,individualUseOnly:!0}),[y,N]=l.useState(!1),[w,k]=l.useState(!1);l.useEffect(()=>{b&&C()},[f]);const C=async()=>{try{N(!0);const e=(await h.get(`/v1/coupons/${f}`)).data.data;v({...e,validFrom:e.validFrom?e.validFrom.split("T")[0]:"",validUntil:e.validUntil?e.validUntil.split("T")[0]:""})}catch(e){n.error("Failed to load coupon")}finally{N(!1)}},F=e=>{const{name:s,value:l,type:n}=e.target;if("checkbox"===n){const l=e.target.checked;v(e=>({...e,[s]:l}))}else v("number"===n?e=>({...e,[s]:parseFloat(l)||0}):e=>({...e,[s]:l}))};return y?a.jsx("div",{className:"flex items-center justify-center h-96",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold",children:b?"쿠폰 수정":"새 쿠폰 만들기"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"할인 쿠폰을 생성하고 설정하세요"})]}),a.jsxs(d,{variant:"outline",onClick:()=>j("/ecommerce/coupons"),children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),"취소"]})]}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),g.code)if(g.discountValue<=0)n.error("할인 값을 입력해주세요");else if("percent"===g.discountType&&g.discountValue>100)n.error("퍼센트 할인은 100%를 초과할 수 없습니다");else try{k(!0);const e={...g,validFrom:g.validFrom||void 0,validUntil:g.validUntil||void 0,minOrderAmount:g.minOrderAmount||void 0,maxDiscountAmount:g.maxDiscountAmount||void 0};b?(await h.put(`/v1/coupons/${f}`,e),n.success("쿠폰이 수정되었습니다")):(await h.post("/v1/coupons",e),n.success("쿠폰이 생성되었습니다")),j("/ecommerce/coupons")}catch(s){const e=s.response?.data?.message||"Failed to save coupon";n.error(e)}finally{k(!1)}else n.error("쿠폰 코드를 입력해주세요")},className:"space-y-6",children:[a.jsxs(m,{children:[a.jsx(u,{children:a.jsx(p,{children:"기본 정보"})}),a.jsx(x,{className:"space-y-4",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"쿠폰 코드 *"}),a.jsx("input",{type:"text",name:"code",value:g.code,onChange:F,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"예: WELCOME10",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"할인 타입 *"}),a.jsxs("select",{name:"discountType",value:g.discountType,onChange:F,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"percent",children:"퍼센트 할인"}),a.jsx("option",{value:"fixed_cart",children:"정액 할인 (장바구니)"}),a.jsx("option",{value:"fixed_product",children:"정액 할인 (상품별)"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"할인 값 *"}),a.jsxs("div",{className:"relative",children:["percent"===g.discountType?a.jsx(r,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}):a.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),a.jsx("input",{type:"number",name:"discountValue",value:g.discountValue,onChange:F,className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",step:"0.01",required:!0})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"설명"}),a.jsx("input",{type:"text",name:"description",value:g.description,onChange:F,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"쿠폰 설명"})]})]})})]}),a.jsxs(m,{children:[a.jsx(u,{children:a.jsx(p,{children:"사용 제한"})}),a.jsx(x,{className:"space-y-4",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"최소 주문 금액"}),a.jsx("input",{type:"number",name:"minOrderAmount",value:g.minOrderAmount||"",onChange:F,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",step:"1000"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"최대 할인 금액"}),a.jsx("input",{type:"number",name:"maxDiscountAmount",value:g.maxDiscountAmount||"",onChange:F,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",step:"1000"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"총 사용 제한"}),a.jsx("input",{type:"number",name:"usageLimitPerCoupon",value:g.usageLimitPerCoupon,onChange:F,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0 (무제한)",min:"0"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"0은 무제한"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"고객당 사용 제한"}),a.jsx("input",{type:"number",name:"usageLimitPerCustomer",value:g.usageLimitPerCustomer,onChange:F,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1",min:"1"})]})]})})]}),a.jsxs(m,{children:[a.jsx(u,{children:a.jsx(p,{children:"유효 기간"})}),a.jsx(x,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"시작일"}),a.jsxs("div",{className:"relative",children:[a.jsx(o,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),a.jsx("input",{type:"date",name:"validFrom",value:g.validFrom||"",onChange:F,className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"종료일"}),a.jsxs("div",{className:"relative",children:[a.jsx(o,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),a.jsx("input",{type:"date",name:"validUntil",value:g.validUntil||"",onChange:F,className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})})]}),a.jsxs(m,{children:[a.jsx(u,{children:a.jsx(p,{children:"추가 옵션"})}),a.jsx(x,{className:"space-y-4",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",name:"freeShipping",checked:g.freeShipping,onChange:F,className:"mr-3 rounded"}),a.jsx("span",{className:"text-sm",children:"무료 배송 포함"})]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",name:"excludeSaleItems",checked:g.excludeSaleItems,onChange:F,className:"mr-3 rounded"}),a.jsx("span",{className:"text-sm",children:"세일 상품 제외"})]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",name:"individualUseOnly",checked:g.individualUseOnly,onChange:F,className:"mr-3 rounded"}),a.jsx("span",{className:"text-sm",children:"다른 쿠폰과 중복 사용 불가"})]})]})})]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx(d,{type:"button",variant:"outline",onClick:()=>j("/ecommerce/coupons"),children:"취소"}),a.jsx(d,{type:"submit",disabled:w,children:w?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"저장 중..."]}):a.jsxs(a.Fragment,{children:[a.jsx(t,{className:"w-4 h-4 mr-2"}),b?"수정":"생성"]})})]})]})]})};export{j as default};
