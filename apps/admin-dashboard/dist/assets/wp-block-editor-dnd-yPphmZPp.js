import{s as e}from"./wp-block-editor-store-BOagVFfu.js";import{a as t}from"./wp-block-editor-menus-CucXu4UM.js";import{j as n,r as o}from"./vendor-react-DqgGMt48.js";import{B as r,u as i,a as l,b as c,F as s,e as a,G as d,H as u}from"./wp-block-editor-misc-Bvzg-2Jv.js";import{e as g,j as f,k as p,t as b,l as k}from"./wp-core-BVMytgUH.js";import{Flex as m,FlexItem as h,__unstableMotion as v,Draggable as x,Popover as I,__experimentalHStack as B,__experimentalTruncate as C,Dropdown as w,Button as D,Icon as j,ToolbarDropdownMenu as y}from"./wp-components-Uj2D7Nfy.js";import{a as _,f as R,A as E,z as T,y as S,c as N,t as M}from"./wp-blocks-core-65VcejHr.js";import{a as O,s as L,b as P,i as A}from"./wp-i18n-BuBz6Sgx.js";import{J as z,O as Y,G as H,d as W,P as V,Q as Z,R as G,S as U,T as X,U as $,V as q,X as F}from"./wp-misc-DyLrwF9p.js";import{a as J}from"./wp-block-editor-core-BF86nm2P.js";import{G as K,H as Q,I as ee}from"./wp-block-editor-utils-BmaAXcuk.js";import{u as te}from"./wp-block-editor-api-MRWBPx9C.js";import{c as ne}from"./vendor-ui-CrFdsnXa.js";function oe({count:e,icon:t,isPattern:o,fadeWhenDisabled:i}){const l=o&&O("Pattern");return n.jsx("div",{className:"block-editor-block-draggable-chip-wrapper",children:n.jsx("div",{className:"block-editor-block-draggable-chip","data-testid":"block-draggable-chip",children:n.jsxs(m,{justify:"center",className:"block-editor-block-draggable-chip__content",children:[n.jsx(h,{children:t?n.jsx(r,{icon:t}):l||L(P("%d block","%d blocks",e),e)}),n.jsx(h,{children:n.jsx(r,{icon:z})}),i&&n.jsx(h,{className:"block-editor-block-draggable-chip__disabled",children:n.jsx("span",{className:"block-editor-block-draggable-chip__disabled-icon"})})]})})})}const re={hide:{opacity:0,scaleY:.75},show:{opacity:1,scaleY:1},exit:{opacity:0,scaleY:.9}};function ie({__unstablePopoverSlot:o,__unstableContentRef:r}){const{clientId:l}=i(t=>{const{getBlockOrder:n,getBlockInsertionPoint:o}=t(e),r=o(),i=n(r.rootClientId);return i.length?{clientId:i[r.index]}:{}},[]),c=g();return n.jsx(t,{clientId:l,__unstablePopoverSlot:o,__unstableContentRef:r,className:"block-editor-block-popover__drop-zone",children:n.jsx(v.div,{"data-testid":"block-popover-drop-zone",initial:c?re.show:re.hide,animate:re.show,exit:c?re.show:re.exit,className:"block-editor-block-popover__drop-zone-foreground"})})}function le(e,t,n,o,r,i,l,c,s){return a=>{const{srcRootClientId:d,srcClientIds:u,type:g,blocks:f}=function(e){let t={srcRootClientId:null,srcClientIds:null,srcIndex:null,type:null,blocks:null};if(!e.dataTransfer)return t;try{t=Object.assign(t,JSON.parse(e.dataTransfer.getData("wp-blocks")))}catch(n){return t}return t}(a);if("inserter"===g){l();const e=f.map(e=>N(e));i(e,!0,null)}if("block"===g){const l=n(u[0]);if(d===e&&l===t)return;if(u.includes(e)||o(u).some(t=>t===e))return;if("group"===c){const e=u.map(e=>s(e));return void i(e,!0,null,u)}const a=d===e,g=u.length;r(u,d,a&&l<t?t-g:t)}}}function ce(t,n,r={}){const{operation:c="insert",nearestSide:s="right"}=r,{canInsertBlockType:a,getBlockIndex:d,getClientIdsOfDescendants:u,getBlockOrder:g,getBlocksByClientId:f,getSettings:p,getBlock:b}=i(e),{getGroupingBlockName:k}=i(_),{insertBlocks:m,moveBlocksToPosition:h,updateBlockAttributes:v,clearSelectedBlock:x,replaceBlocks:I,removeBlocks:B}=l(e),C=te(),w=o.useCallback((e,o=!0,r=0,i=[])=>{Array.isArray(e)||(e=[e]);const l=g(t)[n];if("replace"===c)I(l,e,void 0,r);else if("group"===c){const n=b(l);"left"===s?e.push(n):e.unshift(n);const o=e.map(e=>R(e.name,e.attributes,e.innerBlocks)),c=e.every(e=>"core/image"===e.name),d=a("core/gallery",t),u=R(c&&d?"core/gallery":k(),{layout:{type:"flex",flexWrap:c&&d?null:"nowrap"}},o);I([l,...i],u,void 0,r)}else m(e,n,t,o,r)},[g,t,n,c,I,b,s,a,k,m]),D=o.useCallback((e,o,r)=>{if("replace"===c){const o=f(e),r=g(t)[n];C.batch(()=>{B(e,!1),I(r,o,void 0,0)})}else h(e,o,t,r)},[c,g,f,h,C,B,I,n,t]),j=le(t,n,d,u,D,w,x,c,b),y=function(e,t,n,o,r){return i=>{if(!t().mediaUpload)return;const l=T(S("from"),t=>"files"===t.type&&o(t.blockName,e)&&t.isMatch(i));if(l){const e=l.transform(i,n);r(e)}}}(t,p,v,a,w),N=function(e){return t=>{const n=E({HTML:t,mode:"BLOCKS"});n.length&&e(n)}}(w);return e=>{const t=Y(e.dataTransfer),n=e.dataTransfer.getData("text/html");n?N(n):t.length?y(t):j(e)}}function se(e,t,n,o){let r=!0;if(t){const e=t?.map(({name:e})=>e);r=n.every(t=>e?.includes(t))}const i=n.map(t=>e(t)).every(e=>{const[t]=e?.parent||[];return!t||t===o});return r&&i}function ae(e,t){const{defaultView:n}=t;return!!(n&&e instanceof n.HTMLElement&&e.dataset.isInsertionPoint)}function de({dropZoneElement:t,rootClientId:n="",parentClientId:r="",isDisabled:s=!1}={}){const a=te(),[d,u]=o.useState({index:null,operation:"insert"}),{getBlockType:g,getBlockVariations:b,getGroupingBlockName:k}=i(_),{canInsertBlockType:m,getBlockListSettings:h,getBlocks:v,getBlockIndex:x,getDraggedBlockClientIds:I,getBlockNamesByClientId:B,getAllowedBlocks:C,isDragging:w,isGroupable:D,isZoomOutMode:j,getSectionRootClientId:y}=c(i(e)),{showInsertionPoint:R,hideInsertionPoint:E,startDragging:T,stopDragging:S}=c(l(e)),N=ce("before"===d.operation||"after"===d.operation?r:n,d.index,{operation:d.operation,nearestSide:d.nearestSide}),O=f(o.useCallback((e,o)=>{w()||T();const i=C(n),l=B([n])[0],c=B(I());if(!se(g,i,c,l))return;const s=y();if(j()&&s!==n)return;const d=v(n);if(0===d.length)return void a.batch(()=>{u({index:0,operation:"insert"}),R(n,0,{operation:"insert"})});const f=function(e,t,n="vertical",o={}){const r="horizontal"===n?["left","right"]:["top","bottom"];let i=0,l="before",c=1/0,s=null,a="right";const{dropZoneElement:d,parentBlockOrientation:u,rootBlockIndex:g=0}=o;if(d&&"horizontal"!==u){const e=d.getBoundingClientRect(),[n,o]=K(t,e,["top","bottom"]);if(e.height>120&&n<30){if("top"===o)return[g,"before"];if("bottom"===o)return[g+1,"after"]}}const f=A();if(d&&"horizontal"===u){const e=d.getBoundingClientRect(),[n,o]=K(t,e,["left","right"]);if(e.width>120&&n<30){if(f&&"right"===o||!f&&"left"===o)return[g,"before"];if(f&&"left"===o||!f&&"right"===o)return[g+1,"after"]}}e.forEach(({isUnmodifiedDefaultBlock:e,getBoundingClientRect:o,blockIndex:d,blockOrientation:u})=>{const g=o();let[p,b]=K(t,g,r);const[k,m]=K(t,g,["left","right"]),h=Q(t,g);e&&h?p=0:"vertical"===n&&"horizontal"!==u&&(h&&k<30||!h&&ee(t,g))&&(s=d,a=m),p<c&&(l="bottom"===b||!f&&"right"===b||f&&"left"===b?"after":"before",c=p,i=d)});const p=i+("after"===l?1:-1),b=!!e[i]?.isUnmodifiedDefaultBlock,k=!!e[p]?.isUnmodifiedDefaultBlock;if(null!==s)return[s,"group",a];if(!b&&!k)return["after"===l?i+1:i,"insert"];return[b?i:p,"replace"]}(d.map(e=>{const t=e.clientId;return{isUnmodifiedDefaultBlock:M(e),getBoundingClientRect:()=>o.getElementById(`block-${t}`).getBoundingClientRect(),blockIndex:x(t),blockOrientation:h(t)?.orientation}}),{x:e.clientX,y:e.clientY},h(n)?.orientation,{dropZoneElement:t,parentBlockOrientation:r?h(r)?.orientation:void 0,rootBlockIndex:x(n)}),[p,_,E]=f;if(!j()||"insert"===_){if("group"===_){const e=d[p],t=[e.name,...c].every(e=>"core/image"===e),o=m("core/gallery",n),r=D([e.clientId,I()]),i=b(k(),"block"),l=i&&i.find(({name:e})=>"group-row"===e);if(t&&!o&&(!r||!l))return;if(!(t||r&&l))return}a.batch(()=>{u({index:p,operation:_,nearestSide:E});const e=["before","after"].includes(_)?r:n;R(e,p,{operation:_,nearestSide:E})})}},[w,C,n,B,I,g,y,j,v,h,t,r,x,a,T,R,m,D,b,k]),200);return p({dropZoneElement:t,isDisabled:s,onDrop:N,onDragOver(e){O(e,e.currentTarget.ownerDocument)},onDragLeave(e){const{ownerDocument:t}=e.currentTarget;ae(e.relatedTarget,t)||ae(e.target,t)||(O.cancel(),E())},onDragEnd(){O.cancel(),S(),E()}})}const ue=({appendToOwnerDocument:t,children:r,clientIds:c,cloneClassname:s,elementId:a,onDragStart:d,onDragEnd:u,fadeWhenDisabled:g=!1,dragComponent:f})=>{const{srcRootClientId:p,isDraggable:k,icon:m,visibleInserter:h,getBlockType:v}=i(t=>{const{canMoveBlocks:n,getBlockRootClientId:o,getBlockName:r,getBlockAttributes:i,isBlockInsertionPointVisible:l}=t(e),{getBlockType:s,getActiveBlockVariation:a}=t(_),d=o(c[0]),u=r(c[0]),g=a(u,i(c[0]));return{srcRootClientId:d,isDraggable:n(c),icon:g?.icon||s(u)?.icon,visibleInserter:l(),getBlockType:s}},[c]),I=o.useRef(!1),[B,C,w]=function(){const e=o.useRef(null),t=o.useRef(null),n=o.useRef(null),r=o.useRef(null);return o.useEffect(()=>()=>{r.current&&(clearInterval(r.current),r.current=null)},[]),[o.useCallback(o=>{e.current=o.clientY,n.current=H(o.target),r.current=setInterval(()=>{if(n.current&&t.current){const e=n.current.scrollTop+t.current;n.current.scroll({top:e})}},25)},[]),o.useCallback(o=>{if(!n.current)return;const r=n.current.offsetHeight,i=e.current-n.current.offsetTop,l=o.clientY-n.current.offsetTop;if(o.clientY>i){const e=Math.max(r-i-50,0),n=Math.max(l-i-50,0),o=0===e||0===n?0:n/e;t.current=25*o}else if(o.clientY<i){const e=Math.max(i-50,0),n=Math.max(i-l-50,0),o=0===e||0===n?0:n/e;t.current=-25*o}else t.current=0},[]),()=>{e.current=null,n.current=null,r.current&&(clearInterval(r.current),r.current=null)}]}(),{getAllowedBlocks:D,getBlockNamesByClientId:j,getBlockRootClientId:y}=i(e),{startDraggingBlocks:R,stopDraggingBlocks:E}=l(e);o.useEffect(()=>()=>{I.current&&E()},[]);const T=J(c[0]),S=T?.closest("body");if(o.useEffect(()=>{if(!S||!g)return;const e=b(e=>{if(!e.target.closest("[data-block]"))return;const t=j(c),n=e.target.closest("[data-block]").getAttribute("data-block"),o=D(n),r=j([n])[0];let i;if(0===o?.length){const e=y(n),o=j([e])[0],r=D(e);i=se(v,r,t,o)}else i=se(v,o,t,r);i||h?window?.document?.body?.classList?.remove("block-draggable-invalid-drag-token"):window?.document?.body?.classList?.add("block-draggable-invalid-drag-token")},200);return S.addEventListener("dragover",e),()=>{S.removeEventListener("dragover",e)}},[c,S,g,D,j,y,v,h]),!k)return r({draggable:!1});const N={type:"block",srcClientIds:c,srcRootClientId:p};return n.jsx(x,{appendToOwnerDocument:t,cloneClassname:s,__experimentalTransferDataType:"wp-blocks",transferData:N,onDragStart:e=>{window.requestAnimationFrame(()=>{R(c),I.current=!0,B(e),d&&d()})},onDragOver:C,onDragEnd:()=>{E(),I.current=!1,w(),u&&u()},__experimentalDragComponent:void 0!==f?f:n.jsx(oe,{count:c.length,icon:m,fadeWhenDisabled:!0}),elementId:a,children:({onDraggableStart:e,onDraggableEnd:t})=>r({draggable:!0,onDragStart:e,onDragEnd:t})})};function ge({draggedBlockClientId:e,listViewRef:t,blockDropTarget:i}){const l=s(e),c=a({clientId:e,context:"list-view"}),{rootClientId:u,clientId:g,dropPosition:f}=i||{},[p,b]=o.useMemo(()=>{if(!t.current)return[];return[u?t.current.querySelector(`[data-block="${u}"]`):void 0,g?t.current.querySelector(`[data-block="${g}"]`):void 0]},[t,u,g]),k=b||p,m=A(),h=o.useCallback((e,t)=>{if(!k)return 0;let n=k.offsetWidth;const o=H(k,"horizontal"),r=k.ownerDocument,i=o===r.body||o===r.documentElement;if(o&&!i){const r=o.getBoundingClientRect(),i=A()?r.right-e.right:e.left-r.left,l=o.clientWidth;if(l<n+i&&(n=l-i),!m&&e.left+t<r.left)return n-=r.left-e.left,n;if(m&&e.right-t>r.right)return n-=e.right-r.right,n}return n-t},[m,k]),v=o.useMemo(()=>{if(!k)return{};const e=k.getBoundingClientRect();return{width:h(e,0)}},[h,k]),x=o.useMemo(()=>{if(!k)return{};const e=H(k),t=k.ownerDocument,n=e===t.body||e===t.documentElement;if(e&&!n){const t=e.getBoundingClientRect(),n=k.getBoundingClientRect(),o=m?t.right-n.right:n.left-t.left;if(!m&&t.left>n.left)return{transform:`translateX( ${o}px )`};if(m&&t.right<n.right)return{transform:`translateX( ${-1*o}px )`}}return{}},[m,k]),w=o.useMemo(()=>{if(!p)return 1;const e=parseInt(p.getAttribute("aria-level"),10);return e?e+1:1},[p]),D=o.useMemo(()=>!!k&&k.classList.contains("is-branch-selected"),[k]),j=o.useMemo(()=>{if(k&&("top"===f||"bottom"===f||"inside"===f))return{contextElement:k,getBoundingClientRect(){const e=k.getBoundingClientRect();let t=e.left,n=0;const o=H(k,"horizontal"),r=k.ownerDocument,i=o===r.body||o===r.documentElement;if(o&&!i){const e=o.getBoundingClientRect(),n=m?o.offsetWidth-o.clientWidth:0;t<e.left+n&&(t=e.left+n)}n="top"===f?e.top-2*e.height:e.top;const l=h(e,0),c=e.height;return new window.DOMRect(t,n,l,c)}}},[k,f,h,m]);return k?n.jsx(I,{animate:!1,anchor:j,focusOnMount:!1,className:"block-editor-list-view-drop-indicator--preview",variant:"unstyled",flip:!1,resize:!0,children:n.jsx("div",{style:v,className:ne("block-editor-list-view-drop-indicator__line",{"block-editor-list-view-drop-indicator__line--darker":D}),children:n.jsxs("div",{className:"block-editor-list-view-leaf","aria-level":w,children:[n.jsxs("div",{className:ne("block-editor-list-view-block-select-button","block-editor-list-view-block-contents"),style:x,children:[n.jsx(d,{onClick:()=>{}}),n.jsx(r,{icon:l?.icon,showColors:!0,context:"list-view"}),n.jsx(B,{alignment:"center",className:"block-editor-list-view-block-select-button__label-wrapper",justify:"flex-start",spacing:1,children:n.jsx("span",{className:"block-editor-list-view-block-select-button__title",children:n.jsx(C,{ellipsizeMode:"auto",children:c})})})]}),n.jsx("div",{className:"block-editor-list-view-block__menu-cell"})]})})}):null}const fe=24;function pe(e,t){const n=e[t+1];return n&&n.isDraggedBlock?pe(e,t+1):n}const be=["top","bottom"];function ke(e,t,n=!1){let o,r,i,l,c;for(let u=0;u<e.length;u++){const n=e[u];if(n.isDraggedBlock)continue;const s=n.element.getBoundingClientRect(),[a,d]=K(t,s,be),g=Q(t,s);if(void 0===i||a<i||g){i=a;const t=e.indexOf(n),u=e[t-1];if("top"===d&&u&&u.rootClientId===n.rootClientId&&!u.isDraggedBlock?(r=u,o="bottom",l=u.element.getBoundingClientRect(),c=t-1):(r=n,o=d,l=s,c=t),g)break}}if(!r)return;const s=function(e,t){const n=[];let o=e;for(;o;)n.push({...o}),o=t.find(e=>e.clientId===o.rootClientId);return n}(r,e),a="bottom"===o;if(a&&r.canInsertDraggedBlocksAsChild&&(r.innerBlockCount>0&&r.isExpanded||function(e,t,n=1,o=!1){const r=o?t.right-n*fe:t.left+n*fe;return(o?e.x<r-fe:e.x>r+fe)&&e.y<t.bottom}(t,l,s.length,n))){const e=r.isExpanded?0:r.innerBlockCount||0;return{rootClientId:r.clientId,clientId:r.clientId,blockIndex:e,dropPosition:"inside"}}if(a&&r.rootClientId&&function(e,t,n=1,o=!1){const r=o?t.right-n*fe:t.left+n*fe;return o?e.x>r:e.x<r}(t,l,s.length,n)){const i=pe(e,c),a=r.nestingLevel,d=i?i.nestingLevel:1;if(a&&d){const u=function(e,t,n=1,o=!1){const r=o?t.right-n*fe:t.left+n*fe,i=o?r-e.x:e.x-r,l=Math.round(i/fe);return Math.abs(l)}(t,l,s.length,n),g=Math.max(Math.min(u,a-d),0);if(s[g]){let t=r.blockIndex;if(s[g].nestingLevel===i?.nestingLevel)t=i?.blockIndex;else for(let n=c;n>=0;n--){const o=e[n];if(o.rootClientId===s[g].rootClientId){t=o.blockIndex+1;break}}return{rootClientId:s[g].rootClientId,clientId:r.clientId,blockIndex:t,dropPosition:o}}}}if(!r.canInsertDraggedBlocksAsSibling)return;const d=a?1:0;return{rootClientId:r.rootClientId,clientId:r.clientId,blockIndex:r.blockIndex+d,dropPosition:o}}const me={leading:!1,trailing:!0};function he({dropZoneElement:t,expandedState:n,setExpandedState:r}){const{getBlockRootClientId:l,getBlockIndex:c,getBlockCount:s,getDraggedBlockClientIds:a,canInsertBlocks:d}=i(e),[u,g]=o.useState(),{rootClientId:b,blockIndex:m}=u||{},h=ce(b,m),v=A(),x=k(b),I=o.useCallback((e,t)=>{const{rootClientId:n}=t||{};n&&("inside"!==t?.dropPosition||e[n]||r({type:"expand",clientIds:[n]}))},[r]),B=f(I,500,me);o.useEffect(()=>{"inside"===u?.dropPosition&&x===u?.rootClientId?B(n,u):B.cancel()},[n,x,u,B]);const C=a(),w=f(o.useCallback((e,t)=>{const n={x:e.clientX,y:e.clientY},o=!!C?.length,r=ke(Array.from(t.querySelectorAll("[data-block]")).map(e=>{const t=e.dataset.block,n="true"===e.dataset.expanded,r=e.classList.contains("is-dragging"),i=parseInt(e.getAttribute("aria-level"),10),a=l(t);return{clientId:t,isExpanded:n,rootClientId:a,blockIndex:c(t),element:e,nestingLevel:i||void 0,isDraggedBlock:!!o&&r,innerBlockCount:s(t),canInsertDraggedBlocksAsSibling:!o||d(C,a),canInsertDraggedBlocksAsChild:!o||d(C,t)}}),n,v);r&&g(r)},[d,C,s,c,l,v]),50);return{ref:p({dropZoneElement:t,onDrop(e){w.cancel(),u&&h(e),g(void 0)},onDragLeave(){w.cancel(),g(null)},onDragOver(e){w(e,e.currentTarget)},onDragEnd(){w.cancel(),g(void 0)}}),target:u}}function ve({isEnabled:e,onToggle:t,isOpen:o,innerRef:r,...i}){return n.jsx(D,{__next40pxDefaultSize:!0,...i,ref:r,icon:V,"aria-expanded":o,"aria-haspopup":"true",onClick:e?t:void 0,label:O("List view"),className:"block-editor-block-navigation","aria-disabled":!e})}const xe=o.forwardRef(function({isDisabled:t,...o},r){W("wp.blockEditor.BlockNavigationDropdown",{since:"6.1",alternative:"wp.components.Dropdown and wp.blockEditor.ListView"});const l=i(t=>!!t(e).getBlockCount(),[])&&!t;return n.jsx(w,{contentClassName:"block-editor-block-navigation__popover",popoverProps:{placement:"bottom-start"},renderToggle:({isOpen:e,onToggle:t})=>n.jsx(ve,{...o,innerRef:r,isOpen:e,onToggle:t,isEnabled:l}),renderContent:()=>n.jsxs("div",{className:"block-editor-block-navigation__container",children:[n.jsx("p",{className:"block-editor-block-navigation__label",children:O("List view")}),n.jsx(u,{})]})})}),Ie={0:F,1:q,2:$,3:X,4:U,5:G,6:Z};function Be({level:e}){return Ie[e]?n.jsx(j,{icon:Ie[e]}):null}const Ce=[1,2,3,4,5,6],we={className:"block-library-heading-level-dropdown"};function De({options:e=Ce,value:t,onChange:o}){const r=e.filter(e=>0===e||Ce.includes(e)).sort((e,t)=>e-t);return n.jsx(y,{popoverProps:we,icon:n.jsx(Be,{level:t}),label:O("Change level"),controls:r.map(e=>{const r=e===t;return{icon:n.jsx(Be,{level:e}),title:0===e?O("Paragraph"):L(O("Heading %d"),e),isActive:r,onClick(){o(e)},role:"menuitemradio"}})})}export{ie as B,De as H,ge as L,ue as a,he as b,oe as c,xe as d,de as u};
