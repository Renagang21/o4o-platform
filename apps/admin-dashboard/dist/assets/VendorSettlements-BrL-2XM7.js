import{r as e,j as t,df as s,bV as r,cw as a,bF as n,b$ as i,bg as d,V as l}from"./vendor-react-BQ6HOJoh.js";import{u as o,a as c,b as m}from"./vendor-query-LYSOqK5P.js";import{B as x,I as p,L as j,b as h}from"./page-template-editor-C7FodHrK.js";import{ak as u,al as v,am as b,an as y,az as g,aA as N,aB as f,aC as w,aD as k,aE as C,av as S}from"./wp-misc-DS9m4_P2.js";import"./wp-block-editor-a11y-DrduSWFW.js";import"./wp-block-editor-misc-pHCPYvR2.js";import"./wp-block-editor-api-Buev8_QU.js";import"./wp-block-editor-utils-M5qXzE1L.js";import"./wp-block-editor-colors-D38h-Odz.js";import"./wp-blocks-core-6vwQKPfS.js";import"./wp-block-editor-clipboard-Dg0Y1gQ6.js";import"./wp-block-editor-store-B-g1aSix.js";import"./vendor-ui-CrFdsnXa.js";import"./wp-block-editor-dnd-BYoS8-II.js";import"./wp-block-editor-library-BpQvynjE.js";import"./wp-block-editor-menus-BTQ2wZ-f.js";import"./wp-block-editor-keyboard-CeHTtvP5.js";import"./wp-block-editor-typography-Bl_1REQP.js";import"./wp-block-editor-spacing-BD_2CpN7.js";import"./wp-block-editor-core-DL280tSA.js";import"./wp-block-editor-selection-CC4tJpUu.js";import"./wp-block-editor-formats-CLXkimOp.js";import"./wp-block-editor-inline-CpXpUhQU.js";import"./wp-block-editor-ui-B8YE_4QL.js";import"./wp-block-editor-transforms-jLcKa8Hv.js";import"./wp-block-editor-preview-iw2Xu1ib.js";import"./wp-block-editor-global-styles-CV5-K6QF.js";import"./wp-block-editor-borders-BH1devca.js";import"./wp-block-editor-patterns-BXdHo9lm.js";import"./wp-block-editor-navigation-BFSoKzg0.js";import"./wp-block-editor-media-Bg-JiQDT.js";import"./wp-api-BeoadipR.js";import"./wp-i18n-DGPtqsXY.js";import"./wp-core-Y-jV-nrZ.js";import"./vendor-monaco-BxJH8uUv.js";import"./wp-block-editor-upload-BLw1R9wP.js";import"./vendor-utils-D-spY-QM.js";import"./wp-block-editor-templates-o1_wAMb9.js";import"./wp-data-BmtL8k4r.js";import"./wp-components-CeQNCpMW.js";const A=()=>{const A=o(),[F,L]=e.useState(""),[q,D]=e.useState("all"),[P,U]=e.useState([]),[$,z]=e.useState(!1),[R,E]=e.useState(""),{data:I,isLoading:K}=c({queryKey:["vendor-settlements",F,q],queryFn:async()=>{const e=new URLSearchParams;F&&e.append("search",F),"all"!==q&&e.append("status",q);return(await h.api.get(`/v1/settlements/vendors?${e}`)).data}}),O=I?.data||[],B=m({mutationFn:async e=>(await h.api.post("/v1/settlements/vendors/approve-bulk",e)).data,onSuccess:()=>{l.success("정산이 승인되었습니다"),A.invalidateQueries({queryKey:["vendor-settlements"]}),U([]),z(!1),E("")},onError:()=>{l.error("정산 승인 중 오류가 발생했습니다")}}),M=m({mutationFn:async({id:e,action:t,memo:s})=>(await h.api.post(`/v1/settlements/vendors/${e}/${t}`,{memo:s})).data,onSuccess:(e,t)=>{const s="approve"===t.action?"승인":"reject"===t.action?"거부":"처리";l.success(`정산이 ${s}되었습니다`),A.invalidateQueries({queryKey:["vendor-settlements"]})}}),Q=m({mutationFn:async e=>(await h.api.post("/v1/settlements/vendors/export",{settlementIds:e},{responseType:"blob"})).data,onSuccess:e=>{const t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`settlements_${(new Date).toISOString().split("T")[0]}.xlsx`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(t),l.success("정산 데이터가 다운로드되었습니다")}}),T=e=>{switch(e){case"pending":return t.jsx(S,{variant:"outline",className:"text-orange-600 border-orange-600",children:"승인 대기"});case"approved":return t.jsx(S,{variant:"outline",className:"text-blue-600 border-blue-600",children:"승인됨"});case"processing":return t.jsx(S,{variant:"outline",className:"text-purple-600 border-purple-600",children:"처리중"});case"completed":return t.jsx(S,{children:"완료"});case"failed":return t.jsx(S,{variant:"secondary",children:"실패"});default:return t.jsx(S,{variant:"outline",children:e})}},V=e=>`₩${e.toLocaleString()}`,_=e=>new Date(e).toLocaleDateString("ko-KR"),G=O.filter(e=>"pending"===e.status),H=G.reduce((e,t)=>e+t.netAmount,0);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"판매자 정산 관리"}),t.jsx("p",{className:"text-modern-text-secondary mt-1",children:"판매자별 정산 승인 및 처리"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(x,{variant:"outline",onClick:()=>{const e=P.length>0?P:O.map(e=>e.id);Q.mutate(e)},disabled:Q.isPending,children:[t.jsx(s,{className:"w-4 h-4 mr-2"}),"엑셀 다운로드"]}),t.jsxs(x,{onClick:()=>{0!==P.length?z(!0):l.error("승인할 정산을 선택하세요")},disabled:0===P.length,children:[t.jsx(r,{className:"w-4 h-4 mr-2"}),"일괄 승인 (",P.length,")"]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs(u,{children:[t.jsx(v,{className:"pb-2",children:t.jsxs(b,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[t.jsx(a,{className:"w-4 h-4"}),"승인 대기"]})}),t.jsxs(y,{children:[t.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[G.length,"건"]}),t.jsx("div",{className:"text-xs text-modern-text-tertiary mt-1",children:V(H)})]})]}),t.jsxs(u,{children:[t.jsx(v,{className:"pb-2",children:t.jsxs(b,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[t.jsx(r,{className:"w-4 h-4"}),"완료"]})}),t.jsxs(y,{children:[t.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[O.filter(e=>"completed"===e.status).length,"건"]}),t.jsx("div",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]}),t.jsxs(u,{children:[t.jsx(v,{className:"pb-2",children:t.jsxs(b,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[t.jsx(n,{className:"w-4 h-4"}),"정산 판매자"]})}),t.jsx(y,{children:t.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[new Set(O.map(e=>e.vendorId)).size,"명"]})})]}),t.jsxs(u,{children:[t.jsx(v,{className:"pb-2",children:t.jsxs(b,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[t.jsx(i,{className:"w-4 h-4"}),"총 정산 금액"]})}),t.jsx(y,{children:t.jsx("div",{className:"text-2xl font-bold text-modern-text-primary",children:V(O.reduce((e,t)=>e+t.netAmount,0))})})]})]}),t.jsx(u,{children:t.jsx(y,{className:"pt-6",children:t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-modern-text-tertiary w-4 h-4"}),t.jsx(p,{placeholder:"판매자명, 이메일로 검색...",value:F,onChange:e=>L(e.target.value),className:"pl-10"})]})}),t.jsxs("select",{value:q,onChange:e=>D(e.target.value),className:"px-4 py-2 border border-modern-border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-modern-primary",children:[t.jsx("option",{value:"all",children:"모든 상태"}),t.jsx("option",{value:"pending",children:"승인 대기"}),t.jsx("option",{value:"approved",children:"승인됨"}),t.jsx("option",{value:"processing",children:"처리중"}),t.jsx("option",{value:"completed",children:"완료"}),t.jsx("option",{value:"failed",children:"실패"})]})]})})}),t.jsxs(u,{children:[t.jsx(v,{children:t.jsx(b,{children:"정산 목록"})}),t.jsx(y,{children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-modern-bg-tertiary border-b border-modern-border-primary",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left",children:t.jsx("input",{type:"checkbox",onChange:e=>{e.target.checked?U(O.map(e=>e.id)):U([])},checked:P.length===O.length&&O.length>0})}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"판매자"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"정산 기간"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"매출액"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"수수료"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"정산액"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상태"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"요청일"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"작업"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-modern-border-primary",children:K?t.jsx("tr",{children:t.jsx("td",{colSpan:9,className:"px-4 py-8 text-center",children:t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-modern-primary"})})})}):0===O.length?t.jsx("tr",{children:t.jsx("td",{colSpan:9,className:"px-4 py-8 text-center text-modern-text-secondary",children:"정산 데이터가 없습니다."})}):O.map(e=>t.jsxs("tr",{className:"hover:bg-modern-bg-hover",children:[t.jsx("td",{className:"px-4 py-4",children:t.jsx("input",{type:"checkbox",checked:P.includes(e.id),onChange:t=>{t.target.checked?U([...P,e.id]):U(P.filter(t=>t!==e.id))}})}),t.jsx("td",{className:"px-4 py-4",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:e.vendorName}),t.jsx("div",{className:"text-sm text-modern-text-secondary",children:e.vendorEmail})]})}),t.jsxs("td",{className:"px-4 py-4",children:[t.jsxs("div",{className:"text-sm text-modern-text-primary",children:[_(e.settlementPeriod.startDate)," ~ ",_(e.settlementPeriod.endDate)]}),t.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:[e.orderCount,"건 주문"]})]}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:V(e.totalSales)})}),t.jsxs("td",{className:"px-4 py-4",children:[t.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["플랫폼: ",V(e.platformFee)]}),t.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:["토스: ",V(e.tossFee)]})]}),t.jsxs("td",{className:"px-4 py-4",children:[t.jsx("div",{className:"text-sm font-medium text-green-600",children:V(e.netAmount)}),e.taxAmount>0&&t.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:["세금: ",V(e.taxAmount)]})]}),t.jsx("td",{className:"px-4 py-4",children:T(e.status)}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"text-sm text-modern-text-secondary",children:_(e.requestedAt)})}),t.jsx("td",{className:"px-4 py-4",children:t.jsxs("div",{className:"flex gap-2",children:["pending"===e.status&&t.jsxs(t.Fragment,{children:[t.jsx(x,{size:"sm",onClick:()=>M.mutate({id:e.id,action:"approve"}),disabled:M.isPending,children:"승인"}),t.jsx(x,{size:"sm",variant:"outline",onClick:()=>M.mutate({id:e.id,action:"reject"}),disabled:M.isPending,children:"거부"})]}),e.receiptUrl&&t.jsx(x,{size:"sm",variant:"ghost",onClick:()=>window.open(e.receiptUrl,"_blank"),children:"영수증"})]})})]},e.id))})]})})})]}),t.jsx(g,{open:$,onOpenChange:z,children:t.jsxs(N,{children:[t.jsxs(f,{children:[t.jsx(w,{children:"정산 일괄 승인"}),t.jsxs(k,{children:["선택한 ",P.length,"건의 정산을 승인하시겠습니까?"]})]}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"p-4 bg-modern-bg-secondary rounded-lg",children:[t.jsx("div",{className:"text-sm font-medium text-modern-text-secondary mb-2",children:"승인 요약"}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"총 정산건수"}),t.jsxs("span",{className:"font-medium",children:[P.length,"건"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"총 정산금액"}),t.jsx("span",{className:"font-medium text-green-600",children:V(O.filter(e=>P.includes(e.id)).reduce((e,t)=>e+t.netAmount,0))})]})]}),t.jsxs("div",{children:[t.jsx(j,{htmlFor:"approvalMemo",children:"메모 (선택)"}),t.jsx(p,{id:"approvalMemo",value:R,onChange:e=>E(e.target.value),placeholder:"승인 관련 메모를 입력하세요"})]})]}),t.jsxs(C,{children:[t.jsx(x,{variant:"outline",onClick:()=>z(!1),children:"취소"}),t.jsx(x,{onClick:()=>{const e=O.filter(e=>P.includes(e.id)).reduce((e,t)=>e+t.netAmount,0);B.mutate({settlementIds:P,totalAmount:e,memo:R})},disabled:B.isPending,children:"승인 확정"})]})]})})]})};export{A as default};
