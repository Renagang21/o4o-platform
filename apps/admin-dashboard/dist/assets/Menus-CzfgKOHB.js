import{a3 as e,V as s,j as a,P as t,bu as r,E as l,cc as i,D as n,a as c,X as d,bP as o,a4 as m,r as h,a5 as x,a1 as u,cf as p,d as j,c as g,cN as v,n as y,d3 as N,F as f,bZ as b,b_ as w}from"./vendor-react-Bb0TGSr4.js";import{j as C,B as D,s as k,C as A,k as S,l as F,D as E,n as q,o as I,r as $,m as K,L as P,I as L,S as _,f as z,g as O,h as Q,i as V,a as M,b as T,d as U,e as J,w as B,x as R,y as Z,z as G,E as H,F as W}from"./page-gutenberg-CGPrHM9_.js";import{S as X}from"./page-template-editor-jCKIl0_P.js";import{u as Y,a as ee,b as se}from"./vendor-query-BEO_OofR.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-B-KQWpLj.js";import"./wp-foundation-Ht0JG6Uo.js";import"./wp-components-CoD93iDH.js";const ae={primary:"주 메뉴",footer:"푸터",sidebar:"사이드바",mobile:"모바일"},te={primary:"bg-blue-100 text-blue-800",footer:"bg-gray-100 text-gray-800",sidebar:"bg-green-100 text-green-800",mobile:"bg-purple-100 text-purple-800"},re=()=>{const m=e(),h=Y(),{data:x,isLoading:u}=ee({queryKey:["menus"],queryFn:async()=>{const e=new Date;return{menus:[{id:"1",name:"Main Menu",location:"primary",items:[],isActive:!0,createdAt:e,updatedAt:e},{id:"2",name:"Footer Menu",location:"footer",items:[],isActive:!0,createdAt:e,updatedAt:e}]}}}),p=x?.menus||[],j=se({mutationFn:async e=>C.api.delete(`/v1/menus/${e}`),onSuccess:()=>{h.invalidateQueries({queryKey:["menus"]}),s.success("메뉴가 삭제되었습니다")},onError:()=>{s.error("메뉴 삭제에 실패했습니다")}}),g=se({mutationFn:async({id:e,isActive:s})=>C.api.patch(`/v1/menus/${e}/active`,{isActive:s}),onSuccess:()=>{h.invalidateQueries({queryKey:["menus"]}),s.success("메뉴 상태가 변경되었습니다")},onError:()=>{s.error("메뉴 상태 변경에 실패했습니다")}}),v=p.reduce((e,s)=>(e[s.location]||(e[s.location]=[]),e[s.location].push(s),e),{});return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"메뉴 관리"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"사이트의 내비게이션 메뉴를 관리합니다"})]}),a.jsxs(D,{onClick:()=>m("/themes/menus/new"),children:[a.jsx(t,{className:"w-4 h-4 mr-2"}),"새 메뉴"]})]}),u?a.jsx("div",{className:"text-center py-12",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"})}):p.length>0?a.jsx("div",{className:"space-y-8",children:["primary","footer","sidebar","mobile"].map(e=>{const s=v[e]||[];return 0===s.length?null:a.jsxs("div",{children:[a.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[a.jsx(k,{className:te[e],children:ae[e]}),a.jsxs("span",{className:"text-sm text-gray-500 font-normal",children:["(",s.length,"개 메뉴)"]})]}),a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:s.map(e=>a.jsxs(A,{children:[a.jsx(S,{className:"pb-3",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"space-y-1 flex-1",children:[a.jsxs(F,{className:"text-lg flex items-center gap-2",children:[a.jsx(r,{className:"w-4 h-4"}),e.name]}),e.description&&a.jsx("p",{className:"text-sm text-gray-500",children:e.description})]}),a.jsxs(E,{children:[a.jsx(q,{children:a.jsx(D,{variant:"ghost",size:"sm",children:a.jsx(l,{className:"w-4 h-4"})})}),a.jsxs(I,{align:"end",children:[a.jsxs($,{onClick:()=>m(`/themes/menus/${e.id}/edit`),children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),"편집"]}),a.jsxs($,{onClick:()=>{return s=e.id,void(confirm("정말 이 메뉴를 삭제하시겠습니까?")&&j.mutate(s));var s},className:"text-red-600",children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]})}),a.jsx(K,{children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"항목 수"}),a.jsxs(k,{variant:"outline",children:[e.items.length,"개"]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"활성화"}),a.jsxs("div",{className:"flex items-center gap-2",children:[e.isActive?a.jsx(c,{className:"w-4 h-4 text-green-600"}):a.jsx(d,{className:"w-4 h-4 text-gray-400"}),a.jsx(X,{checked:e.isActive,onCheckedChange:()=>(e=>{g.mutate({id:e.id,isActive:!e.isActive})})(e),disabled:g.isPending})]})]}),a.jsx("div",{className:"pt-3 border-t",children:a.jsx(o,{to:`/themes/menus/${e.id}/edit`,className:"text-sm text-blue-600 hover:text-blue-800",children:"메뉴 편집 →"})})]})})]},e.id))})]},e)})}):a.jsx(A,{children:a.jsxs(K,{className:"text-center py-12",children:[a.jsx(r,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500 mb-4",children:"메뉴가 없습니다"}),a.jsxs(D,{onClick:()=>m("/themes/menus/new"),children:[a.jsx(t,{className:"w-4 h-4 mr-2"}),"첫 메뉴 만들기"]})]})})]})},le=()=>{const r=e(),{id:l}=m(),c=Y(),d=!!l,[o,b]=h.useState(""),[w,E]=h.useState("primary"),[q,I]=h.useState(""),[$,X]=h.useState([]),[ae,te]=h.useState(!1),[re,le]=h.useState(null),[ie,ne]=h.useState(null),[ce,de]=h.useState(null),[oe,me]=h.useState({label:"",type:"custom",url:"",target:"_self"}),{data:he,isLoading:xe}=ee({queryKey:["menu",l],queryFn:async()=>(await C.api.get(`/v1/menus/${l}`)).data,enabled:d}),{data:ue=[]}=ee({queryKey:["pages-for-menu"],queryFn:async()=>(await C.api.get("/v1/posts?type=page&status=published")).data.posts||[]}),{data:pe=[]}=ee({queryKey:["posts-for-menu"],queryFn:async()=>(await C.api.get("/v1/posts?type=post&status=published&limit=50")).data.posts||[]}),{data:je=[]}=ee({queryKey:["categories-for-menu"],queryFn:async()=>(await C.api.get("/v1/categories")).data}),ge=se({mutationFn:async e=>(await C.api.post("/v1/menus",e)).data,onSuccess:()=>{s.success("메뉴가 생성되었습니다"),c.invalidateQueries({queryKey:["menus"]}),r("/themes/menus")},onError:()=>{s.error("메뉴 생성에 실패했습니다")}}),ve=se({mutationFn:async e=>(await C.api.put(`/v1/menus/${l}`,e)).data,onSuccess:()=>{s.success("메뉴가 수정되었습니다"),c.invalidateQueries({queryKey:["menus"]}),c.invalidateQueries({queryKey:["menu",l]})},onError:()=>{s.error("메뉴 수정에 실패했습니다")}});h.useEffect(()=>{he&&(b(he.name),E(he.location),I(he.description||""),X(he.items.map(e=>({...e,isExpanded:!1}))))},[he]);const ye=()=>{de(null)},Ne=(e,s,a="after")=>{if(e.preventDefault(),e.stopPropagation(),!ie||ie.id===s.id)return;const t=JSON.parse(JSON.stringify($)),r=(e,s)=>{for(let a=0;a<e.length;a++){if(e[a].id===s)return e.splice(a,1)[0];if(e[a].children&&e[a].children.length>0){const t=r(e[a].children,s);if(t)return t}}return null},l=(e,s,a,t)=>{for(let r=0;r<e.length;r++){if(e[r].id===s){if("inside"===t)e[r].children=e[r].children||[],a.parentId=s,e[r].children.push(a),e[r].isExpanded=!0;else{a.parentId=e[r].parentId;const s="before"===t?r:r+1;e.splice(s,0,a)}return!0}if(e[r].children&&e[r].children.length>0&&l(e[r].children,s,a,t))return!0}return!1},i=r(t,ie.id);if(!i)return;l(t,s.id,i,a);const n=(e,s=0)=>{e.forEach((e,a)=>{e.order=s+a,e.children&&e.children.length>0&&n(e.children,0)})};n(t),X(t),ne(null),de(null)},fe=e=>{switch(e){case"page":case"post":return a.jsx(f,{className:"w-4 h-4"});case"category":return a.jsx(N,{className:"w-4 h-4"});default:return a.jsx(y,{className:"w-4 h-4"})}},be=(e,s=0)=>{const t=e.children&&e.children.length>0;return a.jsxs("div",{className:s>0?"ml-8":"",children:[a.jsxs("div",{className:`\n            relative flex items-center gap-2 p-3 bg-white border rounded-lg mb-2 transition-all\n            ${ce===e.id?"border-blue-500 bg-blue-50":"border-gray-200"}\n            ${ie?.id===e.id?"opacity-50":""}\n            hover:shadow-sm\n          `,draggable:!0,onDragStart:s=>((e,s)=>{ne(s),e.dataTransfer.effectAllowed="move"})(s,e),onDragOver:s=>{s.preventDefault(),((e,s)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",de(s)})(s,e.id)},onDragLeave:ye,onDrop:s=>Ne(s,e,"after"),children:[a.jsx(p,{className:"w-5 h-5 text-gray-400 cursor-move flex-shrink-0"}),t&&a.jsx("button",{onClick:()=>{return s=e.id,void X($.map(e=>e.id===s?{...e,isExpanded:!e.isExpanded}:e));var s},className:"p-1 hover:bg-gray-100 rounded",children:e.isExpanded?a.jsx(j,{className:"w-4 h-4"}):a.jsx(g,{className:"w-4 h-4"})}),a.jsxs("div",{className:"flex-1 flex items-center gap-2 min-w-0",children:[fe(e.type),a.jsx("span",{className:"font-medium truncate",children:e.label}),a.jsx(k,{variant:"outline",className:"text-xs flex-shrink-0",children:e.type}),e.url&&a.jsxs("span",{className:"text-sm text-gray-500 truncate hidden sm:block",children:["(",e.url,")"]}),"_blank"===e.target&&a.jsx(v,{className:"w-3 h-3 text-gray-400 flex-shrink-0"})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[a.jsx(D,{variant:"ghost",size:"sm",onClick:()=>(e=>{le(e),me({label:e.label,type:e.type,url:e.url||"",target:e.target||"_self",icon:e.icon,cssClass:e.cssClass,pageId:e.pageId,postId:e.postId,categoryId:e.categoryId}),te(!0)})(e),className:"h-8 w-8 p-0",children:a.jsx(i,{className:"w-4 h-4"})}),a.jsx(D,{variant:"ghost",size:"sm",onClick:()=>(e=>{const s=a=>a.filter(a=>a.id!==e&&(a.children&&a.children.length>0&&(a.children=s(a.children)),!0));X(s($))})(e.id),className:"h-8 w-8 p-0 hover:bg-red-50",children:a.jsx(n,{className:"w-4 h-4 text-red-500"})})]}),a.jsx("div",{className:"absolute inset-x-0 bottom-0 h-8 flex items-end justify-center opacity-0 hover:opacity-100",onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:s=>{s.preventDefault(),s.stopPropagation(),Ne(s,e,"inside")},children:a.jsx("div",{className:"w-full mx-8 h-1 bg-purple-500 rounded-full flex items-center justify-center",children:a.jsx("span",{className:"text-xs bg-purple-500 text-white px-2 py-1 rounded",children:"Drop here to nest"})})})]}),t&&e.isExpanded&&a.jsx("div",{className:"ml-4 pl-4 border-l-2 border-gray-200",children:e.children.map(e=>be(e,s+1))})]},e.id)};return d&&xe?a.jsx("div",{className:"flex items-center justify-center h-96",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):a.jsxs("div",{className:"max-w-6xl mx-auto",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[a.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>r("/themes/menus"),children:[a.jsx(x,{className:"w-4 h-4 mr-2"}),"메뉴 목록"]}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:d?"메뉴 수정":"새 메뉴 만들기"})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"lg:col-span-1",children:[a.jsxs(A,{children:[a.jsx(S,{children:a.jsx(F,{children:"메뉴 설정"})}),a.jsxs(K,{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(P,{htmlFor:"name",children:"메뉴 이름"}),a.jsx(L,{id:"name",value:o,onChange:e=>b(e.target.value),placeholder:"예: 주 메뉴",className:"mt-2"})]}),a.jsxs("div",{children:[a.jsx(P,{htmlFor:"location",children:"메뉴 위치"}),a.jsxs(_,{value:w,onValueChange:e=>E(e),children:[a.jsx(z,{className:"mt-2",children:a.jsx(O,{})}),a.jsxs(Q,{children:[a.jsx(V,{value:"primary",children:"주 메뉴"}),a.jsx(V,{value:"footer",children:"푸터"}),a.jsx(V,{value:"sidebar",children:"사이드바"}),a.jsx(V,{value:"mobile",children:"모바일"})]})]})]}),a.jsxs("div",{children:[a.jsx(P,{htmlFor:"description",children:"설명 (선택)"}),a.jsx(L,{id:"description",value:q,onChange:e=>I(e.target.value),placeholder:"메뉴 설명",className:"mt-2"})]}),a.jsx("div",{className:"pt-4",children:a.jsxs(D,{onClick:()=>{const e=s=>s.map(({isExpanded:s,...a})=>({...a,children:a.children?e(a.children):void 0})),s={name:o,location:w,description:q,items:e($),isActive:!0};d?ve.mutate({id:l,...s}):ge.mutate(s)},className:"w-full",disabled:!o||ge.isPending||ve.isPending,children:[a.jsx(u,{className:"w-4 h-4 mr-2"}),d?"메뉴 수정":"메뉴 생성"]})})]})]}),a.jsxs(A,{className:"mt-6",children:[a.jsx(S,{children:a.jsx(F,{children:"항목 추가"})}),a.jsx(K,{children:a.jsxs(M,{defaultValue:"pages",children:[a.jsxs(T,{className:"grid w-full grid-cols-4",children:[a.jsx(U,{value:"pages",children:"페이지"}),a.jsx(U,{value:"posts",children:"포스트"}),a.jsx(U,{value:"categories",children:"카테고리"}),a.jsx(U,{value:"custom",children:"사용자 정의"})]}),a.jsx(J,{value:"pages",className:"space-y-2",children:ue.map(e=>a.jsxs("div",{className:"p-2 border rounded hover:bg-gray-50 cursor-pointer",onClick:()=>{const s={id:`item-${Date.now()}`,label:e.title,type:"page",pageId:e.id,url:`/${e.slug}`,order:$.length,createdAt:new Date,updatedAt:new Date};X([...$,s])},children:[a.jsx("div",{className:"font-medium",children:e.title}),a.jsxs("div",{className:"text-sm text-gray-500",children:["/",e.slug]})]},e.id))}),a.jsx(J,{value:"posts",className:"space-y-2",children:pe.map(e=>a.jsxs("div",{className:"p-2 border rounded hover:bg-gray-50 cursor-pointer",onClick:()=>{const s={id:`item-${Date.now()}`,label:e.title,type:"post",postId:e.id,url:`/post/${e.slug}`,order:$.length,createdAt:new Date,updatedAt:new Date};X([...$,s])},children:[a.jsx("div",{className:"font-medium",children:e.title}),a.jsxs("div",{className:"text-sm text-gray-500",children:["/post/",e.slug]})]},e.id))}),a.jsx(J,{value:"categories",className:"space-y-2",children:je.map(e=>a.jsxs("div",{className:"p-2 border rounded hover:bg-gray-50 cursor-pointer",onClick:()=>{const s={id:`item-${Date.now()}`,label:e.name,type:"category",categoryId:e.id,url:`/category/${e.slug}`,order:$.length,createdAt:new Date,updatedAt:new Date};X([...$,s])},children:[a.jsx("div",{className:"font-medium",children:e.name}),a.jsxs("div",{className:"text-sm text-gray-500",children:["/category/",e.slug]})]},e.id))}),a.jsx(J,{value:"custom",className:"pt-4",children:a.jsxs(D,{onClick:()=>{le(null),me({label:"",type:"custom",url:"",target:"_self"}),te(!0)},className:"w-full",children:[a.jsx(t,{className:"w-4 h-4 mr-2"}),"사용자 정의 링크 추가"]})})]})})]})]}),a.jsx("div",{className:"lg:col-span-2",children:a.jsxs(A,{children:[a.jsxs(S,{children:[a.jsx(F,{children:"메뉴 구조"}),a.jsx("p",{className:"text-sm text-gray-500",children:"드래그 앤 드롭으로 메뉴 항목의 순서를 변경할 수 있습니다"})]}),a.jsx(K,{children:$.length>0?a.jsx("div",{children:$.map(e=>be(e))}):a.jsxs("div",{className:"text-center py-12 text-gray-500",children:[a.jsx("p",{children:"메뉴 항목이 없습니다"}),a.jsx("p",{className:"text-sm mt-2",children:"왼쪽에서 항목을 추가하세요"})]})})]})})]}),a.jsx(B,{open:ae,onOpenChange:te,children:a.jsxs(R,{children:[a.jsxs(Z,{children:[a.jsx(G,{children:re?"메뉴 항목 수정":"사용자 정의 링크"}),a.jsx(H,{children:"메뉴에 표시될 링크 정보를 입력하세요"})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{children:[a.jsx(P,{htmlFor:"itemLabel",children:"레이블"}),a.jsx(L,{id:"itemLabel",value:oe.label,onChange:e=>me({...oe,label:e.target.value}),placeholder:"메뉴에 표시될 텍스트"})]}),a.jsxs("div",{children:[a.jsx(P,{htmlFor:"itemUrl",children:"URL"}),a.jsx(L,{id:"itemUrl",value:oe.url,onChange:e=>me({...oe,url:e.target.value}),placeholder:"https://example.com 또는 /page-slug"})]}),a.jsxs("div",{children:[a.jsx(P,{htmlFor:"itemTarget",children:"링크 열기"}),a.jsxs(_,{value:oe.target,onValueChange:e=>me({...oe,target:e}),children:[a.jsx(z,{children:a.jsx(O,{})}),a.jsxs(Q,{children:[a.jsx(V,{value:"_self",children:"같은 창"}),a.jsx(V,{value:"_blank",children:"새 창"})]})]})]}),a.jsxs("div",{children:[a.jsx(P,{htmlFor:"itemCssClass",children:"CSS 클래스 (선택)"}),a.jsx(L,{id:"itemCssClass",value:oe.cssClass||"",onChange:e=>me({...oe,cssClass:e.target.value}),placeholder:"custom-class"})]})]}),a.jsxs(W,{children:[a.jsx(D,{variant:"outline",onClick:()=>te(!1),children:"취소"}),a.jsx(D,{onClick:()=>{const e={id:re?.id||`item-${Date.now()}`,...oe,order:re?.order||$.length,parentId:re?.parentId,children:re?.children||[],createdAt:re?.createdAt||new Date,updatedAt:new Date};if(re){const s=a=>a.map(a=>a.id===re.id?{...e,isExpanded:a.isExpanded}:a.children&&a.children.length>0?{...a,children:s(a.children)}:a);X(s($))}else X([...$,e]);te(!1)},children:"저장"})]})]})})]})},ie=()=>a.jsxs(b,{children:[a.jsx(w,{path:"/",element:a.jsx(re,{})}),a.jsx(w,{path:"/new",element:a.jsx(le,{})}),a.jsx(w,{path:"/:id/edit",element:a.jsx(le,{})})]});export{ie as default};
