import{a1 as E,a2 as $,r as g,V as c,j as e,a3 as q,F as T,du as Q,i as I,$ as K}from"./vendor-react-D0umZ417.js";import{u as M,a as B,b as F}from"./vendor-query-CiZyx00p.js";import{j as f,B as v,C as D,k as y,l as N,m as w,L as d,I as o,T as O}from"./page-gutenberg-Bk1xT4fF.js";import"./wp-lazy-CvxKE3_Q.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-monaco-cpVGocfO.js";import"./vendor-utils-DQ8F5vJI.js";const U=()=>{const l=E(),{id:r}=$(),m=M(),n=!!r,[s,C]=g.useState({title:"",description:"",targetParticipantCount:10,startDate:"",endDate:"",forumLink:""}),[a,b]=g.useState({}),{data:p,isLoading:k}=B({queryKey:["crowdfunding-project",r],queryFn:async()=>(await f.api.get(`/v1/crowdfunding-simple/projects/${r}`)).data,enabled:n}),u=F({mutationFn:async t=>(await f.api.post("/v1/crowdfunding-simple/projects",t)).data,onSuccess:()=>{c.success("프로젝트가 생성되었습니다!"),m.invalidateQueries({queryKey:["crowdfunding-projects"]}),l("/crowdfunding/projects")},onError:t=>{c.error(t.response?.data?.error||"프로젝트 생성에 실패했습니다.")}}),x=F({mutationFn:async t=>(await f.api.put(`/v1/crowdfunding-simple/projects/${r}`,t)).data,onSuccess:()=>{c.success("프로젝트가 수정되었습니다!"),m.invalidateQueries({queryKey:["crowdfunding-project",r]}),m.invalidateQueries({queryKey:["crowdfunding-projects"]}),l(`/crowdfunding/projects/${r}`)},onError:t=>{c.error(t.response?.data?.error||"프로젝트 수정에 실패했습니다.")}});g.useEffect(()=>{if(p?.data){const t=p.data;C({title:t.title,description:t.description,targetParticipantCount:t.targetParticipantCount,startDate:t.startDate,endDate:t.endDate,forumLink:t.forumLink||""})}},[p]);const L=()=>{const t={};return s.title.trim()||(t.title="프로젝트 제목을 입력하세요."),s.description.trim()||(t.description="프로젝트 설명을 입력하세요."),s.targetParticipantCount<1&&(t.targetParticipantCount="목표 참여 매장 수는 1개 이상이어야 합니다."),s.startDate||(t.startDate="시작일을 선택하세요."),s.endDate||(t.endDate="종료일을 선택하세요."),s.startDate&&s.endDate&&s.startDate>=s.endDate&&(t.endDate="종료일은 시작일보다 늦어야 합니다."),s.startDate&&new Date(s.startDate)<new Date&&(t.startDate="시작일은 현재 날짜 이후여야 합니다."),b(t),Object.keys(t).length===0},S=t=>{if(t.preventDefault(),!L()){c.error("입력한 정보를 확인해주세요.");return}n?x.mutate(s):u.mutate(s)},i=(t,j)=>{C(h=>({...h,[t]:j})),a[t]&&b(h=>({...h,[t]:void 0}))},P=new Date().toISOString().split("T")[0];return n&&k?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>l(n?`/crowdfunding/projects/${r}`:"/crowdfunding/projects"),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),n?"프로젝트 상세":"프로젝트 목록"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:n?"프로젝트 수정":"새 프로젝트 만들기"})})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs(D,{children:[e.jsx(y,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-modern-primary"}),"프로젝트 기본 정보"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"title",children:"프로젝트 제목 *"}),e.jsx(o,{id:"title",value:s.title,onChange:t=>i("title",t.target.value),placeholder:"예: 친환경 포장재 대량 구매 프로젝트",className:a.title?"border-red-500":""}),a.title&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.title})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"description",children:"프로젝트 설명 *"}),e.jsx(O,{id:"description",value:s.description,onChange:t=>i("description",t.target.value),placeholder:"프로젝트의 목적, 혜택, 예상 절감 비용 등을 상세히 설명해주세요...",rows:8,className:a.description?"border-red-500":""}),a.description&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.description}),e.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:"참여 매장이 이해하기 쉽도록 구체적인 혜택과 절감 효과를 포함해주세요."})]})]})]}),e.jsxs(D,{children:[e.jsx(y,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-modern-primary"}),"목표 및 기간 설정"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"targetParticipantCount",children:"목표 참여 매장 수 *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{id:"targetParticipantCount",type:"number",min:"1",max:"1000",value:s.targetParticipantCount,onChange:t=>i("targetParticipantCount",parseInt(t.target.value)||0),className:`max-w-xs ${a.targetParticipantCount?"border-red-500":""}`}),e.jsx("span",{className:"text-modern-text-secondary",children:"개 매장"})]}),a.targetParticipantCount&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.targetParticipantCount}),e.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:"목표를 달성하면 비용 절감 효과를 얻을 수 있는 최소 참여 매장 수를 설정하세요."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"startDate",children:"프로젝트 시작일 *"}),e.jsx(o,{id:"startDate",type:"date",min:P,value:s.startDate,onChange:t=>i("startDate",t.target.value),className:a.startDate?"border-red-500":""}),a.startDate&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.startDate})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"endDate",children:"프로젝트 종료일 *"}),e.jsx(o,{id:"endDate",type:"date",min:s.startDate||P,value:s.endDate,onChange:t=>i("endDate",t.target.value),className:a.endDate?"border-red-500":""}),a.endDate&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.endDate})]})]})]})]}),e.jsxs(D,{children:[e.jsx(y,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-modern-primary"}),"추가 설정"]})}),e.jsx(w,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(d,{htmlFor:"forumLink",children:"포럼 링크 (선택)"}),e.jsx(o,{id:"forumLink",value:s.forumLink,onChange:t=>i("forumLink",t.target.value),placeholder:"/forum/posts/project-discussion"}),e.jsx("p",{className:"text-sm text-modern-text-secondary mt-1",children:"참여자들이 토론할 수 있는 포럼 페이지 링크를 입력하세요."})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>l(n?`/crowdfunding/projects/${r}`:"/crowdfunding/projects"),children:"취소"}),e.jsxs(v,{type:"submit",disabled:u.isPending||x.isPending,children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),u.isPending||x.isPending?"저장 중...":n?"수정하기":"프로젝트 만들기"]})]})]})]})};export{U as default};
