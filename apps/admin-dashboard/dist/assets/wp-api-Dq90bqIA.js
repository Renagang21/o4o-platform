import"./wp-block-editor-main-DEdKEcH7.js";import{_ as e}from"./wp-i18n-DP14Ry5v.js";import{n as t,g as r,a as o,h as n,b as s,r as a}from"./wp-misc-D0_U3Yh3.js";import"./vendor-react-BqkIXTmC.js";import"./vendor-monaco-BxJH8uUv.js";import"./wp-block-editor-store-Cdz5rmmV.js";import"./wp-blocks-core-C_Umt3qd.js";import"./wp-core-skmJSxj5.js";import"./wp-block-editor-utils-CmROb2t9.js";import"./wp-components-i3qvAB06.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-C9jLuAcl.js";import"./wp-api-Dq90bqIA.js";import"./vendor-query-C5jzPyjL.js";import"./page-template-editor-DmUXhR56.js";import"./wp-data-CsLR-lZb.js";const i=(e,t)=>{let r,o,n=e.path;return"string"==typeof e.namespace&&"string"==typeof e.endpoint&&(r=e.namespace.replace(/^\/|\/$/g,""),o=e.endpoint.replace(/^\//,""),n=o?r+"/"+o:r),delete e.namespace,delete e.endpoint,t({...e,path:n})};function p(e,t){if(t)return Promise.resolve(e.body);try{return Promise.resolve(new window.Response(JSON.stringify(e.body),{status:200,statusText:"OK",headers:e.headers}))}catch{return Object.entries(e.headers).forEach(([t,r])=>{"link"===t.toLowerCase()&&(e.headers[t]=r.replace(/<([^>]+)>/,(e,t)=>`<${encodeURI(t)}>`))}),Promise.resolve(t?e.body:new window.Response(JSON.stringify(e.body),{status:200,statusText:"OK",headers:e.headers}))}}const c=({path:e,url:t,...r},n)=>({...r,url:t&&o(t,n),path:e&&o(e,n)}),d=e=>e.json?e.json():Promise.reject(e),l=e=>{const{next:t}=(e=>{if(!e)return{};const t=e.match(/<([^>]+)>; rel="next"/);return t?{next:t[1]}:{}})(e.headers.get("link"));return t},h=async(e,t)=>{if(!1===e.parse)return t(e);if(!(e=>{const t=!!e.path&&-1!==e.path.indexOf("per_page=-1"),r=!!e.url&&-1!==e.url.indexOf("per_page=-1");return t||r})(e))return t(e);const r=await P({...c(e,{per_page:100}),parse:!1}),o=await d(r);if(!Array.isArray(o))return o;let n=l(r);if(!n)return o;let s=[].concat(o);for(;n;){const t=await P({...e,path:void 0,url:n,parse:!1}),r=await d(t);s=s.concat(r),n=l(t)}return s},u=new Set(["PATCH","PUT","DELETE"]),m="GET",f=(e,t=!0)=>Promise.resolve(((e,t=!0)=>t?204===e.status?null:e.json?e.json():Promise.reject(e):e)(e,t)).catch(e=>w(e,t));function w(t,r=!0){if(!r)throw t;return(t=>{const r={code:"invalid_json",message:e("The response is not a valid JSON response.")};if(!t||!t.json)throw r;return t.json().catch(()=>{throw r})})(t).then(t=>{const r={code:"unknown_error",message:e("An unknown error occurred.")};throw t||r})}const j={Accept:"application/json, */*;q=0.1"},g={credentials:"include"},v=[(e,t)=>("string"!=typeof e.url||n(e.url,"_locale")||(e.url=o(e.url,{_locale:"user"})),"string"!=typeof e.path||n(e.path,"_locale")||(e.path=o(e.path,{_locale:"user"})),t(e)),i,(e,t)=>{const{method:r=m}=e;return u.has(r.toUpperCase())&&(e={...e,headers:{...e.headers,"X-HTTP-Method-Override":r,"Content-Type":"application/json"},method:"POST"}),t(e)},h];const y=e=>{if(e.status>=200&&e.status<300)return e;throw e};let _=t=>{const{url:r,path:o,data:n,parse:s=!0,...a}=t;let{body:i,headers:p}=t;p={...j,...p},n&&(i=JSON.stringify(n),p["Content-Type"]="application/json");return window.fetch(r||o||window.location.href,{...g,...a,body:i,headers:p}).then(e=>Promise.resolve(e).then(y).catch(e=>w(e,s)).then(e=>f(e,s)),t=>{if(t&&"AbortError"===t.name)throw t;throw{code:"fetch_error",message:e("You are probably offline.")}})};function P(e){return v.reduceRight((e,t)=>r=>t(r,e),_)(e).catch(t=>"rest_cookie_invalid_nonce"!==t.code?Promise.reject(t):window.fetch(P.nonceEndpoint).then(y).then(e=>e.text()).then(t=>(P.nonceMiddleware.nonce=t,P(e))))}P.use=function(e){v.unshift(e)},P.setFetchHandler=function(e){_=e},P.createNonceMiddleware=function(e){const t=(e,r)=>{const{headers:o={}}=e;for(const n in o)if("x-wp-nonce"===n.toLowerCase()&&o[n]===t.nonce)return r(e);return r({...e,headers:{...o,"X-WP-Nonce":t.nonce}})};return t.nonce=e,t},P.createPreloadingMiddleware=function(e){const n=Object.fromEntries(Object.entries(e).map(([e,r])=>[t(e),r]));return(e,s)=>{const{parse:a=!0}=e;let i=e.path;if(!i&&e.url){const{rest_route:t,...n}=r(e.url);"string"==typeof t&&(i=o(t,n))}if("string"!=typeof i)return s(e);const c=e.method||"GET",d=t(i);if("GET"===c&&n[d]){const e=n[d];return delete n[d],p(e,!!a)}if("OPTIONS"===c&&n[c]&&n[c][d]){const e=n[c][d];return delete n[c][d],p(e,!!a)}return s(e)}},P.createRootURLMiddleware=e=>(t,r)=>i(t,t=>{let o,n=t.url,s=t.path;return"string"==typeof s&&(o=e,-1!==e.indexOf("?")&&(s=s.replace("?","&")),s=s.replace(/^\//,""),"string"==typeof o&&-1!==o.indexOf("?")&&(s=s.replace("?","&")),n=o+s),r({...t,url:n})}),P.fetchAllMiddleware=h,P.mediaUploadMiddleware=(t,r)=>{if(!function(e){const t=!!e.method&&"POST"===e.method;return(!!e.path&&-1!==e.path.indexOf("/wp/v2/media")||!!e.url&&-1!==e.url.indexOf("/wp/v2/media"))&&t}(t))return r(t);let o=0;const n=e=>(o++,r({path:`/wp/v2/media/${e}/post-process`,method:"POST",data:{action:"create-image-subsizes"},parse:!1}).catch(()=>o<5?n(e):(r({path:`/wp/v2/media/${e}?force=true`,method:"DELETE"}),Promise.reject())));return r({...t,parse:!1}).catch(r=>{if(!r.headers)return Promise.reject(r);const o=r.headers.get("x-wp-upload-attachment-id");return r.status>=500&&r.status<600&&o?n(o).catch(()=>!1!==t.parse?Promise.reject({code:"post_process",message:e("Media upload failed. If this is a photo or a large image, please scale it down and try again.")}):Promise.reject(r)):w(r,t.parse)}).then(e=>f(e,t.parse))},P.createThemePreviewMiddleware=e=>(t,r)=>{if("string"==typeof t.url){const r=s(t.url,"wp_theme_preview");void 0===r?t.url=o(t.url,{wp_theme_preview:e}):""===r&&(t.url=a(t.url,"wp_theme_preview"))}if("string"==typeof t.path){const r=s(t.path,"wp_theme_preview");void 0===r?t.path=o(t.path,{wp_theme_preview:e}):""===r&&(t.path=a(t.path,"wp_theme_preview"))}return r(t)};export{P as default};
