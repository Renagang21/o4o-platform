import{u as e,b as s,r as t,V as r,j as i,A as a,S as n}from"./vendor-react-BoWgD0Bu.js";import{u as d,a as o,b as c}from"./vendor-query-CbBSyLUF.js";import{b as l,B as m,L as u,I as h,S as j,h as x,i as p,j as v,k as y,T as f,m as g}from"./page-template-editor-CWJwXWLM.js";import{cy as b,cz as w,cA as k,cB as N}from"./wp-misc-fiKRzvVp.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-C9jLuAcl.js";import"./wp-foundation-BzBJX52f.js";import"./wp-block-editor-main-y2nlPlta.js";import"./wp-i18n-BPC8WmOV.js";import"./wp-block-editor-store-PPID3vJI.js";import"./wp-block-editor-utils-C52tDze8.js";import"./wp-components-CKWj6dcl.js";const q=()=>{const q=e(),{id:C}=s(),F=d(),L=!!C,[P,I]=t.useState({title:"",content:"",categoryId:"",status:"published",isPinned:!1,isLocked:!1}),{data:S}=o({queryKey:["forum-categories"],queryFn:async()=>(await l.api.get("/v1/forum/categories")).data}),K=S?.data||[],{data:E,isLoading:Q}=o({queryKey:["forum-post",C],queryFn:async()=>(await l.api.get(`/v1/forum/posts/${C}`)).data.data,enabled:L}),V=c({mutationFn:async e=>(await l.api.post("/v1/forum/posts",e)).data,onSuccess:()=>{r.success("게시글이 작성되었습니다"),F.invalidateQueries({queryKey:["forum-posts"]}),q("/forum")},onError:()=>{r.error("게시글 작성에 실패했습니다")}}),z=c({mutationFn:async e=>(await l.api.put(`/v1/forum/posts/${C}`,e)).data,onSuccess:()=>{r.success("게시글이 수정되었습니다"),F.invalidateQueries({queryKey:["forum-posts"]}),F.invalidateQueries({queryKey:["forum-post",C]}),q("/forum")},onError:()=>{r.error("게시글 수정에 실패했습니다")}});t.useEffect(()=>{E&&I({title:E.title,content:E.content,categoryId:E.category.id,status:E.status,isPinned:E.isPinned,isLocked:E.isLocked})},[E]);const A=(e,s)=>{I(t=>({...t,[e]:s}))};return L&&Q?i.jsx("div",{className:"flex items-center justify-center h-96",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[i.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>q("/forum"),children:[i.jsx(a,{className:"w-4 h-4 mr-2"}),"게시판 목록"]}),i.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:L?"게시글 수정":"새 게시글 작성"})]}),i.jsxs("form",{onSubmit:e=>{e.preventDefault(),P.title.trim()?P.content.trim()?P.categoryId?L?z.mutate(P):V.mutate(P):r.error("카테고리를 선택하세요"):r.error("내용을 입력하세요"):r.error("제목을 입력하세요")},children:[i.jsxs("div",{className:"space-y-6",children:[i.jsxs(b,{children:[i.jsx(w,{children:i.jsx(k,{children:"게시글 정보"})}),i.jsxs(N,{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(u,{htmlFor:"title",children:"제목 *"}),i.jsx(h,{id:"title",value:P.title,onChange:e=>A("title",e.target.value),placeholder:"게시글 제목을 입력하세요",required:!0})]}),i.jsxs("div",{children:[i.jsx(u,{htmlFor:"category",children:"카테고리 *"}),i.jsxs(j,{value:P.categoryId,onValueChange:e=>A("categoryId",e),children:[i.jsx(x,{children:i.jsx(p,{placeholder:"카테고리를 선택하세요"})}),i.jsx(v,{children:K.map(e=>i.jsx(y,{value:e.id,children:e.name},e.id))})]})]}),i.jsxs("div",{children:[i.jsx(u,{htmlFor:"content",children:"내용 *"}),i.jsx(f,{id:"content",value:P.content,onChange:e=>A("content",e.target.value),placeholder:"게시글 내용을 입력하세요...",rows:12,required:!0})]})]})]}),i.jsxs(b,{children:[i.jsx(w,{children:i.jsx(k,{children:"게시 옵션"})}),i.jsxs(N,{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(u,{htmlFor:"status",children:"상태"}),i.jsxs(j,{value:P.status,onValueChange:e=>A("status",e),children:[i.jsx(x,{children:i.jsx(p,{})}),i.jsxs(v,{children:[i.jsx(y,{value:"published",children:"게시"}),i.jsx(y,{value:"draft",children:"초안"})]})]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx(u,{htmlFor:"isPinned",children:"상단 고정"}),i.jsx("p",{className:"text-sm text-modern-text-secondary",children:"게시글을 목록 상단에 고정합니다"})]}),i.jsx(g,{id:"isPinned",checked:P.isPinned,onCheckedChange:e=>A("isPinned",e)})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx(u,{htmlFor:"isLocked",children:"댓글 잠금"}),i.jsx("p",{className:"text-sm text-modern-text-secondary",children:"새 댓글 작성을 차단합니다"})]}),i.jsx(g,{id:"isLocked",checked:P.isLocked,onCheckedChange:e=>A("isLocked",e)})]})]})]})]}),i.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[i.jsx(m,{type:"button",variant:"outline",onClick:()=>q("/forum"),children:"취소"}),i.jsxs(m,{type:"submit",disabled:V.isPending||z.isPending,children:[i.jsx(n,{className:"w-4 h-4 mr-2"}),L?"수정하기":"작성하기"]})]})]})]})};export{q as default};
