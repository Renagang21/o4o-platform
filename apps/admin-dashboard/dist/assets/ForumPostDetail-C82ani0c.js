import{b as e,u as s,r as t,V as i,j as a,A as r,dv as n,c5 as c,bc as o,E as l,cs as d,b9 as m,b8 as p,dw as x}from"./vendor-react-DqgGMt48.js";import{u as j,a as u,b as h}from"./vendor-query-D_c3FRkE.js";import{b as v,B as w,T as b}from"./page-template-editor-CdMtnD-k.js";import{cQ as y,cJ as f,cK as N,cL as g,cO as k}from"./wp-misc-nAANEFFa.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-CX-PD_Jc.js";import"./wp-blocks-core-BDaUU0zy.js";import"./wp-block-editor-misc-5qbjj7fi.js";import"./wp-core-BedthL0o.js";import"./wp-block-editor-api-BD-JvyIp.js";import"./wp-block-editor-store-D0LqdVTA.js";import"./wp-block-editor-clipboard-BbjM0mE7.js";import"./wp-i18n-D2qT7FTy.js";import"./wp-block-editor-global-styles-CgbocFEz.js";import"./wp-block-editor-typography-C6olASDs.js";import"./wp-components-Jwbue4-Q.js";import"./wp-block-editor-spacing-Bjm66-GI.js";import"./wp-block-editor-menus-DNdBW6en.js";import"./wp-block-editor-core-BHvRx-9p.js";import"./wp-block-editor-utils-BS9xY-75.js";import"./wp-block-editor-colors-uaYdG60c.js";import"./wp-block-editor-a11y-B3KhLhxS.js";import"./wp-block-editor-preview-IPMCb4VS.js";import"./wp-block-editor-borders-DTrAcZMd.js";import"./wp-block-editor-formats-DG6_xyZ_.js";import"./wp-block-editor-selection-yPihMKSS.js";import"./wp-block-editor-inline-Bkp4Ls8p.js";import"./wp-block-editor-ui-D4dlfw0L.js";import"./wp-block-editor-transforms-CCvPjpfb.js";import"./wp-block-editor-patterns-vKXFRlW-.js";import"./wp-block-editor-navigation-BlWUaXzS.js";import"./wp-block-editor-dnd-BymtRIME.js";import"./wp-block-editor-media-CULIbUAn.js";import"./wp-api-CmKoN5bn.js";import"./wp-block-editor-keyboard-D3kftNm9.js";import"./wp-block-editor-templates-BgLwh8Gm.js";import"./wp-data-BAtVYyan.js";const C=()=>{const{id:C}=e(),q=s(),z=j(),[L,S]=t.useState(""),[F,K]=t.useState(null),[$,A]=t.useState(null),[P,Q]=t.useState(""),{data:D,isLoading:E}=u({queryKey:["forum-post",C],queryFn:async()=>(await v.api.get(`/v1/forum/posts/${C}`)).data}),I=D?.data,{data:B,isLoading:J}=u({queryKey:["forum-comments",C],queryFn:async()=>(await v.api.get(`/v1/forum/posts/${C}/comments`)).data}),O=B?.data||[],R=h({mutationFn:async e=>(await v.api.post(`/v1/forum/posts/${C}/comments`,e)).data,onSuccess:()=>{i.success("댓글이 작성되었습니다"),S(""),K(null),z.invalidateQueries({queryKey:["forum-comments",C]})}}),T=h({mutationFn:async({commentId:e,content:s})=>(await v.api.put(`/v1/forum/comments/${e}`,{content:s})).data,onSuccess:()=>{i.success("댓글이 수정되었습니다"),A(null),Q(""),z.invalidateQueries({queryKey:["forum-comments",C]})}}),V=h({mutationFn:async e=>(await v.api.delete(`/v1/forum/comments/${e}`)).data,onSuccess:()=>{i.success("댓글이 삭제되었습니다"),z.invalidateQueries({queryKey:["forum-comments",C]})}}),G=h({mutationFn:async()=>(await v.api.post(`/v1/forum/posts/${C}/toggle-pin`)).data,onSuccess:()=>{i.success(I?.isPinned?"고정이 해제되었습니다":"게시글이 고정되었습니다"),z.invalidateQueries({queryKey:["forum-post",C]})}}),H=h({mutationFn:async()=>(await v.api.post(`/v1/forum/posts/${C}/toggle-lock`)).data,onSuccess:()=>{i.success(I?.isLocked?"잠금이 해제되었습니다":"게시글이 잠금되었습니다"),z.invalidateQueries({queryKey:["forum-post",C]})}}),M=e=>{L.trim()&&R.mutate({content:L,parentId:e})},U=e=>new Date(e).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=(e,s=0)=>{const t=$===e.id;return a.jsxs("div",{className:""+(s>0?"ml-12":""),children:[a.jsxs("div",{className:"bg-white p-4 rounded-lg border border-modern-border-primary mb-4",children:[a.jsxs("div",{className:"flex items-start justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-modern-primary text-white rounded-full flex items-center justify-center text-sm font-medium",children:e.author.name.charAt(0)}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"font-medium text-modern-text-primary",children:e.author.name}),a.jsx(y,{variant:"outline",className:"text-xs",children:e.author.role})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs text-modern-text-secondary",children:[a.jsx("span",{children:U(e.createdAt)}),e.isEdited&&a.jsx("span",{children:"(수정됨)"})]})]})]}),a.jsxs(f,{children:[a.jsx(N,{children:a.jsx(w,{variant:"ghost",size:"sm",children:a.jsx(m,{className:"w-4 h-4"})})}),a.jsxs(g,{align:"end",children:[a.jsxs(k,{onClick:()=>{A(e.id),Q(e.content)},children:[a.jsx(o,{className:"w-4 h-4 mr-2"}),"수정"]}),a.jsxs(k,{className:"text-destructive",onClick:()=>{confirm("정말 삭제하시겠습니까?")&&V.mutate(e.id)},children:[a.jsx(p,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]})]}),t?a.jsxs("div",{className:"space-y-3",children:[a.jsx(b,{value:P,onChange:e=>Q(e.target.value),rows:3,className:"w-full"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(w,{size:"sm",onClick:()=>{return s=e.id,void(P.trim()&&T.mutate({commentId:s,content:P}));var s},disabled:T.isPending,children:"수정 완료"}),a.jsx(w,{size:"sm",variant:"outline",onClick:()=>{A(null),Q("")},children:"취소"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-modern-text-primary mb-3 whitespace-pre-wrap",children:e.content}),!I?.isLocked&&a.jsxs(w,{size:"sm",variant:"ghost",onClick:()=>{K(e.id),S("")},children:[a.jsx(x,{className:"w-4 h-4 mr-2"}),"답글"]})]})]}),F===e.id&&!I?.isLocked&&a.jsxs("div",{className:"ml-12 mb-4",children:[a.jsx(b,{value:L,onChange:e=>S(e.target.value),placeholder:"답글을 작성하세요...",rows:3,className:"w-full mb-2"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(w,{size:"sm",onClick:()=>M(e.id),disabled:R.isPending,children:"답글 작성"}),a.jsx(w,{size:"sm",variant:"outline",onClick:()=>{K(null),S("")},children:"취소"})]})]}),e.replies&&e.replies.map(e=>W(e,s+1))]},e.id)};return E?a.jsx("div",{className:"flex items-center justify-center h-96",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):I?a.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(w,{variant:"ghost",size:"sm",onClick:()=>q("/forum"),children:[a.jsx(r,{className:"w-4 h-4 mr-2"}),"게시판 목록"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(w,{variant:"outline",size:"sm",onClick:()=>G.mutate(),children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),I.isPinned?"고정 해제":"고정"]}),a.jsxs(w,{variant:"outline",size:"sm",onClick:()=>H.mutate(),children:[a.jsx(c,{className:"w-4 h-4 mr-2"}),I.isLocked?"잠금 해제":"잠금"]}),a.jsxs(w,{variant:"outline",size:"sm",onClick:()=>q(`/forum/posts/${C}/edit`),children:[a.jsx(o,{className:"w-4 h-4 mr-2"}),"수정"]})]})]}),a.jsx("div",{className:"wp-card",children:a.jsx("div",{className:"wp-card-body",children:a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[I.isPinned&&a.jsx(y,{variant:"secondary",children:"고정"}),I.isLocked&&a.jsx(y,{variant:"outline",children:"잠김"}),a.jsx(y,{variant:"outline",children:I.category.name}),"reported"===I.status&&a.jsx(y,{variant:"destructive",children:"신고됨"})]}),a.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary mb-4",children:I.title}),a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 bg-modern-primary text-white rounded-full flex items-center justify-center text-lg font-medium",children:I.author.name.charAt(0)}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-modern-text-primary",children:I.author.name}),a.jsx("p",{className:"text-sm text-modern-text-secondary",children:U(I.createdAt)})]})]}),a.jsxs("div",{className:"flex items-center gap-4 text-sm text-modern-text-secondary",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(l,{className:"w-4 h-4"}),a.jsxs("span",{children:[I.views," 조회"]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(d,{className:"w-4 h-4"}),a.jsxs("span",{children:[I.replyCount," 댓글"]})]})]})]}),a.jsx("div",{className:"prose prose-modern max-w-none",children:a.jsx("div",{className:"whitespace-pre-wrap text-modern-text-primary",children:I.content})})]})})}),a.jsxs("div",{className:"wp-card",children:[a.jsx("div",{className:"wp-card-header",children:a.jsxs("h2",{className:"text-lg font-semibold",children:["댓글 ",O.length,"개"]})}),a.jsxs("div",{className:"wp-card-body",children:[!I.isLocked&&a.jsxs("div",{className:"mb-6",children:[a.jsx(b,{value:L,onChange:e=>S(e.target.value),placeholder:"댓글을 작성하세요...",rows:4,className:"w-full mb-2"}),a.jsx(w,{onClick:()=>M(),disabled:R.isPending||!L.trim(),children:"댓글 작성"})]}),J?a.jsx("div",{className:"text-center py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary mx-auto"})}):0===O.length?a.jsx("p",{className:"text-center text-modern-text-secondary py-8",children:"아직 댓글이 없습니다."}):a.jsx("div",{className:"space-y-4",children:O.map(e=>W(e))})]})]})]}):a.jsx("div",{className:"text-center py-12",children:a.jsx("p",{className:"text-modern-text-secondary",children:"게시글을 찾을 수 없습니다."})})};export{C as default};
