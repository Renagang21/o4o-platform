import{a3 as E,r as a,j as e,P as U,cG as w,bA as I,_ as T,w as V,S as F,c2 as _,N as $,B,D as z,V as d}from"./vendor-react-k21L8gyu.js";import{B as r,C as i,m as c,H as C,s as u}from"./page-gutenberg-DfBK4wFH.js";import{a as j}from"./api-Bnu8ldYb.js";import"./wp-block-editor-DM9yXXIa.js";import"./wp-i18n-DQMG9Moe.js";import"./wp-core-CTkjrE6Y.js";import"./wp-blocks-core-m9M-jdYH.js";import"./wp-misc-eJXghOJf.js";import"./wp-data-CiqFlSQ4.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-monaco-cpVGocfO.js";import"./vendor-query-D5rBm9N_.js";import"./vendor-utils-DQ8F5vJI.js";import"./wp-components-C7vO1IIk.js";const te=()=>{const p=E(),[n,f]=a.useState([]),[S,N]=a.useState(!0),[h,b]=a.useState(""),[o,D]=a.useState("all"),[l,v]=a.useState(1),[x,P]=a.useState(1),g=async()=>{try{N(!0);const s=new URLSearchParams({page:l.toString(),limit:"20",...o!=="all"&&{status:o}}),t=await j.get(`/v1/coupons?${s}`);f(t.data.data||[]),P(t.data.pagination?.totalPages||1)}catch(s){console.error("Error fetching coupons:",s),d.error("Failed to load coupons"),f([{id:"1",code:"WELCOME10",description:"Welcome discount for new customers",discountType:"percent",discountValue:10,minOrderAmount:5e4,usageLimitPerCoupon:100,usageLimitPerCustomer:1,usedCount:23,status:"active",freeShipping:!1,individualUseOnly:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"2",code:"SAVE5000",description:"Fixed discount coupon",discountType:"fixed_cart",discountValue:5e3,minOrderAmount:3e4,maxDiscountAmount:5e3,usageLimitPerCoupon:50,usageLimitPerCustomer:2,usedCount:12,status:"active",freeShipping:!0,individualUseOnly:!1,validUntil:new Date(Date.now()+720*60*60*1e3).toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"3",code:"EXPIRED20",description:"Expired promotional coupon",discountType:"percent",discountValue:20,usageLimitPerCoupon:10,usageLimitPerCustomer:1,usedCount:10,status:"expired",freeShipping:!1,individualUseOnly:!0,validUntil:new Date(Date.now()-14400*60*1e3).toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}])}finally{N(!1)}};a.useEffect(()=>{g()},[l,o]);const O=async s=>{if(window.confirm("Are you sure you want to delete this coupon?"))try{await j.delete(`/v1/coupons/${s}`),d.success("Coupon deleted successfully"),g()}catch(t){console.error("Error deleting coupon:",t),d.error("Failed to delete coupon")}},A=async s=>{try{const t=`${s.code}_COPY_${Date.now()}`;await j.post("/v1/coupons",{...s,id:void 0,code:t,usedCount:0}),d.success("Coupon duplicated successfully"),g()}catch(t){console.error("Error duplicating coupon:",t),d.error("Failed to duplicate coupon")}},m={total:n.length,active:n.filter(s=>s.status==="active").length,expired:n.filter(s=>s.status==="expired").length,totalUsage:n.reduce((s,t)=>s+t.usedCount,0)},y=n.filter(s=>s.code.toLowerCase().includes(h.toLowerCase())||s.description?.toLowerCase().includes(h.toLowerCase())),L=s=>{switch(s.discountType){case"percent":return`${s.discountValue}%`;case"fixed_cart":case"fixed_product":return C(s.discountValue);default:return s.discountValue}},k=s=>{switch(s){case"active":return e.jsx(u,{className:"bg-green-100 text-green-800",children:"Active"});case"expired":return e.jsx(u,{className:"bg-red-100 text-red-800",children:"Expired"});case"inactive":return e.jsx(u,{className:"bg-gray-100 text-gray-800",children:"Inactive"});default:return e.jsx(u,{children:s})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"쿠폰 관리"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"할인 쿠폰을 생성하고 관리하세요"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(r,{onClick:()=>p("/ecommerce/coupons/new"),children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"새 쿠폰"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"전체 쿠폰"}),e.jsx("p",{className:"text-2xl font-bold",children:m.total})]}),e.jsx(w,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(i,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"활성 쿠폰"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.active})]}),e.jsx(I,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(i,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"만료된 쿠폰"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.expired})]}),e.jsx(T,{className:"w-8 h-8 text-red-500"})]})})}),e.jsx(i,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"총 사용 횟수"}),e.jsx("p",{className:"text-2xl font-bold",children:m.totalUsage})]}),e.jsx(V,{className:"w-8 h-8 text-purple-500"})]})})})]}),e.jsx(i,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드 또는 설명 검색...",value:h,onChange:s=>b(s.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),e.jsxs("select",{value:o,onChange:s=>D(s.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"모든 상태"}),e.jsx("option",{value:"active",children:"활성"}),e.jsx("option",{value:"inactive",children:"비활성"}),e.jsx("option",{value:"expired",children:"만료됨"})]})]})})}),e.jsx(i,{children:e.jsx(c,{className:"p-0",children:S?e.jsx("div",{className:"p-8 text-center",children:e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):y.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(w,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"쿠폰이 없습니다"}),e.jsx(r,{className:"mt-4",onClick:()=>p("/ecommerce/coupons/new"),children:"첫 쿠폰 만들기"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"쿠폰 코드"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"할인"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"사용 현황"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"유효 기간"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"상태"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:y.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.code}),s.description&&e.jsx("div",{className:"text-sm text-gray-500",children:s.description})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:L(s)}),s.minOrderAmount&&e.jsxs("div",{className:"text-xs text-gray-500",children:["최소 ",C(s.minOrderAmount)]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm",children:[s.usedCount," / ",s.usageLimitPerCoupon||"∞"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["고객당 ",s.usageLimitPerCustomer,"회"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.validUntil?e.jsxs("div",{className:"text-sm",children:[e.jsx(_,{className:"w-4 h-4 inline mr-1"}),new Date(s.validUntil).toLocaleDateString()]}):e.jsx("span",{className:"text-sm text-gray-500",children:"무제한"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:k(s.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{size:"sm",variant:"ghost",onClick:()=>p(`/ecommerce/coupons/${s.id}/edit`),children:e.jsx($,{className:"w-4 h-4"})}),e.jsx(r,{size:"sm",variant:"ghost",onClick:()=>A(s),children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx(r,{size:"sm",variant:"ghost",onClick:()=>O(s.id),className:"text-red-600 hover:text-red-700",children:e.jsx(z,{className:"w-4 h-4"})})]})})]},s.id))})]})})})}),x>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(r,{variant:"outline",onClick:()=>v(s=>Math.max(1,s-1)),disabled:l===1,children:"이전"}),e.jsxs("span",{className:"flex items-center px-4",children:[l," / ",x]}),e.jsx(r,{variant:"outline",onClick:()=>v(s=>Math.min(x,s+1)),disabled:l===x,children:"다음"})]})]})};export{te as default};
