import{c as e}from"./vendor-ui-CrFdsnXa.js";import{c as t,i as n,s,a as i,b as o}from"./wp-i18n-D6_Il8Rt.js";import{M as r,u as a,a as l,p as c,O as u,x as d,U as g,v as h,Q as p,N as f,S as m,q as b,C as x,D as k,t as _,V as v,X as S,Y as y}from"./wp-block-editor-misc-De1L5-zR.js";import{Y as C,Z as w,_ as j,$ as L,a0 as E,M as R,D as N,a1 as D,a2 as P,a3 as F,a4 as T,a5 as I,a6 as O,a7 as A,a8 as M,I as $,a9 as B,aa as U,ab as V,ac as H,ad as z,j as q,K as W,f as K,ae as G,af as Q,ag as Y,k as Z,ah as J,ai as X,c as ee,aj as te,ak as ne,al as se,am as ie,B as oe,an as re,ao as ae,ap as le,aq as ce,d as ue,ar as de,as as ge,at as he,au as pe,e as fe,av as me,aw as be,ax as xe,ay as ke}from"./wp-misc-CVe7ECV4.js";import{j as _e,r as ve,d as Se}from"./vendor-react-DqgGMt48.js";import{b as ye,l as Ce,p as we,m as je,f as Le,w as Ee,n as Re,q as Ne,r as De,u as Pe,d as Fe}from"./wp-core-kvRrOm9B.js";import{__unstableMotion as Te,Button as Ie,__unstableAnimatePresence as Oe,MenuItem as Ae,TextHighlight as Me,MenuGroup as $e,VisuallyHidden as Be,createSlotFill as Ue,ExternalLink as Ve,__experimentalTruncate as He,CheckboxControl as ze,Spinner as qe,TextControl as We,__experimentalInputControlSuffixWrapper as Ke,Notice as Ge,__experimentalHStack as Qe,withSpokenMessages as Ye,BaseControl as Ze,__experimentalInputControl as Je,Popover as Xe,Slot as et,ToolbarItem as tt,DropdownMenu as nt,ToolbarGroup as st,Fill as it,ToolbarButton as ot,__experimentalVStack as rt,ToggleControl as at,NavigableMenu as lt}from"./wp-components-BJYLMD7r.js";import{s as ct}from"./wp-block-editor-store-BZ6fZn58.js";import{U as ut}from"./wp-block-editor-menus-IWaA-N3x.js";import{y as dt,z as gt,A as ht,B as pt,C as ft,l as mt,D as bt}from"./wp-blocks-core-NinAvWTg.js";import{C as xt,a as kt,i as _t,b as vt,u as St}from"./wp-block-editor-api-BKhomcj9.js";import{J as yt,S as Ct,K as wt,C as jt,z as Lt}from"./wp-block-editor-utils-Bqn4TiQr.js";function Et(e){if(e.includes(" "))return!1;const t=C(e),n=j(t),s=function(e,t=6){const n=e.split(/[?#]/)[0];return new RegExp(`(?<=\\S)\\.(?:[a-zA-Z_]{2,${t}})(?:\\/|$)`).test(n)}(e),i=e?.startsWith("www."),o=e?.startsWith("#")&&w(e);return n||i||o||s}function Rt({children:e,settingsOpen:s,setSettingsOpen:i}){const o=ye(),r=o?ve.Fragment:Oe,a=o?"div":Te.div,l=`link-control-settings-drawer-${Ce(Rt)}`;return _e.jsxs(_e.Fragment,{children:[_e.jsx(Ie,{__next40pxDefaultSize:!0,className:"block-editor-link-control__drawer-toggle","aria-expanded":s,onClick:()=>i(!s),icon:n()?L:E,"aria-controls":l,children:t("Advanced","Additional link settings")}),_e.jsx(r,{children:s&&_e.jsx(a,{className:"block-editor-link-control__drawer",hidden:!s,id:l,initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},transition:{duration:.1},children:_e.jsx("div",{className:"block-editor-link-control__drawer-inner",children:e})})})]})}const Nt=({searchTerm:e,onClick:t,itemProps:n,buttonText:o})=>{if(!e)return null;let a;return a=o?"function"==typeof o?o(e):o:r(s(i("Create: <mark>%s</mark>"),e),{mark:_e.jsx("mark",{})}),_e.jsx(Ae,{...n,iconPosition:"left",icon:R,className:"block-editor-link-control__search-item",onClick:t,children:a})},Dt={post:M,page:A,post_tag:O,category:I,attachment:T};function Pt({isURL:e,suggestion:t}){let n=null;return e?n=B:t.type in Dt&&(n=Dt[t.type],"page"===t.type&&(t.isFrontPage&&(n=U),t.isBlogHome&&(n=V))),n?_e.jsx($,{className:"block-editor-link-control__search-item-icon",icon:n}):null}function Ft(e){const t=e?.trim();return t?.length?e?.replace(/^\/?/,"/"):e}function Tt(e){const t=e?.trim();return t?.length?e?.replace(/\/$/,""):e}const It=({itemProps:e,suggestion:t,searchTerm:n,onClick:s,isURL:o=!1,shouldShowType:r=!1})=>{const a=o?i("Press ENTER to add this link"):(l=t.url)?we(D,P,(c="",e=>null==e||e!=e?c:e),((e,...t)=>(...n)=>e(...n,...t))(F,24),Tt,Ft)(l):l;var l,c;return _e.jsx(Ae,{...e,info:a,iconPosition:"left",icon:_e.jsx(Pt,{suggestion:t,isURL:o}),onClick:s,shortcut:r&&Ot(t),className:"block-editor-link-control__search-item",children:_e.jsx(Me,{text:N(t.title),highlight:n})})};function Ot(e){return e.isFrontPage?"front page":e.isBlogHome?"blog home":"post_tag"===e.type?"tag":e.type}const At="__CREATE__",Mt="link",$t="mailto",Bt="internal",Ut=[Mt,$t,"tel",Bt],Vt=[{id:"opensInNewTab",title:i("Open in new tab")}];function Ht({instanceId:t,withCreateSuggestion:n,currentInputValue:o,handleSuggestionClick:r,suggestionsListProps:a,buildSuggestionItemProps:l,suggestions:c,selectedSuggestion:u,isLoading:d,isInitialSuggestions:g,createSuggestionButtonText:h,suggestionsQuery:p}){const f=e("block-editor-link-control__search-results",{"is-loading":d}),m=1===c.length&&Ut.includes(c[0].type),b=n&&!m&&!g,x=!p?.type,k=`block-editor-link-control-search-results-label-${t}`,_=g?i("Suggestions"):s(i('Search results for "%s"'),o),v=_e.jsx(Be,{id:k,children:_});return _e.jsxs("div",{className:"block-editor-link-control__search-results-wrapper",children:[v,_e.jsx("div",{...a,className:f,"aria-labelledby":k,children:_e.jsx($e,{children:c.map((e,t)=>b&&At===e.type?_e.jsx(Nt,{searchTerm:o,buttonText:h,onClick:()=>r(e),itemProps:l(e,t),isSelected:t===u},e.type):At===e.type?null:_e.jsx(It,{itemProps:l(e,t),suggestion:e,index:t,onClick:()=>{r(e)},isSelected:t===u,isURL:Ut.includes(e.type),searchTerm:o,shouldShowType:x,isFrontPage:e?.isFrontPage,isBlogHome:e?.isBlogHome},`${e.id}-${e.type}`))})})]})}const zt=()=>Promise.resolve([]),qt=e=>{let t=Mt;const n=C(e)||"";return n.includes("mailto")&&(t=$t),n.includes("tel")&&(t="tel"),e?.startsWith("#")&&(t=Bt),Promise.resolve([{id:e,title:e,url:"URL"===t?H(e):e,type:t}])};function Wt(e,t,n){const{fetchSearchSuggestions:s,pageOnFront:i,pageForPosts:o}=a(e=>{const{getSettings:t}=e(ct);return{pageOnFront:t().pageOnFront,pageForPosts:t().pageForPosts,fetchSearchSuggestions:t().__experimentalFetchLinkSuggestions}},[]),r=t?qt:zt;return ve.useCallback((t,{isInitialSuggestions:a})=>Et(t)?r(t):(async(e,t,n,s,i,o)=>{const{isInitialSuggestions:r}=t,a=await n(e,t);return a.map(e=>Number(e.id)===i?(e.isFrontPage=!0,e):Number(e.id)===o?(e.isBlogHome=!0,e):e),r||Et(e)||!s?a:a.concat({title:e,url:e,type:At})})(t,{...e,isInitialSuggestions:a},s,n,i,o),[r,s,i,o,e,n])}const Kt=()=>Promise.resolve([]),Gt=()=>{},Qt=ve.forwardRef(({value:e,children:t,currentLink:n={},className:s=null,placeholder:o=null,withCreateSuggestion:r=!1,onCreateSuggestion:a=Gt,onChange:l=Gt,onSelect:c=Gt,showSuggestions:u=!0,renderSuggestions:d=e=>_e.jsx(Ht,{...e}),fetchSuggestions:g=null,allowDirectEntry:h=!0,showInitialSuggestions:p=!1,suggestionsQuery:f={},withURLSuggestion:m=!0,createSuggestionButtonText:b,hideLabelFromVision:x=!1,suffix:k},_)=>{const v=Wt(f,h,r),S=u?g||v:Kt,y=Ce(Qt),[C,w]=ve.useState(),j=async e=>{let t=e;if(At!==e.type){if(h||t&&Object.keys(t).length>=1){const{id:e,url:s,...i}=null!=n?n:{};c({...i,...t},t)}}else try{t=await a(e.title),t?.url&&c(t)}catch(s){}};return _e.jsxs("div",{className:"block-editor-link-control__search-input-container",children:[_e.jsx(hn,{disableSuggestions:n?.url===e,label:i("Link"),hideLabelFromVision:x,className:s,value:e,onChange:(e,t)=>{l(e),w(t)},placeholder:null!=o?o:i("Search or type URL"),__experimentalRenderSuggestions:u?e=>d({...e,instanceId:y,withCreateSuggestion:r,createSuggestionButtonText:b,suggestionsQuery:f,handleSuggestionClick:t=>{e.handleSuggestionClick&&e.handleSuggestionClick(t),j(t)}}):null,__experimentalFetchLinkSuggestions:S,__experimentalHandleURLSuggestions:!0,__experimentalShowInitialSuggestions:p,onSubmit:(t,n)=>{const s=t||C;s||e?.trim()?.length?j(s||{url:e}):n.preventDefault()},ref:_,suffix:k}),t]})}),{Slot:Yt,Fill:Zt}=Ue("BlockEditorLinkControlViewer");function Jt(e,t){switch(t.type){case"RESOLVED":return{...e,isFetching:!1,richData:t.richData};case"ERROR":return{...e,isFetching:!1,richData:null};case"LOADING":return{...e,isFetching:!0};default:throw new Error(`Unexpected action type ${t.type}`)}}function Xt({value:t,onEditClick:n,hasRichPreviews:o=!1,hasUnlinkControl:r=!1,onRemove:c}){const u=a(e=>e(z).get("core","showIconLabels"),[]),d=o?t?.url:null,{richData:g,isFetching:h}=function(e){const[t,n]=ve.useReducer(Jt,{richData:null,isFetching:!1}),{fetchRichUrlData:s}=a(e=>{const{getSettings:t}=e(ct);return{fetchRichUrlData:t().__experimentalFetchRichUrlData}},[]);return ve.useEffect(()=>{if(e?.length&&s&&"undefined"!=typeof AbortController){n({type:"LOADING"});const t=new window.AbortController,i=t.signal;return s(e,{signal:i}).then(e=>{n({type:"RESOLVED",richData:e})}).catch(()=>{i.aborted||n({type:"ERROR"})}),()=>{t.abort()}}},[e]),t}(d),p=g&&Object.keys(g).length,f=t&&F(D(t.url),24)||"",m=!t?.url?.length,b=!m&&N(g?.title||t?.title||f),x=!t?.url||b.replace(/^[a-z\-.\+]+[0-9]*:(\/\/)?/i,"").replace(/^www\./i,"")===f;let k;k=g?.icon?_e.jsx("img",{src:g?.icon,alt:""}):m?_e.jsx($,{icon:Q,size:32}):_e.jsx($,{icon:B});const{createNotice:_}=l(q),v=je(t.url,()=>{_("info",i("Link copied to clipboard."),{isDismissible:!0,type:"snackbar"})});return _e.jsx("div",{"aria-label":i("Currently selected"),className:e("block-editor-link-control__search-item",{"is-current":!0,"is-rich":p,"is-fetching":!!h,"is-preview":!0,"is-error":m,"is-url-title":b===f}),children:_e.jsxs("div",{className:"block-editor-link-control__search-item-top",children:[_e.jsxs("span",{className:"block-editor-link-control__search-item-header",children:[_e.jsx("span",{className:e("block-editor-link-control__search-item-icon",{"is-image":g?.icon}),children:k}),_e.jsx("span",{className:"block-editor-link-control__search-item-details",children:m?_e.jsx("span",{className:"block-editor-link-control__search-item-error-notice",children:i("Link is empty")}):_e.jsxs(_e.Fragment,{children:[_e.jsx(Ve,{className:"block-editor-link-control__search-item-title",href:t.url,children:_e.jsx(He,{numberOfLines:1,children:b})}),!x&&_e.jsx("span",{className:"block-editor-link-control__search-item-info",children:_e.jsx(He,{numberOfLines:1,children:f})})]})})]}),_e.jsx(Ie,{icon:W,label:i("Edit link"),onClick:n,size:"compact"}),r&&_e.jsx(Ie,{icon:K,label:i("Remove link"),onClick:c,size:"compact"}),_e.jsx(Ie,{icon:G,label:s(i("Copy link%s"),m||u?"":": "+t.url),ref:v,accessibleWhenDisabled:!0,disabled:m,size:"compact"}),_e.jsx(Yt,{fillProps:t})]})})}const en=()=>{},tn=({value:e,onChange:t=en,settings:n})=>{if(!n||!n.length)return null;const s=n=>s=>{t({...e,[n.id]:s})},o=n.map(t=>_e.jsx(ze,{__nextHasNoMarginBottom:!0,className:"block-editor-link-control__setting",label:t.title,onChange:s(t),checked:!!e&&!!e[t.id],help:t?.help},t.id));return _e.jsxs("fieldset",{className:"block-editor-link-control__settings",children:[_e.jsx(Be,{as:"legend",children:i("Currently selected link settings")}),o]})};const nn=e=>{let t=!1;return{promise:new Promise((n,s)=>{e.then(e=>t?s({isCanceled:!0}):n(e),e=>s(t?{isCanceled:!0}:e))}),cancel(){t=!0}}};var sn,on;const rn=Se(on?sn:(on=1,sn=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var s,i,o;if(Array.isArray(t)){if((s=t.length)!=n.length)return!1;for(i=s;0!==i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((s=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=s;0!==i--;)if(!Object.prototype.hasOwnProperty.call(n,o[i]))return!1;for(i=s;0!==i--;){var r=o[i];if(!e(t[r],n[r]))return!1}return!0}return t!=t&&n!=n}));const an=()=>{},ln="core/block-editor",cn="linkControlSettingsDrawer";function un({searchInputPlaceholder:t,value:n,settings:s=Vt,onChange:o=an,onRemove:r,onCancel:u,noDirectEntry:d=!1,showSuggestions:g=!0,showInitialSuggestions:h,forceIsEditingLink:p,createSuggestion:f,withCreateSuggestion:m,inputValue:b="",suggestionsQuery:x={},noURLSuggestion:k=!1,createSuggestionButtonText:_,hasRichPreviews:v=!1,hasTextControl:S=!1,renderControlBottom:y=null}){void 0===m&&f&&(m=!0);const[C,w]=ve.useState(!1),{advancedSettingsPreference:j}=a(e=>{var t;return{advancedSettingsPreference:null!==(t=e(z).get(ln,cn))&&void 0!==t&&t}},[]),{set:L}=l(z),E=j||C,R=ve.useRef(!0),N=ve.useRef(),D=ve.useRef(),P=ve.useRef(!1),F=s.map(({id:e})=>e),[T,I,O,A,M]=function(e){const[t,n]=ve.useState(e||{}),[s,i]=ve.useState(e);return rn(e,s)||(i(e),n(e)),[t,n,e=>{n({...t,url:e})},e=>{n({...t,title:e})},e=>s=>{const i=Object.keys(s).reduce((t,n)=>(e.includes(n)&&(t[n]=s[n]),t),{});n({...t,...i})}]}(n),$=n&&!Y(T,n),[B,U]=ve.useState(void 0!==p?p:!n||!n.url),{createPage:V,isCreatingPage:H,errorMessage:q}=function(e){const t=ve.useRef(),[n,s]=ve.useState(!1),[o,r]=ve.useState(null);return ve.useEffect(()=>()=>{t.current&&t.current.cancel()},[]),{createPage:async function(n){s(!0),r(null);try{return t.current=nn(Promise.resolve(e(n))),await t.current.promise}catch(o){if(o&&o.isCanceled)return;throw r(o.message||i("An unknown error occurred during creation. Please try again.")),o}finally{s(!1)}},isCreatingPage:n,errorMessage:o}}(f);ve.useEffect(()=>{void 0!==p&&U(p)},[p]),ve.useEffect(()=>{if(R.current)return;(Z.focusable.find(N.current)[0]||N.current).focus(),P.current=!1},[B,H]),ve.useEffect(()=>(R.current=!1,()=>{R.current=!0}),[]);const W=n?.url?.trim()?.length>0,K=()=>{P.current=!!N.current?.contains(N.current.ownerDocument.activeElement),U(!1)},G=()=>{$&&o({...n,...T,url:Q}),K()},Q=b||T?.url||"",X=!Q?.trim()?.length,ee=r&&n&&!B&&!H,te=B&&W,ne=W&&S,se=(B||!n)&&!H,ie=!$||X,oe=!!s?.length&&B&&W;return _e.jsxs("div",{tabIndex:-1,ref:N,className:"block-editor-link-control",children:[H&&_e.jsxs("div",{className:"block-editor-link-control__loading",children:[_e.jsx(qe,{})," ",i("Creating"),"…"]}),se&&_e.jsxs(_e.Fragment,{children:[_e.jsxs("div",{className:e({"block-editor-link-control__search-input-wrapper":!0,"has-text-control":ne,"has-actions":te}),children:[ne&&_e.jsx(We,{__nextHasNoMarginBottom:!0,ref:D,className:"block-editor-link-control__field block-editor-link-control__text-content",label:i("Text"),value:T?.title,onChange:A,onKeyDown:e=>{const{keyCode:t}=e;t!==c||X||(e.preventDefault(),G())},__next40pxDefaultSize:!0}),_e.jsx(Qt,{currentLink:n,className:"block-editor-link-control__field block-editor-link-control__search-input",placeholder:t,value:Q,withCreateSuggestion:m,onCreateSuggestion:V,onChange:O,onSelect:e=>{const t=Object.keys(e).reduce((t,n)=>(F.includes(n)||(t[n]=e[n]),t),{});o({...T,...t,title:T?.title||e?.title}),K()},showInitialSuggestions:h,allowDirectEntry:!d,showSuggestions:g,suggestionsQuery:x,withURLSuggestion:!k,createSuggestionButtonText:_,hideLabelFromVision:!ne,suffix:te?void 0:_e.jsx(Ke,{variant:"control",children:_e.jsx(Ie,{onClick:ie?an:G,label:i("Submit"),icon:J,className:"block-editor-link-control__search-submit","aria-disabled":ie,size:"small"})})})]}),q&&_e.jsx(Ge,{className:"block-editor-link-control__search-error",status:"error",isDismissible:!1,children:q})]}),n&&!B&&!H&&_e.jsx(Xt,{value:n,onEditClick:()=>U(!0),hasRichPreviews:v,hasUnlinkControl:ee,onRemove:()=>{r(),U(!0)}},n?.url),oe&&_e.jsx("div",{className:"block-editor-link-control__tools",children:!X&&_e.jsx(Rt,{settingsOpen:E,setSettingsOpen:e=>{L&&L(ln,cn,e),w(e)},children:_e.jsx(tn,{value:T,settings:s,onChange:M(F)})})}),te&&_e.jsxs(Qe,{justify:"right",className:"block-editor-link-control__search-actions",children:[_e.jsx(Ie,{__next40pxDefaultSize:!0,variant:"tertiary",onClick:e=>{e.preventDefault(),e.stopPropagation(),I(n),W?K():r?.(),u?.()},children:i("Cancel")}),_e.jsx(Ie,{__next40pxDefaultSize:!0,variant:"primary",onClick:ie?an:G,className:"block-editor-link-control__search-submit","aria-disabled":ie,children:i("Save")})]}),!H&&y&&y()]})}function dn(e){return"function"==typeof e}un.ViewerFill=Zt,un.DEFAULT_LINK_SETTINGS=Vt;class gn extends ve.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this),this.onFocus=this.onFocus.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.selectLink=this.selectLink.bind(this),this.handleOnClick=this.handleOnClick.bind(this),this.bindSuggestionNode=this.bindSuggestionNode.bind(this),this.autocompleteRef=e.autocompleteRef||ve.createRef(),this.inputRef=ve.createRef(),this.updateSuggestions=Ne(this.updateSuggestions.bind(this),200),this.suggestionNodes=[],this.suggestionsRequest=null,this.state={suggestions:[],showSuggestions:!1,suggestionsValue:null,selectedSuggestion:null,suggestionsListboxId:"",suggestionOptionIdPrefix:""}}componentDidUpdate(e){const{showSuggestions:t,selectedSuggestion:n}=this.state,{value:s,__experimentalShowInitialSuggestions:i=!1}=this.props;t&&null!==n&&this.suggestionNodes[n]&&this.suggestionNodes[n].scrollIntoView({behavior:"instant",block:"nearest",inline:"nearest"}),e.value===s||this.props.disableSuggestions||(s?.length?this.updateSuggestions(s):i&&this.updateSuggestions())}componentDidMount(){this.shouldShowInitialSuggestions()&&this.updateSuggestions()}componentWillUnmount(){this.suggestionsRequest?.cancel?.(),this.suggestionsRequest=null}bindSuggestionNode(e){return t=>{this.suggestionNodes[e]=t}}shouldShowInitialSuggestions(){const{__experimentalShowInitialSuggestions:e=!1,value:t}=this.props;return e&&!(t&&t.length)}updateSuggestions(e=""){const{__experimentalFetchLinkSuggestions:t,__experimentalHandleURLSuggestions:n}=this.props;if(!t)return;const r=!e?.length;if(e=e.trim(),!r&&(e.length<2||!n&&X(e)))return this.suggestionsRequest?.cancel?.(),this.suggestionsRequest=null,void this.setState({suggestions:[],showSuggestions:!1,suggestionsValue:e,selectedSuggestion:null,loading:!1});this.setState({selectedSuggestion:null,loading:!0});const a=t(e,{isInitialSuggestions:r});a.then(t=>{this.suggestionsRequest===a&&(this.setState({suggestions:t,suggestionsValue:e,loading:!1,showSuggestions:!!t.length}),t.length?this.props.debouncedSpeak(s(o("%d result found, use up and down arrow keys to navigate.","%d results found, use up and down arrow keys to navigate.",t.length),t.length),"assertive"):this.props.debouncedSpeak(i("No results."),"assertive"))}).catch(()=>{this.suggestionsRequest===a&&this.setState({loading:!1})}).finally(()=>{this.suggestionsRequest===a&&(this.suggestionsRequest=null)}),this.suggestionsRequest=a}onChange(e){this.props.onChange(e)}onFocus(){const{suggestions:e}=this.state,{disableSuggestions:t,value:n}=this.props;!n||t||e&&e.length||null!==this.suggestionsRequest||this.updateSuggestions(n)}onKeyDown(e){this.props.onKeyDown?.(e);const{showSuggestions:t,selectedSuggestion:n,suggestions:s,loading:o}=this.state;if(!t||!s.length||o){switch(e.keyCode){case g:0!==e.target.selectionStart&&(e.preventDefault(),e.target.setSelectionRange(0,0));break;case d:this.props.value.length!==e.target.selectionStart&&(e.preventDefault(),e.target.setSelectionRange(this.props.value.length,this.props.value.length));break;case c:this.props.onSubmit&&(e.preventDefault(),this.props.onSubmit(null,e))}return}const r=this.state.suggestions[this.state.selectedSuggestion];switch(e.keyCode){case g:{e.preventDefault();const t=n?n-1:s.length-1;this.setState({selectedSuggestion:t});break}case d:{e.preventDefault();const t=null===n||n===s.length-1?0:n+1;this.setState({selectedSuggestion:t});break}case h:null!==this.state.selectedSuggestion&&(this.selectLink(r),this.props.speak(i("Link selected.")));break;case c:e.preventDefault(),null!==this.state.selectedSuggestion?(this.selectLink(r),this.props.onSubmit&&this.props.onSubmit(r,e)):this.props.onSubmit&&this.props.onSubmit(null,e)}}selectLink(e){this.props.onChange(e.url,e),this.setState({selectedSuggestion:null,showSuggestions:!1})}handleOnClick(e){this.selectLink(e),this.inputRef.current.focus()}static getDerivedStateFromProps({value:e,instanceId:t,disableSuggestions:n,__experimentalShowInitialSuggestions:s=!1},{showSuggestions:i}){let o=i;const r=e&&e.length;return s||r||(o=!1),!0===n&&(o=!1),{showSuggestions:o,suggestionsListboxId:`block-editor-url-input-suggestions-${t}`,suggestionOptionIdPrefix:`block-editor-url-input-suggestion-${t}`}}render(){return _e.jsxs(_e.Fragment,{children:[this.renderControl(),this.renderSuggestions()]})}renderControl(){const{label:t=null,className:n,isFullWidth:s,instanceId:o,placeholder:r=i("Paste URL or type to search"),__experimentalRenderControl:a,value:l="",hideLabelFromVision:c=!1}=this.props,{loading:u,showSuggestions:d,selectedSuggestion:g,suggestionsListboxId:h,suggestionOptionIdPrefix:p}=this.state,f=`url-input-control-${o}`,m={id:f,label:t,className:e("block-editor-url-input",n,{"is-full-width":s}),hideLabelFromVision:c},b={id:f,value:l,required:!0,type:"text",onChange:this.onChange,onFocus:this.onFocus,placeholder:r,onKeyDown:this.onKeyDown,role:"combobox","aria-label":t?void 0:i("URL"),"aria-expanded":d,"aria-autocomplete":"list","aria-owns":h,"aria-activedescendant":null!==g?`${p}-${g}`:void 0,ref:this.inputRef,suffix:this.props.suffix};return a?a(m,b,u):_e.jsxs(Ze,{__nextHasNoMarginBottom:!0,...m,children:[_e.jsx(Je,{...b,__next40pxDefaultSize:!0}),u&&_e.jsx(qe,{})]})}renderSuggestions(){const{className:t,__experimentalRenderSuggestions:n}=this.props,{showSuggestions:s,suggestions:i,suggestionsValue:o,selectedSuggestion:r,suggestionsListboxId:a,suggestionOptionIdPrefix:l,loading:c}=this.state;if(!s||0===i.length)return null;const u={id:a,ref:this.autocompleteRef,role:"listbox"},d=(e,t)=>({role:"option",tabIndex:"-1",id:`${l}-${t}`,ref:this.bindSuggestionNode(t),"aria-selected":t===r||void 0});return dn(n)?n({suggestions:i,selectedSuggestion:r,suggestionsListProps:u,buildSuggestionItemProps:d,isLoading:c,handleSuggestionClick:this.handleOnClick,isInitialSuggestions:!o?.length,currentInputValue:o}):_e.jsx(Xe,{placement:"bottom",focusOnMount:!1,children:_e.jsx("div",{...u,className:e("block-editor-url-input__suggestions",`${t}__suggestions`),children:i.map((t,n)=>ve.createElement(Ie,{__next40pxDefaultSize:!0,...d(0,n),key:t.id,className:e("block-editor-url-input__suggestion",{"is-selected":n===r}),onClick:()=>this.handleOnClick(t)},t.title))})})}}const hn=Le(Ee,Ye,Re,u((e,t)=>{if(dn(t.__experimentalFetchLinkSuggestions))return;const{getSettings:n}=e(ct);return{__experimentalFetchLinkSuggestions:n().__experimentalFetchLinkSuggestions}}))(gn),pn={placement:"bottom-start"},fn=()=>_e.jsxs(_e.Fragment,{children:[["bold","italic","link","unknown"].map(e=>_e.jsx(et,{name:`RichText.ToolbarControls.${e}`},e)),_e.jsx(et,{name:"RichText.ToolbarControls",children:t=>{if(!t.length)return null;const n=t.map(([{props:e}])=>e).some(({isActive:e})=>e);return _e.jsx(tt,{children:s=>_e.jsx(nt,{icon:ee,label:i("More"),toggleProps:{...s,className:e(s.className,{"is-pressed":n}),description:i("Displays more block tools")},controls:yt(t.map(([{props:e}])=>e),"title"),popoverProps:pn})})}})]});function mn({popoverAnchor:e}){return _e.jsx(Xe,{placement:"top",focusOnMount:!1,anchor:e,className:"block-editor-rich-text__inline-format-toolbar",__unstableSlotName:"block-toolbar",children:_e.jsx(f,{className:"block-editor-rich-text__inline-format-toolbar-group","aria-label":i("Format tools"),children:_e.jsx(st,{children:_e.jsx(fn,{})})})})}const bn=({inline:e,editableContentElement:t})=>e?_e.jsx(mn,{popoverAnchor:t}):_e.jsx(p,{group:"inline",children:_e.jsx(fn,{})});function xn(e){return e(te).getFormatTypes()}const kn=new Set(["a","audio","button","details","embed","iframe","input","label","select","textarea","video"]);function _n(e,t){return e[t]?e[t]:Object.keys(e).filter(e=>e.startsWith(t+".")).reduce((n,s)=>(n[s.slice(t.length+1)]=e[s],n),{})}const vn=["`",'"',"'","“”","‘’"];function Sn(e){let t=e.length;for(;t--;){const n=wt(e[t].attributes);if(n)return e[t].attributes[n]=e[t].attributes[n].toString().replace(Ct,""),[e[t].clientId,n,0,0];const s=Sn(e[t].innerBlocks);if(s)return s}return[]}function yn(e){if(!0===e||"p"===e||"li"===e)return!0===e?"p":e}function Cn({allowedFormats:e,disableFormats:t}){return t?Cn.EMPTY_ARRAY:e}Cn.EMPTY_ARRAY=[];const wn=[e=>t=>{function n(n){const{inputType:s,data:i}=n,{value:o,onChange:r,registry:a}=e.current;if("insertText"!==s)return;if(ne(o))return;const l=De("blockEditor.wrapSelectionSettings",vn).find(([e,t])=>e===i||t===i);if(!l)return;const[c,u=c]=l,d=o.start,g=o.end+c.length;let h=se(o,c,d,d);h=se(h,u,g,g);const{__unstableMarkLastChangeAsPersistent:p,__unstableMarkAutomaticChange:f}=a.dispatch(ct);p(),r(h),f();const m={};for(const e in n)m[e]=n[e];m.data=u;const{ownerDocument:b}=t,{defaultView:x}=b,k=new x.InputEvent("input",m);window.queueMicrotask(()=>{n.target.dispatchEvent(k)}),n.preventDefault()}return t.addEventListener("beforeinput",n),()=>{t.removeEventListener("beforeinput",n)}},e=>t=>{function n(){const{getValue:t,onReplace:n,selectionChange:s,registry:i}=e.current;if(!n)return;const o=t(),{start:r,text:a}=o;if(" "!==a.slice(r-1,r))return;const l=a.slice(0,r).trim(),c=dt("from").filter(({type:e})=>"prefix"===e),u=gt(c,({prefix:e})=>l===e);if(!u)return;const d=ie({value:se(o,Ct,0,r)}),g=u.transform(d);return s(...Sn([g])),n([g]),i.dispatch(ct).__unstableMarkAutomaticChange(),!0}function s(t){const{inputType:s,type:i}=t,{getValue:o,onChange:r,__unstableAllowPrefixTransformations:a,formatTypes:l,registry:c}=e.current;if("insertText"!==s&&"compositionend"!==i)return;if(a&&n())return;const u=o(),d=l.reduce((e,{__unstableInputRule:t})=>(t&&(e=t(e)),e),function(e){const t="tales of gutenberg",{start:n,text:s}=e;return n<18||s.slice(n-18,n).toLowerCase()!==t?e:se(e," 🐡🐢🦀🐤🦋🐘🐧🐹🦁🦄🦍🐼🐿🎃🐴🐝🐆🦕🦔🌱🍇π🍌🐉💧🥨🌌🍂🍠🥦🥚🥝🎟🥥🥒🛵🥖🍒🍯🎾🎲🐺🐚🐮⌛️")}(u)),{__unstableMarkLastChangeAsPersistent:g,__unstableMarkAutomaticChange:h}=c.dispatch(ct);d!==u&&(g(),r({...d,activeFormats:u.activeFormats}),h())}return t.addEventListener("input",s),t.addEventListener("compositionend",s),()=>{t.removeEventListener("input",s),t.removeEventListener("compositionend",s)}},e=>t=>{function n(t){if("insertReplacementText"!==t.inputType)return;const{registry:n}=e.current;n.dispatch(ct).__unstableMarkLastChangeAsPersistent()}return t.addEventListener("beforeinput",n),()=>{t.removeEventListener("beforeinput",n)}},()=>e=>{function t(e){(m.primary(e,"z")||m.primary(e,"y")||m.primaryShift(e,"z"))&&e.preventDefault()}return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}},e=>t=>{const{keyboardShortcuts:n}=e.current;function s(e){for(const t of n.current)t(e)}return t.addEventListener("keydown",s),()=>{t.removeEventListener("keydown",s)}},e=>t=>{const{inputEvents:n}=e.current;function s(e){for(const t of n.current)t(e)}return t.addEventListener("input",s),()=>{t.removeEventListener("input",s)}},e=>t=>{function n(t){const{keyCode:n}=t;if(t.defaultPrevented)return;if(n!==b&&n!==x)return;const{registry:s}=e.current,{didAutomaticChange:i,getSettings:o}=s.select(ct),{__experimentalUndo:r}=o();r&&i()&&(t.preventDefault(),r())}return t.addEventListener("keydown",n),()=>{t.removeEventListener("keydown",n)}},e=>t=>{function n(n){const{disableFormats:s,onChange:i,value:o,formatTypes:r,tagName:a,onReplace:l,__unstableEmbedURLOnPaste:c,preserveWhiteSpace:u,pastePlainText:d}=e.current;if(!t.contains(n.target))return;if(n.defaultPrevented)return;const{plainText:g,html:h}=jt(n);if(n.preventDefault(),window.console.log("Received HTML:\n\n",h),window.console.log("Received plain text:\n\n",g),s)return void i(se(o,g));function p(e){const t=r.reduce((e,{__unstablePasteRule:t})=>(t&&e===o&&(e=t(o,{html:h,plainText:g})),e),o);if(t!==o)i(t);else{const t=oe({html:e});!function(e,t){if(t?.length){let n=e.formats.length;for(;n--;)e.formats[n]=[...t,...e.formats[n]||[]]}}(t,o.activeFormats),i(se(o,t))}}if("true"===n.clipboardData.getData("rich-text"))return void p(h);if(d)return void i(se(o,oe({text:g})));let f="INLINE";const m=g.trim();c&&re(o)&&X(m)&&/^https?:/.test(m)&&(f="BLOCKS");const b=ht({HTML:h,plainText:g,mode:f,tagName:a});"string"==typeof b?p(b):b.length>0&&l&&re(o)&&l(b,b.length-1,-1)}const{defaultView:s}=t.ownerDocument;return s.addEventListener("paste",n),()=>{s.removeEventListener("paste",n)}},e=>t=>{function n(t){const{keyCode:n}=t;if(t.defaultPrevented)return;const{value:s,onMerge:i,onRemove:o}=e.current;if(n===k||n===b){const{start:e,end:r,text:a}=s,l=n===b,c=s.activeFormats&&!!s.activeFormats.length;if(!ne(s)||c||l&&0!==e||!l&&r!==a.length)return;i?i(!l):o&&re(s)&&l&&o(!l),t.preventDefault()}}return t.addEventListener("keydown",n),()=>{t.removeEventListener("keydown",n)}},e=>t=>{function n(t){if(t.keyCode!==c)return;const{onReplace:n,onSplit:s}=e.current;n&&s&&(t.__deprecatedOnSplit=!0)}function s(n){if(n.defaultPrevented)return;if(n.target!==t)return;if(n.keyCode!==c)return;const{value:s,onChange:i,disableLineBreaks:o,onSplitAtEnd:r,onSplitAtDoubleLineEnd:a,registry:l}=e.current;n.preventDefault();const{text:u,start:d,end:g}=s;n.shiftKey?o||i(se(s,"\n")):r&&d===g&&g===u.length?r():a&&d===g&&g===u.length&&"\n\n"===u.slice(-2)?l.batch(()=>{const e={...s};e.start=e.end-2,i(ae(e)),a()}):o||i(se(s,"\n"))}const{defaultView:i}=t.ownerDocument;return i.addEventListener("keydown",s),t.addEventListener("keydown",n),()=>{i.removeEventListener("keydown",s),t.removeEventListener("keydown",n)}},e=>t=>{function n(){const{registry:n}=e.current;if(!n.select(ct).isMultiSelecting())return;const s=t.parentElement.closest('[contenteditable="true"]');s&&s.focus()}return t.addEventListener("focus",n),()=>{t.removeEventListener("focus",n)}}];function jn(e){const t=ve.useRef(e);t.current=e;const n=ve.useMemo(()=>wn.map(e=>e(t)),[t]);return Pe(t=>{if(!e.isSelected)return;const s=n.map(e=>e(t));return()=>{s.forEach(e=>e())}},[n,e.isSelected])}const Ln={},En=Symbol("usesContext");function Rn({onChange:e,onFocus:t,value:n,forwardedRef:s,settings:i}){const{name:o,edit:r,[En]:a}=i,l=ve.useContext(xt),c=ve.useMemo(()=>a?Object.fromEntries(Object.entries(l).filter(([e])=>a.includes(e))):Ln,[a,l]);if(!r)return null;const u=le(n,o),d=void 0!==u,g=ce(n),h=void 0!==g&&g.type===o;return _e.jsx(r,{isActive:d,activeAttributes:d&&u.attributes||{},isObjectActive:h,activeObjectAttributes:h&&g.attributes||{},value:n,onChange:e,onFocus:t,contentRef:s,context:c},o)}function Nn({formatTypes:e,...t}){return e.map(e=>ve.createElement(Rn,{settings:e,...t,key:e.name}))}function Dn(e,t){if(zn.isEmpty(e)){const e=yn(t);return e?`<${e}></${e}>`:""}return Array.isArray(e)?(ue("wp.blockEditor.RichText value prop as children type",{since:"6.1",version:"6.3",alternative:"value prop as string",link:"https://developer.wordpress.org/block-editor/how-to-guides/block-tutorial/introducing-attributes-and-editable-fields/"}),pt.toHTML(e)):"string"==typeof e?e:e.toHTMLString()}function Pn({value:e,tagName:t,multiline:n,format:s,...i}){return e=_e.jsx(_,{children:Dn(e,n)}),t?_e.jsx(t,{...i,children:e}):e}const Fn=ve.forwardRef(function({children:e,identifier:t,tagName:n="div",value:s="",onChange:i,multiline:o,...r},u){ue("wp.blockEditor.RichText multiline prop",{since:"6.1",version:"6.3",alternative:"nested blocks (InnerBlocks)",link:"https://developer.wordpress.org/block-editor/how-to-guides/block-tutorial/nested-blocks-inner-blocks/"});const{clientId:d}=kt(),{getSelectionStart:g,getSelectionEnd:h}=a(ct),{selectionChange:p}=l(ct),f=yn(o),m=`</${f}>${s=s||`<${f}></${f}>`}<${f}>`.split(`</${f}><${f}>`);function b(e){i(`<${f}>${e.join(`</${f}><${f}>`)}</${f}>`)}return m.shift(),m.pop(),_e.jsx(n,{ref:u,children:m.map((e,n)=>_e.jsx(Un,{identifier:`${t}-${n}`,tagName:f,value:e,onChange:e=>{const t=m.slice();t[n]=e,b(t)},isSelected:void 0,onKeyDown:s=>{if(s.keyCode!==c)return;s.preventDefault();const{offset:i}=g(),{offset:o}=h();if("number"!=typeof i||"number"!=typeof o)return;const r=oe({html:e});r.start=i,r.end=o;const a=de(r).map(e=>ie({value:e})),l=m.slice();l.splice(n,1,...a),b(l),p(d,`${t}-${n+1}`,0,0)},onMerge:e=>{const s=m.slice();let i=0;if(e){if(!s[n+1])return;s.splice(n,2,s[n]+s[n+1]),i=s[n].length-1}else{if(!s[n-1])return;s.splice(n-1,2,s[n-1]+s[n]),i=s[n-1].length-1}b(s),p(d,`${t}-${n-(e?0:1)}`,i,i)},...r},n))})});function Tn({character:e,type:t,onUse:n}){const s=ve.useContext(An),i=ve.useRef();return i.current=n,ve.useEffect(()=>{function n(n){m[t](n,e)&&(i.current(),n.preventDefault())}return s.current.add(n),()=>{s.current.delete(n)}},[e,t]),null}function In({name:e,shortcutType:t,shortcutCharacter:n,...s}){let i,o="RichText.ToolbarControls";return e&&(o+=`.${e}`),t&&n&&(i=v[t](n)),_e.jsx(it,{name:o,children:_e.jsx(ot,{...s,shortcut:i})})}function On({inputType:e,onInput:t}){const n=ve.useContext(Mn),s=ve.useRef();return s.current=t,ve.useEffect(()=>{function t(t){t.inputType===e&&(s.current(),t.preventDefault())}return n.current.add(t),()=>{n.current.delete(t)}},[e]),null}const An=ve.createContext(),Mn=ve.createContext(),$n=Symbol("instanceId");function Bn(e){const{__unstableMobileNoFocusOnMount:t,deleteEnter:n,placeholderTextColor:s,textAlign:i,selectionColor:o,tagsToEliminate:r,disableEditingMenu:a,fontSize:l,fontFamily:c,fontWeight:u,fontStyle:d,minWidth:g,maxWidth:h,disableSuggestions:p,disableAutocorrection:f,...m}=e;return m}function Un({children:t,tagName:n="div",value:o="",onChange:r,isSelected:c,multiline:u,inlineToolbar:d,wrapperClassName:g,autocompleters:h,onReplace:p,placeholder:f,allowedFormats:m,withoutInteractiveFormatting:b,onRemove:x,onMerge:k,onSplit:_,__unstableOnSplitAtEnd:v,__unstableOnSplitAtDoubleLineEnd:y,identifier:C,preserveWhiteSpace:w,__unstablePastePlainText:j,__unstableEmbedURLOnPaste:L,__unstableDisableFormats:E,disableLineBreaks:R,__unstableAllowPrefixTransformations:N,readOnly:D,...P},F){P=Bn(P),_&&ue("wp.blockEditor.RichText onSplit prop",{since:"6.4",alternative:'block.json support key: "splitting"'});const T=Ce(Un),I=ve.useRef(),O=kt(),{clientId:A,isSelected:M,name:$}=O,B=O[vt],U=ve.useContext(xt),V=St(),{selectionStart:H,selectionEnd:z,isSelected:q}=a(e=>{if(!M)return{isSelected:!1};const{getSelectionStart:t,getSelectionEnd:n}=e(ct),s=t(),i=n();let o;return void 0===c?o=s.clientId===A&&i.clientId===A&&(C?s.attributeKey===C:s[$n]===T):c&&(o=s.clientId===A),{selectionStart:o?s.offset:void 0,selectionEnd:o?i.offset:void 0,isSelected:o}},[A,C,T,c,M]),{disableBoundBlock:W,bindingsPlaceholder:K,bindingsLabel:G}=a(e=>{var t;if(!B?.[C]||!Lt($))return{};const n=B[C],r=ft(n.source),a={};if(r?.usesContext?.length)for(const s of r.usesContext)a[s]=U[s];const l=!r?.canUserEditValue?.({select:e,context:a,args:n.args});if(o.length>0)return{disableBoundBlock:l,bindingsPlaceholder:null,bindingsLabel:null};const{getBlockAttributes:c}=e(ct),u=c(A),d=r?.getFieldsList?.({select:e,context:a}),g=null!==(t=d?.[n?.args?.key]?.label)&&void 0!==t?t:r?.label,h=l?g:s(i("Add %s"),g),p=l?n?.args?.key||r?.label:s(i("Empty %s; start writing to edit its value"),n?.args?.key||r?.label);return{disableBoundBlock:l,bindingsPlaceholder:u?.placeholder||h,bindingsLabel:p}},[B,C,$,U,o]),Q=D||W,{getSelectionStart:Y,getSelectionEnd:Z,getBlockRootClientId:J}=a(ct),{selectionChange:X}=l(ct),ee=Cn({allowedFormats:m,disableFormats:E}),te=!ee||ee.length>0,ne=ve.useCallback((e,t)=>{const n={},s=void 0===e&&void 0===t,i={clientId:A,[C?"attributeKey":$n]:C||T};if("number"==typeof e||s){if(void 0===t&&J(A)!==J(Z().clientId))return;n.start={...i,offset:e}}if("number"==typeof t||s){if(void 0===e&&J(A)!==J(Y().clientId))return;n.end={...i,offset:t}}X(n)},[A,J,Z,Y,C,T,X]),{formatTypes:se,prepareHandlers:ie,valueHandlers:oe,changeHandlers:re,dependencies:ae}=function({clientId:e,identifier:t,withoutInteractiveFormatting:n,allowedFormats:s}){const i=a(xn,[]),o=ve.useMemo(()=>i.filter(({name:e,interactive:t,tagName:i})=>!(s&&!s.includes(e)||n&&(t||kn.has(i)))),[i,s,n]),r=a(n=>o.reduce((s,i)=>{return i.__experimentalGetPropsForEditableTreePreparation?{...s,...(o=i.__experimentalGetPropsForEditableTreePreparation(n,{richTextIdentifier:t,blockClientId:e}),r=i.name,"object"!=typeof o?{[r]:o}:Object.fromEntries(Object.entries(o).map(([e,t])=>[`${r}.${e}`,t])))}:s;var o,r},{}),[o,e,t]),c=l(),u=[],d=[],g=[],h=[];for(const a in r)h.push(r[a]);return o.forEach(n=>{if(n.__experimentalCreatePrepareEditableTree){const s=n.__experimentalCreatePrepareEditableTree(_n(r,n.name),{richTextIdentifier:t,blockClientId:e});n.__experimentalCreateOnChangeEditableValue?d.push(s):u.push(s)}if(n.__experimentalCreateOnChangeEditableValue){let s={};n.__experimentalGetPropsForEditableTreeChangeHandler&&(s=n.__experimentalGetPropsForEditableTreeChangeHandler(c,{richTextIdentifier:t,blockClientId:e}));const i=_n(r,n.name);g.push(n.__experimentalCreateOnChangeEditableValue({..."object"==typeof i?i:{},...s},{richTextIdentifier:t,blockClientId:e}))}}),{formatTypes:o,prepareHandlers:u,valueHandlers:d,changeHandlers:g,dependencies:h}}({clientId:A,identifier:C,withoutInteractiveFormatting:b,allowedFormats:ee});function le(e){return se.forEach(t=>{t.__experimentalCreatePrepareEditableTree&&(e=pe(e,t.name,0,e.text.length))}),e.formats}const{value:ce,getValue:de,onChange:ge,ref:fe}=he({value:o,onChange(e,{__unstableFormats:t,__unstableText:n}){r(e),Object.values(re).forEach(e=>{e(t,n)})},selectionStart:H,selectionEnd:z,onSelectionChange:ne,placeholder:K||f,__unstableIsSelected:q,__unstableDisableFormats:E,preserveWhiteSpace:w,__unstableDependencies:[...ae,n],__unstableAfterParse:function(e){return oe.reduce((t,n)=>n(t,e.text),e.formats)},__unstableBeforeSerialize:le,__unstableAddInvisibleFormats:function(e){return ie.reduce((t,n)=>n(t,e.text),e.formats)}}),me=S({onReplace:p,completers:h,record:ce,onChange:ge});!function({html:e,value:t}){const n=ve.useRef(),s=!!t.activeFormats?.length,{__unstableMarkLastChangeAsPersistent:i}=l(ct);ve.useLayoutEffect(()=>{if(n.current){if(n.current!==t.text){const e=window.setTimeout(()=>{i()},1e3);return n.current=t.text,()=>{window.clearTimeout(e)}}i()}else n.current=t.text},[e,s])}({html:o,value:ce});const be=ve.useRef(new Set),xe=ve.useRef(new Set);function ke(){I.current?.focus()}const Se=n;return _e.jsxs(_e.Fragment,{children:[q&&_e.jsx(An.Provider,{value:be,children:_e.jsx(Mn.Provider,{value:xe,children:_e.jsxs(Xe.__unstableSlotNameProvider,{value:"__unstable-block-tools-after",children:[t&&t({value:ce,onChange:ge,onFocus:ke}),_e.jsx(Nn,{value:ce,onChange:ge,onFocus:ke,formatTypes:se,forwardedRef:I})]})})}),q&&te&&_e.jsx(bn,{inline:d,editableContentElement:I.current}),_e.jsx(Se,{role:"textbox","aria-multiline":!R,"aria-readonly":Q,...P,"aria-label":G||P["aria-label"]||f,...me,ref:Fe([fe,F,me.ref,P.ref,jn({registry:V,getValue:de,onChange:ge,__unstableAllowPrefixTransformations:N,formatTypes:se,onReplace:p,selectionChange:X,isSelected:q,disableFormats:E,value:ce,tagName:n,onSplit:_,__unstableEmbedURLOnPaste:L,pastePlainText:j,onMerge:k,onRemove:x,removeEditorOnlyFormats:le,disableLineBreaks:R,onSplitAtEnd:v,onSplitAtDoubleLineEnd:y,keyboardShortcuts:be,inputEvents:xe}),I]),contentEditable:!Q,suppressContentEditableWarning:!0,className:e("block-editor-rich-text__editable",P.className,"rich-text"),tabIndex:0!==P.tabIndex||Q?P.tabIndex:null,"data-wp-block-attribute-key":C})]})}const Vn=(Hn=ve.forwardRef(Un),ve.forwardRef((e,t)=>{let n=e.value,s=e.onChange;Array.isArray(n)&&(ue("wp.blockEditor.RichText value prop as children type",{since:"6.1",version:"6.3",alternative:"value prop as string",link:"https://developer.wordpress.org/block-editor/how-to-guides/block-tutorial/introducing-attributes-and-editable-fields/"}),n=pt.toHTML(e.value),s=t=>e.onChange(pt.fromDOM(ge(document,t).childNodes)));const i=e.multiline?Fn:Hn;return _e.jsx(i,{...e,value:n,onChange:s,ref:t})}));var Hn;Vn.Content=Pn,Vn.isEmpty=e=>!e||0===e.length;const zn=ve.forwardRef((e,t)=>{if(kt()[_t]){const{children:t,tagName:n="div",value:s,onChange:i,isSelected:o,multiline:r,inlineToolbar:a,wrapperClassName:l,autocompleters:c,onReplace:u,placeholder:d,allowedFormats:g,withoutInteractiveFormatting:h,onRemove:p,onMerge:f,onSplit:m,__unstableOnSplitAtEnd:b,__unstableOnSplitAtDoubleLineEnd:x,identifier:k,preserveWhiteSpace:_,__unstablePastePlainText:v,__unstableEmbedURLOnPaste:S,__unstableDisableFormats:y,disableLineBreaks:C,__unstableAllowPrefixTransformations:w,readOnly:j,...L}=Bn(e);return _e.jsx(n,{...L,dangerouslySetInnerHTML:{__html:Dn(s,r)}})}return _e.jsx(Vn,{ref:t,...e,readOnly:!1})});zn.Content=Pn,zn.isEmpty=e=>!e||0===e.length;class qn extends ve.Component{constructor(){super(...arguments),this.toggle=this.toggle.bind(this),this.submitLink=this.submitLink.bind(this),this.state={expanded:!1}}toggle(){this.setState({expanded:!this.state.expanded})}submitLink(e){e.preventDefault(),this.toggle()}render(){const{url:e,onChange:t}=this.props,{expanded:n}=this.state,s=i(e?"Edit link":"Insert link");return _e.jsxs("div",{className:"block-editor-url-input__button",children:[_e.jsx(Ie,{size:"compact",icon:fe,label:s,onClick:this.toggle,className:"components-toolbar__control",isPressed:!!e}),n&&_e.jsx("form",{className:"block-editor-url-input__button-modal",onSubmit:this.submitLink,children:_e.jsxs("div",{className:"block-editor-url-input__button-modal-line",children:[_e.jsx(Ie,{__next40pxDefaultSize:!0,className:"block-editor-url-input__back",icon:me,label:i("Close"),onClick:this.toggle}),_e.jsx(hn,{value:e||"",onChange:t,suffix:_e.jsx(Ke,{variant:"control",children:_e.jsx(Ie,{size:"small",icon:J,label:i("Submit"),type:"submit"})})})]})})]})}}const Wn="none",Kn="custom",Gn="media",Qn="attachment",Yn=["noreferrer","noopener"],Zn=({linkDestination:e,onChangeUrl:t,url:n,mediaType:s="image",mediaUrl:o,mediaLink:r,linkTarget:a,linkClass:l,rel:c,showLightboxSetting:u,lightboxEnabled:d,onSetLightbox:g,resetLightbox:h})=>{const[p,f]=ve.useState(!1),[m,b]=ve.useState(null),[x,k]=ve.useState(!1),[_,v]=ve.useState(null),S=ve.useRef(null),y=ve.useRef();ve.useEffect(()=>{if(!y.current)return;(Z.focusable.find(y.current)[0]||y.current).focus()},[x,n,d]);const C=()=>{e!==Gn&&e!==Qn||v(""),k(!0)},w=()=>{k(!1)},j=()=>{const e=[{linkDestination:Gn,title:i("Link to image file"),url:"image"===s?o:void 0,icon:xe}];return"image"===s&&r&&e.push({linkDestination:Qn,title:i("Link to attachment page"),url:"image"===s?r:void 0,icon:A}),e},L=_e.jsxs(rt,{spacing:"3",children:[_e.jsx(at,{__nextHasNoMarginBottom:!0,label:i("Open in new tab"),onChange:e=>{const n=(e=>{const t=e?"_blank":void 0;let n;if(t){const e=(null!=c?c:"").split(" ");Yn.forEach(t=>{e.includes(t)||e.push(t)}),n=e.join(" ")}else{const e=(null!=c?c:"").split(" ").filter(e=>!1===Yn.includes(e));n=e.length?e.join(" "):void 0}return{linkTarget:t,rel:n}})(e);t(n)},checked:"_blank"===a}),_e.jsx(We,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:i("Link rel"),value:null!=c?c:"",onChange:e=>{t({rel:e})}}),_e.jsx(We,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:i("Link CSS class"),value:l||"",onChange:e=>{t({linkClass:e})}})]}),E=null!==_?_:n,R=!d||d&&!u,N=!E&&R,D=(j().find(t=>t.linkDestination===e)||{}).title;return _e.jsxs(_e.Fragment,{children:[_e.jsx(ot,{icon:fe,className:"components-toolbar__control",label:i("Link"),"aria-expanded":p,onClick:()=>{f(!0)},ref:b,isActive:!!n||d&&u}),p&&_e.jsx(ut,{ref:y,anchor:m,onFocusOutside:e=>{const t=S.current;t&&t.contains(e.target)||(f(!1),v(null),w())},onClose:()=>{v(null),w(),f(!1)},renderSettings:R?()=>L:null,additionalControls:N&&_e.jsxs(lt,{children:[j().map(e=>_e.jsx(Ae,{icon:e.icon,iconPosition:"left",onClick:()=>{v(null),(e=>{const n=j();let s;s=e?(n.find(t=>t.url===e)||{linkDestination:Kn}).linkDestination:Wn,t({linkDestination:s,href:e})})(e.url),w()},children:e.title},e.linkDestination)),u&&_e.jsx(Ae,{className:"block-editor-url-popover__expand-on-click",icon:be,info:i("Scale the image with a lightbox effect."),iconPosition:"left",onClick:()=>{v(null),t({linkDestination:Wn,href:""}),g?.(!0),w()},children:i("Expand on click")},"expand-on-click")]}),offset:13,children:d&&u&&!n&&!x?_e.jsxs("div",{className:"block-editor-url-popover__expand-on-click",children:[_e.jsx($,{icon:be}),_e.jsxs("div",{className:"text",children:[_e.jsx("p",{children:i("Expand on click")}),_e.jsx("p",{className:"description",children:i("Scales the image with a lightbox effect")})]}),_e.jsx(Ie,{icon:K,label:i("Disable expand on click"),onClick:()=>{g?.(!1)},size:"compact"})]}):!n||x?_e.jsx(ut.LinkEditor,{className:"block-editor-format-toolbar__link-container-content",value:E,onChangeInputValue:v,onSubmit:e=>{if(_){const e=j().find(e=>e.url===_)?.linkDestination||Kn;t({href:_,linkDestination:e,lightbox:{enabled:!1}})}w(),v(null),e.preventDefault()},autocompleteRef:S}):n&&!x?_e.jsxs(_e.Fragment,{children:[_e.jsx(ut.LinkViewer,{className:"block-editor-format-toolbar__link-container-content",url:n,onEditLinkClick:C,urlLabel:D}),_e.jsx(Ie,{icon:K,label:i("Remove link"),onClick:()=>{t({linkDestination:Wn,href:""}),h?.()},size:"compact"})]}):void 0})]})};function Jn(e,t,n){if(null==e||!1===e)return;if(Array.isArray(e))return Xn(e,t,n);switch(typeof e){case"string":case"number":return}const{type:s,props:i}=e;switch(s){case ve.StrictMode:case ve.Fragment:return Xn(i.children,t,n);case _:return;case y.Content:return es(t,n);case Pn:return void t.push(i.value)}switch(typeof s){case"string":return void 0!==i.children?Xn(i.children,t,n):void 0;case"function":return Jn(s.prototype&&"function"==typeof s.prototype.render?new s(i).render():s(i),t,n)}}function Xn(e,...t){e=Array.isArray(e)?e:[e];for(let n=0;n<e.length;n++)Jn(e[n],...t)}function es(e,t){for(let n=0;n<t.length;n++){const{name:s,attributes:i,innerBlocks:o}=t[n];Jn(bt(s,i,_e.jsx(y.Content,{})),e,o)}}function ts(e=[]){mt.skipFilters=!0;const t=[];return es(t,e),mt.skipFilters=!1,t.map(e=>e instanceof ke?e:ke.fromHTMLString(e))}export{Zn as I,un as L,Vn as P,Tn as R,hn as U,On as _,zn as a,Qt as b,Ht as c,It as d,In as e,qn as f,ts as g,Et as i,En as u};
