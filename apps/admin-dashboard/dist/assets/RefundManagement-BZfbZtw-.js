import{r as i,j as e,S as Y,co as ee,O as se,bE as te,bv as b,bV as D,Z as w,bu as L,V as j}from"./vendor-react-BZRIq8oW.js";import{u as re,a as F,b as R}from"./vendor-query-GrNIwsDq.js";import{C as l,k as v,l as N,m as o,I as K,B as c,w as P,x as I,y as O,z as T,E,L as x,T as ae,F as Q,s as n,j as y}from"./page-gutenberg-iVBL5IS_.js";import"./wp-block-editor-C14Ds6es.js";import"./wp-blocks-CnCGET8b.js";import"./wp-core-BctBwZpo.js";import"./wp-i18n-Niz9RVma.js";import"./wp-element-CB9_H0_F.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-monaco-cpVGocfO.js";import"./vendor-utils-DQ8F5vJI.js";import"./wp-components-CLkQS2qf.js";const ve=()=>{const g=re(),[m,B]=i.useState(""),[u,z]=i.useState("all"),[t,C]=i.useState(null),[M,p]=i.useState(!1),[U,f]=i.useState(!1),[r,d]=i.useState({refundId:"",action:"approve",approvedAmount:0,adminNote:"",notifyCustomer:!0}),{data:V,isLoading:$}=F({queryKey:["refund-requests",m,u],queryFn:async()=>{const s=new URLSearchParams;return m&&s.append("search",m),u!=="all"&&s.append("status",u),(await y.api.get(`/v1/payments/refunds?${s.toString()}`)).data}}),S=V?.data||[],{data:H}=F({queryKey:["refund-stats"],queryFn:async()=>(await y.api.get("/v1/payments/refunds/stats")).data}),h=H?.data||{},A=R({mutationFn:async s=>(await y.api.post(`/v1/payments/refunds/${s.refundId}/process`,s)).data,onSuccess:()=>{j.success("환불 처리가 완료되었습니다"),g.invalidateQueries({queryKey:["refund-requests"]}),g.invalidateQueries({queryKey:["refund-stats"]}),p(!1),d({refundId:"",action:"approve",approvedAmount:0,adminNote:"",notifyCustomer:!0})}}),q=R({mutationFn:async s=>(await y.api.post(`/v1/payments/refunds/${s}/retry`)).data,onSuccess:()=>{j.success("환불 재시도가 시작되었습니다"),g.invalidateQueries({queryKey:["refund-requests"]})}}),Z=s=>{switch(s){case"requested":return e.jsx(n,{variant:"outline",className:"text-yellow-600 border-yellow-600",children:"요청됨"});case"processing":return e.jsx(n,{variant:"outline",className:"text-blue-600 border-blue-600",children:"처리중"});case"approved":return e.jsx(n,{variant:"outline",className:"text-purple-600 border-purple-600",children:"승인됨"});case"completed":return e.jsx(n,{children:"완료"});case"rejected":return e.jsx(n,{variant:"secondary",children:"거부됨"});case"failed":return e.jsx(n,{variant:"destructive",children:"실패"});default:return e.jsx(n,{variant:"outline",children:s})}},k=s=>{switch(s){case"requested":return e.jsx(D,{className:"w-4 h-4 text-yellow-600"});case"processing":return e.jsx(b,{className:"w-4 h-4 text-blue-600 animate-spin"});case"approved":return e.jsx(w,{className:"w-4 h-4 text-purple-600"});case"completed":return e.jsx(w,{className:"w-4 h-4 text-green-600"});case"rejected":return e.jsx(L,{className:"w-4 h-4 text-gray-600"});case"failed":return e.jsx(L,{className:"w-4 h-4 text-red-600"});default:return e.jsx(b,{className:"w-4 h-4"})}},_=s=>{C(s),d({refundId:s.id,action:"approve",approvedAmount:s.requestedAmount,adminNote:"",notifyCustomer:!0}),p(!0)},G=s=>{C(s),f(!0)},J=s=>{if(s.preventDefault(),r.action==="approve"&&(!r.approvedAmount||r.approvedAmount<=0)){j.error("승인 금액을 입력하세요");return}if(!r.adminNote.trim()){j.error("처리 메모를 입력하세요");return}A.mutate(r)},W=s=>["requested","processing"].includes(s),X=s=>s==="failed";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"환불 관리"}),e.jsx("p",{className:"text-modern-text-secondary mt-1",children:"토스페이먼츠 환불 요청 처리 및 관리"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(l,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(N,{className:"text-sm font-medium text-modern-text-secondary",children:"대기 중"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:h.requested||0}),e.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"처리 대기"})]})]}),e.jsxs(l,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(N,{className:"text-sm font-medium text-modern-text-secondary",children:"처리 중"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:h.processing||0}),e.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"토스 처리 중"})]})]}),e.jsxs(l,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(N,{className:"text-sm font-medium text-modern-text-secondary",children:"완료"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.completed||0}),e.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]}),e.jsxs(l,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(N,{className:"text-sm font-medium text-modern-text-secondary",children:"총 환불 금액"})}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold text-modern-text-primary",children:["₩",(h.totalAmount||0).toLocaleString()]}),e.jsx("p",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-modern-text-tertiary w-5 h-5"}),e.jsx(K,{type:"text",placeholder:"주문번호, 고객명으로 검색...",value:m,onChange:s=>B(s.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-modern-text-secondary"}),e.jsxs("select",{value:u,onChange:s=>z(s.target.value),className:"px-4 py-2 border border-modern-border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-modern-primary",children:[e.jsx("option",{value:"all",children:"모든 상태"}),e.jsx("option",{value:"requested",children:"요청됨"}),e.jsx("option",{value:"processing",children:"처리중"}),e.jsx("option",{value:"approved",children:"승인됨"}),e.jsx("option",{value:"completed",children:"완료"}),e.jsx("option",{value:"rejected",children:"거부됨"}),e.jsx("option",{value:"failed",children:"실패"})]})]})]}),e.jsx(l,{children:e.jsx(o,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-modern-bg-tertiary border-b border-modern-border-primary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"주문 정보"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"고객"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"환불 금액"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상태"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"요청일"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-modern-border-primary",children:$?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})})})}):S.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-modern-text-secondary",children:"환불 요청이 없습니다."})}):S.map(s=>e.jsxs("tr",{className:"hover:bg-modern-bg-hover",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:s.orderNumber}),e.jsxs("div",{className:"text-sm text-modern-text-secondary",children:[s.items.length,"개 상품"]}),e.jsx("div",{className:"text-xs text-modern-text-tertiary",children:s.reason})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:s.customerName}),e.jsx("div",{className:"text-sm text-modern-text-secondary",children:s.customerEmail})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-modern-text-primary",children:["₩",s.requestedAmount.toLocaleString()]}),s.approvedAmount&&s.approvedAmount!==s.requestedAmount&&e.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["승인: ₩",s.approvedAmount.toLocaleString()]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[k(s.status),Z(s.status)]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-modern-text-secondary",children:new Date(s.requestedAt).toLocaleDateString("ko-KR")})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>G(s),children:e.jsx(se,{className:"w-4 h-4"})}),W(s.status)&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>_(s),children:e.jsx(te,{className:"w-4 h-4"})}),X(s.status)&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>q.mutate(s.id),disabled:q.isPending,children:e.jsx(b,{className:"w-4 h-4"})})]})})]},s.id))})]})})})}),e.jsx(P,{open:M,onOpenChange:p,children:e.jsx(I,{className:"max-w-md",children:e.jsxs("form",{onSubmit:J,children:[e.jsxs(O,{children:[e.jsx(T,{children:"환불 처리"}),e.jsxs(E,{children:[t?.orderNumber," - ",t?.customerName]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{children:e.jsxs(x,{children:["요청 금액: ₩",t?.requestedAmount?.toLocaleString()]})}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"action",children:"처리 결과 *"}),e.jsxs("select",{id:"action",value:r.action,onChange:s=>d(a=>({...a,action:s.target.value})),className:"w-full px-3 py-2 border border-modern-border-primary rounded-lg mt-1",required:!0,children:[e.jsx("option",{value:"approve",children:"승인"}),e.jsx("option",{value:"reject",children:"거부"})]})]}),r.action==="approve"&&e.jsxs("div",{children:[e.jsx(x,{htmlFor:"approvedAmount",children:"승인 금액 *"}),e.jsx(K,{id:"approvedAmount",type:"number",min:"0",max:t?.requestedAmount,value:r.approvedAmount,onChange:s=>d(a=>({...a,approvedAmount:parseFloat(s.target.value)||0})),required:!0}),e.jsxs("div",{className:"text-xs text-modern-text-tertiary mt-1",children:["최대 승인 가능: ₩",t?.requestedAmount?.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"adminNote",children:"처리 메모 *"}),e.jsx(ae,{id:"adminNote",value:r.adminNote,onChange:s=>d(a=>({...a,adminNote:s.target.value})),placeholder:"환불 처리 사유나 메모를 입력하세요...",rows:3,required:!0})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"notifyCustomer",checked:r.notifyCustomer,onChange:s=>d(a=>({...a,notifyCustomer:s.target.checked})),className:"mr-2"}),e.jsx(x,{htmlFor:"notifyCustomer",children:"고객에게 알림 발송"})]})]}),e.jsxs(Q,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>p(!1),children:"취소"}),e.jsx(c,{type:"submit",disabled:A.isPending,children:r.action==="approve"?"승인":"거부"})]})]})})}),e.jsx(P,{open:U,onOpenChange:f,children:e.jsxs(I,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(O,{children:[e.jsx(T,{children:"환불 요청 상세"}),e.jsxs(E,{children:[t?.orderNumber," - ",t?.customerName]})]}),t&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"환불 상품"}),e.jsx("div",{className:"space-y-2",children:t.items.map(s=>e.jsxs("div",{className:"flex justify-between p-3 bg-modern-bg-secondary rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.productName}),e.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["SKU: ",s.sku," | 주문 수량: ",s.quantity," | 환불 수량: ",s.refundQuantity]}),e.jsxs("div",{className:"text-sm text-modern-text-tertiary",children:["환불 사유: ",s.reason]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["₩",s.refundAmount.toLocaleString()]}),e.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["단가: ₩",s.unitPrice.toLocaleString()]})]})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"결제 정보"}),e.jsx("div",{className:"p-3 bg-modern-bg-secondary rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-modern-text-secondary",children:"토스 결제키"}),e.jsx("div",{className:"font-medium",children:t.paymentKey})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-modern-text-secondary",children:"요청 금액"}),e.jsxs("div",{className:"font-medium",children:["₩",t.requestedAmount.toLocaleString()]})]}),t.approvedAmount&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-modern-text-secondary",children:"승인 금액"}),e.jsxs("div",{className:"font-medium",children:["₩",t.approvedAmount.toLocaleString()]})]}),t.tossRefundKey&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-modern-text-secondary",children:"토스 환불키"}),e.jsx("div",{className:"font-medium",children:t.tossRefundKey})]})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"처리 이력"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-modern-bg-secondary rounded-lg",children:[e.jsx(D,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:"환불 요청"}),e.jsx("div",{className:"text-sm text-modern-text-secondary",children:new Date(t.requestedAt).toLocaleString("ko-KR")}),e.jsxs("div",{className:"text-sm text-modern-text-tertiary",children:["사유: ",t.reason]})]})]}),t.processedAt&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-modern-bg-secondary rounded-lg",children:[k(t.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:"관리자 처리"}),e.jsx("div",{className:"text-sm text-modern-text-secondary",children:new Date(t.processedAt).toLocaleString("ko-KR")}),t.adminNote&&e.jsxs("div",{className:"text-sm text-modern-text-tertiary",children:["메모: ",t.adminNote]})]})]}),t.completedAt&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-modern-bg-secondary rounded-lg",children:[e.jsx(w,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:"환불 완료"}),e.jsx("div",{className:"text-sm text-modern-text-secondary",children:new Date(t.completedAt).toLocaleString("ko-KR")}),t.receiptUrl&&e.jsx("div",{className:"text-sm",children:e.jsx("a",{href:t.receiptUrl,target:"_blank",rel:"noopener noreferrer",className:"text-modern-primary hover:underline",children:"환불 영수증 보기"})})]})]})]})]})]}),e.jsx(Q,{children:e.jsx(c,{onClick:()=>f(!1),children:"닫기"})})]})})]})};export{ve as default};
