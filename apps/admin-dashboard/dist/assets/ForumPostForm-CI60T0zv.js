import{a1 as V,a2 as D,r as y,V as a,j as e,a3 as M,$ as T}from"./vendor-react-CMQx0Rxg.js";import{u as $,a as v,b as g}from"./vendor-query-B9kD0akd.js";import{j as l,B as h,C,k as b,l as N,m as k,L as i,I as B,S,f as w,g as F,h as L,i as x,T as z}from"./page-gutenberg-Bg9cnlWs.js";import{S as P}from"./page-template-editor-C4kVNhH9.js";import"./wp-all-CpKe89B2.js";import"./vendor-ui-BkLtITBR.js";import"./vendor-monaco-cpVGocfO.js";import"./vendor-utils-DQ8F5vJI.js";const X=()=>{const d=V(),{id:o}=D(),u=$(),c=!!o,[t,j]=y.useState({title:"",content:"",categoryId:"",status:"published",isPinned:!1,isLocked:!1}),{data:q}=v({queryKey:["forum-categories"],queryFn:async()=>(await l.api.get("/v1/forum/categories")).data}),I=q?.data||[],{data:r,isLoading:E}=v({queryKey:["forum-post",o],queryFn:async()=>(await l.api.get(`/v1/forum/posts/${o}`)).data.data,enabled:c}),p=g({mutationFn:async s=>(await l.api.post("/v1/forum/posts",s)).data,onSuccess:()=>{a.success("게시글이 작성되었습니다"),u.invalidateQueries({queryKey:["forum-posts"]}),d("/forum")},onError:()=>{a.error("게시글 작성에 실패했습니다")}}),f=g({mutationFn:async s=>(await l.api.put(`/v1/forum/posts/${o}`,s)).data,onSuccess:()=>{a.success("게시글이 수정되었습니다"),u.invalidateQueries({queryKey:["forum-posts"]}),u.invalidateQueries({queryKey:["forum-post",o]}),d("/forum")},onError:()=>{a.error("게시글 수정에 실패했습니다")}});y.useEffect(()=>{r&&j({title:r.title,content:r.content,categoryId:r.category.id,status:r.status,isPinned:r.isPinned,isLocked:r.isLocked})},[r]);const K=s=>{if(s.preventDefault(),!t.title.trim()){a.error("제목을 입력하세요");return}if(!t.content.trim()){a.error("내용을 입력하세요");return}if(!t.categoryId){a.error("카테고리를 선택하세요");return}c?f.mutate(t):p.mutate(t)},n=(s,m)=>{j(Q=>({...Q,[s]:m}))};return c&&E?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>d("/forum"),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"게시판 목록"]}),e.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:c?"게시글 수정":"새 게시글 작성"})]}),e.jsxs("form",{onSubmit:K,children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(b,{children:e.jsx(N,{children:"게시글 정보"})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"title",children:"제목 *"}),e.jsx(B,{id:"title",value:t.title,onChange:s=>n("title",s.target.value),placeholder:"게시글 제목을 입력하세요",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"category",children:"카테고리 *"}),e.jsxs(S,{value:t.categoryId,onValueChange:s=>n("categoryId",s),children:[e.jsx(w,{children:e.jsx(F,{placeholder:"카테고리를 선택하세요"})}),e.jsx(L,{children:I.map(s=>e.jsx(x,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"content",children:"내용 *"}),e.jsx(z,{id:"content",value:t.content,onChange:s=>n("content",s.target.value),placeholder:"게시글 내용을 입력하세요...",rows:12,required:!0})]})]})]}),e.jsxs(C,{children:[e.jsx(b,{children:e.jsx(N,{children:"게시 옵션"})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"status",children:"상태"}),e.jsxs(S,{value:t.status,onValueChange:s=>n("status",s),children:[e.jsx(w,{children:e.jsx(F,{})}),e.jsxs(L,{children:[e.jsx(x,{value:"published",children:"게시"}),e.jsx(x,{value:"draft",children:"초안"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"isPinned",children:"상단 고정"}),e.jsx("p",{className:"text-sm text-modern-text-secondary",children:"게시글을 목록 상단에 고정합니다"})]}),e.jsx(P,{id:"isPinned",checked:t.isPinned,onCheckedChange:s=>n("isPinned",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"isLocked",children:"댓글 잠금"}),e.jsx("p",{className:"text-sm text-modern-text-secondary",children:"새 댓글 작성을 차단합니다"})]}),e.jsx(P,{id:"isLocked",checked:t.isLocked,onCheckedChange:s=>n("isLocked",s)})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>d("/forum"),children:"취소"}),e.jsxs(h,{type:"submit",disabled:p.isPending||f.isPending,children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),c?"수정하기":"작성하기"]})]})]})]})};export{X as default};
