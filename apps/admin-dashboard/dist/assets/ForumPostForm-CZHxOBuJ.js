import{a3 as e,a4 as s,r as a,V as t,j as r,a5 as i,a1 as n}from"./vendor-react-B2e3hjul.js";import{u as d,a as c,b as o}from"./vendor-query-gT6dZ-b7.js";import{j as l,B as m,C as u,k as h,l as x,m as j,L as p,I as v,S as y,f,g,h as b,i as N,T as k}from"./page-gutenberg-C_zDdNV3.js";import{S as w}from"./page-template-editor-Cnh1CINv.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-B-KQWpLj.js";import"./wp-all-B6DO5GFQ.js";const C=()=>{const C=e(),{id:q}=s(),F=d(),L=!!q,[P,I]=a.useState({title:"",content:"",categoryId:"",status:"published",isPinned:!1,isLocked:!1}),{data:S}=c({queryKey:["forum-categories"],queryFn:async()=>(await l.api.get("/v1/forum/categories")).data}),K=S?.data||[],{data:E,isLoading:Q}=c({queryKey:["forum-post",q],queryFn:async()=>(await l.api.get(`/v1/forum/posts/${q}`)).data.data,enabled:L}),V=o({mutationFn:async e=>(await l.api.post("/v1/forum/posts",e)).data,onSuccess:()=>{t.success("게시글이 작성되었습니다"),F.invalidateQueries({queryKey:["forum-posts"]}),C("/forum")},onError:()=>{t.error("게시글 작성에 실패했습니다")}}),$=o({mutationFn:async e=>(await l.api.put(`/v1/forum/posts/${q}`,e)).data,onSuccess:()=>{t.success("게시글이 수정되었습니다"),F.invalidateQueries({queryKey:["forum-posts"]}),F.invalidateQueries({queryKey:["forum-post",q]}),C("/forum")},onError:()=>{t.error("게시글 수정에 실패했습니다")}});a.useEffect(()=>{E&&I({title:E.title,content:E.content,categoryId:E.category.id,status:E.status,isPinned:E.isPinned,isLocked:E.isLocked})},[E]);const z=(e,s)=>{I(a=>({...a,[e]:s}))};return L&&Q?r.jsx("div",{className:"flex items-center justify-center h-96",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-modern-primary"})}):r.jsxs("div",{className:"max-w-4xl mx-auto",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[r.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>C("/forum"),children:[r.jsx(i,{className:"w-4 h-4 mr-2"}),"게시판 목록"]}),r.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:L?"게시글 수정":"새 게시글 작성"})]}),r.jsxs("form",{onSubmit:e=>{e.preventDefault(),P.title.trim()?P.content.trim()?P.categoryId?L?$.mutate(P):V.mutate(P):t.error("카테고리를 선택하세요"):t.error("내용을 입력하세요"):t.error("제목을 입력하세요")},children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs(u,{children:[r.jsx(h,{children:r.jsx(x,{children:"게시글 정보"})}),r.jsxs(j,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(p,{htmlFor:"title",children:"제목 *"}),r.jsx(v,{id:"title",value:P.title,onChange:e=>z("title",e.target.value),placeholder:"게시글 제목을 입력하세요",required:!0})]}),r.jsxs("div",{children:[r.jsx(p,{htmlFor:"category",children:"카테고리 *"}),r.jsxs(y,{value:P.categoryId,onValueChange:e=>z("categoryId",e),children:[r.jsx(f,{children:r.jsx(g,{placeholder:"카테고리를 선택하세요"})}),r.jsx(b,{children:K.map(e=>r.jsx(N,{value:e.id,children:e.name},e.id))})]})]}),r.jsxs("div",{children:[r.jsx(p,{htmlFor:"content",children:"내용 *"}),r.jsx(k,{id:"content",value:P.content,onChange:e=>z("content",e.target.value),placeholder:"게시글 내용을 입력하세요...",rows:12,required:!0})]})]})]}),r.jsxs(u,{children:[r.jsx(h,{children:r.jsx(x,{children:"게시 옵션"})}),r.jsxs(j,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(p,{htmlFor:"status",children:"상태"}),r.jsxs(y,{value:P.status,onValueChange:e=>z("status",e),children:[r.jsx(f,{children:r.jsx(g,{})}),r.jsxs(b,{children:[r.jsx(N,{value:"published",children:"게시"}),r.jsx(N,{value:"draft",children:"초안"})]})]})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx(p,{htmlFor:"isPinned",children:"상단 고정"}),r.jsx("p",{className:"text-sm text-modern-text-secondary",children:"게시글을 목록 상단에 고정합니다"})]}),r.jsx(w,{id:"isPinned",checked:P.isPinned,onCheckedChange:e=>z("isPinned",e)})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx(p,{htmlFor:"isLocked",children:"댓글 잠금"}),r.jsx("p",{className:"text-sm text-modern-text-secondary",children:"새 댓글 작성을 차단합니다"})]}),r.jsx(w,{id:"isLocked",checked:P.isLocked,onCheckedChange:e=>z("isLocked",e)})]})]})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx(m,{type:"button",variant:"outline",onClick:()=>C("/forum"),children:"취소"}),r.jsxs(m,{type:"submit",disabled:V.isPending||$.isPending,children:[r.jsx(n,{className:"w-4 h-4 mr-2"}),L?"수정하기":"작성하기"]})]})]})]})};export{C as default};
