import{r as e,j as s,cD as t,bh as a,bU as r,b1 as n,bn as d,aE as i,V as l}from"./vendor-react-BqkIXTmC.js";import{u as c,a as x,b as o}from"./vendor-query-C5jzPyjL.js";import{B as m,I as p,L as h,b as j}from"./page-template-editor-DmUXhR56.js";import{cF as u,cG as v,cH as y,cI as N,cU as g,cV as f,cW as b,cX as w,cY as k,cZ as S,cQ as C}from"./wp-misc-D0_U3Yh3.js";import"./vendor-monaco-BxJH8uUv.js";import"./vendor-ui-CrFdsnXa.js";import"./vendor-utils-C9jLuAcl.js";import"./wp-blocks-core-C_Umt3qd.js";import"./wp-block-editor-main-DEdKEcH7.js";import"./wp-block-editor-store-Cdz5rmmV.js";import"./wp-block-editor-utils-CmROb2t9.js";import"./wp-i18n-DP14Ry5v.js";import"./wp-core-skmJSxj5.js";import"./wp-components-i3qvAB06.js";import"./wp-api-Dq90bqIA.js";import"./wp-data-CsLR-lZb.js";const A=()=>{const A=c(),[F,L]=e.useState(""),[U,P]=e.useState("all"),[q,D]=e.useState([]),[I,R]=e.useState(!1),[$,z]=e.useState(""),{data:E,isLoading:K}=x({queryKey:["vendor-settlements",F,U],queryFn:async()=>{const e=new URLSearchParams;F&&e.append("search",F),"all"!==U&&e.append("status",U);return(await j.api.get(`/v1/settlements/vendors?${e}`)).data}}),O=E?.data||[],Q=o({mutationFn:async e=>(await j.api.post("/v1/settlements/vendors/approve-bulk",e)).data,onSuccess:()=>{l.success("정산이 승인되었습니다"),A.invalidateQueries({queryKey:["vendor-settlements"]}),D([]),R(!1),z("")},onError:()=>{l.error("정산 승인 중 오류가 발생했습니다")}}),M=o({mutationFn:async({id:e,action:s,memo:t})=>(await j.api.post(`/v1/settlements/vendors/${e}/${s}`,{memo:t})).data,onSuccess:(e,s)=>{const t="approve"===s.action?"승인":"reject"===s.action?"거부":"처리";l.success(`정산이 ${t}되었습니다`),A.invalidateQueries({queryKey:["vendor-settlements"]})}}),T=o({mutationFn:async e=>(await j.api.post("/v1/settlements/vendors/export",{settlementIds:e},{responseType:"blob"})).data,onSuccess:e=>{const s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download=`settlements_${(new Date).toISOString().split("T")[0]}.xlsx`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(s),l.success("정산 데이터가 다운로드되었습니다")}}),V=e=>{switch(e){case"pending":return s.jsx(C,{variant:"outline",className:"text-orange-600 border-orange-600",children:"승인 대기"});case"approved":return s.jsx(C,{variant:"outline",className:"text-blue-600 border-blue-600",children:"승인됨"});case"processing":return s.jsx(C,{variant:"outline",className:"text-purple-600 border-purple-600",children:"처리중"});case"completed":return s.jsx(C,{children:"완료"});case"failed":return s.jsx(C,{variant:"secondary",children:"실패"});default:return s.jsx(C,{variant:"outline",children:e})}},_=e=>`₩${e.toLocaleString()}`,B=e=>new Date(e).toLocaleDateString("ko-KR"),G=O.filter(e=>"pending"===e.status),H=G.reduce((e,s)=>e+s.netAmount,0);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-modern-text-primary",children:"판매자 정산 관리"}),s.jsx("p",{className:"text-modern-text-secondary mt-1",children:"판매자별 정산 승인 및 처리"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(m,{variant:"outline",onClick:()=>{const e=q.length>0?q:O.map(e=>e.id);T.mutate(e)},disabled:T.isPending,children:[s.jsx(t,{className:"w-4 h-4 mr-2"}),"엑셀 다운로드"]}),s.jsxs(m,{onClick:()=>{0!==q.length?R(!0):l.error("승인할 정산을 선택하세요")},disabled:0===q.length,children:[s.jsx(a,{className:"w-4 h-4 mr-2"}),"일괄 승인 (",q.length,")"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs(u,{children:[s.jsx(v,{className:"pb-2",children:s.jsxs(y,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[s.jsx(r,{className:"w-4 h-4"}),"승인 대기"]})}),s.jsxs(N,{children:[s.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[G.length,"건"]}),s.jsx("div",{className:"text-xs text-modern-text-tertiary mt-1",children:_(H)})]})]}),s.jsxs(u,{children:[s.jsx(v,{className:"pb-2",children:s.jsxs(y,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[s.jsx(a,{className:"w-4 h-4"}),"완료"]})}),s.jsxs(N,{children:[s.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[O.filter(e=>"completed"===e.status).length,"건"]}),s.jsx("div",{className:"text-xs text-modern-text-tertiary mt-1",children:"이번 달"})]})]}),s.jsxs(u,{children:[s.jsx(v,{className:"pb-2",children:s.jsxs(y,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[s.jsx(n,{className:"w-4 h-4"}),"정산 판매자"]})}),s.jsx(N,{children:s.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[new Set(O.map(e=>e.vendorId)).size,"명"]})})]}),s.jsxs(u,{children:[s.jsx(v,{className:"pb-2",children:s.jsxs(y,{className:"text-sm font-medium text-modern-text-secondary flex items-center gap-2",children:[s.jsx(d,{className:"w-4 h-4"}),"총 정산 금액"]})}),s.jsx(N,{children:s.jsx("div",{className:"text-2xl font-bold text-modern-text-primary",children:_(O.reduce((e,s)=>e+s.netAmount,0))})})]})]}),s.jsx(u,{children:s.jsx(N,{className:"pt-6",children:s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"relative",children:[s.jsx(i,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-modern-text-tertiary w-4 h-4"}),s.jsx(p,{placeholder:"판매자명, 이메일로 검색...",value:F,onChange:e=>L(e.target.value),className:"pl-10"})]})}),s.jsxs("select",{value:U,onChange:e=>P(e.target.value),className:"px-4 py-2 border border-modern-border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-modern-primary",children:[s.jsx("option",{value:"all",children:"모든 상태"}),s.jsx("option",{value:"pending",children:"승인 대기"}),s.jsx("option",{value:"approved",children:"승인됨"}),s.jsx("option",{value:"processing",children:"처리중"}),s.jsx("option",{value:"completed",children:"완료"}),s.jsx("option",{value:"failed",children:"실패"})]})]})})}),s.jsxs(u,{children:[s.jsx(v,{children:s.jsx(y,{children:"정산 목록"})}),s.jsx(N,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-modern-bg-tertiary border-b border-modern-border-primary",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left",children:s.jsx("input",{type:"checkbox",onChange:e=>{e.target.checked?D(O.map(e=>e.id)):D([])},checked:q.length===O.length&&O.length>0})}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"판매자"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"정산 기간"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"매출액"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"수수료"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"정산액"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"상태"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"요청일"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-modern-text-secondary uppercase tracking-wider",children:"작업"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-modern-border-primary",children:K?s.jsx("tr",{children:s.jsx("td",{colSpan:9,className:"px-4 py-8 text-center",children:s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-modern-primary"})})})}):0===O.length?s.jsx("tr",{children:s.jsx("td",{colSpan:9,className:"px-4 py-8 text-center text-modern-text-secondary",children:"정산 데이터가 없습니다."})}):O.map(e=>s.jsxs("tr",{className:"hover:bg-modern-bg-hover",children:[s.jsx("td",{className:"px-4 py-4",children:s.jsx("input",{type:"checkbox",checked:q.includes(e.id),onChange:s=>{s.target.checked?D([...q,e.id]):D(q.filter(s=>s!==e.id))}})}),s.jsx("td",{className:"px-4 py-4",children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:e.vendorName}),s.jsx("div",{className:"text-sm text-modern-text-secondary",children:e.vendorEmail})]})}),s.jsxs("td",{className:"px-4 py-4",children:[s.jsxs("div",{className:"text-sm text-modern-text-primary",children:[B(e.settlementPeriod.startDate)," ~ ",B(e.settlementPeriod.endDate)]}),s.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:[e.orderCount,"건 주문"]})]}),s.jsx("td",{className:"px-4 py-4",children:s.jsx("div",{className:"text-sm font-medium text-modern-text-primary",children:_(e.totalSales)})}),s.jsxs("td",{className:"px-4 py-4",children:[s.jsxs("div",{className:"text-sm text-modern-text-secondary",children:["플랫폼: ",_(e.platformFee)]}),s.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:["토스: ",_(e.tossFee)]})]}),s.jsxs("td",{className:"px-4 py-4",children:[s.jsx("div",{className:"text-sm font-medium text-green-600",children:_(e.netAmount)}),e.taxAmount>0&&s.jsxs("div",{className:"text-xs text-modern-text-tertiary",children:["세금: ",_(e.taxAmount)]})]}),s.jsx("td",{className:"px-4 py-4",children:V(e.status)}),s.jsx("td",{className:"px-4 py-4",children:s.jsx("div",{className:"text-sm text-modern-text-secondary",children:B(e.requestedAt)})}),s.jsx("td",{className:"px-4 py-4",children:s.jsxs("div",{className:"flex gap-2",children:["pending"===e.status&&s.jsxs(s.Fragment,{children:[s.jsx(m,{size:"sm",onClick:()=>M.mutate({id:e.id,action:"approve"}),disabled:M.isPending,children:"승인"}),s.jsx(m,{size:"sm",variant:"outline",onClick:()=>M.mutate({id:e.id,action:"reject"}),disabled:M.isPending,children:"거부"})]}),e.receiptUrl&&s.jsx(m,{size:"sm",variant:"ghost",onClick:()=>window.open(e.receiptUrl,"_blank"),children:"영수증"})]})})]},e.id))})]})})})]}),s.jsx(g,{open:I,onOpenChange:R,children:s.jsxs(f,{children:[s.jsxs(b,{children:[s.jsx(w,{children:"정산 일괄 승인"}),s.jsxs(k,{children:["선택한 ",q.length,"건의 정산을 승인하시겠습니까?"]})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{className:"p-4 bg-modern-bg-secondary rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-modern-text-secondary mb-2",children:"승인 요약"}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"총 정산건수"}),s.jsxs("span",{className:"font-medium",children:[q.length,"건"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"총 정산금액"}),s.jsx("span",{className:"font-medium text-green-600",children:_(O.filter(e=>q.includes(e.id)).reduce((e,s)=>e+s.netAmount,0))})]})]}),s.jsxs("div",{children:[s.jsx(h,{htmlFor:"approvalMemo",children:"메모 (선택)"}),s.jsx(p,{id:"approvalMemo",value:$,onChange:e=>z(e.target.value),placeholder:"승인 관련 메모를 입력하세요"})]})]}),s.jsxs(S,{children:[s.jsx(m,{variant:"outline",onClick:()=>R(!1),children:"취소"}),s.jsx(m,{onClick:()=>{const e=O.filter(e=>q.includes(e.id)).reduce((e,s)=>e+s.netAmount,0);Q.mutate({settlementIds:q,totalAmount:e,memo:$})},disabled:Q.isPending,children:"승인 확정"})]})]})})]})};export{A as default};
