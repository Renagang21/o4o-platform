{
  "title": "Node.js Runtime Validity Check",
  "audit_date": "2025-12-10",
  "runtime_version": "Node.js >= 22.16.0",
  "criteria": "Node.js 런타임 호환성 6가지 기준",
  "results": {
    "module_loader_compatibility": {
      "status": "PASS",
      "score": 92,
      "description": "ModuleLoader가 Node.js dynamic import와 호환",
      "evidence": [
        "ESM (import.meta.url) 사용",
        "dynamic import() 패턴 적용",
        "file:// URL 스키마 사용",
        "pathToFileURL 유틸 활용"
      ],
      "code_reference": "apps/api-server/src/modules/module-loader.ts:86-88",
      "pattern_used": "const manifestModule = await import(`file://${manifestPath}`)"
    },
    "backend_export_structure": {
      "status": "PASS",
      "score": 90,
      "description": "backend/index.ts export 방식이 Express/TypeORM 구조 호환",
      "evidence": [
        "Router factory pattern (createRoutes(dataSource))",
        "entities 배열 export",
        "services 객체 export"
      ],
      "code_reference": "packages/*/src/index.ts",
      "standard_pattern": {
        "createRoutes": "(dataSource: DataSource) => Router",
        "entities": "TypeORM Entity[]",
        "services": "Record<string, ServiceClass>"
      }
    },
    "lifecycle_async_safety": {
      "status": "PASS",
      "score": 95,
      "description": "Lifecycle Hooks가 async-safe 패턴 준수",
      "evidence": [
        "모든 lifecycle hook이 async function",
        "try/catch 에러 처리 적용",
        "Promise chain 안전하게 처리"
      ],
      "code_reference": "apps/api-server/src/services/AppManager.ts:694-751",
      "pattern_used": "await module.lifecycle.activate(context)"
    },
    "view_system_framework_compatibility": {
      "status": "N/A",
      "score": 0,
      "description": "ViewSystem - Next.js App Router 충돌 검사",
      "evidence": [
        "현재 React Router 사용 (Next.js 아님)",
        "admin-dashboard: Vite + React",
        "main-site: Vite + React"
      ],
      "notes": "Next.js 미사용으로 충돌 우려 없음"
    },
    "manifest_module_system": {
      "status": "PASS",
      "score": 88,
      "description": "manifest.ts 구조가 Node.js module 시스템과 호환",
      "evidence": [
        "ESM export default 패턴 사용",
        "named export도 함께 제공",
        "TypeScript → JavaScript 트랜스파일 정상"
      ],
      "issues": [
        "일부 manifest에서 appId vs id 혼용 (수정 완료)",
        "type vs appType 혼용 (수정 완료)"
      ]
    },
    "dependency_loading_order": {
      "status": "PASS",
      "score": 93,
      "description": "앱 간 의존성 로딩 순서가 Node 환경에서 안전",
      "evidence": [
        "AppDependencyResolver.resolveInstallOrder() 구현",
        "topological sort 기반 순서 결정",
        "순환 참조 감지 및 차단"
      ],
      "code_reference": "apps/api-server/src/services/AppDependencyResolver.ts",
      "example_order": [
        "organization-core",
        "forum-core",
        "forum-yaksa",
        "forum-cosmetics"
      ]
    }
  },
  "additional_checks": {
    "typescript_compatibility": {
      "status": "PASS",
      "score": 90,
      "description": "TypeScript 5.x 호환성",
      "evidence": [
        "strict mode 사용",
        "ESM interop 설정 적용",
        "path mapping 정상 작동"
      ]
    },
    "pnpm_workspace": {
      "status": "PASS",
      "score": 95,
      "description": "pnpm workspace 호환성",
      "evidence": [
        "workspace:* 프로토콜 사용",
        "패키지 간 참조 정상",
        "hoisting 설정 적절"
      ]
    },
    "typeorm_integration": {
      "status": "PASS",
      "score": 88,
      "description": "TypeORM 0.3.x 호환성",
      "evidence": [
        "DataSource 패턴 사용",
        "Entity metadata 정상 수집",
        "Migration 시스템 연동"
      ],
      "issues": [
        "일부 앱에서 entity 정의 누락",
        "relation lazy loading 이슈 가능성"
      ]
    }
  },
  "overall_score": 91.3,
  "grade": "A-",
  "summary": {
    "strengths": [
      "ESM dynamic import 완벽 지원",
      "async/await 패턴 일관성",
      "의존성 로딩 순서 안전",
      "TypeScript 호환성 우수"
    ],
    "weaknesses": [
      "일부 앱 빌드 에러 (기존 코드 문제)",
      "Entity 정의 누락 앱 존재"
    ],
    "recommendations": [
      "빌드 실패 앱 수정 (partnerops, sellerops 등)",
      "Entity export 패턴 표준화 완료",
      "TypeORM lazy loading 검토"
    ]
  }
}
