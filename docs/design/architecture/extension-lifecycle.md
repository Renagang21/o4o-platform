# Extension Lifecycle

## 1. 목적(Purpose)

앱이 설치되고 동작하는 전체 과정을 표준화하여,
앱 개발자가 안정적으로 install / activate / deactivate / uninstall 로직을 구현하도록 돕기 위한 규칙이다.
모든 앱은 동일한 라이프사이클을 따르므로 플랫폼 전체 일관성을 유지할 수 있다.

## 2. 개요(Overview)

- Lifecycle은 AppStore와 Module Loader가 실행한다.
- 주요 목적은 앱 데이터를 초기화하고, 필요한 Entity·Route를 등록하거나 제거하는 것이다.
- Lifecycle은 **앱 상태 변화 시 자동으로 호출**되며, 개발자가 직접 호출하지 않는다.
- 데이터 삭제 규칙은 매우 보수적으로 처리해야 하며, uninstall 시에도 DB를 완전히 비우지 않는 것이 원칙이다.

## 3. 핵심 구성요소(Key Components)

### 1) install()
- 앱 최초 설치 시 1회 실행.
- 필요한 DB 테이블 생성, 기본 데이터 삽입, 권한(role) 초기화 등을 수행.
- idempotent(중복 실행 가능)하게 구현해야 한다.

### 2) activate()
- 앱 활성화 시 실행.
- Route 등록, 메뉴 등록, 스케줄러 시작 등.
- 앱이 실제로 동작하기 위한 준비를 수행.

### 3) deactivate()
- 앱 비활성화 시 실행.
- Route 해제, 메뉴 숨김, 스케줄러 중지 등.
- **데이터는 삭제하지 않음** (다시 활성화 가능하도록).

### 4) uninstall()
- 앱 제거 시 실행.
- 설정 파일 제거, 캐시 정리 등.
- **DB 데이터 삭제는 최대한 피함** (복구 가능성 유지).

## 4. 동작 구조(Architecture / Flow)

### Lifecycle 상태 전이

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│   [Not Installed]                                           │
│         │                                                   │
│         ▼ install()                                         │
│   ┌───────────┐                                             │
│   │ Installed │ (비활성 상태)                                │
│   └─────┬─────┘                                             │
│         │                                                   │
│         ▼ activate()                                        │
│   ┌───────────┐                                             │
│   │  Active   │◀────────────────┐                           │
│   └─────┬─────┘                 │                           │
│         │                       │ activate()                │
│         ▼ deactivate()          │                           │
│   ┌───────────┐                 │                           │
│   │ Inactive  │─────────────────┘                           │
│   └─────┬─────┘                                             │
│         │                                                   │
│         ▼ uninstall()                                       │
│   [Not Installed]                                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### Hook 실행 타이밍

| Hook | 실행 시점 | 주요 작업 |
|------|----------|----------|
| install() | 앱 최초 설치 | DB 초기화, 기본 데이터 |
| activate() | 앱 활성화 | Route/메뉴 등록 |
| deactivate() | 앱 비활성화 | Route/메뉴 해제 |
| uninstall() | 앱 제거 | 설정 정리 (데이터 보존) |

### 간단한 요약

```
설치(install) → 활성화(activate) → (필요 시) 비활성화(deactivate) → 제거(uninstall)
```

## 5. 개발 및 유지보수 규칙(Development Rules)

1. **Idempotent install**: install Hook은 항상 재실행해도 문제가 없도록 작성.
2. **데이터 보존 원칙**: deactivate는 기능만 비활성화하며, 데이터는 보존한다.
3. **보수적 삭제**: uninstall은 데이터 삭제를 최대한 피하고, 필요한 경우 명시적으로만 수행한다.
4. **예외 처리 필수**: Lifecycle 내부에서는 예외 처리(try/catch)를 반드시 구현한다.
5. **문서 동기화**: Lifecycle 변경 시 문서(specs/design)도 반드시 함께 업데이트한다.

---
*최종 업데이트: 2025-12-10*
*상태: 초안 완료*
