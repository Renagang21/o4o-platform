# Action / Agent / Extension 통합 테스트 시나리오

> **목적**: 실제 운영 중 발생할 수 있는 사건을 "하나의 이야기"로 검증
>
> 각 시나리오는 **순서 + 기대 결과**가 명확합니다.

---

## 시나리오 1: 기본 운영 흐름

### 상황
- 약국 1곳
- Display 2대
- Slot 2개

### 절차

| Step | 행동 | 예상 결과 |
|------|------|----------|
| 1 | Playlist A 실행 (Slot 1) | Slot 1: A → RUNNING |
| 2 | Playlist B 실행 (Slot 2) | Slot 2: B → RUNNING |
| 3 | Slot 1에 Playlist C replace 실행 | Slot 1: A → STOPPED, C → RUNNING |

### 기대 결과
- Slot 1: A → STOPPED, C → RUNNING
- Slot 2: B → RUNNING 유지
- UI/Core/Agent 상태 일치

### 검증 결과
| 항목 | Pass/Fail | 비고 |
|------|-----------|------|
| Slot 1 상태 정확 | [ ] | |
| Slot 2 상태 유지 | [ ] | |
| UI-Core-Agent 일치 | [ ] | |

---

## 시나리오 2: 네트워크 장애 중 실행

### 상황
- Playlist 실행 중

### 절차

| Step | 행동 | 예상 결과 |
|------|------|----------|
| 1 | 실행 중 네트워크 차단 | Agent Heartbeat 중단 |
| 2 | 30초 대기 | Core에서 FAILED 전이 확인 |
| 3 | 네트워크 복구 | Agent 재연결 |
| 4 | Core 상태 조회 | 자동 재실행 없음 |

### 기대 결과
- 재연결 시 자동 재실행 ❌
- Core 지시 전까지 대기
- Slot 점유 없음

### 검증 결과
| 항목 | Pass/Fail | 비고 |
|------|-----------|------|
| FAILED 전이 확인 | [ ] | |
| 자동 재실행 없음 | [ ] | |
| Slot 해제 확인 | [ ] | |

---

## 시나리오 3: 긴급 공지 반복

### 상황
- 오전 스케줄 실행 중

### 절차

| Step | 행동 | 예상 결과 |
|------|------|----------|
| 1 | 긴급 공지 A 실행 | 오전 스케줄 STOPPED, A → RUNNING |
| 2 | 30초 대기 | A 실행 중 |
| 3 | 긴급 공지 B 실행 | A → STOPPED, B → RUNNING |
| 4 | B 종료 | B → COMPLETED |
| 5 | 상태 확인 | 원래 오전 스케줄 복귀 |

### 기대 결과
- 첫 공지 STOPPED
- 두 번째 공지 RUNNING → COMPLETED
- 원래 오전 스케줄 복귀

### 검증 결과
| 항목 | Pass/Fail | 비고 |
|------|-----------|------|
| 첫 공지 STOPPED | [ ] | |
| 두 번째 공지 정상 종료 | [ ] | |
| 스케줄 복귀 확인 | [ ] | |

---

## 시나리오 4: Agent 재시작

### 상황
- Playlist 실행 중

### 절차

| Step | 행동 | 예상 결과 |
|------|------|----------|
| 1 | Agent 프로세스 강제 종료 | Core에서 연결 끊김 감지 |
| 2 | 30초 대기 | Action FAILED 전이 |
| 3 | Agent 재실행 | Core에 재연결 |
| 4 | Core 상태 조회 | 이전 Action STOPPED/FAILED |

### 기대 결과
- 이전 Action STOPPED 또는 FAILED
- 중복 실행 없음
- UI 상태 정확

### 검증 결과
| 항목 | Pass/Fail | 비고 |
|------|-----------|------|
| Action 상태 전이 | [ ] | |
| 중복 실행 방지 | [ ] | |
| UI 상태 일치 | [ ] | |

---

## 시나리오 5: Extension UX 검증

### 상황
- 신규 약국 계정

### 절차

| Step | 행동 | 예상 결과 |
|------|------|----------|
| 1 | 프리셋으로 Playlist 생성 | Playlist 생성 완료 |
| 2 | 즉시 실행 | Action RUNNING |
| 3 | 중지 | Action STOPPED |
| 4 | Playlist 복제 | 새 Playlist 생성 |
| 5 | 복제본 재실행 | 새 Action RUNNING |

### 기대 결과
- 사용자 개입 최소
- 모든 단계에서 상태 일관
- 오류 메시지 최소/명확

### 검증 결과
| 항목 | Pass/Fail | 비고 |
|------|-----------|------|
| 프리셋 생성 성공 | [ ] | |
| 실행/중지 정상 | [ ] | |
| 복제 독립성 확인 | [ ] | |

---

## 시나리오 6: 동시 다중 사용자 (추가)

### 상황
- 동일 약국의 2명 관리자가 동시 접속

### 절차

| Step | 행동 | 예상 결과 |
|------|------|----------|
| 1 | 관리자 A가 Playlist X 실행 | X → RUNNING |
| 2 | 관리자 B가 동시에 Playlist Y 실행 (같은 Slot) | X → STOPPED, Y → RUNNING |
| 3 | 관리자 A 화면 새로고침 | Y 실행 중으로 표시 |

### 기대 결과
- 최종 상태 일관성 유지
- 데이터 손실 없음
- 양쪽 UI 동기화

### 검증 결과
| 항목 | Pass/Fail | 비고 |
|------|-----------|------|
| 상태 일관성 | [ ] | |
| UI 동기화 | [ ] | |

---

## 테스트 실행 기록

| 날짜 | 버전 | 시나리오 | 실행자 | 결과 | 비고 |
|------|------|---------|-------|------|------|
| | | | | | |

---

*Created: 2024-12-22*
*Version: 1.0*
