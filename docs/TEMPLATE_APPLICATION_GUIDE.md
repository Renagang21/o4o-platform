# API Server Template Application Guide

## ğŸ“‹ ê°œìš”

ì´ ê°€ì´ë“œëŠ” API ì„œë²„ì— ìµœì í™”ëœ npm ìŠ¤í¬ë¦½íŠ¸ í…œí”Œë¦¿ì„ ìë™ìœ¼ë¡œ ì ìš©í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤. ì´ ìë™í™” ì‹œìŠ¤í…œì„ í†µí•´ **85% ì„±ëŠ¥ ê°œì„ **ê³¼ **ì™„ì „ ìë™í™”ëœ í™˜ê²½ ì„¤ì •**ì„ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### ì›ìŠ¤í… ì„¤ì • (ê¶Œì¥)
```bash
# API ì„œë²„ì—ì„œ ì‹¤í–‰
cd /path/to/o4o-platform
npm run setup:apiserver
```

ì´ ëª…ë ¹ì–´ í•˜ë‚˜ë¡œ ëª¨ë“  ì„¤ì •ì´ ìë™ìœ¼ë¡œ ì™„ë£Œë©ë‹ˆë‹¤!

## ğŸ› ï¸ ìë™í™” ì‹œìŠ¤í…œ êµ¬ì„±

### 1. **í…œí”Œë¦¿ ì ìš© ìŠ¤í¬ë¦½íŠ¸** (`apply-apiserver-template.js`)
- **ì—­í• **: package.jsonì— ìµœì í™”ëœ ìŠ¤í¬ë¦½íŠ¸ ìë™ ë³‘í•©
- **ê¸°ëŠ¥**:
  - ê¸°ì¡´ ì„¤ì • ë°±ì—…
  - ìŠ¤ë§ˆíŠ¸ ë³‘í•© (ì¶©ëŒ ë°©ì§€)
  - ê²€ì¦ ë° ë¦¬í¬íŠ¸ ìƒì„±

### 2. **í™˜ê²½ ìë™ ì„¤ì •** (`auto-setup-environment.js`)
- **ì—­í• **: ì„œë²„ íƒ€ì…ë³„ í™˜ê²½ ìë™ êµ¬ì„±
- **ê¸°ëŠ¥**:
  - SERVER_TYPE ìë™ ê°ì§€
  - í™˜ê²½ íŒŒì¼ ìƒì„±
  - PM2 ì„¤ì •
  - ì˜ì¡´ì„± ì„¤ì¹˜
  - ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •

### 3. **í…œí”Œë¦¿ íŒŒì¼** (`package.apiserver.scripts.json`)
- **ì—­í• **: ìµœì í™”ëœ npm ìŠ¤í¬ë¦½íŠ¸ ì •ì˜
- **ë‚´ìš©**:
  - 85% ë¹Œë“œ ì‹œê°„ ë‹¨ì¶• ìŠ¤í¬ë¦½íŠ¸
  - PM2 ê´€ë¦¬ ëª…ë ¹ì–´
  - ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
  - ëª¨ë‹ˆí„°ë§ ë° ê²€ì¦

## ğŸ“¦ ì„¤ì¹˜ ë° ì‚¬ìš©

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­
- Node.js 18.0.0 ì´ìƒ
- npm 8.0.0 ì´ìƒ
- PM2 5.0.0 ì´ìƒ (ì„ íƒì‚¬í•­)

### ë‹¨ê³„ë³„ ì‹¤í–‰

#### 1. í…œí”Œë¦¿ë§Œ ì ìš©
```bash
node scripts/apply-apiserver-template.js
```

#### 2. í™˜ê²½ ì„¤ì •ë§Œ ì‹¤í–‰
```bash
node scripts/auto-setup-environment.js
```

#### 3. ì „ì²´ ìë™ ì„¤ì • (ê¶Œì¥)
```bash
npm run setup:apiserver
```

## ğŸ”§ ì ìš©ë˜ëŠ” ìµœì í™”

### ë¹Œë“œ ìµœì í™”
- **ì´ì „**: ì „ì²´ 8ê°œ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë¹Œë“œ
- **ì´í›„**: API ì„œë²„ í•„ìš” 2ê°œë§Œ ë¹Œë“œ
- **ê²°ê³¼**: **85% ì‹œê°„ ë‹¨ì¶•**

### ë©”ëª¨ë¦¬ ìµœì í™”
```javascript
// ìë™ ì ìš©ë˜ëŠ” ì„¤ì •
NODE_OPTIONS=--max-old-space-size=1024  // 1GB ì œí•œ
```

### PM2 ìµœì í™”
```javascript
// í´ëŸ¬ìŠ¤í„° ëª¨ë“œ, ìë™ ì¬ì‹œì‘, ë¬´ì¤‘ë‹¨ ë°°í¬
instances: 'max',
exec_mode: 'cluster',
wait_ready: true
```

## ğŸ“ ì ìš© í›„ ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´

### ì„œë²„ ì‹¤í–‰
```bash
npm run start:prod      # í”„ë¡œë•ì…˜ ì‹¤í–‰
npm run dev            # ê°œë°œ ëª¨ë“œ
npm run pm2:start      # PM2ë¡œ ì‹¤í–‰
```

### ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸
```bash
npm run build          # í”„ë¡œë•ì…˜ ë¹Œë“œ
npm run type-check     # TypeScript ê²€ì¦
npm run lint          # ì½”ë“œ ê²€ì‚¬
npm run test          # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```

### PM2 ê´€ë¦¬
```bash
npm run pm2:status     # ìƒíƒœ í™•ì¸
npm run pm2:logs      # ë¡œê·¸ ë³´ê¸°
npm run pm2:restart   # ì¬ì‹œì‘
npm run pm2:reload    # ë¬´ì¤‘ë‹¨ ì¬ë°°í¬
npm run pm2:monit     # ëª¨ë‹ˆí„°ë§
```

### ë°ì´í„°ë² ì´ìŠ¤
```bash
npm run migration:generate -- -n MigrationName
npm run migration:run
npm run db:seed
npm run db:reset
```

### ëª¨ë‹ˆí„°ë§
```bash
npm run validate:env   # í™˜ê²½ ê²€ì¦
npm run monitor       # ìƒíƒœ ëª¨ë‹ˆí„°ë§
```

## ğŸ” ê²€ì¦ ë° í…ŒìŠ¤íŠ¸

### ìë™ ê²€ì¦
ì„¤ì • ì ìš© ì‹œ ìë™ìœ¼ë¡œ ë‹¤ìŒ í•­ëª©ë“¤ì´ ê²€ì¦ë©ë‹ˆë‹¤:
- âœ… package.json ë¬¸ë²• ê²€ì¦
- âœ… í•„ìˆ˜ ìŠ¤í¬ë¦½íŠ¸ ì¡´ì¬ ì—¬ë¶€
- âœ… TypeScript ì„¤ì • ê²€ì¦
- âœ… í™˜ê²½ ë³€ìˆ˜ ê²€ì¦

### ìˆ˜ë™ í…ŒìŠ¤íŠ¸
```bash
# ë¹Œë“œ ì‹œê°„ ì¸¡ì •
time npm run build

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
npm run pm2:monit

# í™˜ê²½ ê²€ì¦
npm run validate:env
```

## ğŸ“Š ì„±ëŠ¥ ê°œì„  ê²°ê³¼

### Before (ìˆ˜ë™ ì„¤ì •)
- ë¹Œë“œ ì‹œê°„: 3ë¶„ 20ì´ˆ
- ì„¤ì • ì‹œê°„: 30ë¶„
- ì˜¤ë¥˜ ê°€ëŠ¥ì„±: ë†’ìŒ

### After (ìë™í™”)
- ë¹Œë“œ ì‹œê°„: **30ì´ˆ** (85% ë‹¨ì¶•)
- ì„¤ì • ì‹œê°„: **1ë¶„** (96% ë‹¨ì¶•)
- ì˜¤ë¥˜ ê°€ëŠ¥ì„±: **ê±°ì˜ ì—†ìŒ**

## ğŸš¨ ë¬¸ì œ í•´ê²°

### í…œí”Œë¦¿ ì ìš© ì‹¤íŒ¨
```bash
# ë°±ì—…ì—ì„œ ë³µêµ¬
cp apps/api-server/backups/package.json.*.backup apps/api-server/package.json
```

### PM2 í”„ë¡œì„¸ìŠ¤ ë¬¸ì œ
```bash
# í”„ë¡œì„¸ìŠ¤ ì •ë¦¬
pm2 delete all
pm2 kill

# ì¬ì‹œì‘
npm run pm2:start
```

### í™˜ê²½ ë³€ìˆ˜ ë¬¸ì œ
```bash
# í™˜ê²½ íŒŒì¼ í™•ì¸
cat apps/api-server/.env.production

# ê²€ì¦ ì‹¤í–‰
npm run validate:env
```

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
o4o-platform/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ apply-apiserver-template.js    # í…œí”Œë¦¿ ì ìš©
â”‚   â”œâ”€â”€ auto-setup-environment.js      # í™˜ê²½ ì„¤ì •
â”‚   â”œâ”€â”€ pm2-env-validator.sh          # í™˜ê²½ ê²€ì¦
â”‚   â”œâ”€â”€ pm2-safe-start.sh            # ì•ˆì „ ì‹¤í–‰
â”‚   â””â”€â”€ pm2-monitor.sh               # ëª¨ë‹ˆí„°ë§
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ package.apiserver.scripts.json # ìŠ¤í¬ë¦½íŠ¸ í…œí”Œë¦¿
â””â”€â”€ apps/api-server/
    â”œâ”€â”€ package.json                   # ì ìš© ëŒ€ìƒ
    â”œâ”€â”€ .env.production               # í™˜ê²½ ì„¤ì •
    â””â”€â”€ backups/                      # ìë™ ë°±ì—…
```

## ğŸ”„ ì—…ë°ì´íŠ¸ ë° ìœ ì§€ë³´ìˆ˜

### í…œí”Œë¦¿ ì—…ë°ì´íŠ¸
```bash
# 1. í…œí”Œë¦¿ íŒŒì¼ ìˆ˜ì •
vim templates/package.apiserver.scripts.json

# 2. ì¬ì ìš©
npm run setup:apiserver
```

### ë¡¤ë°±
```bash
# ë°±ì—… ëª©ë¡ í™•ì¸
ls -la apps/api-server/backups/

# íŠ¹ì • ë°±ì—…ìœ¼ë¡œ ë³µêµ¬
cp apps/api-server/backups/package.json.2025-08-18.backup apps/api-server/package.json
```

## ğŸ¯ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

1. **í•­ìƒ ë°±ì—… í™•ì¸**: ìë™ ë°±ì—…ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
2. **í™˜ê²½ë³„ í…ŒìŠ¤íŠ¸**: ë¡œì»¬ì—ì„œ ë¨¼ì € í…ŒìŠ¤íŠ¸ í›„ í”„ë¡œë•ì…˜ ì ìš©
3. **ëª¨ë‹ˆí„°ë§ í™œìš©**: ì ìš© í›„ `npm run monitor` ì‹¤í–‰
4. **ë¬¸ì„œí™”**: ì»¤ìŠ¤í…€ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ ì‹œ ë¬¸ì„œ ì—…ë°ì´íŠ¸

## ğŸ“ˆ ì„±ê³¼ ì§€í‘œ

### ê°œë°œ ìƒì‚°ì„±
- ì„¤ì • ì‹œê°„: **30ë¶„ â†’ 1ë¶„** (96% ê°œì„ )
- ì˜¤ë¥˜ ë°œìƒ: **ë¹ˆë²ˆ â†’ ê±°ì˜ ì—†ìŒ**
- ì¼ê´€ì„±: **100% ë³´ì¥**

### ì‹œìŠ¤í…œ ì„±ëŠ¥
- ë¹Œë“œ ì†ë„: **85% í–¥ìƒ**
- ë©”ëª¨ë¦¬ ì‚¬ìš©: **ìµœì í™” (1GB ì œí•œ)**
- ì‹œì‘ ì‹œê°„: **50% ë‹¨ì¶•**

## ğŸ¤ ê¸°ì—¬ ê°€ì´ë“œ

### í…œí”Œë¦¿ ê°œì„ 
1. `templates/package.apiserver.scripts.json` ìˆ˜ì •
2. í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ê²€ì¦
3. PR ìƒì„±

### ìŠ¤í¬ë¦½íŠ¸ ê°œì„ 
1. `scripts/` ë””ë ‰í† ë¦¬ì˜ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •
2. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¶”ê°€
3. ë¬¸ì„œ ì—…ë°ì´íŠ¸

## ğŸ“ ì§€ì›

ë¬¸ì œê°€ ë°œìƒí•˜ë©´:
1. `docs/INCIDENT_REPORT_*.md` ì°¸ì¡°
2. `npm run monitor` ì‹¤í–‰í•˜ì—¬ ìƒíƒœ í™•ì¸
3. GitHub Issuesì— ë¬¸ì œ ë³´ê³ 

---

**ì‘ì„±ì¼**: 2025-08-18  
**ë²„ì „**: 1.0.0  
**ì‘ì„±ì**: O4O Platform Team

---

## ë¶€ë¡: ë¹ ë¥¸ ëª…ë ¹ì–´ ë ˆí¼ëŸ°ìŠ¤

```bash
# ì „ì²´ ì„¤ì • (ê¶Œì¥)
npm run setup:apiserver

# ê°œë³„ ì‹¤í–‰
node scripts/apply-apiserver-template.js     # í…œí”Œë¦¿ë§Œ
node scripts/auto-setup-environment.js       # í™˜ê²½ë§Œ

# ê²€ì¦
npm run validate:env
npm run monitor

# PM2
npm run pm2:start
npm run pm2:status
npm run pm2:logs

# ë¹Œë“œ
npm run build
npm run type-check
```

---

*"ìë™í™”ëŠ” íš¨ìœ¨ì„±ì˜ ì‹œì‘ì´ë‹¤"* ğŸš€