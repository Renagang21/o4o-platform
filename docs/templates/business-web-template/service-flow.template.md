# {Business} Web Service Flow

> **Version**: 1.0
> **Status**: Reference
> **Created**: {date}

이 문서는 {business}-web의 주요 사용자 흐름을 정의합니다.

---

## 1. 전체 시스템 구조

```
┌─────────────────────────────────────────────────────────────────────┐
│                            Browser                                   │
└─────────────────────────────────┬───────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        {business}-web                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │
│  │   Public    │  │    Admin    │  │  Auth Flow  │                 │
│  │   Pages     │  │   Pages     │  │  (Core 연동) │                 │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                 │
│         │                │                │                         │
│         └────────────────┼────────────────┘                         │
│                          │                                          │
│                    API Client                                       │
└──────────────────────────┬──────────────────────────────────────────┘
                           │
           ┌───────────────┼───────────────┐
           │               │               │
           ▼               ▼               ▼
┌─────────────────┐ ┌─────────────┐ ┌─────────────┐
│ {business}-api  │ │  Core API   │ │ 타 서비스    │
│  (도메인 전용)   │ │  (인증만)    │ │   (금지)    │
└────────┬────────┘ └─────────────┘ └─────────────┘
         │
         ▼
┌─────────────────┐
│  {Business} DB  │
└─────────────────┘
```

---

## 2. 인증 흐름

### 2.1 로그인 흐름

```
┌──────────┐     ┌────────────────┐     ┌───────────┐
│  Browser │     │ {business}-web │     │ Core API  │
└────┬─────┘     └───────┬────────┘     └─────┬─────┘
     │                   │                    │
     │  1. 로그인 요청    │                    │
     │ ─────────────────>│                    │
     │                   │                    │
     │  2. 로그인 페이지  │                    │
     │ <─────────────────│                    │
     │                   │                    │
     │  3. 자격증명 입력  │                    │
     │ ─────────────────>│                    │
     │                   │  4. 인증 요청       │
     │                   │ ──────────────────>│
     │                   │                    │
     │                   │  5. JWT 발급       │
     │                   │ <──────────────────│
     │                   │                    │
     │  6. JWT 저장 +    │                    │
     │     리다이렉트     │                    │
     │ <─────────────────│                    │
     │                   │                    │
```

### 2.2 인증된 API 호출

```
┌──────────┐     ┌────────────────┐     ┌─────────────────┐
│  Browser │     │ {business}-web │     │ {business}-api  │
└────┬─────┘     └───────┬────────┘     └────────┬────────┘
     │                   │                       │
     │  1. 페이지 요청    │                       │
     │ ─────────────────>│                       │
     │                   │                       │
     │                   │  2. API 호출          │
     │                   │  + Authorization      │
     │                   │ ─────────────────────>│
     │                   │                       │
     │                   │  3. 데이터 응답       │
     │                   │ <─────────────────────│
     │                   │                       │
     │  4. 렌더링된 페이지│                       │
     │ <─────────────────│                       │
     │                   │                       │
```

### 2.3 토큰 갱신 흐름

```
┌──────────┐     ┌────────────────┐     ┌───────────┐
│  Browser │     │ {business}-web │     │ Core API  │
└────┬─────┘     └───────┬────────┘     └─────┬─────┘
     │                   │                    │
     │  1. API 호출 시    │                    │
     │     만료 감지      │                    │
     │ ─────────────────>│                    │
     │                   │                    │
     │                   │  2. 토큰 갱신 요청  │
     │                   │ ──────────────────>│
     │                   │                    │
     │                   │  3. 새 JWT 발급    │
     │                   │ <──────────────────│
     │                   │                    │
     │  4. 새 토큰 저장   │                    │
     │ <─────────────────│                    │
     │                   │                    │
     │  5. 원래 요청 재시도│                    │
     │ ─────────────────>│                    │
     │                   │                    │
```

---

## 3. 공개 흐름 (Public)

### 3.1 리소스 목록 조회

```
┌──────────┐     ┌────────────────┐     ┌─────────────────┐
│  Browser │     │ {business}-web │     │ {business}-api  │
└────┬─────┘     └───────┬────────┘     └────────┬────────┘
     │                   │                       │
     │  1. /resources    │                       │
     │ ─────────────────>│                       │
     │                   │                       │
     │                   │  2. GET /{business}/  │
     │                   │     resources         │
     │                   │ ─────────────────────>│
     │                   │                       │
     │                   │  3. 목록 데이터       │
     │                   │ <─────────────────────│
     │                   │                       │
     │  4. 목록 페이지    │                       │
     │ <─────────────────│                       │
     │                   │                       │
```

### 3.2 리소스 상세 조회

```
┌──────────┐     ┌────────────────┐     ┌─────────────────┐
│  Browser │     │ {business}-web │     │ {business}-api  │
└────┬─────┘     └───────┬────────┘     └────────┬────────┘
     │                   │                       │
     │  1. /resources/   │                       │
     │     {id}          │                       │
     │ ─────────────────>│                       │
     │                   │                       │
     │                   │  2. GET /{business}/  │
     │                   │     resources/{id}    │
     │                   │ ─────────────────────>│
     │                   │                       │
     │                   │  3. 상세 데이터       │
     │                   │ <─────────────────────│
     │                   │                       │
     │  4. 상세 페이지    │                       │
     │ <─────────────────│                       │
     │                   │                       │
```

---

## 4. 관리자 흐름 (Admin)

### 4.1 리소스 등록

```
┌──────────┐     ┌────────────────┐     ┌─────────────────┐
│  Browser │     │ {business}-web │     │ {business}-api  │
└────┬─────┘     └───────┬────────┘     └────────┬────────┘
     │                   │                       │
     │  1. /admin/       │                       │
     │     resources/new │                       │
     │ ─────────────────>│                       │
     │                   │                       │
     │  2. 등록 폼 표시   │                       │
     │ <─────────────────│                       │
     │                   │                       │
     │  3. 폼 데이터 제출 │                       │
     │ ─────────────────>│                       │
     │                   │                       │
     │                   │  4. POST /{business}/ │
     │                   │     admin/resources   │
     │                   │ ─────────────────────>│
     │                   │                       │
     │                   │  5. 생성 결과         │
     │                   │ <─────────────────────│
     │                   │                       │
     │  6. 성공 메시지 +  │                       │
     │     리다이렉트     │                       │
     │ <─────────────────│                       │
     │                   │                       │
```

### 4.2 리소스 수정

```
┌──────────┐     ┌────────────────┐     ┌─────────────────┐
│  Browser │     │ {business}-web │     │ {business}-api  │
└────┬─────┘     └───────┬────────┘     └────────┬────────┘
     │                   │                       │
     │  1. /admin/       │                       │
     │     resources/{id}│                       │
     │ ─────────────────>│                       │
     │                   │                       │
     │                   │  2. GET (현재 데이터) │
     │                   │ ─────────────────────>│
     │                   │                       │
     │                   │  3. 현재 데이터       │
     │                   │ <─────────────────────│
     │                   │                       │
     │  4. 수정 폼 표시   │                       │
     │ <─────────────────│                       │
     │                   │                       │
     │  5. 수정 데이터    │                       │
     │ ─────────────────>│                       │
     │                   │                       │
     │                   │  6. PUT /{business}/  │
     │                   │     admin/resources/  │
     │                   │     {id}              │
     │                   │ ─────────────────────>│
     │                   │                       │
     │                   │  7. 수정 결과         │
     │                   │ <─────────────────────│
     │                   │                       │
     │  8. 성공 메시지    │                       │
     │ <─────────────────│                       │
     │                   │                       │
```

### 4.3 상태 변경

```
┌──────────┐     ┌────────────────┐     ┌─────────────────┐
│  Browser │     │ {business}-web │     │ {business}-api  │
└────┬─────┘     └───────┬────────┘     └────────┬────────┘
     │                   │                       │
     │  1. 상태 변경     │                       │
     │     버튼 클릭     │                       │
     │ ─────────────────>│                       │
     │                   │                       │
     │                   │  2. PATCH /{business}/│
     │                   │     admin/resources/  │
     │                   │     {id}/status       │
     │                   │ ─────────────────────>│
     │                   │                       │
     │                   │  3. 상태 변경 결과    │
     │                   │ <─────────────────────│
     │                   │                       │
     │  4. UI 업데이트    │                       │
     │ <─────────────────│                       │
     │                   │                       │
```

---

## 5. 에러 처리 흐름

### 5.1 인증 에러 (401)

```
┌──────────┐     ┌────────────────┐     ┌─────────────────┐
│  Browser │     │ {business}-web │     │ {business}-api  │
└────┬─────┘     └───────┬────────┘     └────────┬────────┘
     │                   │                       │
     │  1. API 요청      │                       │
     │ ─────────────────>│                       │
     │                   │                       │
     │                   │  2. API 호출          │
     │                   │ ─────────────────────>│
     │                   │                       │
     │                   │  3. 401 Unauthorized  │
     │                   │ <─────────────────────│
     │                   │                       │
     │  4. 로그인 페이지  │                       │
     │     리다이렉트     │                       │
     │ <─────────────────│                       │
     │                   │                       │
```

### 5.2 권한 에러 (403)

```
┌──────────┐     ┌────────────────┐     ┌─────────────────┐
│  Browser │     │ {business}-web │     │ {business}-api  │
└────┬─────┘     └───────┬────────┘     └────────┬────────┘
     │                   │                       │
     │  1. Admin 요청    │                       │
     │ ─────────────────>│                       │
     │                   │                       │
     │                   │  2. API 호출          │
     │                   │ ─────────────────────>│
     │                   │                       │
     │                   │  3. 403 Forbidden     │
     │                   │ <─────────────────────│
     │                   │                       │
     │  4. 권한 없음     │                       │
     │     메시지 표시   │                       │
     │ <─────────────────│                       │
     │                   │                       │
```

---

## 6. 참조 문서

- docs/architecture/business-web-template.md
- docs/services/{business}/web-rules.md
- docs/services/{business}/openapi.yaml
- CLAUDE.md §16 Business Web Template Rules

---

*이 문서는 {business}-web의 서비스 흐름을 정의합니다.*
