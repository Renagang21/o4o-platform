ë‹¤ìŒì€ ìš”ì²­í•˜ì‹  ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ë§ˆí¬ë‹¤ìš´ `.md` í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•œ ì •ì‹ ë¬¸ì„œì…ë‹ˆë‹¤.

---

````markdown
# yaksa.site ë°°í¬ êµ¬ì„± ì •ë¦¬ ë¬¸ì„œ

ì‘ì„±ì¼: 2025-05-25  
ì‘ì„±ì: yaksa.site ìš´ì˜ì

---

## âœ… ì‹œìŠ¤í…œ ê°œìš”

| í•­ëª©           | ë‚´ìš© |
|----------------|------|
| ì„œë²„           | AWS Lightsail, Ubuntu 20.04 |
| ë„ë©”ì¸         | `yaksa.site` |
| ì¸ì¦ì„œ         | Let's Encrypt (certbotìœ¼ë¡œ ë°œê¸‰ ì™„ë£Œ) |
| ì„œë¹„ìŠ¤ í¬íŠ¸    | 443 (HTTPS) |
| ì• í”Œë¦¬ì¼€ì´ì…˜   | React + Vite (`serve` ì‚¬ìš©) |
| í”„ë¡œì„¸ìŠ¤ ë§¤ë‹ˆì € | PM2 |
| í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ | `vite build` ê²°ê³¼ë¬¼ì„ `dist/` í´ë”ì— ì €ì¥ |
| Nginx ì—­í•      | HTTPS ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ (localhost:3000ìœ¼ë¡œ í¬ì›Œë”©) |

---

## âœ… í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```bash
/home/ubuntu/o4o-platform/services/yaksa-main-site/
â”œâ”€â”€ dist/                 # React ì •ì  ë¹Œë“œ ê²°ê³¼
â”œâ”€â”€ serve-start.sh        # npx serve ì‹¤í–‰ìš© ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â””â”€â”€ ...
````

---

## âœ… PM2 ì‹¤í–‰ êµ¬ì„±

```bash
pm2 start ./serve-start.sh --name yaksa-site
pm2 save
pm2 startup systemd
```

`serve-start.sh` ë‚´ìš©:

```bash
#!/bin/bash
npx serve -s dist -l 3000
```

> PM2 + ESM ì¡°í•©ìœ¼ë¡œ ì¸í•´ `ERR_REQUIRE_ESM` ì˜¤ë¥˜ê°€ ë‹¤ìˆ˜ ë°œìƒí•¨.

---

## âœ… Nginx ì„¤ì • (/etc/nginx/sites-available/yaksa.site)

```nginx
server {
    listen 443 ssl;
    server_name yaksa.site www.yaksa.site;

    ssl_certificate /etc/letsencrypt/live/yaksa.site/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yaksa.site/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

ì ìš© ëª…ë ¹:

```bash
sudo ln -s /etc/nginx/sites-available/yaksa.site /etc/nginx/sites-enabled/yaksa.site
sudo nginx -t
sudo systemctl reload nginx
```

---

## â— í˜„ì¬ ë¬¸ì œ ìš”ì•½

* `curl -I http://localhost:3000` â†’ **ì •ìƒ (200 OK)**
* `curl -I https://yaksa.site` â†’ **500 Internal Server Error**
* Nginx ì„¤ì •ì€ ì •ìƒì´ë‚˜, ë‚´ë¶€ ì•±(`serve`)ì´ ìš”ì²­ ì²˜ë¦¬ ì‹¤íŒ¨
* PM2 ë¡œê·¸ì—ì„œ `ERR_REQUIRE_ESM` ì˜¤ë¥˜ ì§€ì† ë°œìƒ
* ë¹Œë“œëŠ” ì™„ë£Œë˜ì–´ `dist/index.html` ì¡´ì¬
* `serve`ë¥¼ ì§ì ‘ ì‹¤í–‰í•˜ê±°ë‚˜ systemdë¡œ ëŒ€ì²´ í•„ìš” ê°€ëŠ¥ì„± ìˆìŒ

---

## ğŸ” ì‘ì—… ì´ë ¥ ìš”ì•½

* Nginx `yaksa.site` ì„¤ì • proxy\_passë¡œ êµ¬ì„± ì™„ë£Œ
* `/etc/nginx/sites-enabled/default` ì¤‘ë³µ ì„¤ì • ì œê±°
* PM2 ì‹¤í–‰/ì‚­ì œ/ì¬ë“±ë¡/ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ë°©ì‹ ëª¨ë‘ ì‹œë„
* ì¸ì¦ì„œ ìœ„ì¹˜ í™•ì¸ ë° nginx SSL êµ¬ì„± í…ŒìŠ¤íŠ¸ ì™„ë£Œ
* nginx -T ê²°ê³¼ ê¸°ì¤€ ì„¤ì • ì ìš© ì •ìƒ í™•ì¸ë¨

---

## ğŸ“Œ ë‹¤ìŒ ìš”ì²­ì„ ìœ„í•œ ì°¸ê³  ì œì•ˆ

| ì œì•ˆ ë°©ì•ˆ         | ì„¤ëª…                                                     |
| ------------- | ------------------------------------------------------ |
| PM2 ë¯¸ì‚¬ìš©       | `serve -s dist -l 3000`ì„ systemd ë˜ëŠ” background ì‹¤í–‰ìœ¼ë¡œ ëŒ€ì²´ |
| ì •ì  íŒŒì¼ ì„œë¹™      | Nginxì—ì„œ ì§ì ‘ `dist/`ë¥¼ `root`ë¡œ ì„œë¹™ (`try_files` í¬í•¨)        |
| React ì•± ë¹Œë“œ ì ê²€ | index.html ë° ê²½ë¡œ ì˜¤ë¥˜ ê°€ëŠ¥ì„± í™•ì¸ í•„ìš”                           |
| Vite ì„¤ì • ì ê²€    | base ê²½ë¡œ ë° asset ê²½ë¡œ í™•ì¸ ê¶Œì¥                               |

---

```

---

í•„ìš”í•˜ì‹œë©´ ì´ ë¬¸ì„œë¥¼ `.md` íŒŒì¼ë¡œ ì €ì¥í•´ GitHubì— ë„£ê±°ë‚˜, ë‹¤ë¥¸ ê°œë°œìì—ê²Œ ê·¸ëŒ€ë¡œ ì „ë‹¬í•˜ì‹œë©´ ë©ë‹ˆë‹¤.  
ë‹¤ë¥¸ í¬ë§·ì´ë‚˜ ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•˜ë©´ ë§ì”€ë§Œ ì£¼ì„¸ìš”.
```
