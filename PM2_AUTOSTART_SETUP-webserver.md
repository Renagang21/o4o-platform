# PM2 ìë™ì‹œì‘ ì„¤ì • ë³´ê³ ì„œ - Webserver
ì‘ì„±ì¼: 2025-08-18
ì„œë²„: o4o-webserver

## ğŸ“Œ Phase 5.3 ì‘ì—… ê²°ê³¼

### âœ… ì™„ë£Œëœ ì‘ì—…

1. **PM2 í”„ë¡œì„¸ìŠ¤ ì§ì ‘ ì‹¤í–‰**
   - ecosystem.config.webserver.cjs ìŠ¤í¬ë¦½íŠ¸ ëŒ€ì‹  ì§ì ‘ ëª…ë ¹ ì‚¬ìš©
   - o4o-webserver: í¬íŠ¸ 3000ì—ì„œ ì‹¤í–‰ ì¤‘
   - o4o-admin: í¬íŠ¸ 3001ì—ì„œ ì‹¤í–‰ ì¤‘

2. **PM2 systemd ì„¤ì •**
   - `pm2 startup systemd` ëª…ë ¹ ì‹¤í–‰ ì™„ë£Œ
   - systemd ì„œë¹„ìŠ¤ íŒŒì¼ ìƒì„±: `/etc/systemd/system/pm2-ubuntu.service`
   - PM2 ê²½ë¡œ ìˆ˜ì •: `/usr/bin/pm2`ë¡œ ë³€ê²½

3. **í”„ë¡œì„¸ìŠ¤ ì €ì¥**
   - `pm2 save` ëª…ë ¹ìœ¼ë¡œ í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ì €ì¥
   - ì €ì¥ ìœ„ì¹˜: `/home/ubuntu/.pm2/dump.pm2`

### âš ï¸ ë¯¸í•´ê²° ì´ìŠˆ

1. **systemd ì„œë¹„ìŠ¤ ì‹œì‘ ì‹¤íŒ¨**
   - ì—ëŸ¬: `Failed with result 'protocol'`
   - ì›ì¸: PM2ê°€ forking ëª¨ë“œì—ì„œ PID íŒŒì¼ì„ ì œëŒ€ë¡œ ìƒì„±í•˜ì§€ ëª»í•¨
   - systemdê°€ ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ ì¶”ì í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œ

### ğŸ”§ í˜„ì¬ ìƒíƒœ

```bash
# PM2 í”„ë¡œì„¸ìŠ¤ ìƒíƒœ
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name             â”‚ mode     â”‚ pid    â”‚ status  â”‚ â†º    â”‚ cpu       â”‚ mem      â”‚ uptime   â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ o4o-webserver    â”‚ fork     â”‚ 2296876â”‚ online  â”‚ 0    â”‚ 0%        â”‚ 95.0mb   â”‚ ì‹¤í–‰ ì¤‘  â”‚
â”‚ 1  â”‚ o4o-admin        â”‚ fork     â”‚ 2296988â”‚ online  â”‚ 0    â”‚ 0%        â”‚ 95.0mb   â”‚ ì‹¤í–‰ ì¤‘  â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ ìˆ˜ë™ ì‹œì‘ ëª…ë ¹ì–´

ì‹œìŠ¤í…œ ì¬ë¶€íŒ… í›„ ìˆ˜ë™ìœ¼ë¡œ PM2 í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤:

```bash
# PM2 í”„ë¡œì„¸ìŠ¤ ì‹œì‘
pm2 start /usr/bin/serve --name "o4o-webserver" -- -s apps/main-site/dist -l 3000
pm2 start /usr/bin/serve --name "o4o-admin" -- -s apps/admin-dashboard/dist -l 3001

# í”„ë¡œì„¸ìŠ¤ ì €ì¥
pm2 save
```

### ğŸš¨ ê¶Œì¥ì‚¬í•­

1. **ëŒ€ì•ˆ 1: PM2 ëŒ€ì‹  systemd ì§ì ‘ ì‚¬ìš©**
   - PM2 ì—†ì´ systemd ì„œë¹„ìŠ¤ë¡œ ì§ì ‘ serve ì‹¤í–‰
   - ë” ì•ˆì •ì ì¸ ìë™ì‹œì‘ ë³´ì¥

2. **ëŒ€ì•ˆ 2: PM2 simple ëª¨ë“œ ì‚¬ìš©**
   - forking ëŒ€ì‹  cluster ëª¨ë“œ ì‚¬ìš© ê²€í† 
   - systemdì™€ì˜ í˜¸í™˜ì„± ê°œì„ 

3. **ëŒ€ì•ˆ 3: ìˆ˜ë™ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±**
   - `/etc/rc.local` ë˜ëŠ” cronì˜ `@reboot` ì‚¬ìš©
   - PM2 ëŒ€ì‹  ì§ì ‘ í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬

### ğŸ“Š ìš”ì•½

- **ì„±ê³µ**: PM2 í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ ë° ì €ì¥ âœ…
- **ë¶€ë¶„ ì„±ê³µ**: systemd ì„œë¹„ìŠ¤ ìƒì„± (í™œì„±í™” ì‹¤íŒ¨) âš ï¸
- **ì‹¤íŒ¨**: ìë™ì‹œì‘ ì„¤ì • ì™„ë£Œ âŒ

í˜„ì¬ ì›¹ì„œë²„ëŠ” ì •ìƒ ì‘ë™ ì¤‘ì´ë‚˜, ì‹œìŠ¤í…œ ì¬ë¶€íŒ… ì‹œ ìë™ì‹œì‘ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ìˆ˜ë™ìœ¼ë¡œ PM2 í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.

## íŒŒì¼ ë³€ê²½ì‚¬í•­
- ìƒì„±: `/home/ubuntu/o4o-platform/ecosystem.config.webserver.cjs` (ì‚¬ìš© ì•ˆ í•¨)
- ìˆ˜ì •: `/etc/systemd/system/pm2-ubuntu.service` (PM2 ê²½ë¡œ ìˆ˜ì •)
- ìƒì„±: ë³¸ ë³´ê³ ì„œ íŒŒì¼